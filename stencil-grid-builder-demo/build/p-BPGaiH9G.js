import{c as t,g as s,u as i,d as n,a as o}from"./p-Dn6kA53k.js";class e{constructor(){this.observer=null;this.observedElements=new Map;this.initialize()}initialize(){this.observer=new IntersectionObserver((t=>{t.forEach((t=>{const s=t.target.id;const i=this.observedElements.get(s);if(i){i(t.isIntersecting)}}))}),{rootMargin:"200px",threshold:[0,.01]})}observe(t,s,i){if(!this.observer||!t){return}this.observedElements.set(s,i);this.observer.observe(t);const n=t.getBoundingClientRect();const o=window.innerHeight||document.documentElement.clientHeight;const e=window.innerWidth||document.documentElement.clientWidth;const c=n.top<o+200&&n.bottom>-200&&n.left<e+200&&n.right>-200;if(c){i(true)}}unobserve(t,s){if(!this.observer||!t){return}this.observedElements.delete(s);this.observer.unobserve(t)}destroy(){if(this.observer){this.observer.disconnect();this.observer=null}this.observedElements.clear()}}const c=new e;const d=t("undo-redo-commands");class h{constructor(t,s,i,n,o,e,c,d,h,r){this.itemId=t;this.sourceCanvasId=s;this.targetCanvasId=i;this.sourcePosition=Object.assign({},n);this.targetPosition=Object.assign({},o);this.sourceIndex=e;this.sourceZIndex=c;this.targetZIndex=d;this.sourceSize=h?Object.assign({},h):undefined;this.targetSize=r?Object.assign({},r):undefined}undo(){d.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let t=s.canvases[this.targetCanvasId];let i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){for(const n in s.canvases){const o=s.canvases[n];i=o.items.find((t=>t.id===this.itemId));if(i){t=o;break}}}if(!i||!t){console.warn("  âŒ Item or canvas not found, aborting undo");return}d.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.sourceCanvasId;i.layouts.desktop.x=this.sourcePosition.x;i.layouts.desktop.y=this.sourcePosition.y;i.zIndex=this.sourceZIndex;d.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.sourceSize){i.layouts.desktop.width=this.sourceSize.width;i.layouts.desktop.height=this.sourceSize.height}const n=s.canvases[this.sourceCanvasId];if(!n){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=n.items.length){n.items.splice(this.sourceIndex,0,i)}else{n.items.push(i)}s.canvases=Object.assign({},s.canvases);const o=document.getElementById(this.itemId);if(o){d.log("  ðŸŽ¨ Clearing inline transform style");o.style.transform=""}d.log("  âœ… Undo complete")}redo(){d.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const t=s.canvases[this.sourceCanvasId];const i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){console.warn("  âŒ Item not found, aborting redo");return}d.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.targetCanvasId;i.layouts.desktop.x=this.targetPosition.x;i.layouts.desktop.y=this.targetPosition.y;i.zIndex=this.targetZIndex;d.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.targetSize){i.layouts.desktop.width=this.targetSize.width;i.layouts.desktop.height=this.targetSize.height}const n=s.canvases[this.targetCanvasId];if(!n){console.warn("  âŒ Target canvas not found, aborting redo");return}n.items.push(i);s.canvases=Object.assign({},s.canvases);const o=document.getElementById(this.itemId);if(o){d.log("  ðŸŽ¨ Clearing inline transform style");o.style.transform=""}d.log("  âœ… Redo complete")}}class r{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));n(t)}redo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}}class a{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}redo(){const t=this.itemsData.map((t=>t.id));n(t)}}class u{constructor(t){this.updates=t.map((({itemId:t,canvasId:i,updates:n})=>{const o=s.canvases[i];const e=o===null||o===void 0?void 0:o.items.find((s=>s.id===t));if(!e){return null}return{itemId:t,canvasId:i,oldItem:JSON.parse(JSON.stringify(e)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},e),n)))}})).filter(Boolean)}undo(){const t=this.updates.map((({itemId:t,canvasId:s,oldItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}redo(){const t=this.updates.map((({itemId:t,canvasId:s,newItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}}const l=t("undo-redo");const f=50;class m{constructor(){this.commandHistory=[];this.historyPosition=-1;const{state:t,dispose:s}=o({canUndo:false,canRedo:false});this.state=t;this.dispose=s}updateButtonStates(){this.state.canUndo=this.historyPosition>=0;this.state.canRedo=this.historyPosition<this.commandHistory.length-1}push(t){l.log("âž• PUSH: Adding command to history:",t.description||t);this.commandHistory.splice(this.historyPosition+1);this.commandHistory.push(t);if(this.commandHistory.length>f){this.commandHistory.shift()}else{this.historyPosition++}l.log("  History position now:",this.historyPosition,", Total commands:",this.commandHistory.length);this.updateButtonStates()}undo(){if(this.historyPosition<0){return}const t=this.commandHistory[this.historyPosition];l.log("ðŸ”™ UNDO: Executing command at position",this.historyPosition,":",t);l.log("  Command description:",t.description);t.undo();this.historyPosition--;l.log("  New position after undo:",this.historyPosition);this.updateButtonStates()}redo(){if(this.historyPosition>=this.commandHistory.length-1){return}this.historyPosition++;const t=this.commandHistory[this.historyPosition];t.redo();this.updateButtonStates()}canUndo(){return this.historyPosition>=0}canRedo(){return this.historyPosition<this.commandHistory.length-1}clearHistory(){this.commandHistory.length=0;this.historyPosition=-1;this.updateButtonStates()}}const v=new m;const I=v.state;const p=t=>v.push(t);const O=50;function b(t,s=O){var i;const n=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;return n<=s}function j(t,s=O){var i,n,o,e;const c=t.defaultSize.width;const d=t.defaultSize.height;const h=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;const r=((n=t.maxSize)===null||n===void 0?void 0:n.width)||Infinity;let a=c;let u=d;let l=false;if(a>s){a=s;l=true}if(a<h){a=h}if(a>r){a=r}const f=((o=t.minSize)===null||o===void 0?void 0:o.height)||0;const m=((e=t.maxSize)===null||e===void 0?void 0:e.height)||Infinity;if(u<f){u=f}if(u>m){u=m}return{width:a,height:u,wasAdjusted:l}}function g(t,s,i,n,o=O){let e=t;let c=s;let d=false;if(e<0){e=0;d=true}if(e+i>o){e=o-i;d=true}if(c<0){c=0;d=true}e=Math.max(0,e);c=Math.max(0,c);return{x:e,y:c,width:i,height:n,positionAdjusted:d,sizeAdjusted:false}}function w(t,s,i,n=O){var o;if(!b(t,n)){console.warn(`Component "${t.name}" minSize (${(o=t.minSize)===null||o===void 0?void 0:o.width}) `+`exceeds canvas width (${n}). Placement rejected.`);return null}const e=j(t,n);const c=g(s,i,e.width,e.height,n);return Object.assign(Object.assign({},c),{sizeAdjusted:e.wasAdjusted})}export{u as B,O as C,h as M,m as U,e as V,w as a,a as b,g as c,r as d,p,I as u,c as v};
//# sourceMappingURL=p-BPGaiH9G.js.map