{"version":3,"file":"component-palette.entry.esm.js","sources":["src/components/component-palette/component-palette.scss?tag=component-palette","src/components/component-palette/component-palette.tsx"],"sourcesContent":["/**\n * Component Palette Styles\n * =========================\n *\n * Styles for component-palette component with draggable items and drag clone.\n */\n\n/* Component Palette */\n.palette {\n  width: 250px;\n  padding: 20px;\n  border-right: 1px solid #ddd;\n  background: white;\n  overflow-y: visible; /* Allow scrolling with parent container */\n}\n\n.palette h2 {\n  margin-bottom: 20px;\n  color: #333;\n  font-size: 18px;\n}\n\n/* Chromeless Mode - for embedding with custom structure */\n.palette-chromeless {\n  /* Remove default padding/border if you want minimal styling */\n  /* Consumers can override these via their own CSS if needed */\n\n  /* Remove top padding when there's no header */\n  padding-top: 10px;\n}\n\n.palette-empty {\n  color: #999;\n  font-size: 13px;\n  font-style: italic;\n}\n\n.palette-item {\n  margin-bottom: 10px;\n  cursor: move;\n  user-select: none;\n  touch-action: none; /* Enable touch dragging from palette on mobile/tablet */\n\n  /* Default styling for components without renderPaletteItem */\n  &:not(:has(> div)) {\n    padding: 15px;\n    border-radius: 4px;\n    background: #4a90e2;\n    color: white;\n    font-weight: 500;\n    text-align: center;\n    transition: transform 0.2s, box-shadow 0.2s;\n  }\n}\n\n.palette-item:hover {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 10%);\n  transform: translateY(-2px);\n}\n\n.palette-item.dragging-from-palette {\n  opacity: 0.5;\n}\n\n/* Drag Clone - only positioning, no visual styling */\n.dragging-clone {\n  position: fixed;\n  z-index: 10000;\n  pointer-events: none;\n}\n","/**\n * Component Palette Component (Library Version)\n * ===============================================\n *\n * Draggable component library providing visual component selection and drag-and-drop\n * functionality for adding new items to canvases.\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Hardcoded componentTemplates import\n * - Undo/redo UI controls (will be plugin/UI override)\n * - Complex/simple categorization (consumer can provide via props)\n *\n * **Library-specific features**:\n * - Renders from ComponentDefinition[] prop\n * - Clean component list without hardcoded data\n * - Fully customizable via props\n * - Chromeless mode for flexible embedding\n *\n * ## Component-Driven Design\n *\n * **Standard mode with header**:\n * ```typescript\n * <component-palette components={componentDefinitions} />\n * ```\n *\n * **Chromeless mode (no header)**:\n * ```typescript\n * <component-palette\n * components={componentDefinitions}\n * showHeader={false}\n * />\n * ```\n *\n * **Consumer provides**:\n * - Component types (via ComponentDefinition[])\n * - Icons, names, default sizes\n * - All visual content\n * - Optional: Header visibility preference\n *\n * **Library provides**:\n * - Drag initiation infrastructure\n * - Visual drag clone\n * - Cursor-centered positioning\n * - interact.js integration\n * - Flexible header display (chromeless mode)\n *\n * ## Drag Clone Strategy\n *\n * **Why create clone**:\n * - Original palette item stays in place\n * - Visual feedback at correct size\n * - Cursor centered on component (UX polish)\n * - Doesn't interfere with drop detection\n *\n * **Clone sizing**:\n * ```typescript\n * // Uses ComponentDefinition.defaultSize (or fallback 10Ã—6)\n * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n * const heightPx = gridToPixelsY(defaultSize.height);\n *\n * // Center cursor in clone\n * clone.style.left = event.clientX - halfWidth + 'px';\n * clone.style.top = event.clientY - halfHeight + 'px';\n * ```\n *\n * **Why half dimensions**:\n * - Centers cursor in dragged element\n * - Better visual alignment with drop target\n * - Matches user expectations from other tools\n *\n * ## Data Transfer Pattern\n *\n * **Component type stored in**:\n * - `data-component-type` attribute on palette item\n * - Read in `start` event: `event.target.getAttribute('data-component-type')`\n * - Canvas retrieves from dropzone event\n *\n * **Why data attribute**:\n * - Standard HTML pattern\n * - Accessible in event handlers\n * - No global state needed\n * - Works with interact.js events\n *\n * ## Performance Characteristics\n *\n * **Drag clone creation**: ~1-2ms (DOM creation + styling)\n * **Drag move**: <1ms (style updates only, no layout)\n * **Drag end**: <1ms (remove clone)\n * **Re-renders**: Only on components prop changes\n *\n * **Optimization**: Drag clone uses `position: fixed` + `pointer-events: none`\n * to avoid triggering layout recalculations during drag.\n * @module component-palette\n */\n\nimport { Component, h, Prop, State, Watch, Element } from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\n\n// Utility imports\nimport { gridToPixelsX, gridToPixelsY } from \"../../utils/grid-calculations\";\n\n/**\n * ComponentPalette Component\n * ===========================\n *\n * Library component providing draggable component palette UI.\n *\n * **Tag**: `<component-palette>`\n * **Shadow DOM**: Disabled (for consistency with other components)\n * **Reactivity**: Re-renders when components prop changes\n *\n * ## Usage Patterns\n *\n * **Pattern 1: Default (inside grid-builder)**\n * ```typescript\n * // Palette automatically rendered by grid-builder\n * <grid-builder components={componentDefinitions} />\n * ```\n *\n * **Pattern 2: Independent placement**\n * ```typescript\n * // Place palette anywhere in your app\n * <div class=\"my-layout\">\n *   <aside class=\"sidebar\">\n *     <component-palette\n *       components={componentDefinitions}\n *       config={gridConfig}\n *     />\n *   </aside>\n *   <main>\n *     <grid-builder\n *       components={componentDefinitions}\n *       config={gridConfig}\n *       uiOverrides={{\n *         ComponentPalette: () => null  // Hide default palette\n *       }}\n *     />\n *   </main>\n * </div>\n * ```\n *\n * **Pattern 3: Custom wrapper component**\n * ```typescript\n * // Wrap in your own component for styling\n * @Component({ tag: 'my-palette-sidebar' })\n * export class MyPaletteSidebar {\n *   @Prop() components: ComponentDefinition[];\n *\n *   render() {\n *     return (\n *       <div class=\"custom-sidebar\">\n *         <h3>Components</h3>\n *         <component-palette components={this.components} />\n *       </div>\n *     );\n *   }\n * }\n * ```\n *\n * ## Key Features\n *\n * - **Self-contained**: Works independently of grid-builder\n * - **Drag/drop ready**: Uses interact.js for drag functionality\n * - **Flexible placement**: Can be rendered anywhere in DOM\n * - **Works across boundaries**: Drag from palette to any canvas-section\n */\n@Component({\n  tag: \"component-palette\",\n  styleUrl: \"component-palette.scss\",\n  shadow: false,\n})\nexport class ComponentPalette {\n  /**\n   * Host element reference\n   *\n   * **Used for**: Scoping querySelectorAll to only palette items in this instance\n   */\n  @Element() hostElement: HTMLElement;\n\n  /**\n   * Component definitions to render in palette\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Source**: Passed from grid-builder component\n   *\n   * **Each definition provides**:\n   * - type: Unique identifier for component\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Size when dropped (for drag clone sizing)\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => <my-header itemId={itemId} config={config} />\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Drag clone sizing (gridToPixelsX/Y calculations)\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Show palette header (title)\n   *\n   * **Optional prop**: Controls whether the \"Components\" header is displayed\n   * **Default**: true (shows header for backward compatibility)\n   *\n   * **Use cases**:\n   * - `showHeader={true}` (default): Standard palette with \"Components\" title\n   * - `showHeader={false}`: Chromeless mode - just the component list\n   *\n   * **Chromeless mode benefits**:\n   * - Embed palette in custom layouts\n   * - Add your own headers/titles\n   * - Integrate into existing UI structures\n   * - More flexible component placement\n   *\n   * **Example - Chromeless with custom wrapper**:\n   * ```typescript\n   * <div class=\"my-custom-sidebar\">\n   * <h3 class=\"my-title\">Available Components</h3>\n   * <p class=\"my-description\">Drag to add</p>\n   * <component-palette\n   * components={componentDefinitions}\n   * showHeader={false}\n   * />\n   * </div>\n   * ```\n   * @default true\n   */\n  @Prop() showHeader?: boolean = true;\n\n  /**\n   * Custom label for this palette instance\n   *\n   * **Optional prop**: Provides a descriptive label for this specific palette\n   * **Default**: \"Component palette\"\n   * **Used for**: ARIA label on toolbar container\n   *\n   * **Use case - Multiple palettes**:\n   * When multiple component palettes exist on the same page (e.g., categorized palettes),\n   * provide unique labels for screen reader users:\n   *\n   * ```typescript\n   * <component-palette\n   * components={contentComponents}\n   * paletteLabel=\"Content components\"\n   * />\n   * <component-palette\n   * components={mediaComponents}\n   * paletteLabel=\"Media components\"\n   * />\n   * <component-palette\n   * components={interactiveComponents}\n   * paletteLabel=\"Interactive components\"\n   * />\n   * ```\n   *\n   * **Accessibility benefit**:\n   * - Screen readers announce: \"Content components, toolbar\"\n   * - Users can navigate between palettes by their distinct labels\n   * - Each palette has unique ARIA IDs to avoid conflicts\n   * @default \"Component palette\"\n   */\n  @Prop() paletteLabel?: string = \"Component palette\";\n\n  /**\n   * Target grid-builder instance ID\n   *\n   * **Optional prop**: Specifies which grid-builder instance should receive click-to-add events\n   * **Default**: undefined (events received by all grid-builder instances)\n   * **Used for**: Multi-instance scenarios with multiple grid-builders on the same page\n   *\n   * **Use case - Multiple grid-builders**:\n   * When multiple grid-builder instances exist on the same page, use this prop\n   * to route palette events to a specific instance:\n   *\n   * ```typescript\n   * // Grid builders with different API keys\n   * <grid-builder api-ref={{ key: 'gridAPI1' }} components={...} />\n   * <grid-builder api-ref={{ key: 'gridAPI2' }} components={...} />\n   *\n   * // Palettes targeting specific builders\n   * <component-palette\n   *   components={components}\n   *   targetGridBuilderId=\"gridAPI1\"\n   * />\n   * <component-palette\n   *   components={components}\n   *   targetGridBuilderId=\"gridAPI2\"\n   * />\n   * ```\n   *\n   * **How it works**:\n   * - Palette includes `targetGridBuilderId` in `palette-item-click` event detail\n   * - Grid-builder filters events by matching against its own instance ID\n   * - If omitted, all grid-builders receive the event (backward compatible)\n   * @default undefined\n   */\n  @Prop() targetGridBuilderId?: string;\n\n  /**\n   * Currently dragging component type\n   *\n   * **Internal state**: Tracks which palette item is being dragged\n   * **Used for**: Adding 'dragging-from-palette' class to the dragged item\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - null: No item is being dragged\n   * - string: The component type of the item being dragged\n   */\n  @State() draggingItemType: string | null = null;\n\n  /**\n   * Unique ID for this palette instance\n   *\n   * **Internal state**: Ensures unique ARIA IDs when multiple palettes exist\n   * **Generated**: Once on component load (timestamp + random)\n   * **Used for**: Creating unique `id` attributes for help text and aria-describedby\n   *\n   * **Why needed**:\n   * - Multiple palettes on same page would create duplicate IDs (invalid HTML)\n   * - Each palette needs unique `palette-help-{id}` for aria-describedby\n   * - Prevents ARIA reference conflicts\n   *\n   * **Example HTML output**:\n   * ```html\n   * <!-- Palette 1 -->\n   * <div role=\"toolbar\" aria-label=\"Content components\">\n   *   <div id=\"palette-help-1234567890\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-1234567890\">...</div>\n   * </div>\n   *\n   * <!-- Palette 2 -->\n   * <div role=\"toolbar\" aria-label=\"Media components\">\n   *   <div id=\"palette-help-0987654321\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-0987654321\">...</div>\n   * </div>\n   * ```\n   */\n  @State() private paletteId: string =\n    `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  /**\n   * Watch for components prop changes\n   *\n   * **When triggered**: Parent passes updated component definitions\n   * **Actions**: Reinitialize drag handlers for new/changed palette items\n   *\n   * **Why needed**:\n   * - Component list may change dynamically (add/remove components)\n   * - New items need drag handlers attached\n   * - More efficient than componentDidUpdate (only runs on prop change)\n   */\n  @Watch(\"components\")\n  handleComponentsChange(\n    newComponents: ComponentDefinition[],\n    oldComponents: ComponentDefinition[],\n  ) {\n    // Skip if components reference hasn't changed\n    if (newComponents === oldComponents) return;\n\n    // Skip if not yet mounted (componentDidLoad will handle initialization)\n    if (!oldComponents) return;\n\n    // Reinitialize palette items with new component list\n    // Use requestAnimationFrame to ensure DOM has updated\n    requestAnimationFrame(() => {\n      this.initializePaletteItems();\n    });\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Config changes affect drag clone sizing\n   *\n   * **Note**: Config stored in closure by initializePaletteItems\n   * Will be used on next drag start, no immediate action needed\n   */\n  @Watch(\"config\")\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Config changes are rare but affect drag clone sizing\n    // No immediate action needed - next drag will use new config\n    // If we want to be explicit, could reinitialize handlers:\n    // requestAnimationFrame(() => this.initializePaletteItems());\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize drag functionality on palette items\n   *\n   * **Why after render**:\n   * - Needs DOM elements to exist\n   * - Queries `.palette-item` elements\n   * - Attaches interact.js drag handlers\n   *\n   * **One-time setup**:\n   * - Only runs once after mount\n   * - Doesn't re-run on state changes\n   * - Drag handlers persist across re-renders\n   */\n  componentDidLoad() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Component did update lifecycle hook\n   *\n   * **Called**: After props change and re-render\n   * **Purpose**: Re-initialize drag handlers if components changed\n   *\n   * **Why needed**:\n   * - New palette items need drag handlers\n   * - Components prop may change dynamically\n   * - Ensures all items are draggable\n   */\n  componentDidUpdate() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Render component template\n   *\n   * **Reactive**: Re-runs when components prop changes\n   * **Pure**: No side effects, only returns JSX\n   *\n   * **Component rendering**:\n   * - Maps over components prop\n   * - Renders each as draggable palette item\n   * - Uses icon and name from definition\n   *\n   * **Data attributes**:\n   * - `data-component-type`: Used by drag handlers to identify component\n   * - `key`: React-style key for list rendering\n   */\n  render() {\n    const paletteClasses = {\n      palette: true,\n      \"palette-chromeless\": !this.showHeader,\n    };\n\n    // Generate unique ID for this palette instance's help text\n    const helpTextId = `palette-help-${this.paletteId}`;\n\n    if (!this.components || this.components.length === 0) {\n      return (\n        <div class={paletteClasses}>\n          {this.showHeader && <h2>Components</h2>}\n          <p class=\"palette-empty\" role=\"status\" aria-live=\"polite\">\n            No components available\n          </p>\n        </div>\n      );\n    }\n\n    return (\n      <div\n        class={paletteClasses}\n        role=\"toolbar\"\n        aria-label={this.paletteLabel}\n        aria-orientation=\"vertical\"\n      >\n        {/* Screen reader help text with unique ID per instance */}\n        <div id={helpTextId} class=\"sr-only\">\n          {this.config?.enableClickToAdd !== false\n            ? \"Click or press Enter/Space to add component to active canvas, or drag to position on any canvas\"\n            : \"Drag component to canvas to add\"}\n        </div>\n\n        {this.showHeader && <h2 id=\"palette-heading\">Components</h2>}\n\n        {this.components.map((component) => {\n          // Class binding with reactive state\n          const itemClasses = {\n            \"palette-item\": true,\n            \"palette-item-custom\": !!component.renderPaletteItem,\n            \"dragging-from-palette\": this.draggingItemType === component.type,\n          };\n\n          // Improved aria-label with interaction methods\n          const ariaLabel =\n            this.config?.enableClickToAdd !== false\n              ? `${component.name} component. Click to add to active canvas or drag to position`\n              : `${component.name} component. Drag to canvas`;\n\n          return (\n            <div\n              class={itemClasses}\n              data-component-type={component.type}\n              key={component.type}\n              role=\"button\"\n              tabindex={0}\n              aria-label={ariaLabel}\n              aria-describedby={helpTextId}\n              aria-pressed={\n                this.draggingItemType === component.type ? \"true\" : \"false\"\n              }\n              onClick={(e) => this.handlePaletteItemClick(e)}\n              onKeyDown={(e) => this.handlePaletteItemKeyDown(e)}\n            >\n              {component.renderPaletteItem\n                ? (() => {\n                    const rendered = component.renderPaletteItem({\n                      componentType: component.type,\n                      name: component.name,\n                      icon: component.icon,\n                    });\n\n                    // If render returns a DOM element (HTMLElement), wrap it in a div\n                    // This handles cases where consumer uses document.createElement()\n                    if (rendered instanceof HTMLElement) {\n                      return (\n                        <div\n                          ref={(el) =>\n                            el &&\n                            !el.hasChildNodes() &&\n                            el.appendChild(rendered)\n                          }\n                        />\n                      );\n                    }\n\n                    // Otherwise return the vNode directly (JSX)\n                    return rendered;\n                  })()\n                : `${component.icon} ${component.name}`}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  /**\n   * Initialize drag functionality for palette items\n   *\n   * **Called from**: componentDidLoad, componentDidUpdate\n   * **Purpose**: Attach interact.js drag handlers to all `.palette-item` elements\n   *\n   * ## Drag Lifecycle\n   *\n   * **Three phases**:\n   * 1. **start**: Create drag clone, store metadata\n   * 2. **move**: Update clone position\n   * 3. **end**: Clean up clone\n   *\n   * ## interact.js Configuration\n   *\n   * **Options**:\n   * - `inertia: false` - No momentum after release (precise control)\n   * - `autoScroll: false` - Manual scroll handling (prevents conflicts)\n   *\n   * **Why these settings**:\n   * - Inertia would interfere with drop detection\n   * - Auto-scroll conflicts with canvas scroll handling\n   * - Simpler, more predictable behavior\n   *\n   * ## Drag Clone Storage Pattern\n   *\n   * **Stores on event.target**:\n   * ```typescript\n   * (event.target as any)._dragClone = dragClone;\n   * (event.target as any)._halfWidth = halfWidth;\n   * (event.target as any)._halfHeight = halfHeight;\n   * ```\n   *\n   * **Why store on target**:\n   * - Available in move/end events\n   * - No closure needed\n   * - Automatic cleanup when element removed\n   * - Per-element isolation (multiple drags)\n   */\n  private initializePaletteItems = () => {\n    // IMPORTANT: Scope to only palette items within THIS component instance\n    // Multiple component-palette instances may exist (Content, Interactive, Media categories)\n    // Using document.querySelectorAll would find ALL palette items, causing\n    // drag handlers from one palette to try accessing component definitions from another\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n\n    paletteItems.forEach((element: HTMLElement) => {\n      // Check if already initialized to prevent duplicate handlers\n      if ((element as any)._dragInitialized) {\n        return;\n      }\n\n      interact(element).draggable({\n        inertia: false,\n        autoScroll: false,\n        listeners: {\n          /**\n           * Drag start event handler\n           *\n           * **Triggered**: User begins dragging palette item\n           * **Purpose**: Create visual drag clone with correct sizing\n           *\n           * ## Operations\n           *\n           * 1. **Add visual feedback**: `.dragging-from-palette` class\n           * 2. **Get component metadata**: Type and definition from components prop\n           * 3. **Calculate component size**: Convert grid units to pixels\n           * 4. **Create drag clone**: Fixed-position element following cursor\n           * 5. **Center cursor**: Offset by half dimensions\n           * 6. **Store references**: Clone and dimensions on event.target\n           *\n           * ## Sizing Strategy\n           *\n           * **Uses ComponentDefinition.defaultSize**:\n           * ```typescript\n           * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n           * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n           * const heightPx = gridToPixelsY(defaultSize.height);\n           * ```\n           *\n           * **Fallback**: 10 units wide Ã— 6 units tall if not specified\n           *\n           * ## Clone Styling\n           *\n           * **Key styles**:\n           * - `position: fixed` - Relative to viewport (follows scroll)\n           * - `pointer-events: none` - Doesn't block drop detection\n           * - `z-index: 10000` - Above all other elements\n           * - `background: rgba(74, 144, 226, 0.9)` - Semi-transparent blue\n           *\n           * ## Cursor Centering\n           *\n           * **Formula**:\n           * ```typescript\n           * left = clientX - halfWidth\n           * top = clientY - halfHeight\n           * ```\n           * @param event - interact.js drag start event\n           */\n          start: (event: any) => {\n            // Get the .palette-item element (in case event.target is a nested child)\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) {\n              console.warn(\"Could not find .palette-item element\");\n              return;\n            }\n\n            // Get component type and find definition\n            const componentType = paletteItem.getAttribute(\n              \"data-component-type\",\n            );\n\n            // Set dragging state (replaces classList.add)\n            this.draggingItemType = componentType;\n\n            // Store original palette item position for snap-back animation\n            const paletteRect = paletteItem.getBoundingClientRect();\n            (paletteItem as any)._originalPosition = {\n              left: paletteRect.left,\n              top: paletteRect.top,\n            };\n            (paletteItem as any)._dropWasValid = false; // Flag to track if drop occurred\n            const definition = this.components.find(\n              (c) => c.type === componentType,\n            );\n\n            if (!definition) {\n              console.warn(\n                `Component definition not found for type: ${componentType}`,\n              );\n              return;\n            }\n\n            // Calculate actual component size from definition (or use default)\n            const defaultSize = definition.defaultSize || {\n              width: 10,\n              height: 6,\n            };\n\n            // Get first available canvas ID from grid-builder API instance for size calculation\n            // Use targetGridBuilderId to access the correct instance (supports multiple grid-builders)\n            const apiKey = this.targetGridBuilderId || 'gridBuilderAPI';\n            const api = (window as any)[apiKey];\n            const state = api?.getState?.();\n            const canvasIds = state?.canvases\n              ? Object.keys(state.canvases)\n              : [];\n            const canvasId = canvasIds.length > 0 ? canvasIds[0] : null;\n\n            // Calculate size - if no canvas exists yet, use fallback calculation\n            let widthPx: number;\n            let heightPx: number;\n\n            if (canvasId) {\n              // Use actual canvas for accurate sizing\n              widthPx = gridToPixelsX(defaultSize.width, canvasId, this.config);\n              heightPx = gridToPixelsY(defaultSize.height, this.config);\n            } else {\n              // Fallback: estimate size based on default grid settings (2% of 1000px = 20px per unit)\n              const estimatedGridSize = 20; // Approximate default grid size\n              widthPx = defaultSize.width * estimatedGridSize;\n              heightPx = defaultSize.height * estimatedGridSize;\n            }\n\n            const halfWidth = widthPx / 2;\n            const halfHeight = heightPx / 2;\n\n            // Create drag clone container with base styling\n            const dragClone = document.createElement(\"div\");\n            dragClone.className = \"dragging-clone\";\n            dragClone.style.position = \"fixed\";\n            dragClone.style.left = event.clientX - halfWidth + \"px\";\n            dragClone.style.top = event.clientY - halfHeight + \"px\";\n            dragClone.style.width = widthPx + \"px\";\n            dragClone.style.height = heightPx + \"px\";\n            dragClone.style.overflow = \"hidden\"; // Clip content to size\n            dragClone.style.pointerEvents = \"none\";\n            dragClone.style.zIndex = \"10000\";\n            dragClone.style.border = \"2px solid rgba(74, 144, 226, 0.5)\";\n            dragClone.style.borderRadius = \"4px\";\n            dragClone.style.boxShadow = \"0 4px 12px rgba(0, 0, 0, 0.2)\";\n            dragClone.style.cursor = \"grabbing\";\n\n            // Render custom drag clone (supports both VNode and HTMLElement)\n            const cloneContent = definition.renderDragClone();\n\n            // Check if it's a real DOM element (from document.createElement)\n            if (cloneContent instanceof HTMLElement) {\n              // Direct DOM element - just append it\n              dragClone.appendChild(cloneContent);\n            } else {\n              // Stencil VNode - extract tag and create element\n              const vNode = cloneContent;\n              const tagName = vNode.$tag$;\n\n              // Create the drag clone element (components are pre-loaded in blog-app.tsx)\n              const contentElement = document.createElement(tagName);\n\n              // Copy any props from vNode to element\n              if (vNode.$attrs$) {\n                Object.keys(vNode.$attrs$).forEach((key) => {\n                  contentElement.setAttribute(key, vNode.$attrs$[key]);\n                });\n              }\n\n              dragClone.appendChild(contentElement);\n            }\n            document.body.appendChild(dragClone);\n\n            // Store clone reference, half dimensions, and default size for move/drop events\n            (paletteItem as any)._dragClone = dragClone;\n            (paletteItem as any)._halfWidth = halfWidth;\n            (paletteItem as any)._halfHeight = halfHeight;\n            (paletteItem as any)._defaultWidth = defaultSize.width;\n            (paletteItem as any)._defaultHeight = defaultSize.height;\n          },\n\n          /**\n           * Drag move event handler\n           *\n           * **Triggered**: Every mousemove while dragging (high frequency)\n           * **Purpose**: Update drag clone position to follow cursor\n           *\n           * ## Performance Optimization\n           *\n           * **Only style updates**: No layout/reflow\n           * ```typescript\n           * dragClone.style.left = event.clientX - halfWidth + 'px';\n           * dragClone.style.top = event.clientY - halfHeight + 'px';\n           * ```\n           *\n           * **Why fast**:\n           * - Changes `left/top` only (no width/height/padding)\n           * - `position: fixed` + `pointer-events: none` avoids reflow\n           * - No DOM queries (uses stored reference)\n           * - Runs at ~60fps even with 100+ items on canvas\n           * @param event - interact.js drag move event\n           */\n          move: (event: any) => {\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const halfWidth = (paletteItem as any)._halfWidth;\n            const halfHeight = (paletteItem as any)._halfHeight;\n            if (dragClone) {\n              dragClone.style.left = event.clientX - halfWidth + \"px\";\n              dragClone.style.top = event.clientY - halfHeight + \"px\";\n            }\n          },\n\n          /**\n           * Drag end event handler\n           *\n           * **Triggered**: User releases mouse button\n           * **Purpose**: Clean up drag clone and visual state\n           *\n           * ## Cleanup Operations\n           *\n           * 1. **Remove visual class**: `.dragging-from-palette`\n           * 2. **Remove drag clone**: `dragClone.remove()` from DOM\n           * 3. **Delete references**: Clean up element properties\n           *\n           * ## Memory Management\n           *\n           * **Deletes stored properties**:\n           * ```typescript\n           * delete (event.target as any)._dragClone;\n           * delete (event.target as any)._halfWidth;\n           * delete (event.target as any)._halfHeight;\n           * ```\n           *\n           * **Why important**:\n           * - Prevents memory leaks\n           * - Allows garbage collection of clone element\n           * - Clean state for next drag\n           * @param event - interact.js drag end event\n           */\n          end: (event: any) => {\n            // Clear dragging state (replaces classList.remove)\n            this.draggingItemType = null;\n\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const dropWasValid = (paletteItem as any)._dropWasValid;\n            const originalPos = (paletteItem as any)._originalPosition;\n\n            if (dragClone) {\n              if (!dropWasValid && originalPos) {\n                // Invalid drop - animate back to palette\n                dragClone.style.transition =\n                  \"all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)\";\n                dragClone.style.left = originalPos.left + \"px\";\n                dragClone.style.top = originalPos.top + \"px\";\n                dragClone.style.opacity = \"0\";\n\n                // Remove after animation completes\n                setTimeout(() => {\n                  dragClone.remove();\n                }, 300);\n              } else {\n                // Valid drop - remove immediately\n                dragClone.remove();\n              }\n\n              // Cleanup\n              delete (paletteItem as any)._dragClone;\n              delete (paletteItem as any)._halfWidth;\n              delete (paletteItem as any)._halfHeight;\n              delete (paletteItem as any)._dropWasValid;\n              delete (paletteItem as any)._originalPosition;\n            }\n          },\n        },\n      });\n\n      // Mark as initialized\n      (element as any)._dragInitialized = true;\n    });\n  };\n\n  /**\n   * Handle palette item click (for click-to-add feature)\n   *\n   * **Triggered**: User clicks on palette item\n   * **Purpose**: Emit event for grid-builder to add component to active canvas\n   *\n   * ## Implementation\n   *\n   * 1. **Check if enabled**: Only proceed if `config.enableClickToAdd !== false`\n   * 2. **Prevent drag conflict**: Don't trigger if currently dragging\n   * 3. **Get component type**: From `data-component-type` attribute\n   * 4. **Dispatch event**: Bubble up to grid-builder\n   *\n   * ## Event Details\n   *\n   * **Event name**: `palette-item-click`\n   * **Event detail**: `{ componentType: string }`\n   * **Bubbles**: true (so grid-builder can listen)\n   * **Composed**: true (crosses shadow DOM boundaries)\n   *\n   * ## Accessibility\n   *\n   * **Keyboard support**: Enter/Space keys also trigger (via handlePaletteItemKeyDown)\n   * **Screen reader**: Uses aria-label to announce action\n   * **Focus**: Palette items are focusable (tabindex=0)\n   *\n   * **Example event listener** (in grid-builder):\n   * ```typescript\n   * @Listen('palette-item-click')\n   * handlePaletteClick(event: CustomEvent<{ componentType: string }>) {\n   * const { componentType } = event.detail;\n   * this.addComponentToActiveCanvas(componentType);\n   * }\n   * ```\n   * @param event - Mouse click event\n   */\n  private handlePaletteItemClick = (event: MouseEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Don't trigger click if currently dragging\n    if (this.draggingItemType) {\n      return;\n    }\n\n    // Get the palette item element (in case event.target is a nested child)\n    const paletteItem = (event.target as HTMLElement).closest(\n      \".palette-item\",\n    ) as HTMLElement;\n    if (!paletteItem) {\n      return;\n    }\n\n    // Get component type from data attribute\n    const componentType = paletteItem.getAttribute(\"data-component-type\");\n    if (!componentType) {\n      console.warn(\"handlePaletteItemClick: Component type not found\");\n      return;\n    }\n\n    // Dispatch event for grid-builder to handle\n    // Include targetGridBuilderId for multi-instance routing\n    const clickEvent = new CustomEvent(\"palette-item-click\", {\n      detail: {\n        componentType,\n        targetGridBuilderId: this.targetGridBuilderId,\n      },\n      bubbles: true,\n      composed: true,\n    });\n    this.hostElement.dispatchEvent(clickEvent);\n  };\n\n  /**\n   * Handle palette item keyboard interaction (for accessibility)\n   *\n   * **Triggered**: User presses key on focused palette item\n   * **Purpose**: Enable keyboard users to add components via Enter/Space\n   *\n   * ## Implementation\n   *\n   * **Supported keys**:\n   * - Enter: Add component (same as click)\n   * - Space: Add component (same as click)\n   *\n   * **Behavior**:\n   * - Prevents default scrolling on Space\n   * - Calls handlePaletteItemClick for consistency\n   *\n   * ## Accessibility Impact\n   *\n   * **Benefits**:\n   * - Keyboard-only users can add components\n   * - Screen reader users can navigate and activate palette items\n   * - Matches standard button behavior (Enter/Space activation)\n   *\n   * **WCAG Compliance**:\n   * - 2.1.1 Keyboard (Level A): All functionality available via keyboard\n   * - 2.1.3 Keyboard (No Exception) (Level AAA): Enhanced keyboard access\n   * @param event - Keyboard event\n   */\n  private handlePaletteItemKeyDown = (event: KeyboardEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Handle Enter and Space keys\n    if (event.key === \"Enter\" || event.key === \" \") {\n      // Prevent default Space behavior (page scroll)\n      event.preventDefault();\n\n      // Trigger the same handler as click\n      this.handlePaletteItemClick(event as any);\n    }\n  };\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component is removed from DOM\n   * **Purpose**: Clean up interact.js instances to prevent memory leaks\n   *\n   * ## Cleanup Process\n   *\n   * 1. **Query all palette items**: Find all elements with `.palette-item` class\n   * 2. **Remove interact.js**: Call `interact(element).unset()` on each\n   * 3. **Clear flags**: Remove `_dragInitialized` marker\n   *\n   * ## Why Important\n   *\n   * **Without cleanup**:\n   * - interact.js event listeners persist after unmount\n   * - Memory leaks accumulate with mount/unmount cycles\n   * - References prevent garbage collection\n   *\n   * **With cleanup**:\n   * - All event listeners removed\n   * - Elements can be garbage collected\n   * - Clean state for future mounts\n   *\n   * ## Pattern Match\n   *\n   * This follows the same cleanup pattern as:\n   * - canvas-section.tsx: Cleans up dropzone interact instance\n   * - grid-item-wrapper.tsx: Cleans up drag/resize handlers\n   */\n  disconnectedCallback() {\n    // Cleanup interact.js on all palette items (scoped to this instance)\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n    paletteItems.forEach((element: HTMLElement) => {\n      if ((element as any)._dragInitialized) {\n        interact(element).unset();\n        delete (element as any)._dragInitialized;\n      }\n    });\n  }\n}\n"],"names":[],"mappings":"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"}