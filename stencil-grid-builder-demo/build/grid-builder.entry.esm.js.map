{"version":3,"file":"grid-builder.entry.esm.js","sources":["src/services/event-manager.ts","src/services/undo-redo.ts","src/components/grid-builder/grid-builder.scss?tag=grid-builder","src/components/grid-builder/grid-builder.tsx"],"sourcesContent":["/**\n * Event Manager Service\n * ======================\n *\n * Simple event emitter for grid builder events. Provides on/off/emit pattern\n * for plugins and API consumers to subscribe to grid builder actions.\n *\n * ## Design Pattern\n *\n * **EventEmitter pattern**:\n * - on(event, callback) - Subscribe to event\n * - off(event, callback) - Unsubscribe from event\n * - emit(event, data) - Fire event to all subscribers\n *\n * **Callback storage**: Map<eventName, Set<callback>>\n * - O(1) subscription/unsubscription\n * - Set prevents duplicate callbacks\n * - Easy cleanup (delete entire event Set)\n *\n * ## Usage Example\n *\n * ```typescript\n * import { eventManager } from './event-manager';\n *\n * // Subscribe\n * const callback = (data) => console.log('Item added:', data);\n * eventManager.on('componentAdded', callback);\n *\n * // Fire event\n * eventManager.emit('componentAdded', { itemId: '123', canvasId: 'canvas1' });\n *\n * // Unsubscribe\n * eventManager.off('componentAdded', callback);\n * ```\n *\n * ## Memory Management\n *\n * **Plugin cleanup**:\n * - Plugins MUST unsubscribe in destroy()\n * - Use same callback reference for on/off\n * - Prevents memory leaks\n *\n * **Internal cleanup**:\n * - Empty event Sets auto-deleted\n * - No memory retention for unused events\n * @module event-manager\n */\n\nimport { EventCallback } from \"../types/api\";\n\n/**\n * EventManager Class\n * ==================\n *\n * Simple event emitter for grid builder events.\n *\n * **Storage structure**:\n * ```typescript\n * Map {\n *   'componentAdded' => Set([callback1, callback2, ...]),\n *   'componentDeleted' => Set([callback3, callback4, ...]),\n *   ...\n * }\n * ```\n *\n * **Why Set instead of Array**:\n * - O(1) lookup for has/delete\n * - Prevents duplicate callbacks\n * - Better performance for large subscriber counts\n */\nexport class EventManager {\n  /**\n   * Event listeners storage\n   *\n   * **Key**: Event name (e.g., 'componentAdded')\n   * **Value**: Set of callback functions\n   *\n   * **Why Map instead of plain object**:\n   * - Better type safety\n   * - No prototype pollution\n   * - Better performance for dynamic keys\n   */\n  private listeners: Map<string, Set<EventCallback>> = new Map();\n\n  /**\n   * Debounce timers for events\n   *\n   * **Key**: Event name\n   * **Value**: setTimeout timer ID\n   *\n   * **Purpose**: Store timers for debounced events\n   */\n  private debounceTimers: Map<string, NodeJS.Timeout> = new Map();\n\n  /**\n   * Debounce delay in milliseconds\n   *\n   * **Default**: 300ms\n   * **Configured by**: grid-builder via setDebounceDelay()\n   */\n  private debounceDelay: number = 300;\n\n  /**\n   * Events that should be debounced\n   *\n   * **Events**: componentDragged, componentResized, stateChanged\n   * **Reason**: Fire on every pixel during drag/resize\n   */\n  private debouncedEvents: Set<string> = new Set([\n    \"componentDragged\",\n    \"componentResized\",\n    \"stateChanged\",\n  ]);\n\n  /**\n   * Subscribe to event\n   *\n   * **Idempotent**: Calling multiple times with same callback does nothing\n   * **Thread-safe**: Uses Set which handles concurrent additions\n   * @param eventName - Event to subscribe to\n   * @param callback - Function called when event fires\n   * @example\n   * ```typescript\n   * eventManager.on('componentAdded', (data) => {\n   *   console.log(`Added ${data.item.type} to ${data.canvasId}`);\n   * });\n   * ```\n   */\n  on<T = any>(eventName: string, callback: EventCallback<T>): void {\n    if (!this.listeners.has(eventName)) {\n      this.listeners.set(eventName, new Set());\n    }\n    this.listeners.get(eventName)!.add(callback as EventCallback);\n  }\n\n  /**\n   * Unsubscribe from event\n   *\n   * **Requirements**:\n   * - Must pass EXACT same callback reference used in on()\n   * - Callback stored as property or bound method\n   *\n   * **Cleanup**: If event has no more listeners, delete the Set\n   * @param eventName - Event to unsubscribe from\n   * @param callback - Exact callback reference used in on()\n   * @example\n   * ```typescript\n   * // ‚úÖ Correct pattern\n   * class MyPlugin {\n   *   private handleAdd = (data) => console.log(data);\n   *\n   *   init(api) {\n   *     eventManager.on('componentAdded', this.handleAdd);\n   *   }\n   *\n   *   destroy() {\n   *     eventManager.off('componentAdded', this.handleAdd);\n   *   }\n   * }\n   * ```\n   */\n  off<T = any>(eventName: string, callback: EventCallback<T>): void {\n    const callbacks = this.listeners.get(eventName);\n    if (callbacks) {\n      callbacks.delete(callback as EventCallback);\n\n      // Cleanup empty event listeners\n      if (callbacks.size === 0) {\n        this.listeners.delete(eventName);\n      }\n    }\n  }\n\n  /**\n   * Fire event to all subscribers\n   *\n   * **Debouncing**: Some events are automatically debounced:\n   * - componentDragged (fires on every pixel)\n   * - componentResized (fires on every pixel)\n   * - stateChanged (fires on every state update)\n   *\n   * **Immediate events** (not debounced):\n   * - componentSelected, componentDeleted, componentAdded, etc.\n   *\n   * **Execution order**: Subscribers called in insertion order\n   * **Error handling**: One callback error doesn't prevent others\n   *\n   * **Performance**: O(n) where n = number of callbacks for this event\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   * @example\n   * ```typescript\n   * // Internal usage (in state-manager.ts)\n   * eventManager.emit('componentAdded', {\n   *   item: newItem,\n   *   canvasId: 'canvas1',\n   *   timestamp: Date.now()\n   * });\n   * ```\n   */\n  emit<T = any>(eventName: string, data: T): void {\n    // Check if this event should be debounced\n    if (this.debouncedEvents.has(eventName)) {\n      this.emitDebounced(eventName, data);\n    } else {\n      this.emitImmediate(eventName, data);\n    }\n  }\n\n  /**\n   * Fire event immediately (no debouncing)\n   *\n   * **Private method**: Called by emit()\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   */\n  private emitImmediate<T = any>(eventName: string, data: T): void {\n    const callbacks = this.listeners.get(eventName);\n    if (callbacks) {\n      callbacks.forEach((callback) => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`Error in event callback for \"${eventName}\":`, error);\n        }\n      });\n    }\n  }\n\n  /**\n   * Fire event with debouncing\n   *\n   * **How it works**:\n   * 1. Clear any existing timer for this event\n   * 2. Set new timer with debounceDelay\n   * 3. When timer fires, call emitImmediate()\n   * 4. If emit() called again before timer fires, restart timer\n   *\n   * **Result**: Event only fires once after activity stops\n   *\n   * **Private method**: Called by emit()\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   */\n  private emitDebounced<T = any>(eventName: string, data: T): void {\n    // Clear existing timer for this event\n    const existingTimer = this.debounceTimers.get(eventName);\n    if (existingTimer) {\n      clearTimeout(existingTimer);\n    }\n\n    // Set new timer\n    const timer = setTimeout(() => {\n      this.emitImmediate(eventName, data);\n      this.debounceTimers.delete(eventName);\n    }, this.debounceDelay);\n\n    this.debounceTimers.set(eventName, timer);\n  }\n\n  /**\n   * Set debounce delay for all debounced events\n   *\n   * **Configurable**: Called by grid-builder with config.eventDebounceDelay\n   * @param delay - Delay in milliseconds\n   * @example\n   * ```typescript\n   * // In grid-builder componentDidLoad\n   * eventManager.setDebounceDelay(config?.eventDebounceDelay || 300);\n   * ```\n   */\n  setDebounceDelay(delay: number): void {\n    this.debounceDelay = delay;\n  }\n\n  /**\n   * Get current debounce delay\n   *\n   * **Use case**: Debugging, testing\n   * @returns Debounce delay in milliseconds\n   */\n  getDebounceDelay(): number {\n    return this.debounceDelay;\n  }\n\n  /**\n   * Remove all listeners for specific event\n   *\n   * **Use case**: Cleanup during component unmount\n   * @param eventName - Event to remove all listeners from\n   * @example\n   * ```typescript\n   * // Clear all componentAdded listeners\n   * eventManager.removeAllListeners('componentAdded');\n   * ```\n   */\n  removeAllListeners(eventName?: string): void {\n    if (eventName) {\n      this.listeners.delete(eventName);\n    } else {\n      this.listeners.clear();\n    }\n  }\n\n  /**\n   * Get listener count for debugging\n   *\n   * **Use case**: Check for memory leaks (too many listeners)\n   * @param eventName - Event to count listeners for\n   * @returns Number of listeners or 0 if event not registered\n   * @example\n   * ```typescript\n   * const count = eventManager.listenerCount('componentAdded');\n   * console.log(`${count} listeners for componentAdded`);\n   * ```\n   */\n  listenerCount(eventName: string): number {\n    return this.listeners.get(eventName)?.size || 0;\n  }\n}\n\n/**\n * Backward Compatibility Layer\n * ==============================\n *\n * Singleton instance export for backward compatibility.\n * Existing code can continue using this while we migrate to instance-based architecture.\n */\n\n// Create singleton instance (for backward compatibility only)\nconst defaultManager = new EventManager();\n\n// Export singleton instance\nexport const eventManager = defaultManager;","/**\n * Undo/Redo Service\n * ==================\n *\n * Command pattern implementation for undo/redo functionality in the grid builder.\n * Provides stack-based history management with keyboard shortcuts and UI state tracking.\n *\n * ## Problem\n *\n * Interactive applications need undo/redo capabilities for:\n * - Recovering from mistakes (accidental delete)\n * - Experimenting with layouts (try different arrangements)\n * - Learning the interface (undo to see what changed)\n * - Building confidence (knowing you can undo)\n *\n * **Without undo/redo**:\n * - Users hesitant to experiment\n * - Mistakes are permanent\n * - No way to review history\n * - Poor user experience\n *\n * ## Solution\n *\n * Implement **Command Pattern** with stack-based history:\n *\n * 1. **Command Interface**: Each undoable action implements undo() and redo()\n * 2. **History Stack**: Array of command objects\n * 3. **Position Pointer**: Tracks current position in history\n * 4. **Bounded History**: Limited to 50 commands to prevent memory bloat\n * 5. **Branching**: New actions after undo discard \"future\" history\n *\n * ## Architecture: Command Pattern\n *\n * **Classic Gang of Four pattern** for undo/redo:\n *\n * **Key Components**:\n * - **Command Interface**: Defines undo() and redo() methods\n * - **Concrete Commands**: AddItemCommand, DeleteItemCommand, MoveItemCommand, ResizeCommand\n * - **Invoker**: undo-redo.ts (this file) manages command execution\n * - **Receiver**: state-manager.ts (receives state mutations)\n *\n * **Flow**:\n * ```\n * User Action ‚Üí Create Command ‚Üí pushCommand() ‚Üí Execute & Store\n * Undo (Ctrl+Z) ‚Üí Get command at position ‚Üí command.undo() ‚Üí Update position\n * Redo (Ctrl+Y) ‚Üí Advance position ‚Üí command.redo() ‚Üí Execute\n * ```\n *\n * **Why Command Pattern**:\n * - ‚úÖ Encapsulates actions as objects\n * - ‚úÖ Enables undo/redo without coupling to specific operations\n * - ‚úÖ Supports macro commands (batch operations)\n * - ‚úÖ Easy to extend with new command types\n * - ‚úÖ History can be serialized/persisted\n *\n * ## History Management\n *\n * **Stack-based with position pointer**:\n * ```\n * commandHistory = [cmd1, cmd2, cmd3, cmd4, cmd5]\n * ‚Üë\n * historyPosition = 2\n * ```\n *\n * **Operations**:\n * - **Push new command**: Discard commands after position, append new command\n * - **Undo**: Execute command.undo() at position, decrement position\n * - **Redo**: Increment position, execute command.redo() at new position\n *\n * **Branching behavior** (discarding future on new action):\n * ```\n * Initial:  [cmd1, cmd2, cmd3, cmd4, cmd5]\n * ‚Üë position = 2\n *\n * Undo 2x:  [cmd1, cmd2, cmd3, cmd4, cmd5]\n * ‚Üë position = 0\n *\n * New cmd:  [cmd1, cmd6]  ‚Üê cmd2-cmd5 discarded!\n * ‚Üë position = 1\n * ```\n *\n * **Why branching (not tree)**:\n * - Simpler mental model for users\n * - No UI complexity for branch navigation\n * - Standard undo/redo UX pattern\n *\n * ## Memory Management\n *\n * **Bounded history** (MAX_HISTORY = 50):\n * - Prevents unbounded memory growth\n * - Removes oldest command when limit reached\n * - 50 commands ‚âà typical user session\n *\n * **Memory per command**:\n * - Command object: ~200-500 bytes\n * - State snapshots: ~1-5 KB (JSON serialized GridItem)\n * - Total for 50 commands: ~50-250 KB (acceptable)\n *\n * **Sliding window approach**:\n * ```\n * When history full:\n * [cmd1, cmd2, ..., cmd50]  ‚Üê At capacity\n * Push cmd51:\n * [cmd2, cmd3, ..., cmd51]  ‚Üê cmd1 removed\n * ```\n *\n * ## State Snapshot Strategy\n *\n * Each command stores **before/after snapshots**:\n * ```typescript\n * class MoveItemCommand implements Command {\n * beforeState = JSON.parse(JSON.stringify(item));  // Deep clone\n * afterState = JSON.parse(JSON.stringify(updatedItem));\n *\n * undo() { restoreState(beforeState); }\n * redo() { restoreState(afterState); }\n * }\n * ```\n *\n * **Deep cloning required because**:\n * - Prevents mutations from affecting snapshots\n * - Ensures independent state copies\n * - Simple and reliable (no reference tracking needed)\n *\n * **Trade-off**:\n * - ‚úÖ Simple implementation\n * - ‚úÖ No reference bugs\n * - ‚ùå Higher memory usage than delta-based\n * - ‚ùå Slower than structural sharing (acceptable for this use case)\n *\n * ## Keyboard Shortcuts\n *\n * Implemented in grid-builder-app.tsx:\n * - **Ctrl+Z** (Cmd+Z on Mac): Undo last command\n * - **Ctrl+Y** (Cmd+Y on Mac): Redo next command\n * - **Ctrl+Shift+Z**: Alternative redo (common in design tools)\n *\n * ## UI Integration\n *\n * **Reactive state for buttons**:\n * ```typescript\n * undoRedoState = {\n * canUndo: boolean,  // Enable/disable undo button\n * canRedo: boolean   // Enable/disable redo button\n * }\n * ```\n *\n * **Updates on**:\n * - New command pushed\n * - Undo executed\n * - Redo executed\n * - History cleared\n *\n * **Button rendering**:\n * ```tsx\n * <button disabled={!undoRedoState.canUndo} onClick={undo}>\n * Undo\n * </button>\n * ```\n *\n * ## Extracting This Pattern\n *\n * To adapt Command pattern for your project:\n *\n * **Minimal implementation**:\n * ```typescript\n * interface Command {\n * undo(): void;\n * redo(): void;\n * }\n *\n * class UndoRedoManager {\n * private history: Command[] = [];\n * private position = -1;\n *\n * push(command: Command) {\n * this.history.splice(this.position + 1);  // Discard future\n * this.history.push(command);\n * this.position++;\n * }\n *\n * undo() {\n * if (this.position >= 0) {\n * this.history[this.position].undo();\n * this.position--;\n * }\n * }\n *\n * redo() {\n * if (this.position < this.history.length - 1) {\n * this.position++;\n * this.history[this.position].redo();\n * }\n * }\n * }\n * ```\n *\n * **Example commands**:\n * ```typescript\n * class AddItemCommand implements Command {\n * constructor(\n * private canvasId: string,\n * private item: GridItem\n * ) {}\n *\n * undo() { removeItemFromCanvas(this.canvasId, this.item.id); }\n * redo() { addItemToCanvas(this.canvasId, this.item); }\n * }\n * ```\n *\n * **For different frameworks**:\n * - React: Use useReducer or Zustand middleware\n * - Vue: Use Pinia plugin or custom composable\n * - Angular: Use NgRx effects or service\n * @module undo-redo\n */\n\nimport { createStore } from \"@stencil/store\";\nimport { createDebugLogger } from \"../utils/debug\";\n\nconst debug = createDebugLogger(\"undo-redo\");\n\n/**\n * Command Interface\n * =================\n *\n * Core abstraction for undoable operations. All commands must implement\n * both undo() and redo() methods to reverse and reapply their effects.\n *\n * **Design principle**: Commands are **self-contained** - they store all\n * data needed to both undo and redo without external dependencies.\n *\n * **Typical implementation**:\n * ```typescript\n * class MyCommand implements Command {\n * private beforeState: any;\n * private afterState: any;\n *\n * constructor(initialState) {\n * this.beforeState = JSON.parse(JSON.stringify(initialState));\n * // ... perform operation ...\n * this.afterState = JSON.parse(JSON.stringify(finalState));\n * }\n *\n * undo() { restoreState(this.beforeState); }\n * redo() { restoreState(this.afterState); }\n * }\n * ```\n *\n * **Why separate undo/redo methods**:\n * - ‚ùå Not: Single execute(reverse: boolean) method\n * - ‚úÖ Yes: Separate undo() and redo() methods\n * - Reason: Clearer intent, easier to implement, matches user mental model\n *\n * **Concrete implementations**:\n * - AddItemCommand: Add/remove grid item\n * - DeleteItemCommand: Remove/restore grid item with index preservation\n * - MoveItemCommand: Update item position (cross-canvas support)\n * - ResizeCommand: Update item dimensions\n * @example\n * ```typescript\n * class DeleteItemCommand implements Command {\n *   constructor(\n *     private canvasId: string,\n *     private item: GridItem,\n *     private itemIndex: number\n *   ) {}\n *\n *   undo() {\n *     // Restore item at original index\n *     const canvas = gridState.canvases[this.canvasId];\n *     canvas.items.splice(this.itemIndex, 0, this.item);\n *     gridState.canvases = { ...gridState.canvases };\n *   }\n *\n *   redo() {\n *     // Remove item again\n *     removeItemFromCanvas(this.canvasId, this.item.id);\n *   }\n * }\n * ```\n */\nexport interface Command {\n  /**\n   * Reverse the effect of this command\n   *\n   * **Idempotent**: Calling undo() multiple times has same effect as once\n   * **Side effects**: May update global state, trigger re-renders\n   * **Error handling**: Should not throw (use try/catch internally)\n   */\n  undo(): void;\n\n  /**\n   * Reapply the effect of this command\n   *\n   * **Idempotent**: Calling redo() multiple times has same effect as once\n   * **Side effects**: May update global state, trigger re-renders\n   * **Error handling**: Should not throw (use try/catch internally)\n   */\n  redo(): void;\n}\n\n/**\n * Undo/Redo State\n * ================\n *\n * Reactive state for UI button enable/disable logic.\n * Components subscribe to this state to update undo/redo button states.\n *\n * **Why reactive**:\n * - Automatic button state updates (no manual DOM manipulation)\n * - Components re-render when canUndo/canRedo changes\n * - Declarative UI logic\n *\n * **Usage in components**:\n * ```tsx\n * import { undoRedoState } from './undo-redo';\n *\n * render() {\n *   return (\n *     <div>\n *       <button\n *         disabled={!undoRedoState.canUndo}\n *         onClick={() => undo()}>\n *         Undo\n *       </button>\n *       <button\n *         disabled={!undoRedoState.canRedo}\n *         onClick={() => redo()}>\n *         Redo\n *       </button>\n *     </div>\n *   );\n * }\n * ```\n */\nexport interface UndoRedoState {\n  /** Whether undo operation is available (historyPosition >= 0) */\n  canUndo: boolean;\n\n  /** Whether redo operation is available (historyPosition < commandHistory.length - 1) */\n  canRedo: boolean;\n}\n\n/**\n * Maximum number of commands in history\n *\n * **Why 50**: Balance between:\n * - ‚úÖ Enough for typical user session\n * - ‚úÖ Reasonable memory usage (~50-250 KB)\n * - ‚ùå Not unlimited (prevents memory bloat)\n *\n * **Behavior when exceeded**: Oldest command removed (sliding window)\n */\nconst MAX_HISTORY = 50;\n\n/**\n * UndoRedoManager Class\n * =====================\n *\n * Instance-based undo/redo management for grid builder.\n * Each grid-builder component can create its own UndoRedoManager instance.\n *\n * ## Architecture\n *\n * **Before (Singleton)**:\n * - Single global history shared by all grid-builder instances\n * - Multiple instances pollute each other's history\n * - Storybook stories contaminate each other\n *\n * **After (Instance-based)**:\n * - Each grid-builder creates its own UndoRedoManager\n * - Isolated history per instance\n * - Multiple grid-builders on same page work independently\n *\n * ## Usage\n *\n * **New code (instance-based)**:\n * ```typescript\n * // In grid-builder component\n * componentWillLoad() {\n *   this.undoRedoManager = new UndoRedoManager();\n *   this.undoRedoState = this.undoRedoManager.state;\n * }\n * ```\n *\n * **Legacy code (backward compatible)**:\n * ```typescript\n * // Still works via singleton export\n * import { undoRedo } from './services/undo-redo';\n * undoRedo.push(new AddItemCommand(...));\n * ```\n *\n * ## Instance State\n *\n * Each instance has:\n * - Independent reactive state (StencilJS store)\n * - Own command history stack\n * - Own history position pointer\n * - Own lifecycle (dispose() cleanup)\n */\nexport class UndoRedoManager {\n  /**\n   * Reactive state for button enable/disable\n   *\n   * **Access pattern**:\n   * ```typescript\n   * const canUndoNow = undoRedoManager.state.canUndo;\n   * ```\n   *\n   * **Updates**: Automatically triggered after each operation\n   */\n  public state: UndoRedoState;\n\n  /**\n   * Cleanup subscriptions (called on component unmount)\n   *\n   * **Usage**:\n   * ```typescript\n   * disconnectedCallback() {\n   *   this.undoRedoManager.dispose();\n   * }\n   * ```\n   */\n  public dispose: () => void;\n\n  /**\n   * Command history stack\n   *\n   * **Structure**: Array of Command objects in chronological order\n   * **Growth**: Appends new commands to end\n   * **Bounded**: Limited to MAX_HISTORY commands (50)\n   * **Branching**: Discards commands after current position on new push\n   */\n  private commandHistory: Command[] = [];\n\n  /**\n   * Current position in command history\n   *\n   * **Range**: -1 (empty history) to commandHistory.length - 1\n   * **Meaning**:\n   * - -1: No commands or all undone\n   * - 0: First command is current state\n   * - N: Command at index N is current state\n   */\n  private historyPosition: number = -1;\n\n  /**\n   * Create new UndoRedoManager instance\n   *\n   * @example\n   * ```typescript\n   * // Empty history (default)\n   * const manager = new UndoRedoManager();\n   * ```\n   */\n  constructor() {\n    // Create StencilJS reactive store\n    const { state, dispose } = createStore<UndoRedoState>({\n      canUndo: false,\n      canRedo: false,\n    });\n\n    this.state = state;\n    this.dispose = dispose;\n  }\n\n  /**\n   * Update reactive state for undo/redo button enablement\n   *\n   * **Called after**:\n   * - push() - New command added\n   * - undo() - Position moved backward\n   * - redo() - Position moved forward\n   * - clearHistory() - History reset\n   *\n   * **Updates**:\n   * - `canUndo`: true if historyPosition >= 0 (commands available to undo)\n   * - `canRedo`: true if historyPosition < commandHistory.length - 1 (commands available to redo)\n   */\n  private updateButtonStates(): void {\n    this.state.canUndo = this.historyPosition >= 0;\n    this.state.canRedo = this.historyPosition < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Push a new command to the history stack\n *\n * **Use cases**:\n * - After drag operation completes\n * - After resize operation completes\n * - After adding new item\n * - After deleting item\n *\n * **Branching behavior** (discards future):\n * ```\n * Before: [cmd1, cmd2, cmd3, cmd4]\n * ‚Üë position = 1 (undid twice)\n *\n * Push cmd5: [cmd1, cmd2, cmd5]\n * ‚Üë position = 2\n *\n * Note: cmd3 and cmd4 discarded!\n * ```\n *\n * **Why discard future**:\n * - Matches user mental model (new action erases \"undone\" history)\n * - Simpler implementation than tree-based history\n * - Standard undo/redo UX pattern\n *\n * **Memory management**:\n * - If history exceeds MAX_HISTORY (50), oldest command removed\n * - Position adjusted to maintain integrity\n *\n * **Operation sequence**:\n * 1. Discard commands after current position (splice)\n * 2. Append new command to history\n * 3. If over limit, remove oldest (shift)\n * 4. Update position pointer\n * 5. Update button states (triggers UI)\n *\n * **Typical usage**:\n * ```typescript\n * // After drag end\n * const command = new MoveItemCommand(item, oldPos, newPos);\n * pushCommand(command);\n * ```\n *\n * **Important**: Command should be fully constructed (with snapshots taken)\n * before being pushed. This function does NOT execute the command - it's\n * assumed the operation already happened.\n * @param command - Fully constructed command with before/after snapshots\n * @example\n * ```typescript\n * // Delete item example\n * handleDelete(itemId: string, canvasId: string) {\n *   const item = getItem(canvasId, itemId);\n *   const index = gridState.canvases[canvasId].items.indexOf(item);\n *\n *   // Perform the delete\n *   removeItemFromCanvas(canvasId, itemId);\n *\n *   // Push command for undo (AFTER operation)\n *   const command = new DeleteItemCommand(canvasId, item, index);\n *   pushCommand(command);\n * }\n * ```\n   * @param command - Fully constructed command with before/after snapshots\n   */\n  push(command: Command): void {\n    debug.log(\n      \"‚ûï PUSH: Adding command to history:\",\n      (command as any).description || command,\n    );\n\n    // Remove any commands after current position\n    this.commandHistory.splice(this.historyPosition + 1);\n\n    // Add new command\n    this.commandHistory.push(command);\n\n    // Limit history size\n    if (this.commandHistory.length > MAX_HISTORY) {\n      this.commandHistory.shift();\n    } else {\n      this.historyPosition++;\n    }\n\n    debug.log(\n      \"  History position now:\",\n      this.historyPosition,\n      \", Total commands:\",\n      this.commandHistory.length,\n    );\n\n    // Update button states\n    this.updateButtonStates();\n  }\n\n  /**\n   * Undo the last command in history\n   *\n   * **Triggered by**:\n   * - Ctrl+Z / Cmd+Z keyboard shortcut\n   * - Undo button click\n   * - Programmatic undo (rare)\n   *\n   * **Operation sequence**:\n   * 1. Check if undo available (historyPosition >= 0)\n   * 2. Get command at current position\n   * 3. Execute command.undo() (reverses operation)\n   * 4. Decrement position pointer\n   * 5. Update button states (triggers UI)\n   *\n   * **Side effects**:\n   * - Mutates global state (via command.undo())\n   * - Triggers component re-renders\n   * - Updates undo/redo button states\n   * - May deselect items (depending on command)\n   *\n   * **Position before/after**:\n   * ```\n   * Before: [cmd1, cmd2, cmd3]\n   * ‚Üë position = 2\n   *\n   * After:  [cmd1, cmd2, cmd3]\n   * ‚Üë position = 1\n   * ```\n   *\n   * **Safety**: No-op if historyPosition < 0 (nothing to undo)\n   *\n   * **Multiple undo**: Can be called repeatedly to undo multiple commands\n   * @example\n   * ```typescript\n   * // Keyboard shortcut handler\n   * window.addEventListener('keydown', (e) => {\n   *   if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n   *     undo();\n   *     e.preventDefault();\n   *   }\n   * });\n   * ```\n   */\n  undo(): void {\n    if (this.historyPosition < 0) {\n      return;\n    }\n\n    const command = this.commandHistory[this.historyPosition];\n    debug.log(\n      \"üîô UNDO: Executing command at position\",\n      this.historyPosition,\n      \":\",\n      command,\n    );\n    debug.log(\"  Command description:\", (command as any).description);\n    command.undo();\n    this.historyPosition--;\n    debug.log(\"  New position after undo:\", this.historyPosition);\n\n    this.updateButtonStates();\n  }\n\n  /**\n   * Redo the next command in history\n   *\n   * **Triggered by**:\n   * - Ctrl+Y / Cmd+Y keyboard shortcut\n   * - Ctrl+Shift+Z / Cmd+Shift+Z (alternative)\n   * - Redo button click\n   * - Programmatic redo (rare)\n   *\n   * **Operation sequence**:\n   * 1. Check if redo available (historyPosition < commandHistory.length - 1)\n   * 2. Increment position pointer\n   * 3. Get command at new position\n   * 4. Execute command.redo() (reapplies operation)\n   * 5. Update button states (triggers UI)\n   *\n   * **Side effects**:\n   * - Mutates global state (via command.redo())\n   * - Triggers component re-renders\n   * - Updates undo/redo button states\n   * - May select items (depending on command)\n   *\n   * **Position before/after**:\n   * ```\n   * Before: [cmd1, cmd2, cmd3]\n   * ‚Üë position = 1\n   *\n   * After:  [cmd1, cmd2, cmd3]\n   * ‚Üë position = 2\n   * ```\n   *\n   * **Safety**: No-op if no commands to redo (position at end)\n   *\n   * **Multiple redo**: Can be called repeatedly to redo multiple commands\n   *\n   * **Redo after new action**: Redo becomes unavailable after new command\n   * pushed (future history discarded)\n   * @example\n   * ```typescript\n   * // Keyboard shortcut handler\n   * window.addEventListener('keydown', (e) => {\n   *   if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n   *     redo();\n   *     e.preventDefault();\n   *   }\n   * });\n   * ```\n   */\n  redo(): void {\n    if (this.historyPosition >= this.commandHistory.length - 1) {\n      return;\n    }\n\n    this.historyPosition++;\n    const command = this.commandHistory[this.historyPosition];\n    command.redo();\n\n    this.updateButtonStates();\n  }\n\n  /**\n   * Check if undo operation is available\n   *\n   * **Use cases**:\n   * - Enabling/disabling undo button\n   * - Showing undo keyboard hint\n   * - Programmatic checks before undo\n   *\n   * **Returns true when**: historyPosition >= 0 (commands in history)\n   * **Returns false when**: historyPosition = -1 (no history or all undone)\n   *\n   * **Note**: Prefer using `undoRedoState.canUndo` in UI components\n   * for automatic reactivity. This function is for imperative checks.\n   * @returns true if undo() can be called, false otherwise\n   * @example\n   * ```typescript\n   * // Imperative check\n   * if (canUndo()) {\n   *   debug.log('Undo available');\n   *   undo();\n   * }\n   *\n   * // Prefer reactive state in UI\n   * <button disabled={!undoRedoState.canUndo}>Undo</button>\n   * ```\n   */\n  canUndo(): boolean {\n    return this.historyPosition >= 0;\n  }\n\n  /**\n   * Check if redo operation is available\n   *\n   * **Use cases**:\n   * - Enabling/disabling redo button\n   * - Showing redo keyboard hint\n   * - Programmatic checks before redo\n   *\n   * **Returns true when**: historyPosition < commandHistory.length - 1\n   * **Returns false when**: At end of history or history empty\n   *\n   * **Becomes false after**: New command pushed (future discarded)\n   *\n   * **Note**: Prefer using `undoRedoState.canRedo` in UI components\n   * for automatic reactivity. This function is for imperative checks.\n   * @returns true if redo() can be called, false otherwise\n   * @example\n   * ```typescript\n   * // Imperative check\n   * if (canRedo()) {\n   *   debug.log('Redo available');\n   *   redo();\n   * }\n   *\n   * // Prefer reactive state in UI\n   * <button disabled={!undoRedoState.canRedo}>Redo</button>\n   * ```\n   */\n  canRedo(): boolean {\n    return this.historyPosition < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Clear all command history\n   *\n   * **Use cases**:\n   * - Application reset\n   * - Loading new project\n   * - Test cleanup\n   * - Memory management (rare)\n   *\n   * **Effects**:\n   * - Empties command history array\n   * - Resets position to -1\n   * - Disables both undo and redo buttons\n   * - Does NOT affect current state (only history)\n   *\n   * **Memory**: Allows garbage collection of command objects and snapshots\n   *\n   * **Cannot be undone**: This operation itself is not undoable\n   *\n   * **Safety**: Safe to call even if history already empty\n   * @example\n   * ```typescript\n   * // Reset application\n   * function resetApp() {\n   *   clearHistory();\n   *   reset(); // Reset state\n   *   debug.log('Application reset');\n   * }\n   *\n   * // Test cleanup\n   * afterEach(() => {\n   *   clearHistory();\n   * });\n   * ```\n   */\n  clearHistory(): void {\n    this.commandHistory.length = 0;\n    this.historyPosition = -1;\n    this.updateButtonStates();\n  }\n}\n\n/**\n * Backward Compatibility Layer\n * ==============================\n *\n * Singleton instance and helper function exports for backward compatibility.\n * Existing code can continue using these while we migrate to instance-based architecture.\n *\n */\n\n// Create singleton instance (for backward compatibility only)\nconst defaultManager = new UndoRedoManager();\n\n// Export singleton state (backward compatible)\nexport const undoRedoState = defaultManager.state;\n\n// Export singleton instance methods as standalone functions (backward compatible)\nexport const pushCommand = (command: Command) => defaultManager.push(command);\nexport const undo = () => defaultManager.undo();\nexport const redo = () => defaultManager.redo();\nexport const canUndo = () => defaultManager.canUndo();\nexport const canRedo = () => defaultManager.canRedo();\nexport const clearHistory = () => defaultManager.clearHistory();\n\n// Export object wrapper for backward compatibility (deprecated, use standalone functions)\nexport const undoRedo = {\n  push: pushCommand,\n  undo,\n  redo,\n  canUndo,\n  canRedo,\n  clearHistory,\n};\n","/**\n * Grid Builder Styles\n * ====================\n *\n * Main styles for the grid builder library component.\n * Uses CSS variables for theming support.\n */\n\n:host {\n  // Theme CSS variables with defaults\n  --grid-builder-primary-color: #007bff;\n  --grid-builder-palette-bg: #f5f5f5;\n  --grid-builder-canvas-bg: #ffffff;\n  --grid-builder-grid-line-color: rgba(0, 0, 0, 0.1);\n  --grid-builder-selection-color: #007bff;\n  --grid-builder-resize-handle-color: #007bff;\n  --grid-builder-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell',\n    'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n\n  display: block;\n  width: 100%;\n  height: 100%;\n  font-family: var(--grid-builder-font-family);\n}\n\n/**\n * Screen Reader Only (sr-only)\n * =============================\n *\n * Standard accessibility pattern to hide content visually\n * while keeping it accessible to screen readers.\n *\n * **Use Cases**:\n * - ARIA live regions for announcements\n * - Skip navigation links\n * - Hidden form labels\n * - Status messages\n *\n * **Technique**:\n * - Positioned off-screen instead of display:none\n * - display:none would hide from screen readers too\n * - clip prevents visual rendering\n *\n * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n */\n.sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.grid-builder-container {\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n}\n\n.canvas-area {\n  position: relative;\n  flex: 1;\n  background: var(--grid-builder-canvas-bg);\n  overflow-y: auto;\n}\n\n.canvases-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100%;\n  gap: 0; /* No gaps between canvas sections */\n}\n\n/**\n * Canvas Wrapper\n * ==============\n *\n * Wrapper around each canvas-section providing a mounting point for custom canvas headers.\n * Headers are positioned automatically with their canvases - no manual offset calculations needed.\n *\n * **Layout Pattern**:\n * ```html\n * <div class=\"canvas-wrapper\">\n *   <canvas-header /> <!-- Custom header from uiOverrides.CanvasHeader -->\n *   <canvas-section />\n * </div>\n * ```\n *\n * **Positioning**:\n * - Wrapper uses relative positioning (provides context for absolute children)\n * - Headers can position themselves relative to their canvas\n * - No gaps between canvases (flex column layout)\n *\n * **Performance**:\n * - Negligible overhead (~0.05ms per canvas)\n * - Natural DOM hierarchy (header + canvas siblings)\n */\n.canvas-wrapper {\n  position: relative; // Positioning context for custom headers\n  display: flex;\n  flex-direction: column;\n  gap: 0; // No gap between header and canvas\n\n  // First canvas needs top padding so header doesn't get cut off at page top\n  // Matches the negative margin amount used on other headers\n  &:first-child {\n    padding-top: 38px;\n  }\n}\n\n.config-area {\n  position: fixed;\n  z-index: 1000;\n  right: 0;\n  bottom: 0;\n  display: none; // Hidden by default, shown when item selected\n  width: 350px;\n  max-height: 60%;\n  border: 1px solid #ddd;\n  border-radius: 8px 8px 0 0;\n  background: white;\n  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\n\n  &.visible {\n    display: block;\n  }\n}\n","/**\n * Grid Builder - Main Library Component\n * =======================================\n *\n * Main entry point for the grid builder library. Accepts component definitions,\n * configuration, and customization options via props to create a fully functional\n * drag-and-drop page builder.\n *\n * ## Library Design Philosophy\n *\n * **Consumer-driven configuration**:\n * - Library provides infrastructure (drag/drop, undo/redo, state management)\n * - Consumer provides content (component types, initial layout, styling)\n * - Clean separation of concerns\n * - Maximum flexibility\n *\n * **Props-based API**:\n * ```typescript\n * <grid-builder\n * components={componentDefinitions}     // Required: Component type registry\n * config={gridConfig}                   // Optional: Grid system config\n * theme={gridTheme}                     // Optional: Visual customization\n * plugins={pluginInstances}             // Optional: Plugin extensions\n * uiOverrides={customUIComponents}      // Optional: Custom UI rendering\n * initialState={savedState}             // Optional: Restore saved layout\n * />\n * ```\n *\n * ## Component Lifecycle\n *\n * **Initialization flow**:\n * 1. componentWillLoad: Validate props, set defaults, restore initial state\n * 2. componentDidLoad: Initialize plugins, setup global dependencies, attach event listeners\n * 3. render: Render UI structure (palette, canvases, config panel)\n * 4. disconnectedCallback: Cleanup plugins, remove listeners, dispose resources\n *\n * **State management**:\n * - Uses global gridState from state-manager.ts\n * - Components subscribe via StencilJS reactivity\n * - Plugins access via GridBuilderAPI\n * - Clean separation of library vs consumer state\n * @module grid-builder\n */\n\nimport {\n  Component,\n  Element,\n  h,\n  Host,\n  Listen,\n  Method,\n  Prop,\n  State,\n  Watch,\n} from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { GridBuilderTheme } from \"../../types/theme\";\nimport { GridBuilderPlugin } from \"../../types/plugin\";\nimport { UIComponentOverrides } from \"../../types/ui-overrides\";\nimport { GridBuilderAPI } from \"../../types/api\";\nimport { DeletionHook } from \"../../types/deletion-hook\";\nimport { GridExport } from \"../../types/grid-export\";\nimport {\n  ComponentAddedEvent,\n  ComponentDeletedEvent,\n  ComponentMovedEvent,\n  CanvasActivatedEvent,\n} from \"../../types/events\";\n\n// Service imports\nimport {\n  StateManager,\n  GridState,\n  GridItem,\n  generateItemId,\n  deleteItemsBatch,\n  addItemsBatch,\n  updateItemsBatch,\n} from \"../../services/state-manager\";\nimport { VirtualRendererService } from \"../../services/virtual-renderer\";\nimport { EventManager } from \"../../services/event-manager\";\nimport {\n  BatchAddCommand,\n  BatchDeleteCommand,\n  BatchUpdateConfigCommand,\n  AddCanvasCommand,\n  RemoveCanvasCommand,\n  MoveItemCommand,\n} from \"../../services/undo-redo-commands\";\nimport {\n  UndoRedoManager,\n  undoRedoState,\n} from \"../../services/undo-redo\";\nimport { DOMCache } from \"../../utils/dom-cache\";\n\n// Utility imports\nimport {\n  pixelsToGridX,\n  pixelsToGridY,\n  clearGridSizeCache,\n} from \"../../utils/grid-calculations\";\nimport {\n  applyBoundaryConstraints,\n  constrainPositionToCanvas,\n  CANVAS_WIDTH_UNITS,\n} from \"../../utils/boundary-constraints\";\nimport { createDebugLogger } from \"../../utils/debug\";\n\nconst debug = createDebugLogger(\"grid-builder\");\n\n/**\n * GridBuilder Component\n * ======================\n *\n * Main library component providing complete grid builder functionality.\n *\n * **Tag**: `<grid-builder>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: \"grid-builder\",\n  styleUrl: \"grid-builder.scss\",\n  shadow: false, // Light DOM required for interact.js\n})\nexport class GridBuilder {\n  /**\n   * Component definitions registry\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Purpose**: Defines available component types (header, text, button, etc.)\n   *\n   * **Each definition includes**:\n   * - type: Unique identifier (e.g., 'header', 'text-block')\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Initial size when dropped\n   * - render: Function returning component to render\n   * - configSchema: Optional auto-generated config form\n   * - renderConfigPanel: Optional custom config UI\n   * - Lifecycle hooks: onVisible, onHidden for virtual rendering\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'üìÑ',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => (\n   *       <my-header itemId={itemId} config={config} />\n   *     ),\n   *     configSchema: [\n   *       { name: 'text', label: 'Text', type: 'text', defaultValue: 'Header' }\n   *     ]\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Default**: Standard 2% grid with 10px-50px constraints\n   *\n   * **Configuration options**:\n   * - gridSizePercent: Grid unit as % of width (default: 2)\n   * - minGridSize: Minimum size in pixels (default: 10)\n   * - maxGridSize: Maximum size in pixels (default: 50)\n   * - snapToGrid: Enable snap-to-grid (default: true)\n   * - showGridLines: Show visual grid (default: true)\n   * - minItemSize: Minimum item dimensions (default: { width: 5, height: 4 })\n   * - virtualRenderMargin: Pre-render margin (default: '20%')\n   *\n   * **Example**:\n   * ```typescript\n   * const config = {\n   *   gridSizePercent: 3,           // 3% grid (33 units per 100%)\n   *   minGridSize: 15,              // 15px minimum\n   *   maxGridSize: 60,              // 60px maximum\n   *   snapToGrid: true,\n   *   virtualRenderMargin: '30%'    // Aggressive pre-loading\n   * };\n   * ```\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Visual theme customization\n   *\n   * **Optional prop**: Customizes colors, fonts, and styling\n   * **Default**: Bootstrap-inspired blue theme\n   *\n   * **Theme options**:\n   * - primaryColor: Accent color (default: '#007bff')\n   * - paletteBackground: Palette sidebar color (default: '#f5f5f5')\n   * - canvasBackground: Canvas background (default: '#ffffff')\n   * - gridLineColor: Grid line color (default: 'rgba(0,0,0,0.1)')\n   * - selectionColor: Selection outline (default: '#007bff')\n   * - resizeHandleColor: Resize handle color (default: '#007bff')\n   * - fontFamily: UI font (default: system font stack)\n   * - customProperties: CSS variables for advanced theming\n   *\n   * **Example**:\n   * ```typescript\n   * const theme = {\n   *   primaryColor: '#ff6b6b',        // Brand red\n   *   paletteBackground: '#fff5f5',   // Light red\n   *   customProperties: {\n   *     '--text-color': '#ffffff',\n   *     '--border-radius': '8px'\n   *   }\n   * };\n   * ```\n   */\n  @Prop() theme?: GridBuilderTheme;\n\n  /**\n   * Plugin instances for extending functionality\n   *\n   * **Optional prop**: Array of GridBuilderPlugin instances\n   * **Purpose**: Add custom features, analytics, integrations\n   *\n   * **Plugin lifecycle**:\n   * 1. Library calls plugin.init(api) on componentDidLoad\n   * 2. Plugin subscribes to events, adds UI, etc.\n   * 3. Library calls plugin.destroy() on disconnectedCallback\n   *\n   * **Example**:\n   * ```typescript\n   * class AnalyticsPlugin implements GridBuilderPlugin {\n   *   name = 'analytics';\n   *\n   *   init(api: GridBuilderAPI) {\n   *     api.on('componentAdded', (e) => {\n   *       analytics.track('Component Added', { type: e.item.type });\n   *     });\n   *   }\n   *\n   *   destroy() {\n   *     // Cleanup\n   *   }\n   * }\n   *\n   * const plugins = [new AnalyticsPlugin()];\n   * ```\n   */\n  @Prop() plugins?: GridBuilderPlugin[];\n\n  /**\n   * Custom UI component overrides\n   *\n   * **Optional prop**: Replace default UI components\n   * **Purpose**: Fully customize visual appearance\n   *\n   * **Overridable components**:\n   * - ConfigPanel: Configuration panel UI\n   * - ComponentPalette: Component palette sidebar\n   * - Toolbar: Top toolbar with controls\n   *\n   * **Example**:\n   * ```typescript\n   * const uiOverrides = {\n   *   Toolbar: (props) => (\n   *     <div class=\"my-toolbar\">\n   *       <button onClick={props.onUndo}>Undo</button>\n   *       <button onClick={props.onRedo}>Redo</button>\n   *     </div>\n   *   )\n   * };\n   * ```\n   */\n  @Prop() uiOverrides?: UIComponentOverrides;\n\n  /**\n   * Initial state to restore\n   *\n   * **Optional prop**: Restore saved layout\n   * **Purpose**: Load previously saved grid state\n   *\n   * **State structure**: Same as gridState (canvases, viewport, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const savedState = JSON.parse(localStorage.getItem('grid-state'));\n   * <grid-builder initialState={savedState} ... />\n   * ```\n   */\n  @Prop() initialState?: Partial<GridState>;\n\n  /**\n   * Canvas metadata storage (host app responsibility)\n   *\n   * **Optional prop**: Store canvas-level presentation metadata\n   * **Purpose**: Host app owns canvas metadata (titles, colors, settings)\n   *\n   * **Separation of concerns**:\n   * - Library owns placement state (items, layouts, zIndex)\n   * - Host app owns presentation state (colors, titles, custom metadata)\n   *\n   * **Structure**: Record<canvasId, any>\n   *\n   * **Example**:\n   * ```typescript\n   * const canvasMetadata = {\n   *   'hero-section': {\n   *     title: 'Hero Section',\n   *     backgroundColor: '#f0f4f8',\n   *     customSettings: { ... }\n   *   },\n   *   'articles-grid': {\n   *     title: 'Articles Grid',\n   *     backgroundColor: '#ffffff'\n   *   }\n   * };\n   * <grid-builder canvasMetadata={canvasMetadata} ... />\n   * ```\n   *\n   * **Use with canvas-click events**:\n   * - Library fires canvas-click event when canvas background clicked\n   * - Host app shows canvas settings panel\n   * - Host app updates canvasMetadata state\n   * - Library passes metadata to canvas-section via props\n   */\n  @Prop() canvasMetadata?: Record<string, any>;\n\n  /**\n   * Hook called before deleting a component\n   *\n   * **Optional prop**: Intercept deletion requests for custom workflows\n   * **Purpose**: Allow host app to show confirmation, make API calls, etc.\n   *\n   * **Hook behavior**:\n   * - Return `true` to proceed with deletion\n   * - Return `false` to cancel the deletion\n   * - Return a Promise for async operations (modals, API calls)\n   *\n   * **Example - Confirmation modal**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   const confirmed = await showConfirmModal(\n   *     `Delete ${context.item.name}?`,\n   *     'This action cannot be undone.'\n   *   );\n   *   return confirmed;\n   * };\n   * <grid-builder onBeforeDelete={onBeforeDelete} ... />\n   * ```\n   *\n   * **Example - API call + confirmation**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   // Show loading modal\n   *   const modal = showLoadingModal('Deleting...');\n   *\n   *   try {\n   *     // Make API call\n   *     await fetch(`/api/components/${context.itemId}`, {\n   *       method: 'DELETE'\n   *     });\n   *     modal.close();\n   *     return true; // Proceed with deletion\n   *   } catch (error) {\n   *     modal.close();\n   *     showErrorModal('Failed to delete component');\n   *     return false; // Cancel deletion\n   *   }\n   * };\n   * ```\n   *\n   * **Default behavior**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: DeletionHook;\n\n  /**\n   * Custom API exposure configuration\n   *\n   * **Optional prop**: Control where and how the Grid Builder API is exposed\n   * **Default**: `{ key: 'gridBuilderAPI' }`\n   * **Purpose**: Allows multiple grid-builder instances on the same page\n   *\n   * **Options**:\n   * 1. **Custom key on window** (multiple instances):\n   * ```typescript\n   * <grid-builder api-ref={{ key: 'gridAPI1' }}></grid-builder>\n   * <grid-builder api-ref={{ key: 'gridAPI2' }}></grid-builder>\n   * // Access: window.gridAPI1, window.gridAPI2\n   * ```\n   *\n   * 2. **Disable automatic exposure** (use ref instead):\n   * ```typescript\n   * <grid-builder api-ref={null}></grid-builder>\n   * // Access via ref: <grid-builder ref={el => this.api = el?.api}></grid-builder>\n   * ```\n   */\n  @Prop() apiRef?: { key?: string } | null = {\n    key: \"gridBuilderAPI\",\n  };\n\n  /**\n   * Component registry (internal state)\n   *\n   * **Purpose**: Map component type ‚Üí definition for lookup\n   * **Built from**: components prop\n   * **Used by**: grid-item-wrapper for dynamic rendering\n   *\n   * **Structure**: `{ 'header': ComponentDefinition, 'text': ComponentDefinition, ... }`\n   */\n  @State() private componentRegistry: Map<string, ComponentDefinition> =\n    new Map();\n\n  /**\n   * Initialized plugins (internal state)\n   *\n   * **Purpose**: Track plugin instances for cleanup\n   * **Lifecycle**: Set in componentDidLoad, cleared in disconnectedCallback\n   */\n  @State() private initializedPlugins: GridBuilderPlugin[] = [];\n\n  /**\n   * Screen reader announcement (ARIA live region)\n   *\n   * **Purpose**: Announce dynamic changes to screen reader users\n   * **Updated by**: Event listeners for component operations\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Announces**:\n   * - Component added/deleted\n   * - Drag/drop operations\n   * - Undo/redo actions\n   * - Canvas switching\n   */\n  @State() private announcement: string = \"\";\n\n  /**\n   * GridBuilderAPI instance (internal state)\n   *\n   * **Purpose**: Provides API to plugins and external code\n   * **Lifecycle**: Created in componentDidLoad\n   */\n  private api?: GridBuilderAPI;\n\n  /**\n   * Service instances (Phase 2: Instance-based architecture)\n   *\n   * **Purpose**: Per-component service instances for isolated state\n   * **Lifecycle**: Created in componentWillLoad, disposed in disconnectedCallback\n   * **Migration**: Replacing singleton imports with instance-based approach\n   */\n  private stateManager?: StateManager;\n  private undoRedoManager?: UndoRedoManager;\n  private eventManagerInstance?: EventManager;\n  private virtualRendererInstance?: VirtualRendererService;\n  private domCacheInstance?: DOMCache;\n\n  /**\n   * Instance-specific ID for cache isolation\n   *\n   * **Purpose**: Unique identifier for this grid-builder instance\n   * **Used for**: Cache namespacing to prevent collisions between instances\n   * **Generated from**: apiRef.key prop (defaults to 'gridBuilderAPI')\n   * **Lifecycle**: Set in componentWillLoad, used throughout component lifetime\n   */\n  private instanceId: string;\n\n  /**\n   * Host element reference\n   *\n   * **Purpose**: Access to host element for event listeners\n   */\n  @Element() private hostElement!: HTMLElement;\n\n  /**\n   * Event listener references for cleanup\n   */\n  private canvasDropHandler?: (e: Event) => void;\n  private canvasMoveHandler?: (e: Event) => void;\n  private canvasActivatedHandler?: (e: Event) => void;\n  private keyboardHandler?: (e: KeyboardEvent) => void;\n\n  /**\n   * ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window width)\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private viewportResizeObserver?: ResizeObserver;\n\n  /**\n   * Component will load lifecycle\n   *\n   * **Purpose**: Validate props and initialize component registry\n   *\n   * **Validation**:\n   * - Components prop is required\n   * - Each component must have unique type\n   * - Basic structure validation\n   *\n   * **Registry building**:\n   * - Convert array to Map for O(1) lookups\n   * - Key = component type, Value = ComponentDefinition\n   *\n   * **Initial state restoration**:\n   * - If initialState provided, merge into gridState\n   * - Otherwise use empty canvases\n   */\n\n  /**\n   * Handle item deletion from grid-item-wrapper\n   * Internal event dispatched by grid-item-wrapper after user clicks delete\n   */\n  @Listen(\"grid-item:delete\")\n  handleGridItemDelete(event: CustomEvent) {\n    debug.log(\"üóëÔ∏è @Listen(grid-item:delete) in grid-builder\", {\n      detail: event.detail,\n    });\n\n    const { itemId } = event.detail;\n    if (itemId) {\n      debug.log(\"  ‚úÖ Deleting item via API (with undo support):\", itemId);\n      // Use API method instead of direct deleteItemsBatch to enable undo/redo\n      this.api?.deleteComponent(itemId);\n    }\n  }\n\n  /**\n   * Handle palette item click (click-to-add feature)\n   *\n   * **Triggered**: User clicks palette item (emitted by component-palette)\n   * **Purpose**: Add component to active canvas using smart positioning\n   *\n   * **Event Listener Target**: `document` (not component host element)\n   * - Listens at document level to hear events from palette even when it's a DOM sibling\n   * - Critical for Storybook stories where palette and grid-builder are rendered as siblings\n   * - Events with `bubbles: true` and `composed: true` propagate to document level\n   * - This pattern works in all scenarios: parent-child, siblings, or separate component trees\n   *\n   * ## Implementation Steps\n   *\n   * 1. **Check if enabled**: Only proceed if `config.enableClickToAdd !== false`\n   * 2. **Get active canvas**: Use this.stateManager!.state.activeCanvasId or auto-select first\n   * 3. **Find component definition**: Look up in component registry\n   * 4. **Find free space**: Use findFreeSpace() for collision-free placement\n   * 5. **Create grid item**: Generate ID, build item object with found position\n   * 6. **Add to state**: Use api.addComponent() for undo/redo support\n   * 7. **Visual feedback**: Highlight canvas, show position indicator, animate component\n   * 8. **Emit event**: componentAdded event for plugins\n   *\n   * ## Edge Cases Handled\n   *\n   * - **No active canvas**: Auto-selects first canvas\n   * - **No canvases exist**: Logs warning, exits gracefully\n   * - **Component definition not found**: Logs error, exits\n   * - **No free space**: Places at canvas bottom (auto-expands canvas)\n   *\n   * ## Visual Feedback Sequence\n   *\n   * 1. **Canvas highlight** (600ms pulse on border)\n   * 2. **Position indicator** (800ms ghost outline at target position)\n   * 3. **Component animation** (400ms fade + scale when added)\n   *\n   * **Example flow**:\n   * ```\n   * User clicks \"Header\" in palette\n   * ‚Üí Canvas border pulses\n   * ‚Üí Ghost outline shows where header will appear\n   * ‚Üí Header component fades/scales in at position\n   * ‚Üí Canvas height adjusts if needed\n   * ```\n   * @param event - Custom event with { componentType: string }\n   */\n  @Listen(\"palette-item-click\", { target: \"document\" })\n  async handlePaletteItemClick(\n    event: CustomEvent<{ componentType: string; targetGridBuilderId?: string }>,\n  ) {\n    debug.log(\"‚ûï @Listen(palette-item-click) in grid-builder\", {\n      detail: event.detail,\n    });\n\n    // Filter events by target instance ID (for multi-instance support)\n    // If targetGridBuilderId is specified, only respond if it matches our instance ID\n    const { targetGridBuilderId } = event.detail;\n    if (targetGridBuilderId) {\n      const myInstanceId = this.apiRef?.key || \"gridBuilderAPI\";\n      if (targetGridBuilderId !== myInstanceId) {\n        debug.log(\n          `  ‚è≠Ô∏è Skipping - event targeted at ${targetGridBuilderId}, this instance is ${myInstanceId}`,\n        );\n        return;\n      }\n      debug.log(`  ‚úÖ Event matches this instance (${myInstanceId})`);\n    }\n\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      debug.log(\"  ‚è≠Ô∏è Click-to-add disabled via config\");\n      return;\n    }\n\n    const { componentType } = event.detail;\n    if (!componentType) {\n      debug.warn(\"handlePaletteItemClick: Component type not provided\");\n      return;\n    }\n\n    // Get or auto-select active canvas\n    let canvasId = this.stateManager!.state.activeCanvasId;\n\n    if (!canvasId) {\n      // Auto-select first canvas\n      const canvasIds = Object.keys(this.stateManager!.state.canvases);\n      if (canvasIds.length === 0) {\n        debug.warn(\"handlePaletteItemClick: No canvases available\");\n        return;\n      }\n      canvasId = canvasIds[0];\n      this.api?.setActiveCanvas(canvasId);\n      debug.log(`  üéØ Auto-selected first canvas: ${canvasId}`);\n    }\n\n    // Get component definition\n    const definition = this.componentRegistry.get(componentType);\n    if (!definition) {\n      debug.error(\n        `handlePaletteItemClick: Component definition not found for type: ${componentType}`,\n      );\n      return;\n    }\n\n    // Get default size from definition (or use fallback)\n    const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n\n    // Import space-finder utility (dynamic import to avoid circular dependency)\n    const { findFreeSpace } = await import(\"../../utils/space-finder\");\n\n    // Find free space on canvas (pass state instance for multi-instance support)\n    const position = findFreeSpace(\n      canvasId,\n      defaultSize.width,\n      defaultSize.height,\n      this.stateManager!.state,\n    );\n\n    if (!position) {\n      debug.error(\n        `handlePaletteItemClick: Could not find space on canvas ${canvasId}`,\n      );\n      return;\n    }\n\n    debug.log(\"  üìç Found free space:\", position);\n\n    // Import visual feedback utilities (dynamic import)\n    const visualFeedback = await import(\"../../utils/visual-feedback\");\n\n    // Show visual feedback (canvas highlight + position indicator)\n    visualFeedback.highlightCanvas(canvasId);\n    visualFeedback.showPositionIndicator(\n      canvasId,\n      position.x,\n      position.y,\n      defaultSize.width,\n      defaultSize.height,\n      this.config,\n    );\n\n    debug.log(\"  ‚ûï Adding component via API\");\n\n    // Add via API for undo/redo support (correct signature)\n    const newItemId = this.api?.addComponent(\n      canvasId,\n      componentType,\n      {\n        x: position.x,\n        y: position.y,\n        width: defaultSize.width,\n        height: defaultSize.height,\n      },\n      {}, // Empty config object\n    );\n\n    if (!newItemId) {\n      debug.error(\"Failed to add component to canvas\");\n      return;\n    }\n\n    // Activate the canvas where the component was dropped\n    this.api?.setActiveCanvas(canvasId);\n    debug.log(`  üéØ Activated canvas: ${canvasId}`);\n\n    // Animate component in (after DOM update completes)\n    // Use double requestAnimationFrame to ensure:\n    // 1. First rAF: Current frame completes\n    // 2. Second rAF: Next frame starts (after StencilJS render + positioning)\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        visualFeedback.animateComponentIn(newItemId);\n      });\n    });\n\n    // Set as selected (focus on newly added item)\n    this.stateManager!.state.selectedItemId = newItemId;\n    this.stateManager!.state.selectedCanvasId = canvasId;\n\n    // Emit componentAdded event for plugins\n    // Must include full item object to match ComponentAddedEvent interface\n    const canvas = this.stateManager!.state.canvases[canvasId];\n    const newItem = canvas?.items.find((item) => item.id === newItemId);\n\n    if (newItem) {\n      this.eventManagerInstance?.emit(\"componentAdded\", {\n        item: newItem,\n        canvasId,\n      });\n    }\n\n    debug.log(\"  ‚úÖ Component added successfully\");\n  }\n\n  componentWillLoad() {\n    // Validate required props\n    if (!this.components || this.components.length === 0) {\n      console.error(\"GridBuilder: components prop is required\");\n      return;\n    }\n\n    // Build component registry\n    this.componentRegistry = new Map(\n      this.components.map((comp) => [comp.type, comp]),\n    );\n\n    // Validate unique component types\n    if (this.componentRegistry.size !== this.components.length) {\n      debug.warn(\"GridBuilder: Duplicate component types detected\");\n    }\n\n    // Expose interact.js globally (required for drag/drop handlers)\n    (window as any).interact = interact;\n\n    // Phase 2: Create service instances (instance-based architecture)\n    // Each grid-builder component gets its own isolated service instances\n    this.stateManager = new StateManager();\n    this.undoRedoManager = new UndoRedoManager();\n    this.eventManagerInstance = new EventManager();\n    this.virtualRendererInstance = new VirtualRendererService();\n    this.domCacheInstance = new DOMCache();\n\n    debug.log(\"GridBuilder: Service instances created\", {\n      stateManager: !!this.stateManager,\n      undoRedoManager: !!this.undoRedoManager,\n      eventManagerInstance: !!this.eventManagerInstance,\n      virtualRendererInstance: !!this.virtualRendererInstance,\n      domCacheInstance: !!this.domCacheInstance,\n    });\n\n    // Set instanceId for cache isolation (stored as private property to avoid mutating config prop)\n    // This prevents cache collisions when multiple instances share canvasIds\n    this.instanceId = this.apiRef?.key || 'gridBuilderAPI';\n\n    debug.log(\"GridBuilder: Instance ID set\", {\n      instanceId: this.instanceId,\n      hasCustomConfig: !!this.config,\n    });\n\n    // Clear this instance's cache on load to prevent stale values when remounting\n    // Critical for Storybook tab switching: prevents cache from previous tab (Docs/Canvas)\n    // ResizeObserver only fires on changes, not initial load, so we must clear here\n    clearGridSizeCache(this.instanceId);\n    debug.log(\"GridBuilder: Cleared instance cache on load\", {\n      instanceId: this.instanceId,\n    });\n\n    // Restore initial state if provided\n    if (this.initialState) {\n      Object.assign(this.stateManager!.state, this.initialState);\n    }\n  }\n\n  /**\n   * Component did load lifecycle\n   *\n   * **Purpose**: Initialize global dependencies and plugins\n   *\n   * **Initialization sequence**:\n   * 1. Expose virtualRenderer singleton globally\n   * 2. Create GridBuilderAPI instance\n   * 3. Initialize plugins via plugin.init(api)\n   * 4. Apply theme via CSS variables\n   * 5. Expose debug helpers\n   */\n  componentDidLoad() {\n    // Create GridBuilderAPI instance\n    this.api = this.createAPI();\n\n    // Expose API and service instances based on apiRef configuration\n    debug.log(\"üîß grid-builder exposing API and service instances\", {\n      hasApiRef: !!this.apiRef,\n      apiRefKey: this.apiRef?.key,\n      apiCreated: !!this.api,\n    });\n\n    if (this.apiRef && this.apiRef.key) {\n      debug.log(\"  üì§ Setting API and services on window\", {\n        key: this.apiRef.key,\n      });\n      // Expose main API\n      window[this.apiRef.key] = this.api;\n\n      // Phase 2: Expose service instances globally (for debugging)\n      // Use namespaced keys to support multiple grid-builder instances\n      (window as any)[`${this.apiRef.key}_virtualRenderer`] = this.virtualRendererInstance;\n\n      debug.log(\"  ‚úÖ API and services set on window\", {\n        key: this.apiRef.key,\n        apiExists: !!window[this.apiRef.key],\n        virtualRendererExists: !!(window as any)[`${this.apiRef.key}_virtualRenderer`],\n      });\n    }\n\n    // Initialize plugins\n    if (this.plugins && this.plugins.length > 0) {\n      this.initializedPlugins = this.plugins.filter((plugin) => {\n        try {\n          plugin.init(this.api!);\n          debug.log(`GridBuilder: Initialized plugin \"${plugin.name}\"`);\n          return true;\n        } catch (e) {\n          console.error(\n            `GridBuilder: Failed to initialize plugin \"${plugin.name}\":`,\n            e,\n          );\n          return false;\n        }\n      });\n    }\n\n    // Apply theme\n    if (this.theme) {\n      this.applyTheme(this.theme);\n    }\n\n    // Configure event debouncing (Phase 2: use instance)\n    const debounceDelay = this.config?.eventDebounceDelay ?? 300;\n    this.eventManagerInstance?.setDebounceDelay(debounceDelay);\n    debug.log(`GridBuilder: Event debounce delay set to ${debounceDelay}ms`);\n\n    // Debug helper\n    (window as any).debugInteractables = () => {\n      const interactables = (interact as any).interactables.list;\n      debug.log(\"Total interactables:\", interactables.length);\n      interactables.forEach((interactable: any, index: number) => {\n        debug.log(`Interactable ${index}:`, {\n          target: interactable.target,\n          actions: interactable._actions,\n          options: interactable.options,\n        });\n      });\n    };\n\n    // Setup canvas drop event handler for palette items\n    this.canvasDropHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId, componentType, x, y } = customEvent.detail;\n\n      debug.log(\"üéØ canvas-drop event received:\", {\n        canvasId,\n        componentType,\n        x,\n        y,\n      });\n\n      // Get component definition to determine default size\n      const definition = this.componentRegistry.get(componentType);\n      if (!definition) {\n        debug.warn(\n          `Component definition not found for type: ${componentType}`,\n        );\n        return;\n      }\n\n      // Convert pixel position to grid units\n      const gridX = pixelsToGridX(x, canvasId, this.config);\n      const gridY = pixelsToGridY(y, this.config);\n\n      debug.log(\"  Converting to grid units (before constraints):\", {\n        gridX,\n        gridY,\n        defaultWidth: definition.defaultSize.width,\n        defaultHeight: definition.defaultSize.height,\n      });\n\n      // Apply boundary constraints (validate, adjust size, constrain position)\n      const constrained = applyBoundaryConstraints(definition, gridX, gridY);\n\n      if (!constrained) {\n        debug.warn(\n          `Cannot place component \"${definition.name}\" - minimum size exceeds canvas width`,\n        );\n        return;\n      }\n\n      debug.log(\"  After boundary constraints:\", constrained);\n\n      // Use existing addComponent API method with constrained values\n      const newItem = this.api?.addComponent(canvasId, componentType, {\n        x: constrained.x,\n        y: constrained.y,\n        width: constrained.width,\n        height: constrained.height,\n      });\n\n      debug.log(\"  Created item:\", newItem);\n\n      // Set the target canvas as active when item is dropped\n      this.api?.setActiveCanvas(canvasId);\n    };\n\n    this.hostElement.addEventListener(\"canvas-drop\", this.canvasDropHandler);\n\n    // Setup canvas move event handler for cross-canvas moves\n    this.canvasMoveHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { itemId, sourceCanvasId, targetCanvasId, x, y } =\n        customEvent.detail;\n\n      debug.log(\"üîÑ canvas-move event received:\", {\n        itemId,\n        sourceCanvasId,\n        targetCanvasId,\n        x,\n        y,\n      });\n\n      // 1. Get item from source canvas\n      const sourceCanvas = this.stateManager!.state.canvases[sourceCanvasId];\n      if (!sourceCanvas) {\n        console.error(\"Source canvas not found:\", sourceCanvasId);\n        return;\n      }\n\n      const itemIndex = sourceCanvas.items.findIndex((i) => i.id === itemId);\n      if (itemIndex === -1) {\n        console.error(\"Item not found in source canvas:\", itemId);\n        return;\n      }\n\n      const item = sourceCanvas.items[itemIndex];\n\n      // 2. Capture state BEFORE move (for undo)\n      const sourcePosition = {\n        x: item.layouts.desktop.x,\n        y: item.layouts.desktop.y,\n      };\n\n      // 3. Convert drop position (pixels) to grid units for target canvas\n      let gridX = pixelsToGridX(x, targetCanvasId, this.config);\n      let gridY = pixelsToGridY(y, this.config);\n\n      // 4. Constrain position to target canvas boundaries\n      const constrained = constrainPositionToCanvas(\n        gridX,\n        gridY,\n        item.layouts.desktop.width,\n        item.layouts.desktop.height,\n        CANVAS_WIDTH_UNITS,\n      );\n\n      gridX = constrained.x;\n      gridY = constrained.y;\n\n      const targetPosition = { x: gridX, y: gridY };\n\n      // 5. Capture source z-index before modification\n      const sourceZIndex = item.zIndex;\n\n      // 6. Update item position in desktop layout\n      item.layouts.desktop.x = gridX;\n      item.layouts.desktop.y = gridY;\n\n      // 7. Move item between canvases (updates canvasId, removes from source, adds to target)\n      // Remove from source canvas\n      sourceCanvas.items = sourceCanvas.items.filter((i) => i.id !== itemId);\n\n      // Update item's canvasId\n      item.canvasId = targetCanvasId;\n\n      // Add to target canvas\n      const targetCanvas = this.stateManager!.state.canvases[targetCanvasId];\n      targetCanvas.items.push(item);\n\n      // 8. Assign new z-index in target canvas (prevents z-index conflicts)\n      const targetZIndex = targetCanvas.zIndexCounter++;\n      item.zIndex = targetZIndex;\n      this.stateManager!.state.canvases = { ...this.stateManager!.state.canvases }; // Trigger reactivity\n\n      // 9. Set target canvas as active\n      this.api?.setActiveCanvas(targetCanvasId);\n\n      // 10. Update selection state if item was selected\n      if (this.stateManager!.state.selectedItemId === itemId) {\n        this.stateManager!.state.selectedCanvasId = targetCanvasId;\n      }\n\n      // 11. Create undo/redo command with z-index tracking\n      const command = new MoveItemCommand(\n        itemId,\n        sourceCanvasId,\n        targetCanvasId,\n        sourcePosition,\n        targetPosition,\n        itemIndex,\n        sourceZIndex,\n        targetZIndex,\n      );\n      this.undoRedoManager?.push(command);\n\n      // 11. Emit events for plugins\n      this.eventManagerInstance?.emit(\"componentMoved\", {\n        item,\n        sourceCanvasId,\n        targetCanvasId,\n        position: targetPosition,\n      });\n\n      debug.log(\"‚úÖ Cross-canvas move completed:\", {\n        itemId,\n        from: sourceCanvasId,\n        to: targetCanvasId,\n        position: targetPosition,\n      });\n    };\n\n    this.hostElement.addEventListener(\"canvas-move\", this.canvasMoveHandler);\n\n    // Setup canvas activated event handler\n    this.canvasActivatedHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId } = customEvent.detail;\n\n      debug.log(\"üé® canvas-activated event received:\", { canvasId });\n\n      // Emit plugin event\n      this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n    };\n\n    this.hostElement.addEventListener(\n      \"canvas-activated\",\n      this.canvasActivatedHandler,\n    );\n\n    // Setup keyboard shortcuts\n    this.keyboardHandler = (event: KeyboardEvent) => {\n      // Get modifier keys (Cmd on Mac, Ctrl on Windows/Linux)\n      const isUndo =\n        (event.metaKey || event.ctrlKey) &&\n        event.key === \"z\" &&\n        !event.shiftKey;\n      const isRedo =\n        (event.metaKey || event.ctrlKey) &&\n        ((event.key === \"z\" && event.shiftKey) || // Ctrl/Cmd+Shift+Z\n          event.key === \"y\"); // Ctrl/Cmd+Y\n\n      // Handle undo/redo\n      if (isUndo) {\n        debug.log(\"‚å®Ô∏è Keyboard: Undo triggered\");\n        event.preventDefault();\n        this.api?.undo();\n        return;\n      }\n\n      if (isRedo) {\n        debug.log(\"‚å®Ô∏è Keyboard: Redo triggered\");\n        event.preventDefault();\n        this.api?.redo();\n        return;\n      }\n\n      // Handle Delete key (delete selected component)\n      if (event.key === \"Delete\" || event.key === \"Backspace\") {\n        if (this.stateManager!.state.selectedItemId && this.stateManager!.state.selectedCanvasId) {\n          debug.log(\"‚å®Ô∏è Keyboard: Delete triggered\", {\n            itemId: this.stateManager!.state.selectedItemId,\n          });\n          event.preventDefault();\n\n          // Capture the item ID and canvas ID before deletion\n          const deletedItemId = this.stateManager!.state.selectedItemId;\n          const deletedCanvasId = this.stateManager!.state.selectedCanvasId;\n\n          // Delete the selected item (async - respects onBeforeDelete hook)\n          this.api\n            ?.deleteComponent(this.stateManager!.state.selectedItemId)\n            .then((deleted) => {\n              if (deleted) {\n                // Announce deletion only if actually deleted (not cancelled by modal)\n                this.announce(\"Component deleted\");\n\n                // Move focus to next logical item for keyboard users\n                this.moveFocusAfterDeletion(deletedCanvasId, deletedItemId);\n              }\n            });\n\n          return;\n        }\n      }\n\n      // Handle Escape key (deselect component)\n      if (event.key === \"Escape\") {\n        if (this.stateManager!.state.selectedItemId || this.stateManager!.state.selectedCanvasId) {\n          debug.log(\"‚å®Ô∏è Keyboard: Escape triggered (deselecting)\");\n          event.preventDefault();\n\n          // Clear selection\n          this.stateManager!.state.selectedItemId = null;\n          this.stateManager!.state.selectedCanvasId = null;\n\n          // Announce deselection\n          this.announce(\"Selection cleared\");\n\n          return;\n        }\n      }\n\n      // Handle arrow key nudging (only if component is selected)\n      if (!this.stateManager!.state.selectedItemId || !this.stateManager!.state.selectedCanvasId) {\n        return;\n      }\n\n      const isArrowKey = [\n        \"ArrowUp\",\n        \"ArrowDown\",\n        \"ArrowLeft\",\n        \"ArrowRight\",\n      ].includes(event.key);\n      if (!isArrowKey) {\n        return;\n      }\n\n      event.preventDefault();\n\n      // Get selected item\n      const canvas = this.stateManager!.state.canvases[this.stateManager!.state.selectedCanvasId];\n      if (!canvas) {\n        return;\n      }\n\n      const item = canvas.items.find((i) => i.id === this.stateManager!.state.selectedItemId);\n      if (!item) {\n        return;\n      }\n\n      // Get current viewport layout\n      const viewport = this.stateManager!.state.currentViewport;\n      const layout = item.layouts[viewport];\n\n      // Calculate nudge amount (1 grid unit in each direction)\n      const nudgeAmount = 1;\n      let deltaX = 0;\n      let deltaY = 0;\n\n      switch (event.key) {\n        case \"ArrowUp\":\n          deltaY = -nudgeAmount;\n          break;\n        case \"ArrowDown\":\n          deltaY = nudgeAmount;\n          break;\n        case \"ArrowLeft\":\n          deltaX = -nudgeAmount;\n          break;\n        case \"ArrowRight\":\n          deltaX = nudgeAmount;\n          break;\n      }\n\n      debug.log(\"‚å®Ô∏è Keyboard: Nudging component\", {\n        key: event.key,\n        deltaX,\n        deltaY,\n        itemId: item.id,\n      });\n\n      // Capture old position for undo\n      const oldX = layout.x;\n      const oldY = layout.y;\n\n      // Update position with boundary checks\n      const newX = Math.max(0, layout.x + deltaX);\n      const newY = Math.max(0, layout.y + deltaY);\n\n      // Check right boundary (100 grid units = 100%)\n      const maxX = 100 - layout.width;\n      const constrainedX = Math.min(newX, maxX);\n      const constrainedY = newY; // No vertical limit\n\n      // Only update if position actually changed\n      if (oldX === constrainedX && oldY === constrainedY) {\n        return; // No change, don't create undo command\n      }\n\n      // Update item layout (mutate in place to preserve all properties like 'customized')\n      layout.x = constrainedX;\n      layout.y = constrainedY;\n\n      // Create undo command for nudge (same canvas = z-index unchanged)\n      const nudgeCommand = new MoveItemCommand(\n        item.id,\n        this.stateManager!.state.selectedCanvasId,\n        this.stateManager!.state.selectedCanvasId,\n        { x: oldX, y: oldY },\n        { x: constrainedX, y: constrainedY },\n        canvas.items.findIndex((i) => i.id === item.id),\n        item.zIndex, // sourceZIndex\n        item.zIndex, // targetZIndex (same canvas = no change)\n      );\n      this.undoRedoManager?.push(nudgeCommand);\n\n      // Trigger state update\n      this.stateManager!.state.canvases = { ...this.stateManager!.state.canvases };\n\n      // Emit event\n      this.eventManagerInstance?.emit(\"componentDragged\", {\n        itemId: item.id,\n        canvasId: this.stateManager!.state.selectedCanvasId,\n        position: { x: constrainedX, y: constrainedY },\n      });\n    };\n\n    document.addEventListener(\"keydown\", this.keyboardHandler);\n\n    // Setup container-based viewport switching\n    this.setupViewportResizeObserver();\n\n    // Setup screen reader announcements (ARIA live region)\n    this.setupScreenReaderAnnouncements();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Purpose**: Clean up resources when component unmounts\n   *\n   * **Cleanup sequence**:\n   * 1. Remove event listeners\n   * 2. Destroy all plugins\n   * 3. Clear global references\n   */\n  disconnectedCallback() {\n    // Remove event listeners\n    if (this.canvasDropHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-drop\",\n        this.canvasDropHandler,\n      );\n    }\n    if (this.canvasMoveHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-move\",\n        this.canvasMoveHandler,\n      );\n    }\n    if (this.canvasActivatedHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-activated\",\n        this.canvasActivatedHandler,\n      );\n    }\n    if (this.keyboardHandler) {\n      document.removeEventListener(\"keydown\", this.keyboardHandler);\n    }\n\n    // Cleanup ResizeObserver\n    if (this.viewportResizeObserver) {\n      this.viewportResizeObserver.disconnect();\n    }\n\n    // Destroy plugins\n    if (this.initializedPlugins.length > 0) {\n      this.initializedPlugins.forEach((plugin) => {\n        try {\n          plugin.destroy();\n          debug.log(`GridBuilder: Destroyed plugin \"${plugin.name}\"`);\n        } catch (e) {\n          console.error(\n            `GridBuilder: Failed to destroy plugin \"${plugin.name}\":`,\n            e,\n          );\n        }\n      });\n      this.initializedPlugins = [];\n    }\n\n    // Phase 2: Cleanup service instances\n    if (this.undoRedoManager) {\n      this.undoRedoManager.dispose();\n      debug.log(\"GridBuilder: Disposed undoRedoManager\");\n    }\n    if (this.virtualRendererInstance) {\n      this.virtualRendererInstance.destroy();\n      debug.log(\"GridBuilder: Destroyed virtualRendererInstance\");\n    }\n    if (this.eventManagerInstance) {\n      this.eventManagerInstance.removeAllListeners();\n      debug.log(\"GridBuilder: Cleared eventManagerInstance listeners\");\n    }\n    if (this.domCacheInstance) {\n      this.domCacheInstance.clear();\n      debug.log(\"GridBuilder: Cleared domCacheInstance\");\n    }\n    // StateManager will be garbage collected (no explicit cleanup needed)\n\n    // Clear grid size cache for this instance only (instance-aware cleanup)\n    if (this.instanceId) {\n      clearGridSizeCache(this.instanceId);\n      debug.log(\"GridBuilder: Cleared grid size cache for instance\", {\n        instanceId: this.instanceId,\n      });\n    }\n\n    // Clear global references\n    if (this.apiRef && this.apiRef.key) {\n      // Clear API\n      delete window[this.apiRef.key];\n\n      // Clear namespaced service instances\n      delete (window as any)[`${this.apiRef.key}_virtualRenderer`];\n    }\n  }\n\n  /**\n   * Watch components prop for changes\n   *\n   * **Purpose**: Rebuild component registry when components prop changes\n   */\n  @Watch(\"components\")\n  handleComponentsChange(newComponents: ComponentDefinition[]) {\n    this.componentRegistry = new Map(\n      newComponents.map((comp) => [comp.type, comp]),\n    );\n  }\n\n  /**\n   * Watch theme prop changes and reapply theme\n   *\n   * **When triggered**: Theme prop changes (e.g., from Storybook controls)\n   * **Purpose**: Reapply CSS custom properties when theme colors change\n   */\n  @Watch(\"theme\")\n  handleThemeChange(newTheme: GridBuilderTheme) {\n    if (newTheme) {\n      this.applyTheme(newTheme);\n    }\n  }\n\n  /**\n   * Create GridBuilderAPI instance\n   *\n   * **Purpose**: Provide API to plugins and external code\n   * **Returns**: GridBuilderAPI implementation\n   *\n   * **Implementation**: Full API with event system integration\n   */\n  private createAPI(): GridBuilderAPI {\n    return {\n      // ======================\n      // Event Subscriptions\n      // ======================\n\n      on: <T = any,>(eventName: string, callback: (data: T) => void) => {\n        this.eventManagerInstance?.on(eventName, callback);\n      },\n\n      off: <T = any,>(eventName: string, callback: (data: T) => void) => {\n        this.eventManagerInstance?.off(eventName, callback);\n      },\n\n      // ======================\n      // State Access (Read)\n      // ======================\n\n      getState: () => this.stateManager!.state,\n\n      getItems: (canvasId: string) => {\n        return this.stateManager!.state.canvases[canvasId]?.items || [];\n      },\n\n      getItem: (itemId: string) => {\n        // Search across all canvases\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            return item;\n          }\n        }\n        return null;\n      },\n\n      // ======================\n      // Programmatic Operations\n      // ======================\n\n      addComponent: (\n        canvasId: string,\n        componentType: string,\n        position: { x: number; y: number; width: number; height: number },\n        config?: Record<string, any>,\n      ) => {\n        const canvas = this.stateManager!.state.canvases[canvasId];\n        if (!canvas) {\n          console.error(`Canvas not found: ${canvasId}`);\n          return null;\n        }\n\n        // Look up component definition to get proper name\n        const definition = this.componentRegistry.get(componentType);\n        const componentName = definition?.name || componentType;\n\n        // Create new item\n        const newItem = {\n          id: generateItemId(),\n          canvasId,\n          name: componentName,\n          type: componentType,\n          zIndex: ++canvas.zIndexCounter,\n          layouts: {\n            desktop: { ...position },\n            mobile: {\n              x: 0,\n              y: 0,\n              width: 50,\n              height: position.height,\n              customized: false,\n            },\n          },\n          config: config || {},\n        };\n\n        // Add to canvas (immutable update)\n        const newItems = [...canvas.items, newItem];\n        const newCanvas = { ...canvas, items: newItems };\n        const newCanvases = { ...this.stateManager!.state.canvases, [canvasId]: newCanvas };\n        this.stateManager!.state.canvases = newCanvases;\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(new BatchAddCommand([newItem.id]));\n\n        // Emit event\n        this.eventManagerInstance?.emit(\"componentAdded\", { item: newItem, canvasId });\n\n        return newItem.id;\n      },\n\n      deleteComponent: async (itemId: string) => {\n        // Find item and canvas across all canvases\n        let targetCanvasId: string | null = null;\n        let targetItem: GridItem | null = null;\n\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            targetCanvasId = canvasId;\n            targetItem = item;\n            break;\n          }\n        }\n\n        if (!targetCanvasId || !targetItem) {\n          return false;\n        }\n\n        // Call onBeforeDelete hook if provided (for deletion confirmation)\n        if (this.onBeforeDelete) {\n          try {\n            const shouldDelete = await this.onBeforeDelete({\n              item: targetItem,\n              canvasId: targetCanvasId,\n              itemId,\n            });\n\n            if (!shouldDelete) {\n              // Deletion cancelled by hook\n              return false;\n            }\n          } catch (error) {\n            console.error(\"Error in onBeforeDelete hook:\", error);\n            return false;\n          }\n        }\n\n        // Proceed with deletion\n        const canvas = this.stateManager!.state.canvases[targetCanvasId];\n        const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n        if (itemIndex !== -1) {\n          // Add to undo/redo history BEFORE deletion (need state for undo)\n          this.undoRedoManager?.push(new BatchDeleteCommand([itemId]));\n\n          // Delete item\n          canvas.items.splice(itemIndex, 1);\n          this.stateManager!.state.canvases = { ...this.stateManager!.state.canvases };\n\n          // Deselect if deleted item was selected\n          if (this.stateManager!.state.selectedItemId === itemId) {\n            this.stateManager!.state.selectedItemId = null;\n            this.stateManager!.state.selectedCanvasId = null;\n          }\n\n          // Emit event\n          this.eventManagerInstance?.emit(\"componentDeleted\", {\n            itemId,\n            canvasId: targetCanvasId,\n          });\n\n          return true;\n        }\n        return false;\n      },\n\n      updateConfig: (itemId: string, config: Record<string, any>) => {\n        // Find and update item across all canvases\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n          if (itemIndex !== -1) {\n            const item = canvas.items[itemIndex];\n            const newConfig = { ...item.config, ...config };\n\n            // Create undo command BEFORE making changes\n            const batchUpdate = [\n              {\n                itemId,\n                canvasId,\n                updates: { config: newConfig },\n              },\n            ];\n            this.undoRedoManager?.push(new BatchUpdateConfigCommand(batchUpdate));\n\n            // Merge config\n            canvas.items[itemIndex] = {\n              ...canvas.items[itemIndex],\n              config: newConfig,\n            };\n            this.stateManager!.state.canvases = { ...this.stateManager!.state.canvases };\n\n            // Emit event\n            this.eventManagerInstance?.emit(\"configChanged\", { itemId, canvasId, config });\n\n            return true;\n          }\n        }\n        return false;\n      },\n\n      // ======================\n      // Batch Operations\n      // ======================\n\n      addComponentsBatch: (\n        components: {\n          canvasId: string;\n          type: string;\n          position: { x: number; y: number; width: number; height: number };\n          config?: Record<string, any>;\n        }[],\n      ) => {\n        // Convert API format to state-manager format\n        const partialItems = components.map(\n          ({ canvasId, type, position, config }) => {\n            // Look up component definition to get proper name\n            const definition = this.componentRegistry.get(type);\n            const componentName = definition?.name || type;\n\n            return {\n              canvasId,\n              type,\n              name: componentName,\n              layouts: {\n                desktop: { ...position },\n                mobile: {\n                  x: 0,\n                  y: 0,\n                  width: 50,\n                  height: position.height,\n                  customized: false,\n                },\n              },\n              config: config || {},\n            };\n          },\n        );\n\n        // Use state-manager batch operation (single state update)\n        const itemIds = addItemsBatch(partialItems);\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(new BatchAddCommand(itemIds));\n\n        // Emit batch event\n        const createdItems = itemIds\n          .map((id) => {\n            const item = this.api?.getItem(id);\n            return item ? { item, canvasId: item.canvasId } : null;\n          })\n          .filter(Boolean);\n        this.eventManagerInstance?.emit(\"componentsBatchAdded\", { items: createdItems });\n\n        return itemIds;\n      },\n\n      deleteComponentsBatch: (itemIds: string[]) => {\n        // Store deleted items for event\n        const deletedItems = itemIds\n          .map((itemId) => {\n            const item = this.api?.getItem(itemId);\n            return item ? { itemId, canvasId: item.canvasId } : null;\n          })\n          .filter(Boolean);\n\n        // Add to undo/redo history BEFORE deletion (need state for undo)\n        this.undoRedoManager?.push(new BatchDeleteCommand(itemIds));\n\n        // Use state-manager batch operation (single state update)\n        deleteItemsBatch(itemIds);\n\n        // Clear selection if any deleted item was selected\n        if (\n          this.stateManager!.state.selectedItemId &&\n          itemIds.includes(this.stateManager!.state.selectedItemId)\n        ) {\n          this.stateManager!.state.selectedItemId = null;\n          this.stateManager!.state.selectedCanvasId = null;\n        }\n\n        // Emit batch event\n        this.eventManagerInstance?.emit(\"componentsBatchDeleted\", { items: deletedItems });\n      },\n\n      updateConfigsBatch: (\n        updates: { itemId: string; config: Record<string, any> }[],\n      ) => {\n        // Convert to state-manager format (need canvasId)\n        const batchUpdates = updates\n          .map(({ itemId, config }) => {\n            const item = this.api?.getItem(itemId);\n            if (!item) {\n              debug.warn(`Item ${itemId} not found for config update`);\n              return null;\n            }\n            return {\n              itemId,\n              canvasId: item.canvasId,\n              updates: { config: { ...item.config, ...config } },\n            };\n          })\n          .filter(Boolean) as {\n          itemId: string;\n          canvasId: string;\n          updates: Partial<any>;\n        }[];\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(new BatchUpdateConfigCommand(batchUpdates));\n\n        // Use state-manager batch operation (single state update)\n        updateItemsBatch(batchUpdates);\n\n        // Emit batch event\n        const updatedItems = batchUpdates.map(\n          ({ itemId, canvasId, updates }) => ({\n            itemId,\n            canvasId,\n            config: updates.config,\n          }),\n        );\n        this.eventManagerInstance?.emit(\"configsBatchChanged\", { items: updatedItems });\n      },\n\n      // ======================\n      // Canvas Access\n      // ======================\n\n      getCanvasElement: (canvasId: string) => {\n        return document.getElementById(canvasId);\n      },\n\n      // ======================\n      // Undo/Redo Operations\n      // ======================\n\n      undo: () => {\n        this.undoRedoManager?.undo();\n        // Emit event after undo\n        this.eventManagerInstance?.emit(\"undoExecuted\", {});\n      },\n\n      redo: () => {\n        this.undoRedoManager?.redo();\n        // Emit event after redo\n        this.eventManagerInstance?.emit(\"redoExecuted\", {});\n      },\n\n      canUndo: () => {\n        return this.undoRedoManager?.canUndo();\n      },\n\n      canRedo: () => {\n        return this.undoRedoManager?.canRedo();\n      },\n\n      undoRedoState,\n\n      // ======================\n      // Canvas Management\n      // ======================\n\n      addCanvas: (canvasId: string) => {\n        // Create command with instance state and event manager\n        const command = new AddCanvasCommand(\n          canvasId,\n          this.stateManager!.state,\n          this.eventManagerInstance\n        );\n\n        // Add to undo/redo stack\n        this.undoRedoManager?.push(command);\n\n        // Execute the command\n        command.redo();\n\n        // Set newly added canvas as active\n        this.stateManager!.state.activeCanvasId = canvasId;\n        this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n\n        // Scroll to the new canvas after DOM has updated\n        requestAnimationFrame(() => {\n          const canvasElement = this.domCacheInstance?.getCanvas(canvasId);\n          if (canvasElement) {\n            canvasElement.scrollIntoView({\n              behavior: \"smooth\",\n              block: \"center\",\n            });\n          }\n        });\n      },\n\n      removeCanvas: (canvasId: string) => {\n        // Create command with instance state and event manager\n        const command = new RemoveCanvasCommand(\n          canvasId,\n          this.stateManager!.state,\n          this.eventManagerInstance\n        );\n\n        // Add to undo/redo stack\n        this.undoRedoManager?.push(command);\n\n        // Execute the command\n        command.redo();\n      },\n\n      setActiveCanvas: (canvasId: string) => {\n        this.stateManager!.state.activeCanvasId = canvasId;\n        this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n      },\n\n      getActiveCanvas: () => {\n        return this.stateManager!.state.activeCanvasId;\n      },\n\n      // ======================\n      // Z-Index Management\n      // ======================\n\n      moveItem: (fromCanvasId: string, toCanvasId: string, itemId: string) => {\n        // Find item in source canvas\n        const sourceCanvas = this.stateManager!.state.canvases[fromCanvasId];\n        if (!sourceCanvas) {\n          console.warn(`Source canvas ${fromCanvasId} not found`);\n          return;\n        }\n\n        const item = sourceCanvas.items.find((i) => i.id === itemId);\n        if (!item) {\n          console.warn(`Item ${itemId} not found in canvas ${fromCanvasId}`);\n          return;\n        }\n\n        const sourceIndex = sourceCanvas.items.findIndex((i) => i.id === itemId);\n        const sourceZIndex = item.zIndex;\n        const sourcePosition = {\n          x: item.layouts.desktop.x,\n          y: item.layouts.desktop.y,\n        };\n        const targetPosition = {\n          x: item.layouts.desktop.x,\n          y: item.layouts.desktop.y,\n        };\n\n        // Calculate target z-index\n        let targetZIndex = sourceZIndex;\n        if (fromCanvasId !== toCanvasId) {\n          const targetCanvas = this.stateManager!.state.canvases[toCanvasId];\n          if (targetCanvas) {\n            targetZIndex = ++targetCanvas.zIndexCounter;\n          }\n        }\n\n        // Create and execute command\n        const command = new MoveItemCommand(\n          itemId,\n          fromCanvasId,\n          toCanvasId,\n          sourcePosition,\n          targetPosition,\n          sourceIndex,\n          sourceZIndex,\n          targetZIndex\n        );\n        command.redo();\n        this.undoRedoManager?.push(command);\n\n        // Emit event\n        this.eventManagerInstance?.emit(\"componentMoved\", {\n          itemId,\n          fromCanvasId,\n          toCanvasId,\n        });\n      },\n\n      setItemsZIndexBatch: (\n        changes: {\n          itemId: string;\n          canvasId: string;\n          newZIndex: number;\n        }[]\n      ) => {\n        if (changes.length === 0) {\n          return;\n        }\n\n        // Capture old z-index values before making changes\n        const changesWithOldValues = changes\n          .map(({ itemId, canvasId, newZIndex }) => {\n            const canvas = this.stateManager!.state.canvases[canvasId];\n            if (!canvas) {\n              console.warn(\n                `Canvas ${canvasId} not found for item ${itemId}, skipping`\n              );\n              return null;\n            }\n\n            const item = canvas.items.find((i) => i.id === itemId);\n            if (!item) {\n              console.warn(\n                `Item ${itemId} not found in canvas ${canvasId}, skipping`\n              );\n              return null;\n            }\n\n            const oldZIndex = item.zIndex;\n\n            // Skip if already at target z-index\n            if (oldZIndex === newZIndex) {\n              return null;\n            }\n\n            return {\n              itemId,\n              canvasId,\n              oldZIndex,\n              newZIndex,\n            };\n          })\n          .filter(Boolean) as {\n          itemId: string;\n          canvasId: string;\n          oldZIndex: number;\n          newZIndex: number;\n        }[];\n\n        // No valid changes after filtering\n        if (changesWithOldValues.length === 0) {\n          return;\n        }\n\n        // Apply all changes to instance state\n        changesWithOldValues.forEach(({ itemId, canvasId, newZIndex }) => {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            item.zIndex = newZIndex;\n          }\n        });\n\n        // Trigger reactivity (single state update for all changes)\n        this.stateManager!.state.canvases = { ...this.stateManager!.state.canvases };\n\n        // Create instance-aware undo/redo command\n        // TODO: Update ChangeZIndexCommand to support instance state\n        // For now, create an inline command that operates on instance state\n        const stateInstance = this.stateManager!.state;\n        const eventManager = this.eventManagerInstance;\n\n        const command = {\n          undo: () => {\n            // Restore old z-index for all affected items\n            changesWithOldValues.forEach((change) => {\n              const canvas = stateInstance.canvases[change.canvasId];\n              const item = canvas?.items.find((i) => i.id === change.itemId);\n              if (item) {\n                item.zIndex = change.oldZIndex;\n              }\n            });\n            stateInstance.canvases = { ...stateInstance.canvases };\n\n            // Emit event\n            if (changesWithOldValues.length === 1) {\n              const change = changesWithOldValues[0];\n              eventManager?.emit(\"zIndexChanged\", {\n                itemId: change.itemId,\n                canvasId: change.canvasId,\n                oldZIndex: change.newZIndex,\n                newZIndex: change.oldZIndex,\n              });\n            } else {\n              eventManager?.emit(\"zIndexBatchChanged\", {\n                changes: changesWithOldValues.map((change) => ({\n                  itemId: change.itemId,\n                  canvasId: change.canvasId,\n                  oldZIndex: change.newZIndex,\n                  newZIndex: change.oldZIndex,\n                })),\n              });\n            }\n          },\n          redo: () => {\n            // Reapply new z-index for all affected items\n            changesWithOldValues.forEach((change) => {\n              const canvas = stateInstance.canvases[change.canvasId];\n              const item = canvas?.items.find((i) => i.id === change.itemId);\n              if (item) {\n                item.zIndex = change.newZIndex;\n              }\n            });\n            stateInstance.canvases = { ...stateInstance.canvases };\n\n            // Emit event\n            if (changesWithOldValues.length === 1) {\n              const change = changesWithOldValues[0];\n              eventManager?.emit(\"zIndexChanged\", {\n                itemId: change.itemId,\n                canvasId: change.canvasId,\n                oldZIndex: change.oldZIndex,\n                newZIndex: change.newZIndex,\n              });\n            } else {\n              eventManager?.emit(\"zIndexBatchChanged\", {\n                changes: changesWithOldValues.map((change) => ({\n                  itemId: change.itemId,\n                  canvasId: change.canvasId,\n                  oldZIndex: change.oldZIndex,\n                  newZIndex: change.newZIndex,\n                })),\n              });\n            }\n          },\n        };\n\n        this.undoRedoManager?.push(command);\n\n        // Emit batch event\n        this.eventManagerInstance?.emit(\"zIndexBatchChanged\", {\n          changes: changesWithOldValues,\n        });\n      },\n\n      // ======================\n      // Custom Command Support\n      // ======================\n\n      pushCommand: (command: any) => {\n        this.undoRedoManager?.push(command);\n      },\n    };\n  }\n\n  /**\n   * Apply theme via CSS variables\n   *\n   * **Purpose**: Apply theme customization to host element\n   * **Implementation**: Set CSS custom properties on :host\n   */\n  private applyTheme(theme: GridBuilderTheme) {\n    const host = this.el;\n    if (!host) return;\n\n    // Apply predefined theme properties\n    if (theme.primaryColor) {\n      host.style.setProperty(\n        \"--grid-builder-primary-color\",\n        theme.primaryColor,\n      );\n    }\n    if (theme.paletteBackground) {\n      host.style.setProperty(\n        \"--grid-builder-palette-bg\",\n        theme.paletteBackground,\n      );\n    }\n    if (theme.canvasBackground) {\n      host.style.setProperty(\n        \"--grid-builder-canvas-bg\",\n        theme.canvasBackground,\n      );\n    }\n    if (theme.gridLineColor) {\n      host.style.setProperty(\n        \"--grid-builder-grid-line-color\",\n        theme.gridLineColor,\n      );\n    }\n    if (theme.selectionColor) {\n      host.style.setProperty(\n        \"--grid-builder-selection-color\",\n        theme.selectionColor,\n      );\n    }\n    if (theme.resizeHandleColor) {\n      host.style.setProperty(\n        \"--grid-builder-resize-handle-color\",\n        theme.resizeHandleColor,\n      );\n    }\n    if (theme.fontFamily) {\n      host.style.setProperty(\"--grid-builder-font-family\", theme.fontFamily);\n    }\n\n    // Apply custom properties\n    if (theme.customProperties) {\n      Object.entries(theme.customProperties).forEach(([key, value]) => {\n        host.style.setProperty(key, value);\n      });\n    }\n  }\n\n  /**\n   * Setup ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window viewport)\n   *\n   * **Observer callback**:\n   * 1. Get container width from ResizeObserver entry\n   * 2. Determine target viewport (mobile if < 768px, desktop otherwise)\n   * 3. Update this.stateManager!.state.currentViewport if changed\n   *\n   * **Why container-based**:\n   * - More flexible than window.resize (e.g., sidebar layouts, embedded widgets)\n   * - Grid-builder can be embedded at any size\n   * - Multiple instances can have different viewports on same page\n   *\n   * **Debouncing**: Not needed - ResizeObserver is already efficient\n   */\n  private setupViewportResizeObserver = () => {\n    if (!this.hostElement) {\n      return;\n    }\n\n    // Watch for grid-builder container size changes\n    this.viewportResizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Get container width directly from the element\n        // Note: We use offsetWidth instead of entry.contentRect.width because\n        // the grid-builder uses Shadow DOM and contentRect can return 0 for elements with height: 100%\n        const width =\n          this.hostElement.offsetWidth ||\n          entry.borderBoxSize?.[0]?.inlineSize ||\n          entry.contentRect.width;\n\n        // Skip viewport switching if width is 0 or very small (container not yet laid out)\n        // This prevents premature switching to mobile before CSS layout is complete\n        if (width < 100) {\n          debug.log(\n            `üì± Skipping viewport switch - container not yet laid out (width: ${Math.round(width)}px)`,\n          );\n          return;\n        }\n\n        // Determine target viewport based on container width\n        const targetViewport = width < 768 ? \"mobile\" : \"desktop\";\n\n        // Only update if viewport changed\n        if (this.stateManager!.state.currentViewport !== targetViewport) {\n          debug.log(\n            `üì± Container-based viewport switch: ${this.stateManager!.state.currentViewport} ‚Üí ${targetViewport} (width: ${Math.round(width)}px)`,\n          );\n          this.stateManager!.state.currentViewport = targetViewport;\n        }\n      }\n    });\n\n    this.viewportResizeObserver.observe(this.hostElement);\n  };\n\n  /**\n   * Setup screen reader announcements for dynamic changes\n   *\n   * **Purpose**: Subscribe to events and announce changes via ARIA live region\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Subscribes to**:\n   * - componentAdded: \"Component added to canvas\"\n   * - componentDeleted: \"Component deleted\"\n   * - componentMoved: \"Component moved to new canvas\"\n   * - undoExecuted: \"Undo action performed\"\n   * - redoExecuted: \"Redo action performed\"\n   * - canvasActivated: \"Canvas activated\"\n   *\n   * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n   */\n  private setupScreenReaderAnnouncements = () => {\n    // Component added\n    this.eventManagerInstance?.on(\"componentAdded\", (data: ComponentAddedEvent) => {\n      const definition = this.componentRegistry.get(data.item.type);\n      const componentName = definition?.name || data.item.type;\n      this.announce(`${componentName} component added to canvas`);\n    });\n\n    // Component deleted\n    this.eventManagerInstance?.on(\"componentDeleted\", (_data: ComponentDeletedEvent) => {\n      this.announce(`Component deleted`);\n    });\n\n    // Component moved (cross-canvas)\n    this.eventManagerInstance?.on(\"componentMoved\", (_data: ComponentMovedEvent) => {\n      this.announce(`Component moved to new canvas`);\n    });\n\n    // Undo/Redo with focus management\n    this.eventManagerInstance?.on(\"undoExecuted\", () => {\n      this.announce(`Undo action performed`);\n\n      // Restore focus to selected item after undo (if any)\n      this.restoreFocusToSelection();\n    });\n\n    this.eventManagerInstance?.on(\"redoExecuted\", () => {\n      this.announce(`Redo action performed`);\n\n      // Restore focus to selected item after redo (if any)\n      this.restoreFocusToSelection();\n    });\n\n    // Canvas activated\n    this.eventManagerInstance?.on(\"canvasActivated\", (data: CanvasActivatedEvent) => {\n      const metadata = this.canvasMetadata?.[data.canvasId];\n      const canvasTitle = metadata?.title || data.canvasId;\n      this.announce(`${canvasTitle} canvas activated`);\n    });\n  };\n\n  /**\n   * Announce message to screen readers via ARIA live region\n   *\n   * **Purpose**: Update announcement state for screen reader users\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Implementation**:\n   * - Updates @State() announcement property\n   * - Triggers re-render of ARIA live region\n   * - Screen reader automatically announces new content\n   * - Clears announcement after 100ms (prevents repeat announcements)\n   *\n   * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n   * @param message - Message to announce to screen reader users\n   */\n  private announce = (message: string) => {\n    this.announcement = message;\n\n    // Clear announcement after brief delay to allow re-announcing same message\n    setTimeout(() => {\n      this.announcement = \"\";\n    }, 100);\n  };\n\n  /**\n   * Move focus to next logical item after deletion\n   *\n   * **Purpose**: Improve keyboard navigation by maintaining focus context after deletion\n   * **Non-visual**: Uses programmatic focus, no visual changes\n   *\n   * **Focus strategy**:\n   * 1. Try to focus the next item in the same canvas (by y position, then x)\n   * 2. If no next item, try to focus the previous item\n   * 3. If no items left in canvas, focus the canvas container\n   * 4. If canvas not found, focus the component palette\n   *\n   * **WCAG Compliance**: 2.4.3 Focus Order (Level A)\n   * @param canvasId - Canvas that contained the deleted item\n   * @param _deletedItemId - ID of the item that was deleted (unused, for documentation)\n   */\n  private moveFocusAfterDeletion = (\n    canvasId: string,\n    _deletedItemId: string,\n  ) => {\n    // Get the canvas that contained the deleted item\n    const canvas = this.stateManager!.state.canvases[canvasId];\n    if (!canvas) {\n      debug.log(\"‚å®Ô∏è Focus: Canvas not found, focusing palette\");\n      // Focus the component palette as fallback\n      const paletteElement = this.hostElement.querySelector(\n        \"component-palette\",\n      ) as HTMLElement;\n      if (paletteElement) {\n        paletteElement.focus();\n      }\n      return;\n    }\n\n    // Get remaining items in the canvas\n    const remainingItems = canvas.items;\n\n    if (remainingItems.length === 0) {\n      debug.log(\"‚å®Ô∏è Focus: No items left, focusing canvas\");\n      // No items left in canvas - focus the canvas container\n      const canvasElement = this.hostElement.querySelector(\n        `canvas-section[canvas-id=\"${canvasId}\"]`,\n      ) as HTMLElement;\n      if (canvasElement) {\n        canvasElement.focus();\n      } else {\n        // Fallback to component palette\n        const paletteElement = this.hostElement.querySelector(\n          \"component-palette\",\n        ) as HTMLElement;\n        if (paletteElement) {\n          paletteElement.focus();\n        }\n      }\n      return;\n    }\n\n    // Sort items by position (top-to-bottom, left-to-right) to find next logical item\n    const sortedItems = [...remainingItems].sort((a, b) => {\n      const aLayout = a.layouts.desktop;\n      const bLayout = b.layouts.desktop;\n\n      // Sort by y position first (top to bottom)\n      if (aLayout.y !== bLayout.y) {\n        return aLayout.y - bLayout.y;\n      }\n\n      // If same y, sort by x position (left to right)\n      return aLayout.x - bLayout.x;\n    });\n\n    // Focus the first item in the sorted list\n    const nextItem = sortedItems[0];\n    debug.log(\"‚å®Ô∏è Focus: Focusing next item\", {\n      itemId: nextItem.id,\n      position: {\n        x: nextItem.layouts.desktop.x,\n        y: nextItem.layouts.desktop.y,\n      },\n    });\n\n    // Find the DOM element for the next item\n    const nextItemElement = this.hostElement.querySelector(\n      `#${nextItem.id}`,\n    ) as HTMLElement;\n    if (nextItemElement) {\n      // Focus the item element\n      nextItemElement.focus();\n\n      // Also select it in the state\n      this.stateManager!.state.selectedItemId = nextItem.id;\n      this.stateManager!.state.selectedCanvasId = nextItem.canvasId;\n    }\n  };\n\n  /**\n   * Restore focus to currently selected item (for undo/redo)\n   *\n   * **Purpose**: Maintain focus context after undo/redo operations\n   * **Non-visual**: Uses programmatic focus, no visual changes\n   *\n   * **Implementation**:\n   * - Check if an item is selected in state\n   * - Find the DOM element for that item\n   * - Focus it programmatically\n   * - Use setTimeout to ensure DOM has updated after state change\n   *\n   * **WCAG Compliance**: 2.4.3 Focus Order (Level A)\n   */\n  private restoreFocusToSelection = () => {\n    // Wait for DOM to update after state change\n    setTimeout(() => {\n      if (this.stateManager!.state.selectedItemId) {\n        debug.log(\"‚å®Ô∏è Focus: Restoring focus to selected item\", {\n          itemId: this.stateManager!.state.selectedItemId,\n        });\n\n        const selectedElement = this.hostElement.querySelector(\n          `#${this.stateManager!.state.selectedItemId}`,\n        ) as HTMLElement;\n\n        if (selectedElement) {\n          selectedElement.focus();\n        }\n      }\n    }, 10);\n  };\n\n  /**\n   * Export current state to JSON-serializable format\n   *\n   * **Purpose**: Export grid layout for saving or transferring to viewer app\n   *\n   * **Use Cases**:\n   * - Save layout to database/localStorage\n   * - Transfer layout to viewer app via API\n   * - Create layout templates/presets\n   * - Backup/restore functionality\n   *\n   * **Example - Save to API**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const exportData = await builder.exportState();\n   * await fetch('/api/layouts', {\n   * method: 'POST',\n   * headers: { 'Content-Type': 'application/json' },\n   * body: JSON.stringify(exportData)\n   * });\n   * ```\n   *\n   * **Example - Save to localStorage**:\n   * ```typescript\n   * const exportData = await builder.exportState();\n   * localStorage.setItem('grid-layout', JSON.stringify(exportData));\n   * ```\n   * @returns Promise<GridExport> - JSON-serializable export object\n   */\n  @Method()\n  async exportState(): Promise<GridExport> {\n    // Build export data from current gridState\n    const exportData: GridExport = {\n      version: \"1.0.0\",\n      canvases: {},\n      viewport: this.stateManager!.state.currentViewport,\n      metadata: {\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      },\n    };\n\n    // Export each canvas with its items\n    for (const canvasId in this.stateManager!.state.canvases) {\n      const canvas = this.stateManager!.state.canvases[canvasId];\n\n      exportData.canvases[canvasId] = {\n        items: canvas.items.map((item) => ({\n          id: item.id,\n          canvasId: item.canvasId,\n          type: item.type,\n          name: item.name,\n          layouts: {\n            desktop: { ...item.layouts.desktop },\n            mobile: { ...item.layouts.mobile },\n          },\n          zIndex: item.zIndex,\n          config: { ...item.config }, // Deep copy to avoid mutations\n        })),\n      };\n    }\n\n    return exportData;\n  }\n\n  /**\n   * Import state from JSON-serializable format\n   *\n   * **Purpose**: Restore previously exported grid state\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const savedState = JSON.parse(localStorage.getItem('grid-layout'));\n   * await builder.importState(savedState);\n   * ```\n   * @param state - GridExport or partial GridState object\n   */\n  @Method()\n  async importState(state: Partial<GridState> | GridExport) {\n    // Import grid state\n    Object.assign(this.stateManager!.state, state);\n  }\n\n  /**\n   * Get current grid state\n   *\n   * **Purpose**: Direct access to grid state for reading\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const state = await builder.getState();\n   * console.log('Current viewport:', state.currentViewport);\n   * ```\n   * @returns Promise<GridState> - Current grid state\n   */\n  @Method()\n  async getState(): Promise<GridState> {\n    return this.stateManager!.state;\n  }\n\n  /**\n   * Add a new canvas programmatically\n   *\n   * **Purpose**: Create new section/canvas in the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.addCanvas('new-section');\n   * ```\n   * @param canvasId - Unique canvas identifier\n   */\n  @Method()\n  async addCanvas(canvasId: string) {\n    this.api?.addCanvas(canvasId);\n  }\n\n  /**\n   * Remove a canvas programmatically\n   *\n   * **Purpose**: Delete section/canvas from the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.removeCanvas('old-section');\n   * ```\n   * @param canvasId - Canvas identifier to remove\n   */\n  @Method()\n  async removeCanvas(canvasId: string) {\n    this.api?.removeCanvas(canvasId);\n  }\n\n  /**\n   * Set active canvas programmatically\n   *\n   * **Purpose**: Activate a specific canvas for focused editing\n   *\n   * **Use cases**:\n   * - Focus specific section after adding items\n   * - Programmatic navigation between sections\n   * - Show canvas-specific settings panel\n   *\n   * **Events triggered**: 'canvasActivated'\n   * @param canvasId - Canvas to activate\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.setActiveCanvas('canvas2');\n   * ```\n   */\n  @Method()\n  async setActiveCanvas(canvasId: string) {\n    this.api?.setActiveCanvas(canvasId);\n  }\n\n  /**\n   * Get currently active canvas ID\n   *\n   * **Purpose**: Check which canvas is currently active/focused\n   * @returns Promise<string | null> - Active canvas ID or null if none active\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const activeId = await builder.getActiveCanvas();\n   * if (activeId === 'canvas1') {\n   *   console.log('Canvas 1 is active');\n   * }\n   * ```\n   */\n  @Method()\n  async getActiveCanvas(): Promise<string | null> {\n    return this.api?.getActiveCanvas() || null;\n  }\n\n  /**\n   * Undo last action\n   *\n   * **Purpose**: Revert last user action (move, resize, add, delete, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.undo();\n   * ```\n   */\n  @Method()\n  async undo() {\n    this.api?.undo();\n  }\n\n  /**\n   * Redo last undone action\n   *\n   * **Purpose**: Re-apply last undone action\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.redo();\n   * ```\n   */\n  @Method()\n  async redo() {\n    this.api?.redo();\n  }\n\n  /**\n   * Check if undo is available\n   *\n   * **Purpose**: Determine if there are actions to undo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canUndo = await builder.canUndo();\n   * undoButton.disabled = !canUndo;\n   * ```\n   * @returns Promise<boolean> - True if undo is available\n   */\n  @Method()\n  async canUndo(): Promise<boolean> {\n    return this.api?.canUndo() || false;\n  }\n\n  /**\n   * Check if redo is available\n   *\n   * **Purpose**: Determine if there are actions to redo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canRedo = await builder.canRedo();\n   * redoButton.disabled = !canRedo;\n   * ```\n   * @returns Promise<boolean> - True if redo is available\n   */\n  @Method()\n  async canRedo(): Promise<boolean> {\n    return this.api?.canRedo() || false;\n  }\n\n  /**\n   * Add a component programmatically\n   *\n   * **Purpose**: Add new component to canvas without dragging from palette\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const itemId = await builder.addComponent('canvas1', 'header', {\n   * x: 10, y: 10, width: 30, height: 6\n   * }, { title: 'My Header' });\n   * ```\n   * @param canvasId - Canvas to add component to\n   * @param componentType - Component type from registry\n   * @param position - Grid position and size\n   * @param config - Optional component configuration\n   * @returns Promise<string | null> - New item ID or null if failed\n   */\n  @Method()\n  async addComponent(\n    canvasId: string,\n    componentType: string,\n    position: { x: number; y: number; width: number; height: number },\n    config?: Record<string, any>,\n  ): Promise<string | null> {\n    return (\n      this.api?.addComponent(canvasId, componentType, position, config) || null\n    );\n  }\n\n  /**\n   * Delete a component programmatically\n   *\n   * **Purpose**: Remove component from grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.deleteComponent('item-123');\n   * ```\n   * @param itemId - Item ID to delete\n   * @returns Promise<boolean> - True if deleted successfully\n   */\n  @Method()\n  async deleteComponent(itemId: string): Promise<boolean> {\n    return this.api?.deleteComponent(itemId) || false;\n  }\n\n  /**\n   * Update component configuration\n   *\n   * **Purpose**: Update component properties/config\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.updateConfig('item-123', {\n   * title: 'Updated Title',\n   * color: '#ff0000'\n   * });\n   * ```\n   * @param itemId - Item ID to update\n   * @param config - Configuration updates\n   * @returns Promise<boolean> - True if updated successfully\n   */\n  @Method()\n  async updateConfig(\n    itemId: string,\n    config: Record<string, any>,\n  ): Promise<boolean> {\n    return this.api?.updateConfig(itemId, config) || false;\n  }\n\n  /**\n   * Reference to host element\n   */\n  private el?: HTMLElement;\n\n  /**\n   * Render component template\n   *\n   * **Purpose**: Render main UI structure\n   *\n   * **Structure**:\n   * - Host element with theme classes\n   * - Component palette (sidebar or custom)\n   * - Canvas area with sections\n   *\n   * **Note**: Actual rendering delegates to child components:\n   * - <component-palette> or custom ComponentPalette\n   * - <canvas-section> for each canvas\n   *\n   * **Config Panel**: Users should implement their own config panels\n   * - See custom-config-panel in demo for reference implementation\n   * - Listen to 'item-click' events to show your config UI\n   */\n  render() {\n    const canvasIds = Object.keys(this.stateManager!.state.canvases);\n\n    // Merge instanceId into config for child components (avoids mutating prop)\n    const configWithInstance = this.config\n      ? { ...this.config, instanceId: this.instanceId }\n      : { instanceId: this.instanceId };\n\n    return (\n      <Host ref={(el) => (this.el = el)}>\n        {/* ARIA Live Region for Screen Reader Announcements */}\n        <div\n          class=\"sr-only\"\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-atomic=\"true\"\n        >\n          {this.announcement}\n        </div>\n\n        <div\n          class=\"grid-builder-container\"\n          role=\"application\"\n          aria-label=\"Grid builder\"\n        >\n          {/* Canvas Area */}\n          <div class=\"canvas-area\">\n            {/* Canvases */}\n            <div class=\"canvases-container\">\n              {canvasIds.map((canvasId) => {\n                const isActive = this.stateManager!.state.activeCanvasId === canvasId;\n                const metadata = this.canvasMetadata?.[canvasId] || {};\n\n                // Render custom canvas header if provided\n                const headerElement = this.uiOverrides?.CanvasHeader?.({\n                  canvasId,\n                  metadata,\n                  isActive,\n                });\n\n                // Handle both vNode and HTMLElement returns\n                const headerContent =\n                  headerElement instanceof HTMLElement ? (\n                    <div\n                      ref={(el) => {\n                        if (el) {\n                          // Clear existing children to allow updates when active state changes\n                          el.innerHTML = \"\";\n                          el.appendChild(headerElement);\n                        }\n                      }}\n                    />\n                  ) : (\n                    headerElement\n                  );\n\n                return (\n                  <div key={canvasId} class=\"canvas-wrapper\">\n                    {headerContent}\n                    <canvas-section\n                      canvasId={canvasId}\n                      isActive={isActive}\n                      config={configWithInstance}\n                      componentRegistry={this.componentRegistry}\n                      backgroundColor={metadata.backgroundColor}\n                      canvasTitle={metadata.title}\n                      onBeforeDelete={this.onBeforeDelete}\n                      virtualRendererInstance={this.virtualRendererInstance}\n                      eventManagerInstance={this.eventManagerInstance}\n                      undoRedoManagerInstance={this.undoRedoManager}\n                      stateInstance={this.stateManager!.state}\n                      onStateChange={(key: string, callback: Function) => this.stateManager!.onChange(key, callback)}\n                      domCacheInstance={this.domCacheInstance}\n                      theme={this.theme}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"],"names":["defaultManager","debug"],"mappings":"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"}