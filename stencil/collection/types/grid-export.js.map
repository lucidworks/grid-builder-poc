{"version":3,"file":"grid-export.js","sourceRoot":"","sources":["../../src/types/grid-export.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA+BG;AAyNH;;;;;;;;;;GAUG;AACH,MAAM,UAAU,iBAAiB,CAAC,IAAS;IACzC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE,CAAC;QACtC,OAAO,KAAK,CAAC;IACf,CAAC;IAED,gBAAgB;IAChB,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,EAAE,CAAC;QAC7B,OAAO,KAAK,CAAC;IACf,CAAC;IAED,iBAAiB;IACjB,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,OAAO,IAAI,CAAC,QAAQ,KAAK,QAAQ,EAAE,CAAC;QACxD,OAAO,KAAK,CAAC;IACf,CAAC;IAED,iBAAiB;IACjB,IAAI,IAAI,CAAC,QAAQ,KAAK,SAAS,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,EAAE,CAAC;QAC9D,OAAO,KAAK,CAAC;IACf,CAAC;IAED,uBAAuB;IACvB,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACrC,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC;YAC5C,OAAO,KAAK,CAAC;QACf,CAAC;QAED,qBAAqB;QACrB,KAAK,MAAM,IAAI,IAAI,MAAM,CAAC,KAAK,EAAE,CAAC;YAChC,IACE,CAAC,IAAI,CAAC,EAAE;gBACR,CAAC,IAAI,CAAC,QAAQ;gBACd,CAAC,IAAI,CAAC,IAAI;gBACV,CAAC,IAAI,CAAC,OAAO;gBACb,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO;gBACrB,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM;gBACpB,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ;gBAC/B,CAAC,IAAI,CAAC,MAAM,EACZ,CAAC;gBACD,OAAO,KAAK,CAAC;YACf,CAAC;QACH,CAAC;IACH,CAAC;IAED,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["/**\n * Grid Export/Import Types\n * =========================\n *\n * JSON-serializable format for exporting layouts from builder and importing to viewer.\n *\n * ## Use Cases\n *\n * **Builder App** → Export layout to JSON:\n * ```typescript\n * const builder = document.querySelector('grid-builder');\n * const exportData = await builder.exportState();\n * await fetch('/api/layouts', {\n *   method: 'POST',\n *   body: JSON.stringify(exportData)\n * });\n * ```\n *\n * **Viewer App** → Import layout from JSON:\n * ```typescript\n * const layout = await fetch('/api/layouts/123').then(r => r.json());\n * const viewer = document.querySelector('grid-viewer');\n * viewer.initialState = layout;\n * ```\n *\n * ## Format Versioning\n *\n * The `version` field allows for future format changes while maintaining backwards compatibility.\n * Current version: '1.0.0'\n *\n * @module grid-export\n */\n\n/**\n * Grid item layout for a specific viewport\n *\n * **Desktop layout**: Always has concrete values\n * **Mobile layout**: Can be auto-generated (null values) or customized\n */\nexport interface GridItemLayout {\n  /** X position in grid units (0-50 for 2% grid) */\n  x: number | null;\n\n  /** Y position in grid units */\n  y: number | null;\n\n  /** Width in grid units */\n  width: number | null;\n\n  /** Height in grid units */\n  height: number | null;\n\n  /**\n   * Whether mobile layout is customized\n   *\n   * **false** (default): Auto-generate mobile layout (stack vertically, full width)\n   * **true**: Use explicit x/y/width/height values\n   */\n  customized?: boolean;\n}\n\n/**\n * Exported grid item (JSON-serializable)\n *\n * **Differences from GridItem**:\n * - Fully serializable to JSON\n * - No selection state\n * - Minimal metadata\n */\nexport interface GridExportItem {\n  /** Unique item identifier */\n  id: string;\n\n  /** Parent canvas identifier */\n  canvasId: string;\n\n  /** Component type (matches ComponentDefinition.type) */\n  type: string;\n\n  /** Display name (optional for viewer) */\n  name: string;\n\n  /**\n   * Responsive layouts\n   *\n   * **Desktop**: Always required with concrete values\n   * **Mobile**: Can be auto-generated or customized\n   */\n  layouts: {\n    desktop: GridItemLayout;\n    mobile: GridItemLayout;\n  };\n\n  /**\n   * Z-index for stacking order\n   *\n   * Higher values appear above lower values.\n   * Typically starts at 1 and increments for each new item.\n   */\n  zIndex: number;\n\n  /**\n   * Component-specific configuration\n   *\n   * **Must be JSON-serializable**:\n   * - Strings, numbers, booleans\n   * - Arrays and objects\n   * - NO functions, NO circular references\n   *\n   * **Example**:\n   * ```typescript\n   * {\n   *   title: 'Welcome',\n   *   fontSize: 24,\n   *   color: '#007bff',\n   *   alignment: 'center'\n   * }\n   * ```\n   */\n  config: Record<string, any>;\n}\n\n/**\n * Exported canvas (JSON-serializable)\n *\n * **Differences from Canvas**:\n * - No zIndexCounter (editing-only state)\n * - Items array is fully serialized\n */\nexport interface GridExportCanvas {\n  /** Grid items on this canvas */\n  items: GridExportItem[];\n\n  /**\n   * Canvas height (optional)\n   *\n   * Stores the current canvas height as a CSS value (e.g., '800px', '50vh').\n   * If not specified, canvas height will default to auto/content height.\n   *\n   * This allows canvases that have been dynamically expanded (via drag operations)\n   * to maintain their height when exported and re-imported.\n   */\n  height?: string;\n}\n\n/**\n * Complete grid export format\n *\n * **Root object for JSON serialization**\n *\n * ## Example Usage\n *\n * **Export from builder**:\n * ```typescript\n * const exportData: GridExport = {\n *   version: '1.0.0',\n *   canvases: {\n *     'hero-section': {\n *       items: [\n *         {\n *           id: 'header-1',\n *           canvasId: 'hero-section',\n *           type: 'header',\n *           name: 'Hero Header',\n *           layouts: {\n *             desktop: { x: 0, y: 0, width: 50, height: 6 },\n *             mobile: { x: null, y: null, width: null, height: null, customized: false }\n *           },\n *           zIndex: 1,\n *           config: { title: 'Welcome to My Site' }\n *         }\n *       ]\n *     }\n *   },\n *   viewport: 'desktop'\n * };\n *\n * // Serialize to JSON string\n * const json = JSON.stringify(exportData, null, 2);\n * ```\n *\n * **Import to viewer**:\n * ```typescript\n * const importData: GridExport = JSON.parse(json);\n * viewer.initialState = importData;\n * ```\n */\nexport interface GridExport {\n  /**\n   * Format version for compatibility\n   *\n   * **Semantic versioning**:\n   * - Major: Breaking changes (e.g., '2.0.0')\n   * - Minor: New fields (backwards compatible)\n   * - Patch: Bug fixes\n   *\n   * **Current version**: '1.0.0'\n   */\n  version: '1.0.0';\n\n  /**\n   * Canvas sections with their items\n   *\n   * **Key**: Canvas ID (e.g., 'hero-section', 'articles-grid')\n   * **Value**: Canvas data with items array\n   */\n  canvases: Record<string, GridExportCanvas>;\n\n  /**\n   * Current viewport mode\n   *\n   * **'desktop'**: Wide layout (side-by-side components)\n   * **'mobile'**: Narrow layout (stacked components)\n   *\n   * **Note**: Viewer can override this via props\n   */\n  viewport: 'desktop' | 'mobile';\n\n  /**\n   * Optional metadata\n   *\n   * **Use for**:\n   * - Layout name/title\n   * - Author information\n   * - Creation/modified timestamps\n   * - Custom app-specific data\n   */\n  metadata?: {\n    /** Layout name/title */\n    name?: string;\n\n    /** Layout description */\n    description?: string;\n\n    /** Author/creator */\n    author?: string;\n\n    /** Creation timestamp (ISO 8601) */\n    createdAt?: string;\n\n    /** Last modified timestamp (ISO 8601) */\n    updatedAt?: string;\n\n    /** Custom application-specific metadata */\n    [key: string]: any;\n  };\n}\n\n/**\n * Validation helper for GridExport format\n *\n * **Usage**:\n * ```typescript\n * const data = JSON.parse(jsonString);\n * if (!isValidGridExport(data)) {\n *   throw new Error('Invalid grid export format');\n * }\n * ```\n */\nexport function isValidGridExport(data: any): data is GridExport {\n  if (!data || typeof data !== 'object') {\n    return false;\n  }\n\n  // Check version\n  if (data.version !== '1.0.0') {\n    return false;\n  }\n\n  // Check canvases\n  if (!data.canvases || typeof data.canvases !== 'object') {\n    return false;\n  }\n\n  // Check viewport\n  if (data.viewport !== 'desktop' && data.viewport !== 'mobile') {\n    return false;\n  }\n\n  // Validate each canvas\n  for (const canvasId in data.canvases) {\n    const canvas = data.canvases[canvasId];\n    if (!canvas || !Array.isArray(canvas.items)) {\n      return false;\n    }\n\n    // Validate each item\n    for (const item of canvas.items) {\n      if (\n        !item.id ||\n        !item.canvasId ||\n        !item.type ||\n        !item.layouts ||\n        !item.layouts.desktop ||\n        !item.layouts.mobile ||\n        typeof item.zIndex !== 'number' ||\n        !item.config\n      ) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n"]}