{"file":"state-manager-9d34a2f0.js","mappings":"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","names":[],"sources":["src/services/state-manager.ts"],"sourcesContent":["/**\n * State Manager\n * ==============\n *\n * Centralized reactive state management for the grid builder using StencilJS Store.\n * Manages grid items, canvases, layouts, selection state, and viewport configuration\n * with automatic component re-renders on state changes.\n *\n * ## Problem\n *\n * Complex interactive applications need:\n * - Centralized state accessible across all components\n * - Automatic UI updates when state changes\n * - Type-safe state mutations\n * - Undo/redo support (requires state snapshots)\n * - Desktop + mobile layout management\n * - Selection tracking across multiple canvases\n *\n * Without centralized state:\n * - Props drilling through component hierarchies\n * - Manual event subscriptions and cleanup\n * - Synchronization issues between components\n * - Difficult undo/redo implementation\n *\n * ## Solution\n *\n * Use @stencil/store for reactive state management with:\n * 1. **Single source of truth**: All state in one store\n * 2. **Automatic reactivity**: Components re-render on state changes\n * 3. **Type safety**: Full TypeScript support\n * 4. **Simple API**: Direct property access (no actions/reducers)\n * 5. **Lightweight**: ~1KB, built into StencilJS\n *\n * ## Architecture Decisions\n *\n * ### Why @stencil/store vs Redux/Zustand?\n *\n * **@stencil/store chosen because**:\n * - ✅ Native StencilJS integration (zero setup)\n * - ✅ Automatic component subscriptions (no manual connect/subscribe)\n * - ✅ Simple mutation API (direct property assignment)\n * - ✅ Tiny bundle size (~1KB)\n * - ✅ Full TypeScript support\n * - ✅ Perfect for component-scoped state\n *\n * **Redux would add**:\n * - ❌ Boilerplate (actions, reducers, dispatch)\n * - ❌ Bundle size (~15KB min)\n * - ❌ Learning curve (middleware, selectors)\n * - ❌ Manual component subscriptions\n *\n * **Zustand would work but**:\n * - ⚠️ External dependency (not StencilJS native)\n * - ⚠️ Manual subscriptions in StencilJS\n * - ⚠️ Less TypeScript integration\n *\n * ### Dual Layout System (Desktop + Mobile)\n *\n * Each grid item has TWO layout configurations:\n *\n * **Desktop Layout** (always present):\n * - Primary layout with full positioning data\n * - x, y, width, height in grid units\n * - Never null, always has values\n *\n * **Mobile Layout** (optional/auto-generated):\n * - x, y, width, height can be null\n * - `customized: false` → auto-generated from desktop layout\n * - `customized: true` → user manually positioned in mobile view\n *\n * **Why dual layouts**:\n * - Different screen sizes need different layouts\n * - Mobile can auto-adapt OR be manually customized\n * - Single item definition works across viewports\n *\n * **Auto-generation strategy**:\n * ```typescript\n * // When mobile layout is null (not customized):\n * // - Full width items (span entire mobile viewport)\n * // - Stacked vertically\n * // - Responsive heights\n *\n * // When mobile.customized = true:\n * // - Use explicit mobile.x, mobile.y, mobile.width, mobile.height\n * // - Ignore desktop layout\n * ```\n *\n * ### State Mutation Pattern\n *\n * **Immutable spread pattern** for reactivity:\n * ```typescript\n * // ❌ Wrong: Direct mutation doesn't trigger updates\n * canvas.items.push(newItem);\n *\n * // ✅ Correct: Spread triggers reactivity\n * canvas.items.push(newItem);\n * state.canvases = { ...state.canvases };\n * ```\n *\n * **Why this pattern**:\n * - StencilJS store detects reference changes\n * - Object spread creates new reference\n * - Components automatically re-render\n * - Simple and performant\n *\n * ### Z-Index Management\n *\n * **Per-canvas z-index tracking**:\n * - Each canvas has `zIndexCounter` (monotonically increasing)\n * - New items get `zIndexCounter++`\n * - Ensures unique z-index per canvas\n * - Higher z-index = rendered on top\n *\n * **Why per-canvas**:\n * - Items in different canvases don't overlap\n * - Simplifies z-index calculations\n * - Prevents z-index conflicts\n * - Independent stacking contexts\n *\n * **Bringing to front**:\n * ```typescript\n * item.zIndex = canvas.zIndexCounter++;\n * state.canvases = { ...state.canvases }; // Trigger update\n * ```\n *\n * ## State Structure\n *\n * ```typescript\n * {\n *   canvases: {\n *     'canvas1': {\n *       items: [GridItem, GridItem, ...],\n *       zIndexCounter: 5,\n *       backgroundColor: '#ffffff'\n *     },\n *     'canvas2': { ... },\n *     ...\n *   },\n *   selectedItemId: 'item-3' | null,\n *   selectedCanvasId: 'canvas1' | null,\n *   currentViewport: 'desktop' | 'mobile',\n *   showGrid: true | false\n * }\n * ```\n *\n * ## Performance Characteristics\n *\n * **State access**: O(1) - direct property access\n * **State updates**: O(n) - spread operation copies references\n * **Component re-renders**: Only components consuming changed state\n * **Memory**: Lightweight (~1KB store + actual state data)\n *\n * **Optimization**: Immutable updates only copy top-level references,\n * not deep clones. Child objects remain same reference if unchanged.\n *\n * ## Integration with Undo/Redo\n *\n * State structure supports undo/redo via snapshots:\n * ```typescript\n * // Save snapshot\n * const snapshot = JSON.parse(JSON.stringify(state.canvases));\n *\n * // Restore snapshot\n * state.canvases = JSON.parse(JSON.stringify(snapshot));\n * ```\n *\n * Deep cloning required because:\n * - Prevents mutations from affecting history\n * - Ensures independent state snapshots\n * - Simple and reliable (no ref tracking)\n *\n * ## Extracting This Pattern\n *\n * To adapt for other frameworks:\n *\n * **React + Zustand**:\n * ```typescript\n * import create from 'zustand';\n *\n * const useStore = create<GridState>((set) => ({\n *   ...initialState,\n *   addItem: (canvasId, item) => set((state) => ({\n *     canvases: {\n *       ...state.canvases,\n *       [canvasId]: {\n *         ...state.canvases[canvasId],\n *         items: [...state.canvases[canvasId].items, item]\n *       }\n *     }\n *   }))\n * }));\n * ```\n *\n * **Vue + Pinia**:\n * ```typescript\n * import { defineStore } from 'pinia';\n *\n * export const useGridStore = defineStore('grid', {\n *   state: () => initialState,\n *   actions: {\n *     addItem(canvasId, item) {\n *       this.canvases[canvasId].items.push(item);\n *     }\n *   }\n * });\n * ```\n *\n * **Angular + NgRx**:\n * ```typescript\n * export const addItem = createAction(\n *   '[Grid] Add Item',\n *   props<{ canvasId: string; item: GridItem }>()\n * );\n *\n * export const gridReducer = createReducer(\n *   initialState,\n *   on(addItem, (state, { canvasId, item }) => ({\n *     ...state,\n *     canvases: {\n *       ...state.canvases,\n *       [canvasId]: {\n *         ...state.canvases[canvasId],\n *         items: [...state.canvases[canvasId].items, item]\n *       }\n *     }\n *   }))\n * );\n * ```\n *\n * @module state-manager\n */\n\nimport { createStore } from '@stencil/store';\n\n/**\n * Grid Item Interface\n * ====================\n *\n * Core data structure representing a single component instance in the grid.\n * Each item has dual layouts (desktop + mobile) and positioning metadata.\n *\n * **Lifecycle**:\n * 1. Created when dropped from palette or added programmatically\n * 2. Updated during drag/resize operations\n * 3. Persisted in state for undo/redo\n * 4. Removed when deleted\n *\n * **Key Properties**:\n * - `id`: Unique identifier (generated via generateItemId)\n * - `canvasId`: Which canvas owns this item\n * - `type`: Component type ('header', 'text', 'button', etc.)\n * - `name`: Display name (shown in UI)\n * - `layouts`: Desktop and mobile positioning\n * - `zIndex`: Stacking order within canvas\n *\n * **Type System Integration**:\n * The `type` field determines which component renders via dynamic imports:\n * ```typescript\n * switch (item.type) {\n *   case 'header': return <component-header />;\n *   case 'text': return <component-text-block />;\n *   case 'button': return <component-button />;\n *   // ...\n * }\n * ```\n */\nexport interface GridItem {\n  id: string;\n  canvasId: string;\n  type: string;\n  name: string;\n  layouts: {\n    desktop: {\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n    };\n    mobile: {\n      x: number | null;\n      y: number | null;\n      width: number | null;\n      height: number | null;\n      customized: boolean;\n    };\n  };\n  zIndex: number;\n}\n\n/**\n * Canvas Interface\n */\nexport interface Canvas {\n  items: GridItem[];\n  zIndexCounter: number;\n  backgroundColor: string;\n}\n\n/**\n * Grid State Interface\n */\nexport interface GridState {\n  canvases: Record<string, Canvas>;\n  selectedItemId: string | null;\n  selectedCanvasId: string | null;\n  currentViewport: 'desktop' | 'mobile';\n  showGrid: boolean;\n}\n\n/**\n * Initial State with prepopulated demo items\n */\nconst initialState: GridState = {\n  canvases: {\n    canvas1: {\n      items: [\n        // Hero section demo items\n        {\n          id: 'item-1',\n          canvasId: 'canvas1',\n          type: 'header',\n          name: 'Header',\n          layouts: {\n            desktop: { x: 2, y: 2, width: 20, height: 6 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 1,\n        },\n        {\n          id: 'item-2',\n          canvasId: 'canvas1',\n          type: 'text',\n          name: 'Text',\n          layouts: {\n            desktop: { x: 2, y: 9, width: 20, height: 5 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 2,\n        },\n        {\n          id: 'item-3',\n          canvasId: 'canvas1',\n          type: 'button',\n          name: 'Button',\n          layouts: {\n            desktop: { x: 2, y: 15, width: 9, height: 4 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 3,\n        },\n        {\n          id: 'item-4',\n          canvasId: 'canvas1',\n          type: 'image',\n          name: 'Image',\n          layouts: {\n            desktop: { x: 23, y: 2, width: 15, height: 12 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 4,\n        },\n      ],\n      zIndexCounter: 5,\n      backgroundColor: '#ffffff',\n    },\n    canvas2: {\n      items: [\n        // Content section demo items\n        {\n          id: 'item-5',\n          canvasId: 'canvas2',\n          type: 'header',\n          name: 'Header',\n          layouts: {\n            desktop: { x: 2, y: 2, width: 18, height: 4 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 1,\n        },\n        {\n          id: 'item-6',\n          canvasId: 'canvas2',\n          type: 'text',\n          name: 'Text',\n          layouts: {\n            desktop: { x: 2, y: 7, width: 18, height: 8 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 2,\n        },\n        {\n          id: 'item-7',\n          canvasId: 'canvas2',\n          type: 'video',\n          name: 'Video',\n          layouts: {\n            desktop: { x: 21, y: 2, width: 17, height: 13 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 3,\n        },\n      ],\n      zIndexCounter: 4,\n      backgroundColor: '#f5f5f5',\n    },\n    canvas3: {\n      items: [\n        // Footer section demo items\n        {\n          id: 'item-8',\n          canvasId: 'canvas3',\n          type: 'text',\n          name: 'Text',\n          layouts: {\n            desktop: { x: 2, y: 2, width: 15, height: 5 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 1,\n        },\n        {\n          id: 'item-9',\n          canvasId: 'canvas3',\n          type: 'button',\n          name: 'Button',\n          layouts: {\n            desktop: { x: 18, y: 2, width: 8, height: 4 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 2,\n        },\n        {\n          id: 'item-10',\n          canvasId: 'canvas3',\n          type: 'button',\n          name: 'Button',\n          layouts: {\n            desktop: { x: 27, y: 2, width: 8, height: 4 },\n            mobile: { x: null, y: null, width: null, height: null, customized: false },\n          },\n          zIndex: 3,\n        },\n      ],\n      zIndexCounter: 4,\n      backgroundColor: '#ffffff',\n    },\n  },\n  selectedItemId: null,\n  selectedCanvasId: null,\n  currentViewport: 'desktop',\n  showGrid: true,\n};\n\n/**\n * Global Grid State Store\n */\nconst { state, onChange, dispose } = createStore<GridState>(initialState);\n\n// Wrap reset to also reset the ID counter and restore initial state\nexport function reset() {\n  itemIdCounter = 10; // Reset to 10 to account for prepopulated items\n\n  // Restore initial state with prepopulated items\n  state.canvases = JSON.parse(JSON.stringify(initialState.canvases));\n  state.selectedItemId = null;\n  state.selectedCanvasId = null;\n  state.currentViewport = 'desktop';\n  state.showGrid = true;\n}\n\nexport { state as gridState, onChange, dispose };\n\n/**\n * Helper Functions\n */\n\n/**\n * Add item to canvas\n */\nexport function addItemToCanvas(canvasId: string, item: GridItem) {\n  const canvas = state.canvases[canvasId];\n  if (!canvas) {\n    return;\n  }\n\n  canvas.items.push(item);\n  state.canvases = { ...state.canvases }; // Trigger update\n}\n\n/**\n * Remove item from canvas\n */\nexport function removeItemFromCanvas(canvasId: string, itemId: string) {\n  const canvas = state.canvases[canvasId];\n  if (!canvas) {\n    return;\n  }\n\n  canvas.items = canvas.items.filter((item) => item.id !== itemId);\n  state.canvases = { ...state.canvases }; // Trigger update\n}\n\n/**\n * Update item in canvas\n */\nexport function updateItem(canvasId: string, itemId: string, updates: Partial<GridItem>) {\n  const canvas = state.canvases[canvasId];\n  if (!canvas) {\n    return;\n  }\n\n  const item = canvas.items.find((i) => i.id === itemId);\n  if (!item) {\n    return;\n  }\n\n  Object.assign(item, updates);\n  state.canvases = { ...state.canvases }; // Trigger update\n}\n\n/**\n * Get item by ID\n */\nexport function getItem(canvasId: string, itemId: string): GridItem | null {\n  const canvas = state.canvases[canvasId];\n  if (!canvas) {\n    return null;\n  }\n\n  return canvas.items.find((i) => i.id === itemId) || null;\n}\n\n/**\n * Move item to different canvas\n */\nexport function moveItemToCanvas(fromCanvasId: string, toCanvasId: string, itemId: string) {\n  const fromCanvas = state.canvases[fromCanvasId];\n  const toCanvas = state.canvases[toCanvasId];\n\n  if (!fromCanvas || !toCanvas) {\n    return;\n  }\n\n  const item = fromCanvas.items.find((i) => i.id === itemId);\n  if (!item) {\n    return;\n  }\n\n  // Remove from old canvas\n  fromCanvas.items = fromCanvas.items.filter((i) => i.id !== itemId);\n\n  // Update item's canvasId\n  item.canvasId = toCanvasId;\n\n  // Add to new canvas\n  toCanvas.items.push(item);\n\n  state.canvases = { ...state.canvases }; // Trigger update\n}\n\n/**\n * Generate unique item ID\n */\nlet itemIdCounter = 10; // Start at 10 to account for prepopulated items (item-1 through item-10)\nexport function generateItemId(): string {\n  return `item-${++itemIdCounter}`;\n}\n\n/**\n * Select item\n */\nexport function selectItem(itemId: string, canvasId: string) {\n  state.selectedItemId = itemId;\n  state.selectedCanvasId = canvasId;\n}\n\n/**\n * Deselect item\n */\nexport function deselectItem() {\n  state.selectedItemId = null;\n  state.selectedCanvasId = null;\n}\n"],"version":3}