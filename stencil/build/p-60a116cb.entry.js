import{r as t,h as i}from"./p-4Z_c7dK2.js";import{i as s}from"./p-BKH_Whl_.js";import{s as e,g as a,o as n}from"./p-Dn6kA53k.js";import{s as o,b as r,g as h,a as c}from"./p-B5eO_qMn.js";import{c as d}from"./p-BL_TKl2v.js";const l=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}@keyframes canvas-highlight-pulse{0%,100%{box-shadow:0 0 0 0 var(--primary-color, #f59e0b);opacity:1}50%{box-shadow:0 0 0 4px var(--primary-color, #f59e0b);opacity:0.7}}.canvas-highlight{animation:canvas-highlight-pulse 600ms ease-out}@keyframes position-indicator-fade{0%{opacity:0.8}70%{opacity:0.8}100%{opacity:0}}.position-indicator{position:absolute;border:2px dashed var(--primary-color, #007bff);opacity:0.8;pointer-events:none;z-index:9999;animation:position-indicator-fade 800ms ease-out forwards}";const p=class{constructor(i){t(this,i);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.isDropTarget=false;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){e(this.canvasId);const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const i=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(i)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((t=>{requestAnimationFrame((()=>{var i,s;for(const e of t){const t=e.contentRect.width;console.log("[BUILD-2025-12-01-02:15] ResizeObserver fired (RAF)",{canvasId:this.canvasId,instanceId:(i=this.config)===null||i===void 0?void 0:i.instanceId,observedWidth:t,clientWidth:(s=this.gridContainerRef)===null||s===void 0?void 0:s.clientWidth});if(t>100){o(this.canvasId,t,this.config);console.log("  → Pre-populated cache with correct value");this.renderVersion++}else{console.log("  → Skipped (width too small, waiting for layout)")}}}))}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=s(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{this.isDropTarget=true},dragleave:t=>{this.isDropTarget=false},drop:t=>{this.isDropTarget=false;let i=t.relatedTarget;const s=i.closest(".palette-item");if(s){i=s}const e=i.classList.contains("palette-item");if(e){i._dropWasValid=true}const a=i.classList.contains("grid-item-header");const n=i.classList.contains("grid-item");const o=a?i.closest(".grid-item"):i;if(e){const s=i.getAttribute("data-component-type");const e=i._defaultWidth||10;const a=i._defaultHeight||6;const n=r(e,this.canvasId,this.config);const o=h(a,this.config);const c=n/2;const d=o/2;const l=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-l.left-c;const v=t.dragEvent.clientY-l.top-d;const f=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:s,x:p,y:v},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(f)}else if(n||a){const t=o.id;const i=o.getAttribute("data-canvas-id");if(i!==this.canvasId){const s=o.getBoundingClientRect();const e=this.gridContainerRef.getBoundingClientRect();const a=s.left-e.left;const n=s.top-e.top;const r=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:i,targetCanvasId:this.canvasId,x:a,y:n},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(r)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=(this.stateInstance||a).canvases[this.canvasId];this.calculatedHeight=d(this.canvasId,this.config,this.stateInstance);const t=this.onStateChange||n;t("canvases",(()=>{try{if(this.canvasId&&(this.stateInstance||a).canvases[this.canvasId]){this.canvas=(this.stateInstance||a).canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=d(this.canvasId,this.config,this.stateInstance)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));t("currentViewport",(()=>{this.calculatedHeight=d(this.canvasId,this.config,this.stateInstance)}));t("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=(this.stateInstance||a).canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,i){if(t===i)return;this.canvas=(this.stateInstance||a).canvases[t];this.calculatedHeight=d(t,this.config,this.stateInstance);if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,i){if(t===i)return;this.calculatedHeight=d(this.canvasId,t,this.stateInstance);this.renderVersion++}handleIsActiveChange(t,i){if(t===i)return}render(){var t,s,e,n,o,r;const d=(this.stateInstance||a).showGrid;const l=c(this.config);const p=(s=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&s!==void 0?s:20;const v=h(p,this.config);return i("div",{key:"e815455a2df2e17b38c2898028cc7fe5eebe08ff",class:"canvas-section","data-canvas-id":this.canvasId},i("div",{key:"fc96a4e58fd74834cdaabb410ffbdda394d61ca1",class:{"grid-container":true,"hide-grid":!d,active:this.isActive,"drop-target":this.isDropTarget},id:this.canvasId,role:"region","aria-label":this.canvasTitle||`Canvas ${this.canvasId}`,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${l}px`,backgroundImage:d?`linear-gradient(${((e=this.theme)===null||e===void 0?void 0:e.gridLineColor)||"rgba(0, 0, 0, 0.05)"} 1px, transparent 1px), linear-gradient(90deg, ${((n=this.theme)===null||n===void 0?void 0:n.gridLineColor)||"rgba(0, 0, 0, 0.05)"} 1px, transparent 1px)`:"none",minHeight:`${v}px`,["--primary-color"]:((o=this.theme)===null||o===void 0?void 0:o.primaryColor)||"#007bff"},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(r=this.canvas)===null||r===void 0?void 0:r.items.map((t=>i("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete,virtualRendererInstance:this.virtualRendererInstance,eventManagerInstance:this.eventManagerInstance,stateInstance:this.stateInstance,theme:this.theme})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};p.style=l;export{p as canvas_section};
//# sourceMappingURL=p-60a116cb.entry.js.map