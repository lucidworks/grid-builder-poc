import{r as t,h as e}from"./p-CC73Dkup.js";import{i}from"./p-BKH_Whl_.js";import{a as s,s as n,o}from"./p-CDiz7xEh.js";import{c as a,b as r,g as c,a as h}from"./p-CcbD7Svb.js";import{a as d}from"./p-DZpb-Vl1.js";const l=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}";const p=class{constructor(e){t(this,e);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.isDropTarget=false;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){s(this.canvasId);const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const e=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(e)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((()=>{a();this.renderVersion++}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=i(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{this.isDropTarget=true},dragleave:t=>{this.isDropTarget=false},drop:t=>{this.isDropTarget=false;const e=t.relatedTarget;const i=e.classList.contains("palette-item");if(i){e._dropWasValid=true}const s=e.classList.contains("grid-item-header");const n=e.classList.contains("grid-item");const o=s?e.closest(".grid-item"):e;if(i){const i=e.getAttribute("data-component-type");const s=e._defaultWidth||10;const n=e._defaultHeight||6;const o=r(s,this.canvasId,this.config);const a=c(n);const h=o/2;const d=a/2;const l=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-l.left-h;const f=t.dragEvent.clientY-l.top-d;const m=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:i,x:p,y:f},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(m)}else if(n||s){const t=o.id;const e=o.getAttribute("data-canvas-id");if(e!==this.canvasId){const i=o.getBoundingClientRect();const s=this.gridContainerRef.getBoundingClientRect();const n=i.left-s.left;const a=i.top-s.top;const r=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:e,targetCanvasId:this.canvasId,x:n,y:a},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(r)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=n.canvases[this.canvasId];this.calculatedHeight=d(this.canvasId,this.config);o("canvases",(()=>{try{if(this.canvasId&&n.canvases[this.canvasId]){this.canvas=n.canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=d(this.canvasId,this.config)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));o("currentViewport",(()=>{this.calculatedHeight=d(this.canvasId,this.config)}));o("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=n.canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){i(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,e){if(t===e)return;this.canvas=n.canvases[t];this.calculatedHeight=d(t,this.config);if(this.gridContainerRef&&this.dropzoneInitialized){i(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,e){if(t===e)return;this.calculatedHeight=d(this.canvasId,t);this.renderVersion++}handleIsActiveChange(t,e){if(t===e)return}render(){var t,i,s;const o=n.showGrid;const a=h(this.config);const r=(i=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&i!==void 0?i:20;const d=c(r,this.config);return e("div",{key:"3dc37262a5f15cf588dc292cb61cbb67ed865cf9",class:"canvas-section","data-canvas-id":this.canvasId},e("div",{key:"9a5ad4c2ccc630070eefca751d9c5c0d6aa4490f",class:{"grid-container":true,"hide-grid":!o,active:this.isActive,"drop-target":this.isDropTarget},id:this.canvasId,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${a}px`,minHeight:`${d}px`},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(s=this.canvas)===null||s===void 0?void 0:s.items.map((t=>e("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};p.style=l;const f=".palette{width:250px;padding:20px;border-right:1px solid #ddd;background:white;overflow-y:auto}.palette h2{margin-bottom:20px;color:#333;font-size:18px}.palette-chromeless{padding-top:10px}.palette-empty{color:#999;font-size:13px;font-style:italic}.palette-item{padding:15px;border-radius:4px;margin-bottom:10px;background:#4a90e2;color:white;cursor:move;font-weight:500;text-align:center;transition:transform 0.2s, box-shadow 0.2s;user-select:none;touch-action:none;}.palette-item:hover{box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);transform:translateY(-2px)}.palette-item.dragging-from-palette{opacity:0.5}.dragging-clone{position:fixed;z-index:10000;pointer-events:none}";const m=class{constructor(e){t(this,e);this.showHeader=true;this.draggingItemType=null;this.initializePaletteItems=()=>{const t=document.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){return}i(t).draggable({inertia:false,autoScroll:false,listeners:{start:t=>{const e=t.target.getAttribute("data-component-type");this.draggingItemType=e;const i=t.target.getBoundingClientRect();t.target._originalPosition={left:i.left,top:i.top};t.target._dropWasValid=false;const s=this.components.find((t=>t.type===e));if(!s){console.warn(`Component definition not found for type: ${e}`);return}const n=s.defaultSize||{width:10,height:6};const o=window.gridState;const a=(o===null||o===void 0?void 0:o.canvases)?Object.keys(o.canvases):[];const h=a.length>0?a[0]:null;let d;let l;if(h){d=r(n.width,h,this.config);l=c(n.height)}else{const t=20;d=n.width*t;l=n.height*t}const p=d/2;const f=l/2;const m=document.createElement("div");m.className="dragging-clone";m.style.position="fixed";m.style.left=t.clientX-p+"px";m.style.top=t.clientY-f+"px";m.style.pointerEvents="none";m.style.zIndex="10000";if(s.renderDragClone){const t=s.renderDragClone({componentType:e,name:s.name,icon:s.icon,width:d,height:l});m.innerHTML=t}else{m.style.width=d+"px";m.style.height=l+"px";m.style.padding="20px";m.style.background="rgba(74, 144, 226, 0.9)";m.style.color="#ffffff";m.style.borderRadius="4px";m.innerHTML=`\n                <div style="font-weight: 600; color: #ffffff; font-size: 14px;">${s.icon} ${s.name}</div>\n              `}document.body.appendChild(m);t.target._dragClone=m;t.target._halfWidth=p;t.target._halfHeight=f;t.target._defaultWidth=n.width;t.target._defaultHeight=n.height},move:t=>{const e=t.target._dragClone;const i=t.target._halfWidth;const s=t.target._halfHeight;if(e){e.style.left=t.clientX-i+"px";e.style.top=t.clientY-s+"px"}},end:t=>{this.draggingItemType=null;const e=t.target._dragClone;const i=t.target._dropWasValid;const s=t.target._originalPosition;if(e){if(!i&&s){e.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";e.style.left=s.left+"px";e.style.top=s.top+"px";e.style.opacity="0";setTimeout((()=>{e.remove()}),300)}else{e.remove()}delete t.target._dragClone;delete t.target._halfWidth;delete t.target._halfHeight;delete t.target._dropWasValid;delete t.target._originalPosition}}}});t._dragInitialized=true}))}}handleComponentsChange(t,e){if(t===e)return;if(!e)return;requestAnimationFrame((()=>{this.initializePaletteItems()}))}handleConfigChange(t,e){if(t===e)return}componentDidLoad(){this.initializePaletteItems()}componentDidUpdate(){this.initializePaletteItems()}render(){const t={palette:true,"palette-chromeless":!this.showHeader};if(!this.components||this.components.length===0){return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),e("p",{class:"palette-empty"},"No components available"))}return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),this.components.map((t=>{const i={"palette-item":true,"dragging-from-palette":this.draggingItemType===t.type};return e("div",{class:i,"data-component-type":t.type,key:t.type},t.renderPaletteItem?t.renderPaletteItem({componentType:t.type,name:t.name,icon:t.icon}):`${t.icon} ${t.name}`)})))}disconnectedCallback(){const t=document.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){i(t).unset();delete t._dragInitialized}}))}static get watchers(){return{components:["handleComponentsChange"],config:["handleConfigChange"]}}};m.style=f;export{p as canvas_section,m as component_palette};
//# sourceMappingURL=p-865139c2.entry.js.map