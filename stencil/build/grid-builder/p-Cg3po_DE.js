import{s as t,b as s,d as n,c as o}from"./p-CDiz7xEh.js";import{e as i}from"./p-C411GiWR.js";class e{constructor(){this.observer=null;this.observedElements=new Map;this.initialize()}initialize(){this.observer=new IntersectionObserver((t=>{t.forEach((t=>{const s=t.target.id;const n=this.observedElements.get(s);if(n){n(t.isIntersecting)}}))}),{rootMargin:"200px",threshold:[0,.01]})}observe(t,s,n){if(!this.observer||!t){return}this.observedElements.set(s,n);this.observer.observe(t)}unobserve(t,s){if(!this.observer||!t){return}this.observedElements.delete(s);this.observer.unobserve(t)}destroy(){if(this.observer){this.observer.disconnect();this.observer=null}this.observedElements.clear()}}const c=new e;function r(){if(typeof process!=="undefined"&&process.env&&"production"==="development");if(typeof process!=="undefined"&&process.env&&"production"==="test");return false}const d={log(...t){if(r()){console.log(...t)}},warn(...t){if(r()){console.warn(...t)}},error(...t){if(r()){console.error(...t)}},group(t,s){if(r()){console.group(t);s();console.groupEnd()}},isEnabled(){return r()}};function a(t){return{log(...s){d.log(`[${t}]`,...s)},warn(...s){d.warn(`[${t}]`,...s)},error(...s){d.error(`[${t}]`,...s)},group(s,n){d.group(`[${t}] ${s}`,n)},isEnabled(){return d.isEnabled()}}}const u=a("undo-redo-commands");class h{constructor(t,s,n,o,i,e,c,r){this.itemId=t;this.sourceCanvasId=s;this.targetCanvasId=n;this.sourcePosition=Object.assign({},o);this.targetPosition=Object.assign({},i);this.sourceSize=c?Object.assign({},c):undefined;this.targetSize=r?Object.assign({},r):undefined;this.sourceIndex=e}undo(){u.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let s=t.canvases[this.targetCanvasId];let n=s===null||s===void 0?void 0:s.items.find((t=>t.id===this.itemId));if(!n){for(const o in t.canvases){const i=t.canvases[o];n=i.items.find((t=>t.id===this.itemId));if(n){s=i;break}}}if(!n||!s){console.warn("  âŒ Item or canvas not found, aborting undo");return}u.log("  ðŸ“ Found item, current position:",{x:n.layouts.desktop.x,y:n.layouts.desktop.y});s.items=s.items.filter((t=>t.id!==this.itemId));n.canvasId=this.sourceCanvasId;n.layouts.desktop.x=this.sourcePosition.x;n.layouts.desktop.y=this.sourcePosition.y;u.log("  âœ… Updated item position to:",{x:n.layouts.desktop.x,y:n.layouts.desktop.y});if(this.sourceSize){n.layouts.desktop.width=this.sourceSize.width;n.layouts.desktop.height=this.sourceSize.height}const o=t.canvases[this.sourceCanvasId];if(!o){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=o.items.length){o.items.splice(this.sourceIndex,0,n)}else{o.items.push(n)}t.canvases=Object.assign({},t.canvases);const i=document.getElementById(this.itemId);if(i){u.log("  ðŸŽ¨ Clearing inline transform style");i.style.transform=""}u.log("  âœ… Undo complete")}redo(){u.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const s=t.canvases[this.sourceCanvasId];const n=s===null||s===void 0?void 0:s.items.find((t=>t.id===this.itemId));if(!n){console.warn("  âŒ Item not found, aborting redo");return}u.log("  ðŸ“ Found item, current position:",{x:n.layouts.desktop.x,y:n.layouts.desktop.y});s.items=s.items.filter((t=>t.id!==this.itemId));n.canvasId=this.targetCanvasId;n.layouts.desktop.x=this.targetPosition.x;n.layouts.desktop.y=this.targetPosition.y;u.log("  âœ… Updated item position to:",{x:n.layouts.desktop.x,y:n.layouts.desktop.y});if(this.targetSize){n.layouts.desktop.width=this.targetSize.width;n.layouts.desktop.height=this.targetSize.height}const o=t.canvases[this.targetCanvasId];if(!o){console.warn("  âŒ Target canvas not found, aborting redo");return}o.items.push(n);t.canvases=Object.assign({},t.canvases);const i=document.getElementById(this.itemId);if(i){u.log("  ðŸŽ¨ Clearing inline transform style");i.style.transform=""}u.log("  âœ… Redo complete")}}class l{constructor(s){this.itemsData=s.map((s=>{const n=Object.values(t.canvases).flatMap((t=>t.items)).find((t=>t.id===s));return n?JSON.parse(JSON.stringify(n)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));n(t)}redo(){const s=Object.assign({},t.canvases);for(const t of this.itemsData){const n=s[t.canvasId];if(n){const s=n.items.some((s=>s.id===t.id));if(!s){n.items.push(t)}}}t.canvases=s}}class f{constructor(s){this.itemsData=s.map((s=>{const n=Object.values(t.canvases).flatMap((t=>t.items)).find((t=>t.id===s));return n?JSON.parse(JSON.stringify(n)):null})).filter(Boolean)}undo(){const s=Object.assign({},t.canvases);for(const t of this.itemsData){const n=s[t.canvasId];if(n){const s=n.items.some((s=>s.id===t.id));if(!s){n.items.push(t)}}}t.canvases=s}redo(){const t=this.itemsData.map((t=>t.id));n(t)}}class v{constructor(s){this.updates=s.map((({itemId:s,canvasId:n,updates:o})=>{const i=t.canvases[n];const e=i===null||i===void 0?void 0:i.items.find((t=>t.id===s));if(!e){return null}return{itemId:s,canvasId:n,oldItem:JSON.parse(JSON.stringify(e)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},e),o)))}})).filter(Boolean)}undo(){const t=this.updates.map((({itemId:t,canvasId:s,oldItem:n})=>({itemId:t,canvasId:s,updates:n})));s(t)}redo(){const t=this.updates.map((({itemId:t,canvasId:s,newItem:n})=>({itemId:t,canvasId:s,updates:n})));s(t)}}class m{constructor(t){this.description="Add Canvas";this.canvasId=t}undo(){u.log("ðŸ”™ AddCanvasCommand.undo() - removing canvas:",this.canvasId);delete t.canvases[this.canvasId];t.canvases=Object.assign({},t.canvases);u.log("  ðŸ“¢ Emitting canvasRemoved event for:",this.canvasId);i.emit("canvasRemoved",{canvasId:this.canvasId})}redo(){t.canvases[this.canvasId]={zIndexCounter:1,items:[]};t.canvases=Object.assign({},t.canvases);i.emit("canvasAdded",{canvasId:this.canvasId})}}class p{constructor(s){this.description="Remove Canvas";this.canvasSnapshot=null;this.canvasId=s;const n=t.canvases[s];if(n){this.canvasSnapshot=JSON.parse(JSON.stringify(n))}}undo(){if(this.canvasSnapshot){t.canvases[this.canvasId]=JSON.parse(JSON.stringify(this.canvasSnapshot));t.canvases=Object.assign({},t.canvases);i.emit("canvasAdded",{canvasId:this.canvasId})}}redo(){delete t.canvases[this.canvasId];t.canvases=Object.assign({},t.canvases);i.emit("canvasRemoved",{canvasId:this.canvasId})}}const I=a("undo-redo");const{state:O}=o({canUndo:false,canRedo:false});const b={push:S,undo:N,redo:w,canUndo:J,canRedo:x,clearHistory:A};const j=[];let g=-1;const C=50;function y(){O.canUndo=g>=0;O.canRedo=g<j.length-1}function S(t){I.log("âž• PUSH: Adding command to history:",t.description||t);j.splice(g+1);j.push(t);if(j.length>C){j.shift()}else{g++}I.log("  History position now:",g,", Total commands:",j.length);y()}function N(){if(g<0){return}const t=j[g];I.log("ðŸ”™ UNDO: Executing command at position",g,":",t);I.log("  Command description:",t.description);t.undo();g--;I.log("  New position after undo:",g);y()}function w(){if(g>=j.length-1){return}g++;const t=j[g];t.redo();y()}function J(){return g>=0}function x(){return g<j.length-1}function A(){j.length=0;g=-1;y()}const R=50;function $(t,s=R){var n;const o=((n=t.minSize)===null||n===void 0?void 0:n.width)||0;return o<=s}function M(t,s=R){var n,o,i,e;const c=t.defaultSize.width;const r=t.defaultSize.height;const d=((n=t.minSize)===null||n===void 0?void 0:n.width)||0;const a=((o=t.maxSize)===null||o===void 0?void 0:o.width)||Infinity;let u=c;let h=r;let l=false;if(u>s){u=s;l=true}if(u<d){u=d}if(u>a){u=a}const f=((i=t.minSize)===null||i===void 0?void 0:i.height)||0;const v=((e=t.maxSize)===null||e===void 0?void 0:e.height)||Infinity;if(h<f){h=f}if(h>v){h=v}return{width:u,height:h,wasAdjusted:l}}function U(t,s,n,o,i=R){let e=t;let c=s;let r=false;if(e<0){e=0;r=true}if(e+n>i){e=i-n;r=true}if(c<0){c=0;r=true}e=Math.max(0,e);c=Math.max(0,c);return{x:e,y:c,width:n,height:o,positionAdjusted:r,sizeAdjusted:false}}function z(t,s,n,o=R){var i;if(!$(t,o)){console.warn(`Component "${t.name}" minSize (${(i=t.minSize)===null||i===void 0?void 0:i.width}) `+`exceeds canvas width (${o}). Placement rejected.`);return null}const e=M(t,o);const c=U(s,n,e.width,e.height,o);return Object.assign(Object.assign({},c),{sizeAdjusted:e.wasAdjusted})}export{m as A,v as B,R as C,h as M,p as R,a,z as b,U as c,O as d,f as e,l as f,S as p,b as u,c as v};
//# sourceMappingURL=p-Cg3po_DE.js.map