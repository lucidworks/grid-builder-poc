import{g as t,f as n}from"./p-CC73Dkup.js";const e=(t,n,e)=>{const s=t.get(n);if(!s){t.set(n,[e])}else if(!s.includes(e)){s.push(e)}};const s=(t,n)=>{let e;return(...s)=>{if(e){clearTimeout(e)}e=setTimeout((()=>{e=0;t(...s)}),n)}};const o=t=>!("isConnected"in t)||t.isConnected;const c=s((t=>{for(let n of t.keys()){t.set(n,t.get(n).filter(o))}}),2e3);const r=()=>{if(typeof t!=="function"){return{}}const s=new Map;return{dispose:()=>s.clear(),get:n=>{const o=t();if(o){e(s,n,o)}},set:t=>{const e=s.get(t);if(e){s.set(t,e.filter(n))}c(s)},reset:()=>{s.forEach((t=>t.forEach(n)));c(s)}}};const i=t=>typeof t==="function"?t():t;const u=(t,n=(t,n)=>t!==n)=>{const e=i(t);let s=new Map(Object.entries(e??{}));const o={dispose:[],get:[],set:[],reset:[]};const c=new Map;const r=()=>{s=new Map(Object.entries(i(t)??{}));o.reset.forEach((t=>t()))};const u=()=>{o.dispose.forEach((t=>t()));r()};const f=t=>{o.get.forEach((n=>n(t)));return s.get(t)};const d=(t,e)=>{const c=s.get(t);if(n(e,c,t)){s.set(t,e);o.set.forEach((n=>n(t,e,c)))}};const l=typeof Proxy==="undefined"?{}:new Proxy(e,{get(t,n){return f(n)},ownKeys(t){return Array.from(s.keys())},getOwnPropertyDescriptor(){return{enumerable:true,configurable:true}},has(t,n){return s.has(n)},set(t,n,e){d(n,e);return true}});const p=(t,n)=>{o[t].push(n);return()=>{a(o[t],n)}};const m=(n,e)=>{const s=(t,s)=>{if(t===n){e(s)}};const o=()=>e(i(t)[n]);const r=p("set",s);const u=p("reset",o);c.set(e,{setHandler:s,resetHandler:o,propName:n});return()=>{r();u();c.delete(e)}};const g=(...t)=>{const n=t.reduce(((t,n)=>{if(n.set){t.push(p("set",n.set))}if(n.get){t.push(p("get",n.get))}if(n.reset){t.push(p("reset",n.reset))}if(n.dispose){t.push(p("dispose",n.dispose))}return t}),[]);return()=>n.forEach((t=>t()))};const b=t=>{const n=s.get(t);o.set.forEach((e=>e(t,n,n)))};const v=(t,n)=>{const e=c.get(n);if(e&&e.propName===t){a(o.set,e.setHandler);a(o.reset,e.resetHandler);c.delete(n)}};return{state:l,get:f,set:d,on:p,onChange:m,use:g,dispose:u,reset:r,forceUpdate:b,removeListener:v}};const a=(t,n)=>{const e=t.indexOf(n);if(e>=0){t[e]=t[t.length-1];t.length--}};const f=(t,n)=>{const e=u(t,n);e.use(r());return e};const d={canvases:{canvas1:{items:[],zIndexCounter:1},canvas2:{items:[],zIndexCounter:1},canvas3:{items:[],zIndexCounter:1}},selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,currentViewport:"desktop",showGrid:true};const{state:l,onChange:p}=f(d);function m(t,n,e){const s=l.canvases[t];if(!s){return}const o=s.items.find((t=>t.id===n));if(!o){return}Object.assign(o,e);l.canvases=Object.assign({},l.canvases)}function g(t,n,e){const s=l.canvases[t];const o=l.canvases[n];if(!s||!o){return}const c=s.items.find((t=>t.id===e));if(!c){return}s.items=s.items.filter((t=>t.id!==e));c.canvasId=n;o.items.push(c);l.canvases=Object.assign({},l.canvases)}let b=0;function v(){return`item-${++b}`}function w(t){l.activeCanvasId=t}function j(t){const n=[];const e=Object.assign({},l.canvases);for(const s of t){const t=v();const o=s.canvasId;const c=e[o];if(!c){console.warn(`Canvas ${o} not found, skipping item`);continue}const r={id:t,canvasId:o,type:s.type||"unknown",name:s.name||"Unnamed",layouts:s.layouts||{desktop:{x:0,y:0,width:20,height:10},mobile:{x:null,y:null,width:null,height:null,customized:false}},zIndex:c.zIndexCounter++,config:s.config||{}};c.items.push(r);n.push(t)}l.canvases=e;return n}function y(t){const n=new Set(t);const e=Object.assign({},l.canvases);for(const t in e){e[t]=Object.assign(Object.assign({},e[t]),{items:e[t].items.filter((t=>!n.has(t.id)))})}l.canvases=e}function C(t){const n=Object.assign({},l.canvases);for(const{itemId:e,canvasId:s,updates:o}of t){const t=n[s];if(!t){console.warn(`Canvas ${s} not found, skipping item ${e}`);continue}const c=t.items.find((t=>t.id===e));if(!c){console.warn(`Item ${e} not found in canvas ${s}`);continue}Object.assign(c,o)}l.canvases=n}export{w as a,C as b,f as c,y as d,j as e,v as g,g as m,p as o,l as s,m as u};
//# sourceMappingURL=p-CDiz7xEh.js.map