{"version":3,"file":"canvas-section.entry.esm.js","sources":["src/components/canvas-section/canvas-section.scss?tag=canvas-section","src/components/canvas-section/canvas-section.tsx"],"sourcesContent":["/**\n * Canvas Section Styles\n * ======================\n *\n * Styles for canvas-section component providing grid background and container.\n */\n\n/* Canvas Section Container - Flush sections with title tab on right */\n.canvas-section {\n  position: relative;\n  display: flex;\n  width: 100%;\n  margin: 0; /* Flush sections - no gaps */\n  padding: 0; /* Flush sections - no gaps */\n  flex-direction: column;\n}\n\n/* Grid Container */\n.grid-container {\n  position: relative;\n  width: 100%;\n  /* min-height set dynamically via inline style (grid-based) */\n  background-image: linear-gradient(rgba(0, 0, 0, 5%) 1px, transparent 1px),\n    linear-gradient(90deg, rgba(0, 0, 0, 5%) 1px, transparent 1px);\n  /* background-size set dynamically via inline style (config-based) */\n  transition: background-color 0.2s;\n}\n\n/* Hide grid when toggle disabled */\n.grid-container.hide-grid {\n  background-image: none;\n}\n\n/* Active canvas highlighting */\n.grid-container.active {\n  outline: 2px solid var(--primary-color, #007bff);\n  outline-offset: -2px;\n  box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.3);\n}\n\n/* Drop target highlighting (when dragging over canvas) */\n/* Only show drop target styling if canvas is not already active */\n.grid-container.drop-target:not(.active) {\n  outline: 3px dashed var(--primary-color, #007bff);\n  outline-offset: -3px;\n  box-shadow:\n    0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent),\n    inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);\n  background-color: color-mix(in srgb, var(--primary-color) 8%, transparent);\n}\n\n/* Canvas title styling - consumer can override */\n.canvas-title {\n  opacity: 0.3;\n  transition: opacity 0.2s ease;\n}\n\n/* Undim canvas title when canvas is active */\n/* Targets .canvas-header that precedes an active canvas-section */\n.canvas-header:has(+ canvas-section .grid-container.active) .canvas-title {\n  opacity: 1;\n}\n\n/* ========================================\n * Click-to-Add Visual Feedback Animations\n * ========================================\n * Animations for click-to-add feature providing visual feedback\n * when users click palette items to add components.\n */\n\n/* Canvas Highlight Animation (Pulse on Border) */\n@keyframes canvas-highlight-pulse {\n  0%,\n  100% {\n    box-shadow: 0 0 0 0 var(--primary-color, #f59e0b);\n    opacity: 1;\n  }\n  50% {\n    box-shadow: 0 0 0 4px var(--primary-color, #f59e0b);\n    opacity: 0.7;\n  }\n}\n\n.canvas-highlight {\n  animation: canvas-highlight-pulse 600ms ease-out;\n}\n\n/* Position Indicator (Ghost Outline) */\n@keyframes position-indicator-fade {\n  0% {\n    opacity: 0.8;\n  }\n  70% {\n    opacity: 0.8;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.position-indicator {\n  position: absolute;\n  border: 2px dashed var(--primary-color, #007bff);\n  opacity: 0.8;\n  pointer-events: none;\n  z-index: 9999;\n  animation: position-indicator-fade 800ms ease-out forwards;\n}\n","/**\n * Canvas Section Component\n * ========================\n *\n * Individual canvas dropzone with grid background and item rendering.\n * This is a library component designed to work with the grid-builder component.\n *\n * ## Purpose\n *\n * Provides a single canvas section with:\n * - **Dropzone**: Accepts palette items and grid items via interact.js\n * - **Grid background**: Visual 2% horizontal × 20px vertical grid\n * - **Item rendering**: Renders all items on this canvas\n * - **ResizeObserver**: Invalidates grid cache on resize\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Section controls (background color picker, clear button, delete button)\n * - Section header with number\n * - Confirm dialogs\n * - section-delete events\n *\n * **Library-specific features**:\n * - Clean canvas without UI controls\n * - Grid background based on GridConfig\n * - Designed to be used inside grid-builder component\n *\n * ## Dropzone Behavior\n *\n * **Accepts two types of drops**:\n *\n * ### 1. Palette Item (Create New)\n * ```typescript\n * new CustomEvent('canvas-drop', {\n * detail: { canvasId, componentType, x, y },\n * bubbles: true,\n * composed: true\n * })\n * ```\n *\n * ### 2. Grid Item (Cross-Canvas Move)\n * ```typescript\n * new CustomEvent('canvas-move', {\n * detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n * bubbles: true,\n * composed: true\n * })\n * ```\n *\n * ## Grid Background\n *\n * **CSS grid pattern**:\n * - Horizontal: 2% of container width (responsive)\n * - Vertical: 20px (fixed)\n * - Color: rgba(0,0,0,0.05)\n * - Toggleable via gridState.showGrid\n *\n * ## Performance\n *\n * **ResizeObserver**: Clears grid cache on container resize\n * **Virtual rendering**: Items use VirtualRenderer for lazy loading\n * **Render version**: Forces item recalculation on resize\n * @module canvas-section\n */\n\nimport { Component, h, Prop, State, Watch } from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Internal imports\nimport { Canvas, GridItem } from \"../../services/state-manager\";\nimport {\n  setGridSizeCache,\n  gridToPixelsX,\n  gridToPixelsY,\n  getGridSizeVertical,\n} from \"../../utils/grid-calculations\";\nimport { calculateCanvasHeight } from \"../../utils/canvas-height-calculator\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { DeletionHook } from \"../../types/deletion-hook\";\nimport { VirtualRendererService } from \"../../services/virtual-renderer\";\nimport { EventManager } from \"../../services/event-manager\";\nimport { UndoRedoManager } from \"../../services/undo-redo\";\nimport { DOMCache } from \"../../utils/dom-cache\";\nimport { ComponentRegistry } from \"../../services/component-registry\";\nimport { GridErrorAdapter } from \"../../services/grid-error-adapter\";\n\n/**\n * CanvasSection Component\n * =======================\n *\n * Library component providing individual canvas dropzone.\n *\n * **Tag**: `<canvas-section>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: \"canvas-section\",\n  styleUrl: \"canvas-section.scss\",\n  shadow: false, // Light DOM required for interact.js\n})\nexport class CanvasSection {\n  /**\n   * Canvas ID for state management\n   *\n   * **Format**: 'canvas1', 'canvas2', etc.\n   * **Purpose**: Key for accessing canvas data in gridState.canvases\n   * **Required**: Component won't render without valid canvasId\n   */\n  @Prop() canvasId!: string;\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Grid size calculations, constraints\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Component registry (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (built from components prop)\n   * **Structure**: ComponentRegistry service instance\n   * **Purpose**: Pass to grid-item-wrapper for dynamic rendering\n   */\n  @Prop() componentRegistry?: ComponentRegistry;\n\n  /**\n   * Background color for this canvas\n   *\n   * **Host app responsibility**: Pass canvas styling from host app\n   * **Library does NOT store**: backgroundColor is presentation concern\n   * **Optional**: Defaults to '#ffffff'\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   backgroundColor=\"#f0f4f8\"\n   * />\n   * ```\n   */\n  @Prop() backgroundColor?: string;\n\n  /**\n   * Canvas title (from canvasMetadata)\n   *\n   * **Optional**: Display title for this section\n   * **Renders as**: Rotated tab on right side, outside section bounds\n   * **Builder mode only**: Title tabs visible in builder, not viewer\n   * **Source**: Passed from grid-builder via canvasMetadata[canvasId].title\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   canvasTitle=\"Hero Section\"\n   * />\n   * ```\n   */\n  @Prop() canvasTitle?: string;\n\n  /**\n   * Whether this canvas is currently active\n   *\n   * **Purpose**: Indicate which canvas is currently focused/active\n   * **Source**: Computed from gridState.activeCanvasId in grid-builder\n   * **Default**: false\n   * **Visual effect**: Applies 'active' CSS class to grid-container\n   *\n   * **Canvas becomes active when**:\n   * - User clicks item on canvas\n   * - User clicks canvas background\n   * - User starts dragging item on canvas\n   * - User starts resizing item on canvas\n   * - Programmatically via api.setActiveCanvas()\n   *\n   * **Consumer styling hook**:\n   * Consumer can style active canvas via CSS:\n   * ```css\n   * .grid-container.active .canvas-title {\n   * opacity: 1;\n   * }\n   * ```\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   isActive={gridState.activeCanvasId === 'hero-section'}\n   * />\n   * ```\n   */\n  @Prop() isActive?: boolean = false;\n\n  /**\n   * Deletion hook (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (from onBeforeDelete prop)\n   * **Purpose**: Pass through to grid-item-wrapper for deletion interception\n   * **Optional**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: DeletionHook;\n\n  /**\n   * Virtual renderer service instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated services\n   */\n  @Prop() virtualRendererInstance?: VirtualRendererService;\n\n  /**\n   * Undo/Redo manager service instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated undo/redo stacks\n   */\n  @Prop() undoRedoManagerInstance?: UndoRedoManager;\n\n  /**\n   * Event manager service instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated services\n   */\n  @Prop() eventManagerInstance?: EventManager;\n\n  /**\n   * State manager instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated state\n   * **Used by**: DragHandler, ResizeHandler for accessing canvases and viewport\n   */\n  @Prop() stateInstance?: any;\n\n  /**\n   * State change subscription function (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder (this.stateManager.onChange)\n   * **Purpose**: Subscribe to instance-specific state changes for reactivity\n   *\n   * **Usage**:\n   * ```typescript\n   * onStateChange={(key, callback) => this.stateManager.onChange(key, callback)}\n   * ```\n   */\n  @Prop() onStateChange?: (key: string, callback: Function) => void;\n\n  /**\n   * DOM cache service instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated DOM caches\n   * **Used by**: DragHandler, ResizeHandler for fast canvas element lookups\n   */\n  @Prop() domCacheInstance?: DOMCache;\n\n  /**\n   * Theme configuration (from parent grid-builder)\n   *\n   * **Optional prop**: Theme for selection colors\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Pass theme.selectionColor to grid-item-wrapper for component selection styling\n   */\n  @Prop() theme?: any;\n\n  /**\n   * Error adapter service instance (passed from grid-builder)\n   *\n   * **Required for editing mode** (grid-builder provides this)\n   * **Optional for viewer mode** (grid-viewer doesn't need it)\n   *\n   * **Source**: grid-builder → canvas-section → grid-item-wrapper\n   * **Purpose**: Support multiple grid-builder instances with isolated error handling\n   * **Used by**: Error boundary for handling canvas-level and item-level render errors\n   *\n   * **Error isolation strategy**:\n   * - Canvas-level errors (dropzone failures, canvas rendering issues) caught here\n   * - Item-level errors caught by grid-item-wrapper error boundaries\n   * - Error adapter converts to GridErrorEventDetail and emits to EventManager\n   */\n  @Prop() errorAdapterInstance?: GridErrorAdapter;\n\n  /**\n   * Canvas state (reactive)\n   *\n   * **Source**: gridState.canvases[canvasId]\n   * **Updates**: componentWillLoad, componentWillUpdate, onChange subscription\n   * **Contains**: items array, zIndexCounter (NO backgroundColor - that's a prop now)\n   */\n  @State() canvas: Canvas;\n\n  /**\n   * Render version counter (forces re-renders)\n   *\n   * **Purpose**: Trigger re-renders when grid calculations change\n   * **Incremented on**: ResizeObserver events, state changes\n   * **Passed to**: grid-item-wrapper as prop\n   * **Why needed**: Grid calculations cached, need to recalculate on resize\n   */\n  @State() renderVersion: number = 0;\n\n  /**\n   * Calculated canvas height (content-based)\n   *\n   * **Purpose**: Dynamic canvas height based on bottommost item\n   * **Calculation**: `(bottommost item y + height) + 5 grid units margin`\n   * **Updates**: Real-time on item add/move/delete/resize\n   * **Minimum**: 0 (CSS min-height: 400px will apply)\n   *\n   * **Formula**:\n   * ```\n   * calculatedHeight = gridToPixelsY(maxItemBottom + 5)\n   * ```\n   *\n   * **Applied in render**:\n   * ```typescript\n   * style={{ height: calculatedHeight > 0 ? `${calculatedHeight}px` : undefined }}\n   * ```\n   */\n  @State() private calculatedHeight: number = 0;\n\n  /**\n   * Drop target state\n   *\n   * **Internal state**: Tracks whether this canvas is currently a valid drop target\n   * **Used for**: Adding 'drop-target' class for visual feedback during drag operations\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - false: No drag is over this canvas\n   * - true: A draggable element is currently over this canvas\n   */\n  @State() private isDropTarget: boolean = false;\n\n  /**\n   * Grid container DOM reference\n   *\n   * **Used for**:\n   * - interact.js dropzone setup\n   * - ResizeObserver monitoring\n   * - Position calculations (getBoundingClientRect)\n   */\n  private gridContainerRef: HTMLElement;\n\n  /**\n   * Dropzone initialization flag\n   *\n   * **Prevents**: Multiple dropzone setups on same element\n   * **Set in**: initializeDropzone()\n   * **Checked in**: initializeDropzone(), disconnectedCallback()\n   */\n  private dropzoneInitialized: boolean = false;\n\n  /**\n   * ResizeObserver instance\n   *\n   * **Monitors**: gridContainerRef size changes\n   * **Callback**: Clears grid cache, increments renderVersion\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private resizeObserver: ResizeObserver;\n\n  /**\n   * Component will load lifecycle hook\n   *\n   * **Called**: Before first render\n   * **Purpose**: Load initial canvas state and subscribe to changes\n   *\n   * **Operations**:\n   * 1. Load canvas from global state\n   * 2. Subscribe to 'canvases' state changes\n   * 3. Update local canvas state on changes\n   * 4. Increment renderVersion to trigger item re-renders\n   */\n  componentWillLoad() {\n    // Initial load\n    this.canvas = this.stateInstance.canvases[this.canvasId];\n\n    // Calculate initial height\n    this.calculatedHeight = calculateCanvasHeight(\n      this.canvasId,\n      this.config,\n      this.stateInstance,\n    );\n\n    // Subscribe to state changes\n    this.onStateChange(\"canvases\", () => {\n      try {\n        if (this.canvasId && this.stateInstance.canvases[this.canvasId]) {\n          this.canvas = this.stateInstance.canvases[this.canvasId];\n          this.renderVersion++; // Force re-render\n\n          // Recalculate canvas height based on content\n          this.calculatedHeight = calculateCanvasHeight(\n            this.canvasId,\n            this.config,\n            this.stateInstance,\n          );\n        }\n      } catch (error) {\n        console.debug(\"Canvas section state update skipped:\", error);\n      }\n    });\n\n    // Subscribe to viewport changes (desktop ↔ mobile)\n    this.onStateChange(\"currentViewport\", () => {\n      // Recalculate height for new viewport layout\n      this.calculatedHeight = calculateCanvasHeight(\n        this.canvasId,\n        this.config,\n        this.stateInstance,\n      );\n    });\n\n    // Subscribe to grid visibility changes\n    this.onStateChange(\"showGrid\", () => {\n      // Force re-render to update grid visibility class\n      this.renderVersion++;\n    });\n  }\n\n  /**\n   * Component will update lifecycle hook\n   *\n   * **Called**: Before each re-render\n   * **Purpose**: Ensure canvas reference is fresh from state\n   */\n  componentWillUpdate() {\n    this.canvas = this.stateInstance.canvases[this.canvasId];\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize interact.js dropzone and ResizeObserver\n   */\n  componentDidLoad() {\n    this.initializeDropzone();\n    this.setupResizeObserver();\n    this.setupCanvasClickListener();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component removed from DOM\n   * **Purpose**: Clean up interact.js and ResizeObserver\n   */\n  disconnectedCallback() {\n    // Cleanup interact.js\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n    }\n\n    // Cleanup ResizeObserver\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n  }\n\n  /**\n   * Watch for canvasId prop changes\n   *\n   * **When triggered**: Parent changes which canvas this component displays\n   * **Actions**: Reload canvas data from state, recalculate height\n   *\n   * **Why needed**:\n   * - Canvas ID is the key to access state\n   * - Changing canvas ID means displaying different canvas\n   * - Must reload items, metadata, and recalculate layout\n   *\n   * **Note**: This is rare in practice - usually canvas IDs are static\n   */\n  @Watch(\"canvasId\")\n  handleCanvasIdChange(newCanvasId: string, oldCanvasId: string) {\n    // Skip if canvas ID hasn't changed\n    if (newCanvasId === oldCanvasId) return;\n\n    // Reload canvas data from state\n    this.canvas = this.stateInstance.canvases[newCanvasId];\n\n    // Recalculate canvas height for new canvas\n    this.calculatedHeight = calculateCanvasHeight(\n      newCanvasId,\n      this.config,\n      this.stateInstance,\n    );\n\n    // Reinitialize dropzone with new canvas ID\n    // (dropzone needs to know which canvas it belongs to)\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n      this.dropzoneInitialized = false;\n      this.initializeDropzone();\n    }\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Recalculate canvas height with new grid settings\n   *\n   * **Why needed**:\n   * - Grid calculations depend on config (min/max grid size, etc.)\n   * - Canvas height calculation uses grid-to-pixels conversions\n   * - Config changes affect layout calculations\n   */\n  @Watch(\"config\")\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Recalculate canvas height with new config (use instance state if available)\n    this.calculatedHeight = calculateCanvasHeight(\n      this.canvasId,\n      newConfig,\n      this.stateInstance,\n    );\n\n    // Force re-render to update item positions with new grid size\n    this.renderVersion++;\n  }\n\n  /**\n   * Watch for isActive prop changes\n   *\n   * **When triggered**: Active canvas changes in grid-builder\n   * **Purpose**: Apply/remove 'active' CSS class for styling\n   *\n   * **Note**: No action needed - the prop change triggers re-render\n   * and the render() method applies the 'active' class based on this.isActive\n   *\n   * **Visual feedback**:\n   * - Active canvas may have highlighted border\n   * - Canvas title may be un-dimmed\n   * - Host app can style via `.grid-container.active` selector\n   */\n  @Watch(\"isActive\")\n  handleIsActiveChange(newIsActive: boolean, oldIsActive: boolean) {\n    // Skip if active state hasn't changed\n    if (newIsActive === oldIsActive) return;\n\n    // No action needed - render() will apply/remove 'active' class\n    // This watcher is just for documentation and potential future enhancements\n  }\n\n  /**\n   * Setup canvas click listener for background selection\n   *\n   * **Purpose**: Detect clicks on canvas background (not on grid items)\n   *\n   * **Event dispatch**:\n   * - Only fires when clicking empty canvas area\n   * - Does not fire when clicking grid items\n   * - Bubbles up to grid-builder for host app to handle\n   *\n   * **Custom event**:\n   * ```typescript\n   * new CustomEvent('canvas-click', {\n   *   detail: { canvasId },\n   *   bubbles: true,\n   *   composed: true\n   * })\n   * ```\n   *\n   * **Use case**: Host app can show canvas settings panel when canvas selected\n   */\n  private setupCanvasClickListener = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    this.gridContainerRef.addEventListener(\"click\", (event: MouseEvent) => {\n      // Only fire if clicking directly on the grid container\n      // (not on a grid item or other child element)\n      if (event.target === this.gridContainerRef) {\n        // Set this canvas as active\n        this.stateInstance.activeCanvasId = this.canvasId;\n\n        // Emit canvas-activated event\n        const canvasActivatedEvent = new CustomEvent(\"canvas-activated\", {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasActivatedEvent);\n\n        // Emit canvas-click event (backward compatibility)\n        const canvasClickEvent = new CustomEvent(\"canvas-click\", {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasClickEvent);\n      }\n    });\n  };\n\n  /**\n   * Setup ResizeObserver for grid cache pre-population\n   *\n   * **Purpose**: Detect container size changes and pre-populate cache before re-render\n   *\n   * **Critical Implementation Detail**:\n   * Instead of clearing cache and triggering re-render (which causes clientWidth=0 during\n   * DOM transient state), we PRE-POPULATE the cache with the correct value from ResizeObserver,\n   * THEN trigger re-render. This ensures grid calculations never read stale/zero values.\n   *\n   * **Observer callback**:\n   * 1. Get width from entry.contentRect.width (reliable during re-render)\n   * 2. Pre-calculate and cache correct grid size using setGridSizeCache()\n   * 3. Increment renderVersion (triggers item re-renders with cached correct value)\n   *\n   * **Why this approach**:\n   * - ResizeObserver provides accurate width via entry.contentRect\n   * - Pre-populating cache bypasses DOM reads during re-render\n   * - Prevents reading clientWidth=0 during StencilJS transient DOM state\n   * - Grid calculations hit cache instead of reading DOM\n   */\n  private setupResizeObserver = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    // Watch for canvas container size changes\n    this.resizeObserver = new ResizeObserver((entries) => {\n      // Use requestAnimationFrame to ensure layout is complete before recalculating\n      // This prevents reading containerWidth=0 during StencilJS re-render cycle\n      requestAnimationFrame(() => {\n        for (const entry of entries) {\n          // Get width from ResizeObserver entry (more reliable than clientWidth during re-render)\n          const width = entry.contentRect.width;\n\n          // Only proceed if container is laid out (width > 100px)\n          if (width > 100) {\n            // Pre-populate cache with correct value BEFORE triggering re-render\n            // This ensures grid calculations never read clientWidth=0 during re-render\n            setGridSizeCache(this.canvasId, width, this.config);\n\n            // Force re-render to update item positions\n            // Grid calculations will now use the cached correct value\n            this.renderVersion++;\n          }\n        }\n      });\n    });\n\n    this.resizeObserver.observe(this.gridContainerRef);\n  };\n\n  /**\n   * Initialize interact.js dropzone\n   *\n   * **Called from**: componentDidLoad (after DOM available)\n   * **Purpose**: Setup dropzone to receive palette items and grid items\n   *\n   * ## Dropzone Configuration\n   *\n   * **Accept pattern**: `.palette-item, .grid-item`\n   * - `.palette-item` - New components from palette\n   * - `.grid-item` - Existing items for cross-canvas moves\n   *\n   * **Overlap mode**: `'pointer'`\n   * - Drop detection based on cursor position\n   * - More intuitive than element overlap\n   *\n   * ## Drop Event Handling\n   *\n   * ### 1. Palette Item Drop (Create New)\n   *\n   * **Component type extraction**:\n   * ```typescript\n   * const componentType = droppedElement.getAttribute('data-component-type');\n   * ```\n   *\n   * **Position calculation**:\n   * - Get component's defaultSize from definition\n   * - Calculate half dimensions for cursor-centering\n   * - Subtract half dimensions from cursor position\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-drop', {\n   *   detail: { canvasId, componentType, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   *\n   * ### 2. Grid Item Drop (Cross-Canvas Move)\n   *\n   * **Only process cross-canvas moves**:\n   * - Same-canvas moves handled by drag handler\n   * - Prevents duplicate events\n   *\n   * **Position calculation**:\n   * - Use element's bounding rect (already positioned by drag handler)\n   * - Calculate position relative to target canvas\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-move', {\n   *   detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   */\n  private initializeDropzone = () => {\n    if (!this.gridContainerRef || this.dropzoneInitialized) {\n      return;\n    }\n\n    const interactable = interact(this.gridContainerRef);\n\n    interactable.dropzone({\n      accept: \".palette-item, .grid-item, .grid-item-header\",\n      overlap: \"pointer\",\n\n      listeners: {\n        dragenter: (_event: any) => {\n          // Add visual feedback when drag enters canvas (replaces classList.add)\n          this.isDropTarget = true;\n        },\n\n        dragleave: (_event: any) => {\n          // Remove visual feedback when drag leaves canvas (replaces classList.remove)\n          this.isDropTarget = false;\n        },\n\n        drop: (event: any) => {\n          // Remove visual feedback on successful drop (replaces classList.remove)\n          this.isDropTarget = false;\n          let droppedElement = event.relatedTarget;\n\n          // If dropped element is inside a palette item, get the palette item\n          const paletteItem = droppedElement.closest(\".palette-item\");\n          if (paletteItem) {\n            droppedElement = paletteItem;\n          }\n\n          const isPaletteItem =\n            droppedElement.classList.contains(\"palette-item\");\n\n          // Mark palette item drop as valid (for snap-back animation)\n          if (isPaletteItem) {\n            (droppedElement as any)._dropWasValid = true;\n          }\n\n          // Check if it's a grid item or grid item header (drag handle)\n          const isGridItemHeader =\n            droppedElement.classList.contains(\"grid-item-header\");\n          const isGridItem = droppedElement.classList.contains(\"grid-item\");\n\n          // If it's the header, find the parent grid-item\n          const gridItem = isGridItemHeader\n            ? droppedElement.closest(\".grid-item\")\n            : droppedElement;\n\n          if (isPaletteItem) {\n            // Dropping from palette - create new item\n            const componentType = droppedElement.getAttribute(\n              \"data-component-type\",\n            );\n\n            // Get stored dimensions from palette drag handler (or fall back to 10×6 default)\n            const defaultWidth = (droppedElement as any)._defaultWidth || 10;\n            const defaultHeight = (droppedElement as any)._defaultHeight || 6;\n            const widthPx = gridToPixelsX(\n              defaultWidth,\n              this.canvasId,\n              this.config,\n            );\n            const heightPx = gridToPixelsY(defaultHeight, this.config);\n            const halfWidth = widthPx / 2;\n            const halfHeight = heightPx / 2;\n\n            // Get drop position relative to grid container (cursor-centered)\n            const rect = this.gridContainerRef.getBoundingClientRect();\n            const x = event.dragEvent.clientX - rect.left - halfWidth;\n            const y = event.dragEvent.clientY - rect.top - halfHeight;\n\n            // Dispatch custom event for grid-builder to handle\n            const dropEvent = new CustomEvent(\"canvas-drop\", {\n              detail: {\n                canvasId: this.canvasId,\n                componentType,\n                x,\n                y,\n              },\n              bubbles: true,\n              composed: true,\n            });\n            this.gridContainerRef.dispatchEvent(dropEvent);\n          } else if (isGridItem || isGridItemHeader) {\n            // Moving existing grid item to different canvas\n            const itemId = gridItem.id;\n            const sourceCanvasId = gridItem.getAttribute(\"data-canvas-id\");\n\n            // Only process cross-canvas moves\n            if (sourceCanvasId !== this.canvasId) {\n              // Get element's position (already positioned by drag handler)\n              const droppedRect = gridItem.getBoundingClientRect();\n              const rect = this.gridContainerRef.getBoundingClientRect();\n\n              // Calculate position relative to target canvas\n              const x = droppedRect.left - rect.left;\n              const y = droppedRect.top - rect.top;\n\n              // Dispatch custom event for cross-canvas move\n              const moveEvent = new CustomEvent(\"canvas-move\", {\n                detail: {\n                  itemId,\n                  sourceCanvasId,\n                  targetCanvasId: this.canvasId,\n                  x,\n                  y,\n                },\n                bubbles: true,\n                composed: true,\n              });\n              this.gridContainerRef.dispatchEvent(moveEvent);\n            }\n          }\n        },\n      },\n    });\n\n    this.dropzoneInitialized = true;\n  };\n\n  /**\n   * Render component template\n   *\n   * **Structure**:\n   * - Grid container with background\n   * - Dynamic class for grid visibility\n   * - Background color from canvas state\n   * - Item rendering loop\n   *\n   * **Grid background**:\n   * - CSS linear gradients (2% horizontal, 20px vertical)\n   * - Toggleable via gridState.showGrid\n   * - Hidden when .hide-grid class applied\n   *\n   * **Item rendering**:\n   * - Maps over canvas.items\n   * - Renders grid-item-wrapper for each item\n   * - Passes renderVersion to force recalculation\n   */\n  render() {\n    const showGrid = this.stateInstance.showGrid;\n    const verticalGridSize = getGridSizeVertical(this.config);\n\n    // Calculate min-height from config (default 20 grid units)\n    const minHeightGridUnits = this.config?.canvasMinHeight ?? 20;\n    const minHeightPx = gridToPixelsY(minHeightGridUnits, this.config);\n\n    return (\n      <div class=\"canvas-section\" data-canvas-id={this.canvasId}>\n        <div\n          class={{\n            \"grid-container\": true,\n            \"hide-grid\": !showGrid,\n            active: this.isActive,\n            \"drop-target\": this.isDropTarget,\n          }}\n          id={this.canvasId}\n          role=\"region\"\n          aria-label={this.canvasTitle || `Canvas ${this.canvasId}`}\n          data-canvas-id={this.canvasId}\n          style={{\n            backgroundColor: this.backgroundColor || \"#ffffff\",\n            backgroundSize: `2% ${verticalGridSize}px`,\n            backgroundImage: showGrid\n              ? `linear-gradient(${this.theme?.gridLineColor || \"rgba(0, 0, 0, 0.05)\"} 1px, transparent 1px), linear-gradient(90deg, ${this.theme?.gridLineColor || \"rgba(0, 0, 0, 0.05)\"} 1px, transparent 1px)`\n              : \"none\",\n            minHeight: `${minHeightPx}px`,\n            [\"--primary-color\" as any]: this.theme?.primaryColor || \"#007bff\",\n            ...(this.calculatedHeight > 0\n              ? { height: `${this.calculatedHeight}px` }\n              : {}),\n          }}\n          ref={(el) => (this.gridContainerRef = el)}\n        >\n          {/* Error boundary wraps canvas content for canvas-level error isolation */}\n          {this.errorAdapterInstance ? (\n            <error-boundary\n              {...this.errorAdapterInstance.createErrorBoundaryConfig(\n                \"canvas-section\",\n                {\n                  canvasId: this.canvasId,\n                },\n              )}\n            >\n              {/* Grid items rendered by grid-item-wrapper components */}\n              {this.canvas?.items.map((item: GridItem) => (\n                <grid-item-wrapper\n                  key={item.id}\n                  item={item}\n                  renderVersion={this.renderVersion}\n                  config={this.config}\n                  componentRegistry={this.componentRegistry}\n                  onBeforeDelete={this.onBeforeDelete}\n                  virtualRendererInstance={this.virtualRendererInstance}\n                  eventManagerInstance={this.eventManagerInstance}\n                  undoRedoManagerInstance={this.undoRedoManagerInstance}\n                  stateInstance={this.stateInstance}\n                  domCacheInstance={this.domCacheInstance}\n                  errorAdapterInstance={this.errorAdapterInstance}\n                  theme={this.theme}\n                />\n              ))}\n            </error-boundary>\n          ) : (\n            /* Canvas content without error boundary (viewer mode or legacy) */\n            this.canvas?.items.map((item: GridItem) => (\n              <grid-item-wrapper\n                key={item.id}\n                item={item}\n                renderVersion={this.renderVersion}\n                config={this.config}\n                componentRegistry={this.componentRegistry}\n                onBeforeDelete={this.onBeforeDelete}\n                virtualRendererInstance={this.virtualRendererInstance}\n                eventManagerInstance={this.eventManagerInstance}\n                undoRedoManagerInstance={this.undoRedoManagerInstance}\n                stateInstance={this.stateInstance}\n                domCacheInstance={this.domCacheInstance}\n                theme={this.theme}\n              />\n            ))\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n"],"names":[],"mappings":"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"}