import{r as t,h as e}from"./p-CC73Dkup.js";import{i}from"./p-BKH_Whl_.js";import{a as s,s as n,o}from"./p-CDiz7xEh.js";import{c as a,b as r,g as c,a as d}from"./p-CcbD7Svb.js";import{a as h}from"./p-DZpb-Vl1.js";const l=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}";const p=class{constructor(e){t(this,e);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){s(this.canvasId);const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const e=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(e)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((()=>{a();this.renderVersion++}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=i(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{var e;(e=this.gridContainerRef)===null||e===void 0?void 0:e.classList.add("drop-target")},dragleave:t=>{var e;(e=this.gridContainerRef)===null||e===void 0?void 0:e.classList.remove("drop-target")},drop:t=>{var e;(e=this.gridContainerRef)===null||e===void 0?void 0:e.classList.remove("drop-target");const i=t.relatedTarget;const s=i.classList.contains("palette-item");if(s){i._dropWasValid=true}const n=i.classList.contains("grid-item-header");const o=i.classList.contains("grid-item");const a=n?i.closest(".grid-item"):i;if(s){const e=i.getAttribute("data-component-type");const s=i._defaultWidth||10;const n=i._defaultHeight||6;const o=r(s,this.canvasId,this.config);const a=c(n);const d=o/2;const h=a/2;const l=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-l.left-d;const f=t.dragEvent.clientY-l.top-h;const g=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:e,x:p,y:f},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(g)}else if(o||n){const t=a.id;const e=a.getAttribute("data-canvas-id");if(e!==this.canvasId){const i=a.getBoundingClientRect();const s=this.gridContainerRef.getBoundingClientRect();const n=i.left-s.left;const o=i.top-s.top;const r=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:e,targetCanvasId:this.canvasId,x:n,y:o},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(r)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=n.canvases[this.canvasId];this.calculatedHeight=h(this.canvasId,this.config);o("canvases",(()=>{try{if(this.canvasId&&n.canvases[this.canvasId]){this.canvas=n.canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=h(this.canvasId,this.config)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));o("currentViewport",(()=>{this.calculatedHeight=h(this.canvasId,this.config)}));o("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=n.canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){i(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,e){if(t===e)return;this.canvas=n.canvases[t];this.calculatedHeight=h(t,this.config);if(this.gridContainerRef&&this.dropzoneInitialized){i(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,e){if(t===e)return;this.calculatedHeight=h(this.canvasId,t);this.renderVersion++}handleIsActiveChange(t,e){if(t===e)return}render(){var t,i,s;const o=n.showGrid;const a=d(this.config);const r=(i=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&i!==void 0?i:20;const h=c(r,this.config);return e("div",{key:"26aae8a7b954943b0f5658e824da5212ac85944e",class:"canvas-section","data-canvas-id":this.canvasId},e("div",{key:"8ddb3036a7a0f9153246d0d7e64b0ac807a84129",class:{"grid-container":true,"hide-grid":!o,active:this.isActive},id:this.canvasId,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${a}px`,minHeight:`${h}px`},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(s=this.canvas)===null||s===void 0?void 0:s.items.map((t=>e("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};p.style=l;const f=".palette{width:250px;padding:20px;border-right:1px solid #ddd;background:white;overflow-y:auto}.palette h2{margin-bottom:20px;color:#333;font-size:18px}.palette-chromeless{padding-top:10px}.palette-empty{color:#999;font-size:13px;font-style:italic}.palette-item{padding:15px;border-radius:4px;margin-bottom:10px;background:#4a90e2;color:white;cursor:move;font-weight:500;text-align:center;transition:transform 0.2s, box-shadow 0.2s;user-select:none;touch-action:none;}.palette-item:hover{box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);transform:translateY(-2px)}.palette-item.dragging-from-palette{opacity:0.5}.dragging-clone{position:fixed;z-index:10000;pointer-events:none}";const g=class{constructor(e){t(this,e);this.showHeader=true;this.initializePaletteItems=()=>{const t=document.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){return}i(t).draggable({inertia:false,autoScroll:false,listeners:{start:t=>{t.target.classList.add("dragging-from-palette");const e=t.target.getBoundingClientRect();t.target._originalPosition={left:e.left,top:e.top};t.target._dropWasValid=false;const i=t.target.getAttribute("data-component-type");const s=this.components.find((t=>t.type===i));if(!s){console.warn(`Component definition not found for type: ${i}`);return}const n=s.defaultSize||{width:10,height:6};const o=window.gridState;const a=(o===null||o===void 0?void 0:o.canvases)?Object.keys(o.canvases):[];const d=a.length>0?a[0]:null;let h;let l;if(d){h=r(n.width,d,this.config);l=c(n.height)}else{const t=20;h=n.width*t;l=n.height*t}const p=h/2;const f=l/2;const g=document.createElement("div");g.className="dragging-clone";g.style.position="fixed";g.style.left=t.clientX-p+"px";g.style.top=t.clientY-f+"px";g.style.pointerEvents="none";g.style.zIndex="10000";if(s.renderDragClone){const t=s.renderDragClone({componentType:i,name:s.name,icon:s.icon,width:h,height:l});g.innerHTML=t}else{g.style.width=h+"px";g.style.height=l+"px";g.style.padding="20px";g.style.background="rgba(74, 144, 226, 0.9)";g.style.color="#ffffff";g.style.borderRadius="4px";g.innerHTML=`\n                <div style="font-weight: 600; color: #ffffff; font-size: 14px;">${s.icon} ${s.name}</div>\n              `}document.body.appendChild(g);t.target._dragClone=g;t.target._halfWidth=p;t.target._halfHeight=f;t.target._defaultWidth=n.width;t.target._defaultHeight=n.height},move:t=>{const e=t.target._dragClone;const i=t.target._halfWidth;const s=t.target._halfHeight;if(e){e.style.left=t.clientX-i+"px";e.style.top=t.clientY-s+"px"}},end:t=>{t.target.classList.remove("dragging-from-palette");const e=t.target._dragClone;const i=t.target._dropWasValid;const s=t.target._originalPosition;if(e){if(!i&&s){e.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";e.style.left=s.left+"px";e.style.top=s.top+"px";e.style.opacity="0";setTimeout((()=>{e.remove()}),300)}else{e.remove()}delete t.target._dragClone;delete t.target._halfWidth;delete t.target._halfHeight;delete t.target._dropWasValid;delete t.target._originalPosition}}}});t._dragInitialized=true}))}}handleComponentsChange(t,e){if(t===e)return;if(!e)return;requestAnimationFrame((()=>{this.initializePaletteItems()}))}handleConfigChange(t,e){if(t===e)return}componentDidLoad(){this.initializePaletteItems()}componentDidUpdate(){this.initializePaletteItems()}render(){const t={palette:true,"palette-chromeless":!this.showHeader};if(!this.components||this.components.length===0){return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),e("p",{class:"palette-empty"},"No components available"))}return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),this.components.map((t=>e("div",{class:"palette-item","data-component-type":t.type,key:t.type,innerHTML:t.renderPaletteItem?t.renderPaletteItem({componentType:t.type,name:t.name,icon:t.icon}):`${t.icon} ${t.name}`}))))}disconnectedCallback(){const t=document.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){i(t).unset();delete t._dragInitialized}}))}static get watchers(){return{components:["handleComponentsChange"],config:["handleConfigChange"]}}};g.style=f;export{p as canvas_section,g as component_palette};
//# sourceMappingURL=p-debfde01.entry.js.map