{"version":3,"file":"grid-builder.js","sourceRoot":"","sources":["../../../src/components/grid-builder/grid-builder.tsx"],"names":[],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["/**\n * Grid Builder - Main Library Component\n * =======================================\n *\n * Main entry point for the grid builder library. Accepts component definitions,\n * configuration, and customization options via props to create a fully functional\n * drag-and-drop page builder.\n *\n * ## Library Design Philosophy\n *\n * **Consumer-driven configuration**:\n * - Library provides infrastructure (drag/drop, undo/redo, state management)\n * - Consumer provides content (component types, initial layout, styling)\n * - Clean separation of concerns\n * - Maximum flexibility\n *\n * **Props-based API**:\n * ```typescript\n * <grid-builder\n *   components={componentDefinitions}     // Required: Component type registry\n *   config={gridConfig}                   // Optional: Grid system config\n *   theme={gridTheme}                     // Optional: Visual customization\n *   plugins={pluginInstances}             // Optional: Plugin extensions\n *   uiOverrides={customUIComponents}      // Optional: Custom UI rendering\n *   initialState={savedState}             // Optional: Restore saved layout\n * />\n * ```\n *\n * ## Component Lifecycle\n *\n * **Initialization flow**:\n * 1. componentWillLoad: Validate props, set defaults, restore initial state\n * 2. componentDidLoad: Initialize plugins, setup global dependencies, attach event listeners\n * 3. render: Render UI structure (palette, canvases, config panel)\n * 4. disconnectedCallback: Cleanup plugins, remove listeners, dispose resources\n *\n * **State management**:\n * - Uses global gridState from state-manager.ts\n * - Components subscribe via StencilJS reactivity\n * - Plugins access via GridBuilderAPI\n * - Clean separation of library vs consumer state\n *\n * @module grid-builder\n */\n\nimport { Component, Element, h, Host, Listen, Method, Prop, State, Watch } from '@stencil/core';\nimport interact from 'interactjs';\n\n// Type imports\nimport { ComponentDefinition } from '../../types/component-definition';\nimport { GridConfig } from '../../types/grid-config';\nimport { GridBuilderTheme } from '../../types/theme';\nimport { GridBuilderPlugin } from '../../types/plugin';\nimport { UIComponentOverrides } from '../../types/ui-overrides';\nimport { GridBuilderAPI } from '../../types/api';\nimport { DeletionHook } from '../../types/deletion-hook';\nimport { GridExport } from '../../types/grid-export';\n\n// Service imports\nimport { gridState, GridState, generateItemId, deleteItemsBatch, addItemsBatch, updateItemsBatch, setActiveCanvas, moveItemToCanvas } from '../../services/state-manager';\nimport { virtualRenderer } from '../../services/virtual-renderer';\nimport { eventManager } from '../../services/event-manager';\nimport { BatchAddCommand, BatchDeleteCommand, BatchUpdateConfigCommand, AddCanvasCommand, RemoveCanvasCommand, MoveItemCommand } from '../../services/undo-redo-commands';\nimport { undoRedo, undoRedoState } from '../../services/undo-redo';\n\n// Utility imports\nimport { pixelsToGridX, pixelsToGridY } from '../../utils/grid-calculations';\nimport { applyBoundaryConstraints, constrainPositionToCanvas, CANVAS_WIDTH_UNITS } from '../../utils/boundary-constraints';\nimport { createDebugLogger } from '../../utils/debug';\n\nconst debug = createDebugLogger('grid-builder');\n\n/**\n * GridBuilder Component\n * ======================\n *\n * Main library component providing complete grid builder functionality.\n *\n * **Tag**: `<grid-builder>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: 'grid-builder',\n  styleUrl: 'grid-builder.scss',\n  shadow: false, // Light DOM required for interact.js\n})\nexport class GridBuilder {\n  /**\n   * Component definitions registry\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Purpose**: Defines available component types (header, text, button, etc.)\n   *\n   * **Each definition includes**:\n   * - type: Unique identifier (e.g., 'header', 'text-block')\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Initial size when dropped\n   * - render: Function returning component to render\n   * - configSchema: Optional auto-generated config form\n   * - renderConfigPanel: Optional custom config UI\n   * - Lifecycle hooks: onVisible, onHidden for virtual rendering\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => (\n   *       <my-header itemId={itemId} config={config} />\n   *     ),\n   *     configSchema: [\n   *       { name: 'text', label: 'Text', type: 'text', defaultValue: 'Header' }\n   *     ]\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Default**: Standard 2% grid with 10px-50px constraints\n   *\n   * **Configuration options**:\n   * - gridSizePercent: Grid unit as % of width (default: 2)\n   * - minGridSize: Minimum size in pixels (default: 10)\n   * - maxGridSize: Maximum size in pixels (default: 50)\n   * - snapToGrid: Enable snap-to-grid (default: true)\n   * - showGridLines: Show visual grid (default: true)\n   * - minItemSize: Minimum item dimensions (default: { width: 5, height: 4 })\n   * - virtualRenderMargin: Pre-render margin (default: '20%')\n   *\n   * **Example**:\n   * ```typescript\n   * const config = {\n   *   gridSizePercent: 3,           // 3% grid (33 units per 100%)\n   *   minGridSize: 15,              // 15px minimum\n   *   maxGridSize: 60,              // 60px maximum\n   *   snapToGrid: true,\n   *   virtualRenderMargin: '30%'    // Aggressive pre-loading\n   * };\n   * ```\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Visual theme customization\n   *\n   * **Optional prop**: Customizes colors, fonts, and styling\n   * **Default**: Bootstrap-inspired blue theme\n   *\n   * **Theme options**:\n   * - primaryColor: Accent color (default: '#007bff')\n   * - paletteBackground: Palette sidebar color (default: '#f5f5f5')\n   * - canvasBackground: Canvas background (default: '#ffffff')\n   * - gridLineColor: Grid line color (default: 'rgba(0,0,0,0.1)')\n   * - selectionColor: Selection outline (default: '#007bff')\n   * - resizeHandleColor: Resize handle color (default: '#007bff')\n   * - fontFamily: UI font (default: system font stack)\n   * - customProperties: CSS variables for advanced theming\n   *\n   * **Example**:\n   * ```typescript\n   * const theme = {\n   *   primaryColor: '#ff6b6b',        // Brand red\n   *   paletteBackground: '#fff5f5',   // Light red\n   *   customProperties: {\n   *     '--text-color': '#ffffff',\n   *     '--border-radius': '8px'\n   *   }\n   * };\n   * ```\n   */\n  @Prop() theme?: GridBuilderTheme;\n\n  /**\n   * Plugin instances for extending functionality\n   *\n   * **Optional prop**: Array of GridBuilderPlugin instances\n   * **Purpose**: Add custom features, analytics, integrations\n   *\n   * **Plugin lifecycle**:\n   * 1. Library calls plugin.init(api) on componentDidLoad\n   * 2. Plugin subscribes to events, adds UI, etc.\n   * 3. Library calls plugin.destroy() on disconnectedCallback\n   *\n   * **Example**:\n   * ```typescript\n   * class AnalyticsPlugin implements GridBuilderPlugin {\n   *   name = 'analytics';\n   *\n   *   init(api: GridBuilderAPI) {\n   *     api.on('componentAdded', (e) => {\n   *       analytics.track('Component Added', { type: e.item.type });\n   *     });\n   *   }\n   *\n   *   destroy() {\n   *     // Cleanup\n   *   }\n   * }\n   *\n   * const plugins = [new AnalyticsPlugin()];\n   * ```\n   */\n  @Prop() plugins?: GridBuilderPlugin[];\n\n  /**\n   * Custom UI component overrides\n   *\n   * **Optional prop**: Replace default UI components\n   * **Purpose**: Fully customize visual appearance\n   *\n   * **Overridable components**:\n   * - ConfigPanel: Configuration panel UI\n   * - ComponentPalette: Component palette sidebar\n   * - Toolbar: Top toolbar with controls\n   *\n   * **Example**:\n   * ```typescript\n   * const uiOverrides = {\n   *   Toolbar: (props) => (\n   *     <div class=\"my-toolbar\">\n   *       <button onClick={props.onUndo}>Undo</button>\n   *       <button onClick={props.onRedo}>Redo</button>\n   *     </div>\n   *   )\n   * };\n   * ```\n   */\n  @Prop() uiOverrides?: UIComponentOverrides;\n\n  /**\n   * Initial state to restore\n   *\n   * **Optional prop**: Restore saved layout\n   * **Purpose**: Load previously saved grid state\n   *\n   * **State structure**: Same as gridState (canvases, viewport, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const savedState = JSON.parse(localStorage.getItem('grid-state'));\n   * <grid-builder initialState={savedState} ... />\n   * ```\n   */\n  @Prop() initialState?: Partial<GridState>;\n\n  /**\n   * Canvas metadata storage (host app responsibility)\n   *\n   * **Optional prop**: Store canvas-level presentation metadata\n   * **Purpose**: Host app owns canvas metadata (titles, colors, settings)\n   *\n   * **Separation of concerns**:\n   * - Library owns placement state (items, layouts, zIndex)\n   * - Host app owns presentation state (colors, titles, custom metadata)\n   *\n   * **Structure**: Record<canvasId, any>\n   *\n   * **Example**:\n   * ```typescript\n   * const canvasMetadata = {\n   *   'hero-section': {\n   *     title: 'Hero Section',\n   *     backgroundColor: '#f0f4f8',\n   *     customSettings: { ... }\n   *   },\n   *   'articles-grid': {\n   *     title: 'Articles Grid',\n   *     backgroundColor: '#ffffff'\n   *   }\n   * };\n   * <grid-builder canvasMetadata={canvasMetadata} ... />\n   * ```\n   *\n   * **Use with canvas-click events**:\n   * - Library fires canvas-click event when canvas background clicked\n   * - Host app shows canvas settings panel\n   * - Host app updates canvasMetadata state\n   * - Library passes metadata to canvas-section via props\n   */\n  @Prop() canvasMetadata?: Record<string, any>;\n\n  /**\n   * Hook called before deleting a component\n   *\n   * **Optional prop**: Intercept deletion requests for custom workflows\n   * **Purpose**: Allow host app to show confirmation, make API calls, etc.\n   *\n   * **Hook behavior**:\n   * - Return `true` to proceed with deletion\n   * - Return `false` to cancel the deletion\n   * - Return a Promise for async operations (modals, API calls)\n   *\n   * **Example - Confirmation modal**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   const confirmed = await showConfirmModal(\n   *     `Delete ${context.item.name}?`,\n   *     'This action cannot be undone.'\n   *   );\n   *   return confirmed;\n   * };\n   * <grid-builder onBeforeDelete={onBeforeDelete} ... />\n   * ```\n   *\n   * **Example - API call + confirmation**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   // Show loading modal\n   *   const modal = showLoadingModal('Deleting...');\n   *\n   *   try {\n   *     // Make API call\n   *     await fetch(`/api/components/${context.itemId}`, {\n   *       method: 'DELETE'\n   *     });\n   *     modal.close();\n   *     return true; // Proceed with deletion\n   *   } catch (error) {\n   *     modal.close();\n   *     showErrorModal('Failed to delete component');\n   *     return false; // Cancel deletion\n   *   }\n   * };\n   * ```\n   *\n   * **Default behavior**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: DeletionHook;\n\n  /**\n   * Custom API exposure configuration\n   *\n   * **Optional prop**: Control where and how the Grid Builder API is exposed\n   * **Default**: `{ target: window, key: 'gridBuilderAPI' }`\n   * **Purpose**: Allows multiple grid-builder instances and flexible API access patterns\n   *\n   * **Options**:\n   * 1. **Custom key on window** (multiple instances):\n   * ```typescript\n   * <grid-builder api-ref={{ key: 'gridAPI1' }}></grid-builder>\n   * <grid-builder api-ref={{ key: 'gridAPI2' }}></grid-builder>\n   * // Access: window.gridAPI1, window.gridAPI2\n   * ```\n   *\n   * 2. **Custom storage object**:\n   * ```typescript\n   * const myStore = {};\n   * <grid-builder api-ref={{ target: myStore, key: 'api' }}></grid-builder>\n   * // Access: myStore.api\n   * ```\n   *\n   * 3. **Disable automatic exposure** (use ref instead):\n   * ```typescript\n   * <grid-builder api-ref={null}></grid-builder>\n   * // Access via ref: <grid-builder ref={el => this.api = el?.api}></grid-builder>\n   * ```\n   */\n  @Prop() apiRef?: { target?: any; key?: string } | null = { target: undefined, key: 'gridBuilderAPI' };\n\n  /**\n   * Component registry (internal state)\n   *\n   * **Purpose**: Map component type â†’ definition for lookup\n   * **Built from**: components prop\n   * **Used by**: grid-item-wrapper for dynamic rendering\n   *\n   * **Structure**: `{ 'header': ComponentDefinition, 'text': ComponentDefinition, ... }`\n   */\n  @State() private componentRegistry: Map<string, ComponentDefinition> = new Map();\n\n  /**\n   * Initialized plugins (internal state)\n   *\n   * **Purpose**: Track plugin instances for cleanup\n   * **Lifecycle**: Set in componentDidLoad, cleared in disconnectedCallback\n   */\n  @State() private initializedPlugins: GridBuilderPlugin[] = [];\n\n  /**\n   * GridBuilderAPI instance (internal state)\n   *\n   * **Purpose**: Provides API to plugins and external code\n   * **Lifecycle**: Created in componentDidLoad\n   */\n  private api?: GridBuilderAPI;\n\n  /**\n   * Host element reference\n   *\n   * **Purpose**: Access to host element for event listeners\n   */\n  @Element() private hostElement!: HTMLElement;\n\n  /**\n   * Event listener references for cleanup\n   */\n  private canvasDropHandler?: (e: Event) => void;\n  private canvasMoveHandler?: (e: Event) => void;\n  private canvasActivatedHandler?: (e: Event) => void;\n  private keyboardHandler?: (e: KeyboardEvent) => void;\n\n  /**\n   * ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window width)\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private viewportResizeObserver?: ResizeObserver;\n\n  /**\n   * Component will load lifecycle\n   *\n   * **Purpose**: Validate props and initialize component registry\n   *\n   * **Validation**:\n   * - Components prop is required\n   * - Each component must have unique type\n   * - Basic structure validation\n   *\n   * **Registry building**:\n   * - Convert array to Map for O(1) lookups\n   * - Key = component type, Value = ComponentDefinition\n   *\n   * **Initial state restoration**:\n   * - If initialState provided, merge into gridState\n   * - Otherwise use empty canvases\n   */\n\n  /**\n   * Handle item deletion from grid-item-wrapper\n   * Internal event dispatched by grid-item-wrapper after user clicks delete\n   */\n  @Listen('grid-item:delete')\n  handleGridItemDelete(event: CustomEvent) {\n    debug.log('ðŸ—‘ï¸ @Listen(grid-item:delete) in grid-builder', {\n      detail: event.detail,\n    });\n\n    const { itemId } = event.detail;\n    if (itemId) {\n      debug.log('  âœ… Deleting item via API (with undo support):', itemId);\n      // Use API method instead of direct deleteItemsBatch to enable undo/redo\n      this.api?.deleteComponent(itemId);\n    }\n  }\n\n  componentWillLoad() {\n    // Validate required props\n    if (!this.components || this.components.length === 0) {\n      console.error('GridBuilder: components prop is required');\n      return;\n    }\n\n    // Build component registry\n    this.componentRegistry = new Map(\n      this.components.map(comp => [comp.type, comp])\n    );\n\n    // Validate unique component types\n    if (this.componentRegistry.size !== this.components.length) {\n      console.warn('GridBuilder: Duplicate component types detected');\n    }\n\n    // Expose interact.js globally (required for drag/drop handlers)\n    (window as any).interact = interact;\n\n    // Restore initial state if provided\n    if (this.initialState) {\n      Object.assign(gridState, this.initialState);\n    }\n  }\n\n  /**\n   * Component did load lifecycle\n   *\n   * **Purpose**: Initialize global dependencies and plugins\n   *\n   * **Initialization sequence**:\n   * 1. Expose virtualRenderer singleton globally\n   * 2. Create GridBuilderAPI instance\n   * 3. Initialize plugins via plugin.init(api)\n   * 4. Apply theme via CSS variables\n   * 5. Expose debug helpers\n   */\n  componentDidLoad() {\n    // Expose virtualRenderer singleton globally (for debugging)\n    (window as any).virtualRenderer = virtualRenderer;\n\n    // Create GridBuilderAPI instance\n    this.api = this.createAPI();\n\n    // Expose API based on apiRef configuration\n    debug.log('ðŸ”§ grid-builder exposing API', {\n      hasApiRef: !!this.apiRef,\n      apiRefKey: this.apiRef?.key,\n      hasTarget: !!this.apiRef?.target,\n      targetType: typeof this.apiRef?.target,\n      apiCreated: !!this.api,\n    });\n\n    if (this.apiRef && this.apiRef.key) {\n      const target = this.apiRef.target || window;\n      debug.log('  ðŸ“¤ Setting API on target', {\n        key: this.apiRef.key,\n        isWindow: target === window,\n        targetKeys: Object.keys(target).slice(0, 10), // Show first 10 keys\n      });\n      target[this.apiRef.key] = this.api;\n      debug.log('  âœ… API set on target -', {\n        key: this.apiRef.key,\n        apiNowExists: !!target[this.apiRef.key],\n      });\n    }\n\n    // Initialize plugins\n    if (this.plugins && this.plugins.length > 0) {\n      this.initializedPlugins = this.plugins.filter(plugin => {\n        try {\n          plugin.init(this.api!);\n          debug.log(`GridBuilder: Initialized plugin \"${plugin.name}\"`);\n          return true;\n        } catch (e) {\n          console.error(`GridBuilder: Failed to initialize plugin \"${plugin.name}\":`, e);\n          return false;\n        }\n      });\n    }\n\n    // Apply theme\n    if (this.theme) {\n      this.applyTheme(this.theme);\n    }\n\n    // Configure event debouncing\n    const debounceDelay = this.config?.eventDebounceDelay ?? 300;\n    eventManager.setDebounceDelay(debounceDelay);\n    debug.log(`GridBuilder: Event debounce delay set to ${debounceDelay}ms`);\n\n    // Debug helper\n    (window as any).debugInteractables = () => {\n      const interactables = (interact as any).interactables.list;\n      debug.log('Total interactables:', interactables.length);\n      interactables.forEach((interactable: any, index: number) => {\n        debug.log(`Interactable ${index}:`, {\n          target: interactable.target,\n          actions: interactable._actions,\n          options: interactable.options,\n        });\n      });\n    };\n\n    // Setup canvas drop event handler for palette items\n    this.canvasDropHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId, componentType, x, y } = customEvent.detail;\n\n      debug.log('ðŸŽ¯ canvas-drop event received:', { canvasId, componentType, x, y });\n\n      // Get component definition to determine default size\n      const definition = this.componentRegistry.get(componentType);\n      if (!definition) {\n        console.warn(`Component definition not found for type: ${componentType}`);\n        return;\n      }\n\n      // Convert pixel position to grid units\n      const gridX = pixelsToGridX(x, canvasId, this.config);\n      const gridY = pixelsToGridY(y, this.config);\n\n      debug.log('  Converting to grid units (before constraints):', {\n        gridX,\n        gridY,\n        defaultWidth: definition.defaultSize.width,\n        defaultHeight: definition.defaultSize.height\n      });\n\n      // Apply boundary constraints (validate, adjust size, constrain position)\n      const constrained = applyBoundaryConstraints(definition, gridX, gridY);\n\n      if (!constrained) {\n        console.warn(`Cannot place component \"${definition.name}\" - minimum size exceeds canvas width`);\n        return;\n      }\n\n      debug.log('  After boundary constraints:', constrained);\n\n      // Use existing addComponent API method with constrained values\n      const newItem = this.api?.addComponent(canvasId, componentType, {\n        x: constrained.x,\n        y: constrained.y,\n        width: constrained.width,\n        height: constrained.height,\n      });\n\n      debug.log('  Created item:', newItem);\n    };\n\n    this.hostElement.addEventListener('canvas-drop', this.canvasDropHandler);\n\n    // Setup canvas move event handler for cross-canvas moves\n    this.canvasMoveHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { itemId, sourceCanvasId, targetCanvasId, x, y } = customEvent.detail;\n\n      debug.log('ðŸ”„ canvas-move event received:', { itemId, sourceCanvasId, targetCanvasId, x, y });\n\n      // 1. Get item from source canvas\n      const sourceCanvas = gridState.canvases[sourceCanvasId];\n      if (!sourceCanvas) {\n        console.error('Source canvas not found:', sourceCanvasId);\n        return;\n      }\n\n      const itemIndex = sourceCanvas.items.findIndex(i => i.id === itemId);\n      if (itemIndex === -1) {\n        console.error('Item not found in source canvas:', itemId);\n        return;\n      }\n\n      const item = sourceCanvas.items[itemIndex];\n\n      // 2. Capture state BEFORE move (for undo)\n      const sourcePosition = {\n        x: item.layouts.desktop.x,\n        y: item.layouts.desktop.y\n      };\n\n      // 3. Convert drop position (pixels) to grid units for target canvas\n      let gridX = pixelsToGridX(x, targetCanvasId, this.config);\n      let gridY = pixelsToGridY(y, this.config);\n\n      // 4. Constrain position to target canvas boundaries\n      const constrained = constrainPositionToCanvas(\n        gridX,\n        gridY,\n        item.layouts.desktop.width,\n        item.layouts.desktop.height,\n        CANVAS_WIDTH_UNITS\n      );\n\n      gridX = constrained.x;\n      gridY = constrained.y;\n\n      const targetPosition = { x: gridX, y: gridY };\n\n      // 5. Update item position in desktop layout\n      item.layouts.desktop.x = gridX;\n      item.layouts.desktop.y = gridY;\n\n      // 6. Move item between canvases (updates canvasId, removes from source, adds to target)\n      moveItemToCanvas(sourceCanvasId, targetCanvasId, itemId);\n\n      // 7. Assign new z-index in target canvas\n      const targetCanvas = gridState.canvases[targetCanvasId];\n      item.zIndex = targetCanvas.zIndexCounter++;\n      gridState.canvases = { ...gridState.canvases }; // Trigger reactivity\n\n      // 8. Set target canvas as active\n      setActiveCanvas(targetCanvasId);\n\n      // 9. Update selection state if item was selected\n      if (gridState.selectedItemId === itemId) {\n        gridState.selectedCanvasId = targetCanvasId;\n      }\n\n      // 10. Create undo/redo command\n      const command = new MoveItemCommand(\n        itemId,\n        sourceCanvasId,\n        targetCanvasId,\n        sourcePosition,\n        targetPosition,\n        itemIndex\n      );\n      undoRedo.push(command);\n\n      // 11. Emit events for plugins\n      eventManager.emit('componentMoved', {\n        item,\n        sourceCanvasId,\n        targetCanvasId,\n        position: targetPosition\n      });\n\n      eventManager.emit('canvasActivated', { canvasId: targetCanvasId });\n\n      debug.log('âœ… Cross-canvas move completed:', {\n        itemId,\n        from: sourceCanvasId,\n        to: targetCanvasId,\n        position: targetPosition\n      });\n    };\n\n    this.hostElement.addEventListener('canvas-move', this.canvasMoveHandler);\n\n    // Setup canvas activated event handler\n    this.canvasActivatedHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId } = customEvent.detail;\n\n      debug.log('ðŸŽ¨ canvas-activated event received:', { canvasId });\n\n      // Emit plugin event\n      eventManager.emit('canvasActivated', { canvasId });\n    };\n\n    this.hostElement.addEventListener('canvas-activated', this.canvasActivatedHandler);\n\n    // Setup keyboard shortcuts\n    this.keyboardHandler = (event: KeyboardEvent) => {\n      // Get modifier keys (Cmd on Mac, Ctrl on Windows/Linux)\n      const isUndo = (event.metaKey || event.ctrlKey) && event.key === 'z' && !event.shiftKey;\n      const isRedo = (event.metaKey || event.ctrlKey) && (\n        (event.key === 'z' && event.shiftKey) || // Ctrl/Cmd+Shift+Z\n        event.key === 'y' // Ctrl/Cmd+Y\n      );\n\n      // Handle undo/redo\n      if (isUndo) {\n        debug.log('âŒ¨ï¸ Keyboard: Undo triggered');\n        event.preventDefault();\n        this.api?.undo();\n        return;\n      }\n\n      if (isRedo) {\n        debug.log('âŒ¨ï¸ Keyboard: Redo triggered');\n        event.preventDefault();\n        this.api?.redo();\n        return;\n      }\n\n      // Handle arrow key nudging (only if component is selected)\n      if (!gridState.selectedItemId || !gridState.selectedCanvasId) {\n        return;\n      }\n\n      const isArrowKey = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key);\n      if (!isArrowKey) {\n        return;\n      }\n\n      event.preventDefault();\n\n      // Get selected item\n      const canvas = gridState.canvases[gridState.selectedCanvasId];\n      if (!canvas) {\n        return;\n      }\n\n      const item = canvas.items.find(i => i.id === gridState.selectedItemId);\n      if (!item) {\n        return;\n      }\n\n      // Get current viewport layout\n      const viewport = gridState.currentViewport;\n      const layout = item.layouts[viewport];\n\n      // Calculate nudge amount (1 grid unit in each direction)\n      const nudgeAmount = 1;\n      let deltaX = 0;\n      let deltaY = 0;\n\n      switch (event.key) {\n        case 'ArrowUp':\n          deltaY = -nudgeAmount;\n          break;\n        case 'ArrowDown':\n          deltaY = nudgeAmount;\n          break;\n        case 'ArrowLeft':\n          deltaX = -nudgeAmount;\n          break;\n        case 'ArrowRight':\n          deltaX = nudgeAmount;\n          break;\n      }\n\n      debug.log('âŒ¨ï¸ Keyboard: Nudging component', {\n        key: event.key,\n        deltaX,\n        deltaY,\n        itemId: item.id,\n      });\n\n      // Capture old position for undo\n      const oldX = layout.x;\n      const oldY = layout.y;\n\n      // Update position with boundary checks\n      const newX = Math.max(0, layout.x + deltaX);\n      const newY = Math.max(0, layout.y + deltaY);\n\n      // Check right boundary (100 grid units = 100%)\n      const maxX = 100 - layout.width;\n      const constrainedX = Math.min(newX, maxX);\n      const constrainedY = newY; // No vertical limit\n\n      // Only update if position actually changed\n      if (oldX === constrainedX && oldY === constrainedY) {\n        return; // No change, don't create undo command\n      }\n\n      // Update item layout (mutate in place to preserve all properties like 'customized')\n      layout.x = constrainedX;\n      layout.y = constrainedY;\n\n      // Create undo command for nudge\n      const nudgeCommand = new MoveItemCommand(\n        item.id,\n        gridState.selectedCanvasId,\n        gridState.selectedCanvasId,\n        { x: oldX, y: oldY },\n        { x: constrainedX, y: constrainedY },\n        canvas.items.findIndex(i => i.id === item.id)\n      );\n      undoRedo.push(nudgeCommand);\n\n      // Trigger state update\n      gridState.canvases = { ...gridState.canvases };\n\n      // Emit event\n      eventManager.emit('componentDragged', {\n        itemId: item.id,\n        canvasId: gridState.selectedCanvasId,\n        position: { x: constrainedX, y: constrainedY },\n      });\n    };\n\n    document.addEventListener('keydown', this.keyboardHandler);\n\n    // Setup container-based viewport switching\n    this.setupViewportResizeObserver();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Purpose**: Clean up resources when component unmounts\n   *\n   * **Cleanup sequence**:\n   * 1. Remove event listeners\n   * 2. Destroy all plugins\n   * 3. Clear global references\n   */\n  disconnectedCallback() {\n    // Remove event listeners\n    if (this.canvasDropHandler) {\n      this.hostElement.removeEventListener('canvas-drop', this.canvasDropHandler);\n    }\n    if (this.canvasMoveHandler) {\n      this.hostElement.removeEventListener('canvas-move', this.canvasMoveHandler);\n    }\n    if (this.canvasActivatedHandler) {\n      this.hostElement.removeEventListener('canvas-activated', this.canvasActivatedHandler);\n    }\n    if (this.keyboardHandler) {\n      document.removeEventListener('keydown', this.keyboardHandler);\n    }\n\n    // Cleanup ResizeObserver\n    if (this.viewportResizeObserver) {\n      this.viewportResizeObserver.disconnect();\n    }\n\n    // Destroy plugins\n    if (this.initializedPlugins.length > 0) {\n      this.initializedPlugins.forEach(plugin => {\n        try {\n          plugin.destroy();\n          debug.log(`GridBuilder: Destroyed plugin \"${plugin.name}\"`);\n        } catch (e) {\n          console.error(`GridBuilder: Failed to destroy plugin \"${plugin.name}\":`, e);\n        }\n      });\n      this.initializedPlugins = [];\n    }\n\n    // Clear global references\n    delete (window as any).virtualRenderer;\n\n    // Clear API from storage location if it was set\n    if (this.apiRef && this.apiRef.key) {\n      const target = this.apiRef.target || window;\n      delete target[this.apiRef.key];\n    }\n  }\n\n  /**\n   * Watch components prop for changes\n   *\n   * **Purpose**: Rebuild component registry when components prop changes\n   */\n  @Watch('components')\n  handleComponentsChange(newComponents: ComponentDefinition[]) {\n    this.componentRegistry = new Map(\n      newComponents.map(comp => [comp.type, comp])\n    );\n  }\n\n  /**\n   * Create GridBuilderAPI instance\n   *\n   * **Purpose**: Provide API to plugins and external code\n   * **Returns**: GridBuilderAPI implementation\n   *\n   * **Implementation**: Full API with event system integration\n   */\n  private createAPI(): GridBuilderAPI {\n    return {\n      // ======================\n      // Event Subscriptions\n      // ======================\n\n      on: <T = any>(eventName: string, callback: (data: T) => void) => {\n        eventManager.on(eventName, callback);\n      },\n\n      off: <T = any>(eventName: string, callback: (data: T) => void) => {\n        eventManager.off(eventName, callback);\n      },\n\n      // ======================\n      // State Access (Read)\n      // ======================\n\n      getState: () => gridState,\n\n      getItems: (canvasId: string) => {\n        return gridState.canvases[canvasId]?.items || [];\n      },\n\n      getItem: (itemId: string) => {\n        // Search across all canvases\n        for (const canvasId in gridState.canvases) {\n          const canvas = gridState.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            return item;\n          }\n        }\n        return null;\n      },\n\n      // ======================\n      // Programmatic Operations\n      // ======================\n\n      addComponent: (canvasId: string, componentType: string, position: { x: number; y: number; width: number; height: number }, config?: Record<string, any>) => {\n        const canvas = gridState.canvases[canvasId];\n        if (!canvas) {\n          console.error(`Canvas not found: ${canvasId}`);\n          return null;\n        }\n\n        // Create new item\n        const newItem = {\n          id: generateItemId(),\n          canvasId,\n          name: componentType,\n          type: componentType,\n          zIndex: ++canvas.zIndexCounter,\n          layouts: {\n            desktop: { ...position },\n            mobile: { x: 0, y: 0, width: 50, height: position.height, customized: false },\n          },\n          config: config || {},\n        };\n\n        // Add to canvas\n        canvas.items.push(newItem);\n        gridState.canvases = { ...gridState.canvases };\n\n        // Add to undo/redo history\n        undoRedo.push(new BatchAddCommand([newItem.id]));\n\n        // Emit event\n        eventManager.emit('componentAdded', { item: newItem, canvasId });\n\n        return newItem.id;\n      },\n\n      deleteComponent: (itemId: string) => {\n        // Find and delete item across all canvases\n        for (const canvasId in gridState.canvases) {\n          const canvas = gridState.canvases[canvasId];\n          const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n          if (itemIndex !== -1) {\n            // Add to undo/redo history BEFORE deletion (need state for undo)\n            undoRedo.push(new BatchDeleteCommand([itemId]));\n\n            // Delete item\n            canvas.items.splice(itemIndex, 1);\n            gridState.canvases = { ...gridState.canvases };\n\n            // Deselect if deleted item was selected\n            if (gridState.selectedItemId === itemId) {\n              gridState.selectedItemId = null;\n              gridState.selectedCanvasId = null;\n            }\n\n            // Emit event\n            eventManager.emit('componentDeleted', { itemId, canvasId });\n\n            return true;\n          }\n        }\n        return false;\n      },\n\n      updateConfig: (itemId: string, config: Record<string, any>) => {\n        // Find and update item across all canvases\n        for (const canvasId in gridState.canvases) {\n          const canvas = gridState.canvases[canvasId];\n          const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n          if (itemIndex !== -1) {\n            const item = canvas.items[itemIndex];\n            const newConfig = { ...item.config, ...config };\n\n            // Create undo command BEFORE making changes\n            const batchUpdate = [{\n              itemId,\n              canvasId,\n              updates: { config: newConfig },\n            }];\n            undoRedo.push(new BatchUpdateConfigCommand(batchUpdate));\n\n            // Merge config\n            canvas.items[itemIndex] = {\n              ...canvas.items[itemIndex],\n              config: newConfig,\n            };\n            gridState.canvases = { ...gridState.canvases };\n\n            // Emit event\n            eventManager.emit('configChanged', { itemId, canvasId, config });\n\n            return true;\n          }\n        }\n        return false;\n      },\n\n      // ======================\n      // Batch Operations\n      // ======================\n\n      addComponentsBatch: (components: Array<{ canvasId: string; type: string; position: { x: number; y: number; width: number; height: number }; config?: Record<string, any> }>) => {\n        // Convert API format to state-manager format\n        const partialItems = components.map(({ canvasId, type, position, config }) => ({\n          canvasId,\n          type,\n          name: type,\n          layouts: {\n            desktop: { ...position },\n            mobile: { x: 0, y: 0, width: 50, height: position.height, customized: false },\n          },\n          config: config || {},\n        }));\n\n        // Use state-manager batch operation (single state update)\n        const itemIds = addItemsBatch(partialItems);\n\n        // Add to undo/redo history\n        undoRedo.push(new BatchAddCommand(itemIds));\n\n        // Emit batch event\n        const createdItems = itemIds.map(id => {\n          const item = this.api?.getItem(id);\n          return item ? { item, canvasId: item.canvasId } : null;\n        }).filter(Boolean);\n        eventManager.emit('componentsBatchAdded', { items: createdItems });\n\n        return itemIds;\n      },\n\n      deleteComponentsBatch: (itemIds: string[]) => {\n        // Store deleted items for event\n        const deletedItems = itemIds.map(itemId => {\n          const item = this.api?.getItem(itemId);\n          return item ? { itemId, canvasId: item.canvasId } : null;\n        }).filter(Boolean);\n\n        // Add to undo/redo history BEFORE deletion (need state for undo)\n        undoRedo.push(new BatchDeleteCommand(itemIds));\n\n        // Use state-manager batch operation (single state update)\n        deleteItemsBatch(itemIds);\n\n        // Clear selection if any deleted item was selected\n        if (gridState.selectedItemId && itemIds.includes(gridState.selectedItemId)) {\n          gridState.selectedItemId = null;\n          gridState.selectedCanvasId = null;\n        }\n\n        // Emit batch event\n        eventManager.emit('componentsBatchDeleted', { items: deletedItems });\n      },\n\n      updateConfigsBatch: (updates: Array<{ itemId: string; config: Record<string, any> }>) => {\n        // Convert to state-manager format (need canvasId)\n        const batchUpdates = updates.map(({ itemId, config }) => {\n          const item = this.api?.getItem(itemId);\n          if (!item) {\n            console.warn(`Item ${itemId} not found for config update`);\n            return null;\n          }\n          return {\n            itemId,\n            canvasId: item.canvasId,\n            updates: { config: { ...item.config, ...config } },\n          };\n        }).filter(Boolean) as Array<{ itemId: string; canvasId: string; updates: Partial<any> }>;\n\n        // Add to undo/redo history\n        undoRedo.push(new BatchUpdateConfigCommand(batchUpdates));\n\n        // Use state-manager batch operation (single state update)\n        updateItemsBatch(batchUpdates);\n\n        // Emit batch event\n        const updatedItems = batchUpdates.map(({ itemId, canvasId, updates }) => ({\n          itemId,\n          canvasId,\n          config: updates.config,\n        }));\n        eventManager.emit('configsBatchChanged', { items: updatedItems });\n      },\n\n      // ======================\n      // Canvas Access\n      // ======================\n\n      getCanvasElement: (canvasId: string) => {\n        return document.getElementById(canvasId);\n      },\n\n      // ======================\n      // Undo/Redo Operations\n      // ======================\n\n      undo: () => {\n        undoRedo.undo();\n        // Emit event after undo\n        eventManager.emit('undoExecuted', {});\n      },\n\n      redo: () => {\n        undoRedo.redo();\n        // Emit event after redo\n        eventManager.emit('redoExecuted', {});\n      },\n\n      canUndo: () => {\n        return undoRedo.canUndo();\n      },\n\n      canRedo: () => {\n        return undoRedo.canRedo();\n      },\n\n      undoRedoState: undoRedoState,\n\n      // ======================\n      // Canvas Management\n      // ======================\n\n      addCanvas: (canvasId: string) => {\n        // Create and execute command\n        const command = new AddCanvasCommand(canvasId);\n        undoRedo.push(command);\n        command.redo();\n      },\n\n      removeCanvas: (canvasId: string) => {\n        // Create and execute command\n        const command = new RemoveCanvasCommand(canvasId);\n        undoRedo.push(command);\n        command.redo();\n      },\n\n      setActiveCanvas: (canvasId: string) => {\n        setActiveCanvas(canvasId);\n        eventManager.emit('canvasActivated', { canvasId });\n      },\n\n      getActiveCanvas: () => {\n        return gridState.activeCanvasId;\n      },\n    };\n  }\n\n  /**\n   * Apply theme via CSS variables\n   *\n   * **Purpose**: Apply theme customization to host element\n   * **Implementation**: Set CSS custom properties on :host\n   */\n  private applyTheme(theme: GridBuilderTheme) {\n    const host = this.el;\n    if (!host) return;\n\n    // Apply predefined theme properties\n    if (theme.primaryColor) {\n      host.style.setProperty('--grid-builder-primary-color', theme.primaryColor);\n    }\n    if (theme.paletteBackground) {\n      host.style.setProperty('--grid-builder-palette-bg', theme.paletteBackground);\n    }\n    if (theme.canvasBackground) {\n      host.style.setProperty('--grid-builder-canvas-bg', theme.canvasBackground);\n    }\n    if (theme.gridLineColor) {\n      host.style.setProperty('--grid-builder-grid-line-color', theme.gridLineColor);\n    }\n    if (theme.selectionColor) {\n      host.style.setProperty('--grid-builder-selection-color', theme.selectionColor);\n    }\n    if (theme.resizeHandleColor) {\n      host.style.setProperty('--grid-builder-resize-handle-color', theme.resizeHandleColor);\n    }\n    if (theme.fontFamily) {\n      host.style.setProperty('--grid-builder-font-family', theme.fontFamily);\n    }\n\n    // Apply custom properties\n    if (theme.customProperties) {\n      Object.entries(theme.customProperties).forEach(([key, value]) => {\n        host.style.setProperty(key, value);\n      });\n    }\n  }\n\n  /**\n   * Setup ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window viewport)\n   *\n   * **Observer callback**:\n   * 1. Get container width from ResizeObserver entry\n   * 2. Determine target viewport (mobile if < 768px, desktop otherwise)\n   * 3. Update gridState.currentViewport if changed\n   *\n   * **Why container-based**:\n   * - More flexible than window.resize (e.g., sidebar layouts, embedded widgets)\n   * - Grid-builder can be embedded at any size\n   * - Multiple instances can have different viewports on same page\n   *\n   * **Debouncing**: Not needed - ResizeObserver is already efficient\n   */\n  private setupViewportResizeObserver = () => {\n    if (!this.hostElement) {\n      return;\n    }\n\n    // Watch for grid-builder container size changes\n    this.viewportResizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Get container width (use borderBoxSize for better accuracy)\n        const width = entry.borderBoxSize?.[0]?.inlineSize || entry.contentRect.width;\n\n        // Determine target viewport based on container width\n        const targetViewport = width < 768 ? 'mobile' : 'desktop';\n\n        // Only update if viewport changed\n        if (gridState.currentViewport !== targetViewport) {\n          debug.log(`ðŸ“± Container-based viewport switch: ${gridState.currentViewport} â†’ ${targetViewport} (width: ${Math.round(width)}px)`);\n          gridState.currentViewport = targetViewport;\n        }\n      }\n    });\n\n    this.viewportResizeObserver.observe(this.hostElement);\n  };\n\n  /**\n   * Export current state to JSON-serializable format\n   *\n   * **Purpose**: Export grid layout for saving or transferring to viewer app\n   *\n   * **Use Cases**:\n   * - Save layout to database/localStorage\n   * - Transfer layout to viewer app via API\n   * - Create layout templates/presets\n   * - Backup/restore functionality\n   *\n   * **Example - Save to API**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const exportData = await builder.exportState();\n   * await fetch('/api/layouts', {\n   *   method: 'POST',\n   *   headers: { 'Content-Type': 'application/json' },\n   *   body: JSON.stringify(exportData)\n   * });\n   * ```\n   *\n   * **Example - Save to localStorage**:\n   * ```typescript\n   * const exportData = await builder.exportState();\n   * localStorage.setItem('grid-layout', JSON.stringify(exportData));\n   * ```\n   *\n   * @returns Promise<GridExport> - JSON-serializable export object\n   */\n  @Method()\n  async exportState(): Promise<GridExport> {\n    // Build export data from current gridState\n    const exportData: GridExport = {\n      version: '1.0.0',\n      canvases: {},\n      viewport: gridState.currentViewport,\n      metadata: {\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      },\n    };\n\n    // Export each canvas with its items\n    for (const canvasId in gridState.canvases) {\n      const canvas = gridState.canvases[canvasId];\n\n      exportData.canvases[canvasId] = {\n        items: canvas.items.map(item => ({\n          id: item.id,\n          canvasId: item.canvasId,\n          type: item.type,\n          name: item.name,\n          layouts: {\n            desktop: { ...item.layouts.desktop },\n            mobile: { ...item.layouts.mobile },\n          },\n          zIndex: item.zIndex,\n          config: { ...item.config }, // Deep copy to avoid mutations\n        })),\n      };\n    }\n\n    return exportData;\n  }\n\n  /**\n   * Import state from JSON-serializable format\n   *\n   * **Purpose**: Restore previously exported grid state\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const savedState = JSON.parse(localStorage.getItem('grid-layout'));\n   * await builder.importState(savedState);\n   * ```\n   *\n   * @param state - GridExport or partial GridState object\n   */\n  @Method()\n  async importState(state: Partial<GridState> | GridExport) {\n    // Import grid state\n    Object.assign(gridState, state);\n  }\n\n  /**\n   * Get current grid state\n   *\n   * **Purpose**: Direct access to grid state for reading\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const state = await builder.getState();\n   * console.log('Current viewport:', state.currentViewport);\n   * ```\n   *\n   * @returns Promise<GridState> - Current grid state\n   */\n  @Method()\n  async getState(): Promise<GridState> {\n    return gridState;\n  }\n\n  /**\n   * Add a new canvas programmatically\n   *\n   * **Purpose**: Create new section/canvas in the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.addCanvas('new-section');\n   * ```\n   *\n   * @param canvasId - Unique canvas identifier\n   */\n  @Method()\n  async addCanvas(canvasId: string) {\n    this.api?.addCanvas(canvasId);\n  }\n\n  /**\n   * Remove a canvas programmatically\n   *\n   * **Purpose**: Delete section/canvas from the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.removeCanvas('old-section');\n   * ```\n   *\n   * @param canvasId - Canvas identifier to remove\n   */\n  @Method()\n  async removeCanvas(canvasId: string) {\n    this.api?.removeCanvas(canvasId);\n  }\n\n  /**\n   * Set active canvas programmatically\n   *\n   * **Purpose**: Activate a specific canvas for focused editing\n   *\n   * **Use cases**:\n   * - Focus specific section after adding items\n   * - Programmatic navigation between sections\n   * - Show canvas-specific settings panel\n   *\n   * **Events triggered**: 'canvasActivated'\n   *\n   * @param canvasId - Canvas to activate\n   *\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.setActiveCanvas('canvas2');\n   * ```\n   */\n  @Method()\n  async setActiveCanvas(canvasId: string) {\n    this.api?.setActiveCanvas(canvasId);\n  }\n\n  /**\n   * Get currently active canvas ID\n   *\n   * **Purpose**: Check which canvas is currently active/focused\n   *\n   * @returns Promise<string | null> - Active canvas ID or null if none active\n   *\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const activeId = await builder.getActiveCanvas();\n   * if (activeId === 'canvas1') {\n   *   console.log('Canvas 1 is active');\n   * }\n   * ```\n   */\n  @Method()\n  async getActiveCanvas(): Promise<string | null> {\n    return this.api?.getActiveCanvas() || null;\n  }\n\n  /**\n   * Undo last action\n   *\n   * **Purpose**: Revert last user action (move, resize, add, delete, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.undo();\n   * ```\n   */\n  @Method()\n  async undo() {\n    this.api?.undo();\n  }\n\n  /**\n   * Redo last undone action\n   *\n   * **Purpose**: Re-apply last undone action\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.redo();\n   * ```\n   */\n  @Method()\n  async redo() {\n    this.api?.redo();\n  }\n\n  /**\n   * Check if undo is available\n   *\n   * **Purpose**: Determine if there are actions to undo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canUndo = await builder.canUndo();\n   * undoButton.disabled = !canUndo;\n   * ```\n   *\n   * @returns Promise<boolean> - True if undo is available\n   */\n  @Method()\n  async canUndo(): Promise<boolean> {\n    return this.api?.canUndo() || false;\n  }\n\n  /**\n   * Check if redo is available\n   *\n   * **Purpose**: Determine if there are actions to redo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canRedo = await builder.canRedo();\n   * redoButton.disabled = !canRedo;\n   * ```\n   *\n   * @returns Promise<boolean> - True if redo is available\n   */\n  @Method()\n  async canRedo(): Promise<boolean> {\n    return this.api?.canRedo() || false;\n  }\n\n  /**\n   * Add a component programmatically\n   *\n   * **Purpose**: Add new component to canvas without dragging from palette\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const itemId = await builder.addComponent('canvas1', 'header', {\n   *   x: 10, y: 10, width: 30, height: 6\n   * }, { title: 'My Header' });\n   * ```\n   *\n   * @param canvasId - Canvas to add component to\n   * @param componentType - Component type from registry\n   * @param position - Grid position and size\n   * @param config - Optional component configuration\n   * @returns Promise<string | null> - New item ID or null if failed\n   */\n  @Method()\n  async addComponent(\n    canvasId: string,\n    componentType: string,\n    position: { x: number; y: number; width: number; height: number },\n    config?: Record<string, any>\n  ): Promise<string | null> {\n    return this.api?.addComponent(canvasId, componentType, position, config) || null;\n  }\n\n  /**\n   * Delete a component programmatically\n   *\n   * **Purpose**: Remove component from grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.deleteComponent('item-123');\n   * ```\n   *\n   * @param itemId - Item ID to delete\n   * @returns Promise<boolean> - True if deleted successfully\n   */\n  @Method()\n  async deleteComponent(itemId: string): Promise<boolean> {\n    return this.api?.deleteComponent(itemId) || false;\n  }\n\n  /**\n   * Update component configuration\n   *\n   * **Purpose**: Update component properties/config\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.updateConfig('item-123', {\n   *   title: 'Updated Title',\n   *   color: '#ff0000'\n   * });\n   * ```\n   *\n   * @param itemId - Item ID to update\n   * @param config - Configuration updates\n   * @returns Promise<boolean> - True if updated successfully\n   */\n  @Method()\n  async updateConfig(itemId: string, config: Record<string, any>): Promise<boolean> {\n    return this.api?.updateConfig(itemId, config) || false;\n  }\n\n  /**\n   * Reference to host element\n   */\n  private el?: HTMLElement;\n\n  /**\n   * Render component template\n   *\n   * **Purpose**: Render main UI structure\n   *\n   * **Structure**:\n   * - Host element with theme classes\n   * - Component palette (sidebar or custom)\n   * - Canvas area with sections\n   *\n   * **Note**: Actual rendering delegates to child components:\n   * - <component-palette> or custom ComponentPalette\n   * - <canvas-section> for each canvas\n   *\n   * **Config Panel**: Users should implement their own config panels\n   * - See custom-config-panel in demo for reference implementation\n   * - Listen to 'item-click' events to show your config UI\n   */\n  render() {\n    const canvasIds = Object.keys(gridState.canvases);\n\n    return (\n      <Host ref={(el) => this.el = el}>\n        <div class=\"grid-builder-container\">\n          {/* Component Palette */}\n          <div class=\"palette-area\">\n            <component-palette components={this.components} config={this.config} />\n          </div>\n\n          {/* Canvas Area */}\n          <div class=\"canvas-area\">\n            {/* Canvases */}\n            <div class=\"canvases-container\">\n              {canvasIds.map((canvasId) => (\n                <canvas-section\n                  key={canvasId}\n                  canvasId={canvasId}\n                  isActive={gridState.activeCanvasId === canvasId}\n                  config={this.config}\n                  componentRegistry={this.componentRegistry}\n                  backgroundColor={this.canvasMetadata?.[canvasId]?.backgroundColor}\n                  canvasTitle={this.canvasMetadata?.[canvasId]?.title}\n                  onBeforeDelete={this.onBeforeDelete}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}