{"version":3,"file":"canvas-section.js","sourceRoot":"","sources":["../../../src/components/canvas-section/canvas-section.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Canvas Section Component\n * ========================\n *\n * Individual canvas dropzone with grid background and item rendering.\n * This is a library component designed to work with the grid-builder component.\n *\n * ## Purpose\n *\n * Provides a single canvas section with:\n * - **Dropzone**: Accepts palette items and grid items via interact.js\n * - **Grid background**: Visual 2% horizontal × 20px vertical grid\n * - **Item rendering**: Renders all items on this canvas\n * - **ResizeObserver**: Invalidates grid cache on resize\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Section controls (background color picker, clear button, delete button)\n * - Section header with number\n * - Confirm dialogs\n * - section-delete events\n *\n * **Library-specific features**:\n * - Clean canvas without UI controls\n * - Grid background based on GridConfig\n * - Designed to be used inside grid-builder component\n *\n * ## Dropzone Behavior\n *\n * **Accepts two types of drops**:\n *\n * ### 1. Palette Item (Create New)\n * ```typescript\n * new CustomEvent('canvas-drop', {\n *   detail: { canvasId, componentType, x, y },\n *   bubbles: true,\n *   composed: true\n * })\n * ```\n *\n * ### 2. Grid Item (Cross-Canvas Move)\n * ```typescript\n * new CustomEvent('canvas-move', {\n *   detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n *   bubbles: true,\n *   composed: true\n * })\n * ```\n *\n * ## Grid Background\n *\n * **CSS grid pattern**:\n * - Horizontal: 2% of container width (responsive)\n * - Vertical: 20px (fixed)\n * - Color: rgba(0,0,0,0.05)\n * - Toggleable via gridState.showGrid\n *\n * ## Performance\n *\n * **ResizeObserver**: Clears grid cache on container resize\n * **Virtual rendering**: Items use VirtualRenderer for lazy loading\n * **Render version**: Forces item recalculation on resize\n *\n * @module canvas-section\n */\n\nimport { Component, h, Prop, State, Watch } from '@stencil/core';\nimport interact from 'interactjs';\n\n// Internal imports\nimport { Canvas, GridItem, gridState, onChange, setActiveCanvas } from '../../services/state-manager';\nimport { clearGridSizeCache, gridToPixelsX, gridToPixelsY, getGridSizeVertical } from '../../utils/grid-calculations';\nimport { calculateCanvasHeight } from '../../utils/canvas-height-calculator';\nimport { GridConfig } from '../../types/grid-config';\nimport { ComponentDefinition } from '../../types/component-definition';\n\n/**\n * CanvasSection Component\n * =======================\n *\n * Library component providing individual canvas dropzone.\n *\n * **Tag**: `<canvas-section>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: 'canvas-section',\n  styleUrl: 'canvas-section.scss',\n  shadow: false, // Light DOM required for interact.js\n})\nexport class CanvasSection {\n  /**\n   * Canvas ID for state management\n   *\n   * **Format**: 'canvas1', 'canvas2', etc.\n   * **Purpose**: Key for accessing canvas data in gridState.canvases\n   * **Required**: Component won't render without valid canvasId\n   */\n  @Prop() canvasId!: string;\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Grid size calculations, constraints\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Component registry (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (built from components prop)\n   * **Structure**: Map<type, ComponentDefinition>\n   * **Purpose**: Pass to grid-item-wrapper for dynamic rendering\n   */\n  @Prop() componentRegistry?: Map<string, ComponentDefinition>;\n\n  /**\n   * Background color for this canvas\n   *\n   * **Host app responsibility**: Pass canvas styling from host app\n   * **Library does NOT store**: backgroundColor is presentation concern\n   * **Optional**: Defaults to '#ffffff'\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   backgroundColor=\"#f0f4f8\"\n   * />\n   * ```\n   */\n  @Prop() backgroundColor?: string;\n\n  /**\n   * Canvas title (from canvasMetadata)\n   *\n   * **Optional**: Display title for this section\n   * **Renders as**: Rotated tab on right side, outside section bounds\n   * **Builder mode only**: Title tabs visible in builder, not viewer\n   * **Source**: Passed from grid-builder via canvasMetadata[canvasId].title\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   canvasTitle=\"Hero Section\"\n   * />\n   * ```\n   */\n  @Prop() canvasTitle?: string;\n\n  /**\n   * Whether this canvas is currently active\n   *\n   * **Purpose**: Indicate which canvas is currently focused/active\n   * **Source**: Computed from gridState.activeCanvasId in grid-builder\n   * **Default**: false\n   * **Visual effect**: Applies 'active' CSS class to grid-container\n   *\n   * **Canvas becomes active when**:\n   * - User clicks item on canvas\n   * - User clicks canvas background\n   * - User starts dragging item on canvas\n   * - User starts resizing item on canvas\n   * - Programmatically via api.setActiveCanvas()\n   *\n   * **Consumer styling hook**:\n   * Consumer can style active canvas via CSS:\n   * ```css\n   * .grid-container.active .canvas-title {\n   *   opacity: 1;\n   * }\n   * ```\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   isActive={gridState.activeCanvasId === 'hero-section'}\n   * />\n   * ```\n   */\n  @Prop() isActive?: boolean = false;\n\n  /**\n   * Deletion hook (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (from onBeforeDelete prop)\n   * **Purpose**: Pass through to grid-item-wrapper for deletion interception\n   * **Optional**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: (context: any) => boolean | Promise<boolean>;\n\n  /**\n   * Canvas state (reactive)\n   *\n   * **Source**: gridState.canvases[canvasId]\n   * **Updates**: componentWillLoad, componentWillUpdate, onChange subscription\n   * **Contains**: items array, zIndexCounter (NO backgroundColor - that's a prop now)\n   */\n  @State() canvas: Canvas;\n\n  /**\n   * Render version counter (forces re-renders)\n   *\n   * **Purpose**: Trigger re-renders when grid calculations change\n   * **Incremented on**: ResizeObserver events, state changes\n   * **Passed to**: grid-item-wrapper as prop\n   * **Why needed**: Grid calculations cached, need to recalculate on resize\n   */\n  @State() renderVersion: number = 0;\n\n  /**\n   * Calculated canvas height (content-based)\n   *\n   * **Purpose**: Dynamic canvas height based on bottommost item\n   * **Calculation**: `(bottommost item y + height) + 5 grid units margin`\n   * **Updates**: Real-time on item add/move/delete/resize\n   * **Minimum**: 0 (CSS min-height: 400px will apply)\n   *\n   * **Formula**:\n   * ```\n   * calculatedHeight = gridToPixelsY(maxItemBottom + 5)\n   * ```\n   *\n   * **Applied in render**:\n   * ```typescript\n   * style={{ height: calculatedHeight > 0 ? `${calculatedHeight}px` : undefined }}\n   * ```\n   */\n  @State() private calculatedHeight: number = 0;\n\n  /**\n   * Drop target state\n   *\n   * **Internal state**: Tracks whether this canvas is currently a valid drop target\n   * **Used for**: Adding 'drop-target' class for visual feedback during drag operations\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - false: No drag is over this canvas\n   * - true: A draggable element is currently over this canvas\n   */\n  @State() private isDropTarget: boolean = false;\n\n  /**\n   * Grid container DOM reference\n   *\n   * **Used for**:\n   * - interact.js dropzone setup\n   * - ResizeObserver monitoring\n   * - Position calculations (getBoundingClientRect)\n   */\n  private gridContainerRef: HTMLElement;\n\n  /**\n   * Dropzone initialization flag\n   *\n   * **Prevents**: Multiple dropzone setups on same element\n   * **Set in**: initializeDropzone()\n   * **Checked in**: initializeDropzone(), disconnectedCallback()\n   */\n  private dropzoneInitialized: boolean = false;\n\n  /**\n   * ResizeObserver instance\n   *\n   * **Monitors**: gridContainerRef size changes\n   * **Callback**: Clears grid cache, increments renderVersion\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private resizeObserver: ResizeObserver;\n\n  /**\n   * Component will load lifecycle hook\n   *\n   * **Called**: Before first render\n   * **Purpose**: Load initial canvas state and subscribe to changes\n   *\n   * **Operations**:\n   * 1. Load canvas from global state\n   * 2. Subscribe to 'canvases' state changes\n   * 3. Update local canvas state on changes\n   * 4. Increment renderVersion to trigger item re-renders\n   */\n  componentWillLoad() {\n    // Initial load\n    this.canvas = gridState.canvases[this.canvasId];\n\n    // Calculate initial height\n    this.calculatedHeight = calculateCanvasHeight(this.canvasId, this.config);\n\n    // Subscribe to state changes\n    onChange('canvases', () => {\n      try {\n        if (this.canvasId && gridState.canvases[this.canvasId]) {\n          this.canvas = gridState.canvases[this.canvasId];\n          this.renderVersion++; // Force re-render\n\n          // Recalculate canvas height based on content\n          this.calculatedHeight = calculateCanvasHeight(this.canvasId, this.config);\n        }\n      } catch (error) {\n        console.debug('Canvas section state update skipped:', error);\n      }\n    });\n\n    // Subscribe to viewport changes (desktop ↔ mobile)\n    onChange('currentViewport', () => {\n      // Recalculate height for new viewport layout\n      this.calculatedHeight = calculateCanvasHeight(this.canvasId, this.config);\n    });\n\n    // Subscribe to grid visibility changes\n    onChange('showGrid', () => {\n      // Force re-render to update grid visibility class\n      this.renderVersion++;\n    });\n  }\n\n  /**\n   * Component will update lifecycle hook\n   *\n   * **Called**: Before each re-render\n   * **Purpose**: Ensure canvas reference is fresh from state\n   */\n  componentWillUpdate() {\n    this.canvas = gridState.canvases[this.canvasId];\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize interact.js dropzone and ResizeObserver\n   */\n  componentDidLoad() {\n    this.initializeDropzone();\n    this.setupResizeObserver();\n    this.setupCanvasClickListener();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component removed from DOM\n   * **Purpose**: Clean up interact.js and ResizeObserver\n   */\n  disconnectedCallback() {\n    // Cleanup interact.js\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n    }\n\n    // Cleanup ResizeObserver\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n  }\n\n  /**\n   * Watch for canvasId prop changes\n   *\n   * **When triggered**: Parent changes which canvas this component displays\n   * **Actions**: Reload canvas data from state, recalculate height\n   *\n   * **Why needed**:\n   * - Canvas ID is the key to access state\n   * - Changing canvas ID means displaying different canvas\n   * - Must reload items, metadata, and recalculate layout\n   *\n   * **Note**: This is rare in practice - usually canvas IDs are static\n   */\n  @Watch('canvasId')\n  handleCanvasIdChange(newCanvasId: string, oldCanvasId: string) {\n    // Skip if canvas ID hasn't changed\n    if (newCanvasId === oldCanvasId) return;\n\n    // Reload canvas data from state\n    this.canvas = gridState.canvases[newCanvasId];\n\n    // Recalculate canvas height for new canvas\n    this.calculatedHeight = calculateCanvasHeight(newCanvasId, this.config);\n\n    // Reinitialize dropzone with new canvas ID\n    // (dropzone needs to know which canvas it belongs to)\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n      this.dropzoneInitialized = false;\n      this.initializeDropzone();\n    }\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Recalculate canvas height with new grid settings\n   *\n   * **Why needed**:\n   * - Grid calculations depend on config (min/max grid size, etc.)\n   * - Canvas height calculation uses grid-to-pixels conversions\n   * - Config changes affect layout calculations\n   */\n  @Watch('config')\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Recalculate canvas height with new config\n    this.calculatedHeight = calculateCanvasHeight(this.canvasId, newConfig);\n\n    // Force re-render to update item positions with new grid size\n    this.renderVersion++;\n  }\n\n  /**\n   * Watch for isActive prop changes\n   *\n   * **When triggered**: Active canvas changes in grid-builder\n   * **Purpose**: Apply/remove 'active' CSS class for styling\n   *\n   * **Note**: No action needed - the prop change triggers re-render\n   * and the render() method applies the 'active' class based on this.isActive\n   *\n   * **Visual feedback**:\n   * - Active canvas may have highlighted border\n   * - Canvas title may be un-dimmed\n   * - Host app can style via `.grid-container.active` selector\n   */\n  @Watch('isActive')\n  handleIsActiveChange(newIsActive: boolean, oldIsActive: boolean) {\n    // Skip if active state hasn't changed\n    if (newIsActive === oldIsActive) return;\n\n    // No action needed - render() will apply/remove 'active' class\n    // This watcher is just for documentation and potential future enhancements\n  }\n\n  /**\n   * Setup canvas click listener for background selection\n   *\n   * **Purpose**: Detect clicks on canvas background (not on grid items)\n   *\n   * **Event dispatch**:\n   * - Only fires when clicking empty canvas area\n   * - Does not fire when clicking grid items\n   * - Bubbles up to grid-builder for host app to handle\n   *\n   * **Custom event**:\n   * ```typescript\n   * new CustomEvent('canvas-click', {\n   *   detail: { canvasId },\n   *   bubbles: true,\n   *   composed: true\n   * })\n   * ```\n   *\n   * **Use case**: Host app can show canvas settings panel when canvas selected\n   */\n  private setupCanvasClickListener = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    this.gridContainerRef.addEventListener('click', (event: MouseEvent) => {\n      // Only fire if clicking directly on the grid container\n      // (not on a grid item or other child element)\n      if (event.target === this.gridContainerRef) {\n        // Set this canvas as active\n        setActiveCanvas(this.canvasId);\n\n        // Emit canvas-activated event\n        const canvasActivatedEvent = new CustomEvent('canvas-activated', {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasActivatedEvent);\n\n        // Emit canvas-click event (backward compatibility)\n        const canvasClickEvent = new CustomEvent('canvas-click', {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasClickEvent);\n      }\n    });\n  };\n\n  /**\n   * Setup ResizeObserver for grid cache invalidation\n   *\n   * **Purpose**: Detect container size changes and force grid recalculation\n   *\n   * **Observer callback**:\n   * 1. Clear grid size cache (grid-calculations.ts)\n   * 2. Increment renderVersion (triggers item re-renders)\n   *\n   * **Why needed**:\n   * - Grid calculations cached for performance\n   * - Cache based on container width (responsive 2% units)\n   * - Container resize invalidates cache\n   * - Items need to recalculate positions with new dimensions\n   */\n  private setupResizeObserver = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    // Watch for canvas container size changes\n    this.resizeObserver = new ResizeObserver(() => {\n      // Clear grid size cache when container resizes\n      clearGridSizeCache();\n\n      // Force re-render to update item positions\n      this.renderVersion++;\n    });\n\n    this.resizeObserver.observe(this.gridContainerRef);\n  };\n\n  /**\n   * Initialize interact.js dropzone\n   *\n   * **Called from**: componentDidLoad (after DOM available)\n   * **Purpose**: Setup dropzone to receive palette items and grid items\n   *\n   * ## Dropzone Configuration\n   *\n   * **Accept pattern**: `.palette-item, .grid-item`\n   * - `.palette-item` - New components from palette\n   * - `.grid-item` - Existing items for cross-canvas moves\n   *\n   * **Overlap mode**: `'pointer'`\n   * - Drop detection based on cursor position\n   * - More intuitive than element overlap\n   *\n   * ## Drop Event Handling\n   *\n   * ### 1. Palette Item Drop (Create New)\n   *\n   * **Component type extraction**:\n   * ```typescript\n   * const componentType = droppedElement.getAttribute('data-component-type');\n   * ```\n   *\n   * **Position calculation**:\n   * - Get component's defaultSize from definition\n   * - Calculate half dimensions for cursor-centering\n   * - Subtract half dimensions from cursor position\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-drop', {\n   *   detail: { canvasId, componentType, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   *\n   * ### 2. Grid Item Drop (Cross-Canvas Move)\n   *\n   * **Only process cross-canvas moves**:\n   * - Same-canvas moves handled by drag handler\n   * - Prevents duplicate events\n   *\n   * **Position calculation**:\n   * - Use element's bounding rect (already positioned by drag handler)\n   * - Calculate position relative to target canvas\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-move', {\n   *   detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   */\n  private initializeDropzone = () => {\n    if (!this.gridContainerRef || this.dropzoneInitialized) {\n      return;\n    }\n\n    const interactable = interact(this.gridContainerRef);\n\n    interactable.dropzone({\n      accept: '.palette-item, .grid-item, .grid-item-header',\n      overlap: 'pointer',\n\n      listeners: {\n        dragenter: (_event: any) => {\n          // Add visual feedback when drag enters canvas (replaces classList.add)\n          this.isDropTarget = true;\n        },\n\n        dragleave: (_event: any) => {\n          // Remove visual feedback when drag leaves canvas (replaces classList.remove)\n          this.isDropTarget = false;\n        },\n\n        drop: (event: any) => {\n          // Remove visual feedback on successful drop (replaces classList.remove)\n          this.isDropTarget = false;\n          const droppedElement = event.relatedTarget;\n          const isPaletteItem = droppedElement.classList.contains('palette-item');\n\n          // Mark palette item drop as valid (for snap-back animation)\n          if (isPaletteItem) {\n            (droppedElement as any)._dropWasValid = true;\n          }\n\n        // Check if it's a grid item or grid item header (drag handle)\n        const isGridItemHeader = droppedElement.classList.contains('grid-item-header');\n        const isGridItem = droppedElement.classList.contains('grid-item');\n\n        // If it's the header, find the parent grid-item\n        const gridItem = isGridItemHeader\n          ? droppedElement.closest('.grid-item')\n          : droppedElement;\n\n        if (isPaletteItem) {\n          // Dropping from palette - create new item\n          const componentType = droppedElement.getAttribute('data-component-type');\n\n          // Get stored dimensions from palette drag handler (or fall back to 10×6 default)\n          const defaultWidth = (droppedElement as any)._defaultWidth || 10;\n          const defaultHeight = (droppedElement as any)._defaultHeight || 6;\n          const widthPx = gridToPixelsX(defaultWidth, this.canvasId, this.config);\n          const heightPx = gridToPixelsY(defaultHeight);\n          const halfWidth = widthPx / 2;\n          const halfHeight = heightPx / 2;\n\n          // Get drop position relative to grid container (cursor-centered)\n          const rect = this.gridContainerRef.getBoundingClientRect();\n          const x = event.dragEvent.clientX - rect.left - halfWidth;\n          const y = event.dragEvent.clientY - rect.top - halfHeight;\n\n          // Dispatch custom event for grid-builder to handle\n          const dropEvent = new CustomEvent('canvas-drop', {\n            detail: {\n              canvasId: this.canvasId,\n              componentType,\n              x,\n              y,\n            },\n            bubbles: true,\n            composed: true,\n          });\n          this.gridContainerRef.dispatchEvent(dropEvent);\n        } else if (isGridItem || isGridItemHeader) {\n          // Moving existing grid item to different canvas\n          const itemId = gridItem.id;\n          const sourceCanvasId = gridItem.getAttribute('data-canvas-id');\n\n          // Only process cross-canvas moves\n          if (sourceCanvasId !== this.canvasId) {\n            // Get element's position (already positioned by drag handler)\n            const droppedRect = gridItem.getBoundingClientRect();\n            const rect = this.gridContainerRef.getBoundingClientRect();\n\n            // Calculate position relative to target canvas\n            const x = droppedRect.left - rect.left;\n            const y = droppedRect.top - rect.top;\n\n            // Dispatch custom event for cross-canvas move\n            const moveEvent = new CustomEvent('canvas-move', {\n              detail: {\n                itemId,\n                sourceCanvasId,\n                targetCanvasId: this.canvasId,\n                x,\n                y,\n              },\n              bubbles: true,\n              composed: true,\n            });\n            this.gridContainerRef.dispatchEvent(moveEvent);\n          }\n        }\n      },\n    },\n  });\n\n    this.dropzoneInitialized = true;\n  };\n\n  /**\n   * Render component template\n   *\n   * **Structure**:\n   * - Grid container with background\n   * - Dynamic class for grid visibility\n   * - Background color from canvas state\n   * - Item rendering loop\n   *\n   * **Grid background**:\n   * - CSS linear gradients (2% horizontal, 20px vertical)\n   * - Toggleable via gridState.showGrid\n   * - Hidden when .hide-grid class applied\n   *\n   * **Item rendering**:\n   * - Maps over canvas.items\n   * - Renders grid-item-wrapper for each item\n   * - Passes renderVersion to force recalculation\n   */\n  render() {\n    const showGrid = gridState.showGrid;\n    const verticalGridSize = getGridSizeVertical(this.config);\n\n    // Calculate min-height from config (default 20 grid units)\n    const minHeightGridUnits = this.config?.canvasMinHeight ?? 20;\n    const minHeightPx = gridToPixelsY(minHeightGridUnits, this.config);\n\n    return (\n      <div class=\"canvas-section\" data-canvas-id={this.canvasId}>\n        <div\n          class={{\n            'grid-container': true,\n            'hide-grid': !showGrid,\n            'active': this.isActive,\n            'drop-target': this.isDropTarget,\n          }}\n          id={this.canvasId}\n          data-canvas-id={this.canvasId}\n          style={{\n            backgroundColor: this.backgroundColor || '#ffffff',\n            backgroundSize: `2% ${verticalGridSize}px`,\n            minHeight: `${minHeightPx}px`,\n            ...(this.calculatedHeight > 0 ? { height: `${this.calculatedHeight}px` } : {}),\n          }}\n          ref={(el) => (this.gridContainerRef = el)}\n        >\n          {/* Grid items rendered by grid-item-wrapper components */}\n          {this.canvas?.items.map((item: GridItem) => (\n            <grid-item-wrapper\n              key={item.id}\n              item={item}\n              renderVersion={this.renderVersion}\n              config={this.config}\n              componentRegistry={this.componentRegistry}\n              onBeforeDelete={this.onBeforeDelete}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  }\n}\n"]}