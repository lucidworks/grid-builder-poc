{"version":3,"file":"test-utils.js","sourceRoot":"","sources":["../../src/utils/test-utils.ts"],"names":[],"mappings":"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","sourcesContent":["// External libraries (alphabetical)\nimport { SpecPage } from '@stencil/core/testing';\n\n// Internal imports (alphabetical)\nimport { GridItem, gridState } from '../services/state-manager';\n\n/**\n * Mock global objects for testing\n * Call this before importing components that use these globals\n */\nexport function setupGlobalMocks(): void {\n  // Mock IntersectionObserver\n  (global as any).IntersectionObserver = jest.fn(() => ({\n    observe: jest.fn(),\n    unobserve: jest.fn(),\n    disconnect: jest.fn(),\n  }));\n\n  // Mock interact.js\n  (global as any).interact = jest.fn(() => ({\n    draggable: jest.fn().mockReturnThis(),\n    resizable: jest.fn().mockReturnThis(),\n    dropzone: jest.fn().mockReturnThis(),\n    unset: jest.fn(),\n  }));\n\n  // Set window.interact for components that check it\n  (window as any).interact = (global as any).interact;\n}\n\n/**\n * Reset gridState to initial state\n * Call this in beforeEach to ensure clean state\n */\nexport function resetGridState(): void {\n  gridState.canvases = {\n    canvas1: {\n      items: [],\n      zIndexCounter: 1,\n    },\n  };\n  gridState.selectedItemId = null;\n  gridState.selectedCanvasId = null;\n  gridState.currentViewport = 'desktop';\n  gridState.showGrid = true;\n}\n\n/**\n * Create a test grid item with sensible defaults\n * Customize with partial override\n */\nexport function createTestItem(overrides?: Partial<GridItem>): GridItem {\n  return {\n    id: 'item-1',\n    canvasId: 'canvas1',\n    type: 'header',\n    name: 'Test Header',\n    layouts: {\n      desktop: { x: 100, y: 100, width: 200, height: 150 },\n      mobile: { x: null, y: null, width: null, height: null, customized: false },\n    },\n    zIndex: 1,\n    ...overrides,\n  };\n}\n\n/**\n * Create multiple test items\n */\nexport function createTestItems(count: number, baseOverrides?: Partial<GridItem>): GridItem[] {\n  return Array.from({ length: count }, (_, index) =>\n    createTestItem({\n      id: `item-${index + 1}`,\n      name: `Test Item ${index + 1}`,\n      zIndex: index + 1,\n      layouts: {\n        desktop: {\n          x: 10 + index * 5,\n          y: 10 + index * 5,\n          width: 200,\n          height: 150,\n        },\n        mobile: { x: null, y: null, width: null, height: null, customized: false },\n      },\n      ...baseOverrides,\n    })\n  );\n}\n\n/**\n * Create a mock canvas element with specified width\n * Returns the element so it can be appended to the test page\n */\nexport function createMockCanvas(page: SpecPage, canvasId: string = 'canvas1', width: number = 1000): HTMLElement {\n  const mockCanvas = page.doc.createElement('div');\n  mockCanvas.id = canvasId;\n\n  // Mock clientWidth since JSDOM doesn't compute layout\n  Object.defineProperty(mockCanvas, 'clientWidth', {\n    value: width,\n    writable: true,\n    configurable: true,\n  });\n\n  return mockCanvas;\n}\n\n/**\n * Setup a spec page with mock canvas for layout tests\n * This handles the complex setup needed for tests that use grid calculations\n */\nexport interface MockCanvasSetupOptions {\n  canvasId?: string;\n  canvasWidth?: number;\n  component: any;\n  componentProps?: Record<string, any>;\n  componentTag?: string;\n}\n\nexport async function setupSpecPageWithCanvas(page: SpecPage, options: MockCanvasSetupOptions): Promise<HTMLElement> {\n  const { canvasId = 'canvas1', canvasWidth = 1000, component, componentProps = {}, componentTag } = options;\n\n  // Create and add mock canvas\n  const mockCanvas = createMockCanvas(page, canvasId, canvasWidth);\n  page.body.appendChild(mockCanvas);\n\n  // Clear existing content\n  page.root.innerHTML = '';\n\n  // Create component element\n  const tag =\n    componentTag ||\n    component.is ||\n    `${component.name\n      .replace(/([A-Z])/g, '-$1')\n      .toLowerCase()\n      .slice(1)}`;\n  const wrapper = page.doc.createElement(tag) as any;\n\n  // Apply props\n  Object.entries(componentProps).forEach(([key, value]) => {\n    wrapper[key] = value;\n  });\n\n  // Add to page and wait for changes\n  page.root.appendChild(wrapper);\n  await page.waitForChanges();\n\n  return wrapper;\n}\n\n/**\n * Dispatch a custom event on an element or document\n */\nexport function dispatchCustomEvent<T = any>(\n  element: Element | Document,\n  eventName: string,\n  detail: T,\n  options: { bubbles?: boolean; composed?: boolean } = {}\n): void {\n  const event = new CustomEvent(eventName, {\n    detail,\n    bubbles: options.bubbles ?? true,\n    composed: options.composed ?? true,\n  });\n  element.dispatchEvent(event);\n}\n\n/**\n * Wait for a condition to be true\n * Useful for async operations in tests\n */\nexport async function waitFor(\n  condition: () => boolean | Promise<boolean>,\n  timeout: number = 1000,\n  interval: number = 50\n): Promise<void> {\n  const startTime = Date.now();\n\n  while (Date.now() - startTime < timeout) {\n    const result = await condition();\n    if (result) {\n      return;\n    }\n    await new Promise((resolve) => setTimeout(resolve, interval));\n  }\n\n  throw new Error(`Condition not met within ${timeout}ms`);\n}\n\n/**\n * Get element text content trimmed\n */\nexport function getTextContent(element: Element | null): string {\n  return element?.textContent?.trim() || '';\n}\n\n/**\n * Check if element has class\n */\nexport function hasClass(element: Element | null, className: string): boolean {\n  return element?.classList.contains(className) ?? false;\n}\n\n/**\n * Mock pattern: Create a jest spy function that can be chained\n */\nexport function createChainableMock(): jest.Mock {\n  const mock = jest.fn();\n  mock.mockReturnThis();\n  return mock;\n}\n"]}