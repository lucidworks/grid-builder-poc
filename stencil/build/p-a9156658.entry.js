import{r as e,h as i}from"./p-BS4nUT4S.js";const t="config-panel .config-panel{position:fixed;z-index:2000;top:0;right:-400px;display:flex;width:400px;height:100vh;flex-direction:column;background:white;box-shadow:-2px 0 8px rgba(0, 0, 0, 0.15);transition:right 0.3s ease}config-panel .config-panel.open{right:0}config-panel .config-panel-header{display:flex;align-items:center;justify-content:space-between;padding:20px;border-bottom:1px solid #ddd}config-panel .config-panel-header h2{margin:0;color:#333;font-size:18px}config-panel .config-panel-close{display:flex;width:32px;height:32px;align-items:center;justify-content:center;padding:0;border:none;border-radius:4px;background:transparent;color:#999;cursor:pointer;font-size:24px;transition:all 0.2s}config-panel .config-panel-close:hover{background:#f5f5f5;color:#333}config-panel .config-panel-body{flex:1;padding:20px;overflow-y:auto}config-panel .config-section{margin-bottom:24px}config-panel .config-section h3{margin:0 0 16px 0;color:#333;font-size:14px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase}config-panel .config-section .no-config{color:#999;font-size:13px;font-style:italic}config-panel .config-field{margin-bottom:20px}config-panel .config-field label{display:block;margin-bottom:8px;color:#333;font-size:13px;font-weight:600}config-panel .config-field input[type=text],config-panel .config-field input[type=number],config-panel .config-field input[type=color],config-panel .config-field select,config-panel .config-field textarea{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #ddd;border-radius:4px;font-size:13px;transition:border-color 0.2s}config-panel .config-field input[type=text]:focus,config-panel .config-field input[type=number]:focus,config-panel .config-field input[type=color]:focus,config-panel .config-field select:focus,config-panel .config-field textarea:focus{border-color:#4a90e2;outline:none}config-panel .config-field input[type=color]{height:40px;padding:4px}config-panel .config-field textarea{font-family:inherit;resize:vertical}config-panel .config-field.config-field-checkbox label{display:flex;align-items:center;cursor:pointer;gap:8px}config-panel .config-field.config-field-checkbox label input[type=checkbox]{width:auto;margin:0;cursor:pointer}config-panel .config-field .field-error{margin:4px 0 0 0;color:#f44;font-size:12px}config-panel .z-index-controls{display:grid;gap:8px;grid-template-columns:1fr 1fr}config-panel .z-index-btn{padding:10px 12px;border:1px solid #ddd;border-radius:4px;background:white;cursor:pointer;font-size:13px;font-weight:500;text-align:center;transition:all 0.2s}config-panel .z-index-btn:hover{border-color:#4a90e2;background:#f5f5f5;color:#4a90e2}config-panel .config-panel-footer{display:flex;justify-content:flex-end;padding:20px;border-top:1px solid #ddd;gap:10px}config-panel .config-panel-footer button{padding:10px 20px;border:1px solid #ddd;border-radius:4px;background:white;cursor:pointer;font-size:13px;font-weight:500;transition:all 0.2s}config-panel .config-panel-footer button:hover{background:#f5f5f5}config-panel .config-panel-footer button.primary{border-color:#4a90e2;background:#4a90e2;color:white}config-panel .config-panel-footer button.primary:hover{border-color:#357abd;background:#357abd}";const n=class{constructor(i){e(this,i);this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentName="";this.componentConfig={};this.originalState=null;this.eventsSubscribed=false;this.handleItemRemoved=e=>{console.log("ðŸ”” config-panel received itemRemoved event",{eventItemId:e.itemId,selectedItemId:this.selectedItemId,isOpen:this.isOpen,shouldClose:this.isOpen&&this.selectedItemId&&e.itemId===this.selectedItemId});if(this.isOpen&&this.selectedItemId&&e.itemId===this.selectedItemId){console.log("  âœ… Closing panel because selected item was deleted");this.closePanel()}else{console.log("  â„¹ï¸ Not closing panel - different item or panel already closed")}};this.openPanel=(e,i)=>{var t;this.selectedItemId=e;this.selectedCanvasId=i;const n=this.getSelectedItem();if(!n){return}const o=(t=this.componentRegistry)===null||t===void 0?void 0:t.get(n.type);this.originalState={name:n.name||(o===null||o===void 0?void 0:o.name)||n.type,zIndex:n.zIndex,config:n.config?Object.assign({},n.config):{}};this.componentName=this.originalState.name;this.componentConfig=Object.assign({},this.originalState.config);if(this.api){const t=this.api.getState();t.selectedItemId=e;t.selectedCanvasId=i}this.isOpen=true};this.closePanel=()=>{if(this.selectedItemId&&this.selectedCanvasId&&this.originalState&&this.api){const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t!==undefined&&t!==-1){i.items[t]=Object.assign(Object.assign({},i.items[t]),{name:this.originalState.name,zIndex:this.originalState.zIndex,config:this.originalState.config});e.canvases=Object.assign({},e.canvases)}}this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentName="";this.componentConfig={};this.originalState=null};this.saveConfig=()=>{this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentName="";this.componentConfig={};this.originalState=null};this.handleNameInput=e=>{const i=e.target;this.componentName=i.value;if(this.selectedItemId&&this.selectedCanvasId&&this.api){const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t!==undefined&&t!==-1){i.items[t]=Object.assign(Object.assign({},i.items[t]),{name:this.componentName});e.canvases=Object.assign({},e.canvases)}}};this.handleConfigChange=(e,i)=>{this.componentConfig=Object.assign(Object.assign({},this.componentConfig),{[e]:i});if(this.selectedItemId&&this.selectedCanvasId&&this.api){const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t!==undefined&&t!==-1){i.items[t]=Object.assign(Object.assign({},i.items[t]),{config:this.componentConfig});e.canvases=Object.assign({},e.canvases)}}};this.bringToFront=()=>{if(!this.selectedItemId||!this.selectedCanvasId||!this.api)return;const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t===undefined||t===-1)return;const n=++i.zIndexCounter;i.items[t]=Object.assign(Object.assign({},i.items[t]),{zIndex:n});e.canvases=Object.assign({},e.canvases)};this.bringForward=()=>{if(!this.selectedItemId||!this.selectedCanvasId||!this.api)return;const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t===undefined||t===-1)return;const n=i.items[t];const o=i.items.filter((e=>e.zIndex>n.zIndex));if(o.length>0){const c=Math.min(...o.map((e=>e.zIndex)));const s=i.items.findIndex((e=>e.zIndex===c));if(s!==-1){const o=n.zIndex;i.items[t]=Object.assign(Object.assign({},n),{zIndex:c});i.items[s]=Object.assign(Object.assign({},i.items[s]),{zIndex:o});e.canvases=Object.assign({},e.canvases)}}};this.sendBackward=()=>{if(!this.selectedItemId||!this.selectedCanvasId||!this.api)return;const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t===undefined||t===-1)return;const n=i.items[t];const o=i.items.filter((e=>e.zIndex<n.zIndex));if(o.length>0){const c=Math.max(...o.map((e=>e.zIndex)));const s=i.items.findIndex((e=>e.zIndex===c));if(s!==-1){const o=n.zIndex;i.items[t]=Object.assign(Object.assign({},n),{zIndex:c});i.items[s]=Object.assign(Object.assign({},i.items[s]),{zIndex:o});e.canvases=Object.assign({},e.canvases)}}};this.sendToBack=()=>{if(!this.selectedItemId||!this.selectedCanvasId||!this.api)return;const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];const t=i===null||i===void 0?void 0:i.items.findIndex((e=>e.id===this.selectedItemId));if(t===undefined||t===-1)return;const n=Math.min(...i.items.map((e=>e.zIndex)));const o=Math.max(1,n-1);if(n<=1){const e=[...i.items].sort(((e,i)=>e.zIndex-i.zIndex));i.items=e.map(((e,i)=>Object.assign(Object.assign({},e),{zIndex:e.id===this.selectedItemId?1:i+2})))}else{i.items[t]=Object.assign(Object.assign({},i.items[t]),{zIndex:o})}e.canvases=Object.assign({},e.canvases)}}ensureEventSubscription(){if(this.eventsSubscribed||!this.api){return}this.api.on("itemRemoved",this.handleItemRemoved);this.eventsSubscribed=true;console.log("  âœ… Config panel: Subscribed to itemRemoved event")}handleApiChange(e){console.log("ðŸ“‹ config-panel API prop changed",{hasNewApi:!!e});if(e&&!this.eventsSubscribed){this.ensureEventSubscription()}}handleItemClick(e){const{itemId:i,canvasId:t}=e.detail;this.openPanel(i,t)}componentDidLoad(){console.log("ðŸ“‹ config-panel componentDidLoad - subscribing to itemRemoved event");this.ensureEventSubscription()}disconnectedCallback(){if(this.api&&this.eventsSubscribed){this.api.off("itemRemoved",this.handleItemRemoved);this.eventsSubscribed=false}}render(){var e;const t={"config-panel":true,open:this.isOpen};const n=this.getSelectedItem();const o=n?(e=this.componentRegistry)===null||e===void 0?void 0:e.get(n.type):null;return i("div",{key:"fc359180420e90cef43a4fa72b5fd880d8be6749",class:t},i("div",{key:"c38f36d465c30fc54ef1fdd644fb5db9ac605093",class:"config-panel-header"},i("h2",{key:"a1780ee4d43a1782f5530c3b9329fe263cf71343"},"Component Settings"),i("button",{key:"598f1e39c9184b385c317bc4a526d7253212f2c8",class:"config-panel-close",onClick:()=>this.closePanel()},"Ã—")),i("div",{key:"e7077fcb3f2b9c524fe3fc26a7c20808cf73b506",class:"config-panel-body"},i("div",{key:"0385aad94069529d601e3e249dd9ba3f1639edc3",class:"config-field"},i("label",{key:"410ffbf430f5bd96c7ca251c55b9e5e079e553fe",htmlFor:"componentName"},"Component Name"),i("input",{key:"e67663d22d4c0cacba29c926b3e83c6fde5e5515",type:"text",id:"componentName",value:this.componentName,onInput:e=>this.handleNameInput(e),placeholder:"Enter component name"})),o&&this.renderConfigFields(o),i("div",{key:"b7bd963abf30bae05e1d259e61b9ea13601fe791",class:"config-field"},i("label",{key:"4c7e0a3e53f8d688512eb2f0ef5fb0d0be519cd0"},"Layer Order"),i("div",{key:"28523ac3edfc01300159640f2a4a9e3ef94ea07f",class:"z-index-controls"},i("button",{key:"900668dff340bd8a69190965cc5b636e33881b1f",class:"z-index-btn",onClick:()=>this.bringToFront(),title:"Bring to Front"},"â¬†ï¸ To Front"),i("button",{key:"3549e1a427f296952b1dafcd23c10dc8b0a8c0d3",class:"z-index-btn",onClick:()=>this.bringForward(),title:"Bring Forward"},"â†‘ Forward"),i("button",{key:"a205681e8cd36690f4d08dc6ec5d225f3e0b5c10",class:"z-index-btn",onClick:()=>this.sendBackward(),title:"Send Backward"},"â†“ Backward"),i("button",{key:"4fcf3fe7cd34adcc7c176bf7543eba3f5bf1ef85",class:"z-index-btn",onClick:()=>this.sendToBack(),title:"Send to Back"},"â¬‡ï¸ To Back")))),i("div",{key:"5eff8c62456074ace6e7b8b3f117a88882d8d7d1",class:"config-panel-footer"},i("button",{key:"7e2f11f3712a164fb00d81c6ce3171b27014212b",onClick:()=>this.closePanel()},"Cancel"),i("button",{key:"e80e743f9f1236161cf8756d258b2ec08dd0d363",class:"primary",onClick:()=>this.saveConfig()},"Save")))}renderConfigFields(e){if(e.renderConfigPanel){return e.renderConfigPanel({config:this.componentConfig,onChange:this.handleConfigChange,onSave:this.saveConfig,onCancel:this.closePanel})}if(e.configSchema&&e.configSchema.length>0){return i("div",{class:"config-section"},i("h3",null,"Component Configuration"),e.configSchema.map((e=>this.renderConfigField(e))))}return i("div",{class:"config-section"},i("p",{class:"no-config"},"No configuration options available for this component."))}renderConfigField(e){var t,n,o;const c=(n=(t=this.componentConfig[e.name])!==null&&t!==void 0?t:e.defaultValue)!==null&&n!==void 0?n:"";switch(e.type){case"text":return i("div",{class:"config-field",key:e.name},i("label",{htmlFor:e.name},e.label),i("input",{type:"text",id:e.name,value:c,onInput:i=>this.handleConfigChange(e.name,i.target.value),placeholder:e.placeholder}));case"number":return i("div",{class:"config-field",key:e.name},i("label",{htmlFor:e.name},e.label),i("input",{type:"number",id:e.name,value:c,onInput:i=>this.handleConfigChange(e.name,Number(i.target.value)),min:e.min,max:e.max,step:e.step}));case"select":return i("div",{class:"config-field",key:e.name},i("label",{htmlFor:e.name},e.label),i("select",{id:e.name,onChange:i=>this.handleConfigChange(e.name,i.target.value)},(o=e.options)===null||o===void 0?void 0:o.map((e=>{const t=typeof e==="string"?e:e.value;const n=typeof e==="string"?e:e.label;return i("option",{key:t,value:t,selected:c===t},n)}))));case"checkbox":return i("div",{class:"config-field config-field-checkbox",key:e.name},i("label",{htmlFor:e.name},i("input",{type:"checkbox",id:e.name,checked:!!c,onChange:i=>this.handleConfigChange(e.name,i.target.checked)}),e.label));case"color":return i("div",{class:"config-field",key:e.name},i("label",{htmlFor:e.name},e.label),i("input",{type:"color",id:e.name,value:c,onInput:i=>this.handleConfigChange(e.name,i.target.value)}));case"textarea":return i("div",{class:"config-field",key:e.name},i("label",{htmlFor:e.name},e.label),i("textarea",{id:e.name,value:c,onInput:i=>this.handleConfigChange(e.name,i.target.value),placeholder:e.placeholder,rows:e.rows||3}));default:return i("div",{class:"config-field",key:e.name},i("label",null,e.label),i("p",{class:"field-error"},"Unknown field type: ",e.type))}}getSelectedItem(){if(!this.selectedItemId||!this.selectedCanvasId||!this.api){return null}const e=this.api.getState();const i=e.canvases[this.selectedCanvasId];return i===null||i===void 0?void 0:i.items.find((e=>e.id===this.selectedItemId))}static get watchers(){return{api:["handleApiChange"]}}};n.style=t;export{n as config_panel};
//# sourceMappingURL=p-a9156658.entry.js.map