{"version":3,"file":"canvas-header.component-palette.confirmation-modal.custom-config-panel.grid-builder.grid-viewer.layer-panel.section-editor-panel.entry.esm.js","sources":["src/demo/components/canvas-header/canvas-header.scss?tag=canvas-header","src/demo/components/canvas-header/canvas-header.tsx","src/components/component-palette/component-palette.scss?tag=component-palette","src/components/component-palette/component-palette.tsx","src/demo/components/confirmation-modal/confirmation-modal.scss?tag=confirmation-modal","src/demo/components/confirmation-modal/confirmation-modal.tsx","src/demo/components/custom-config-panel/custom-config-panel.scss?tag=custom-config-panel","src/demo/components/custom-config-panel/custom-config-panel.tsx","src/services/virtual-renderer.ts","src/services/event-manager.ts","src/services/component-registry.ts","src/services/undo-redo.ts","src/components/grid-builder/grid-builder.scss?tag=grid-builder","src/components/grid-builder/grid-builder.tsx","src/components/grid-viewer/grid-viewer.scss?tag=grid-viewer","src/components/grid-viewer/grid-viewer.tsx","src/demo/components/layer-panel/layer-panel.scss?tag=layer-panel","src/demo/components/layer-panel/layer-panel.tsx","src/demo/components/section-editor-panel/section-editor-panel.scss?tag=section-editor-panel","src/demo/components/section-editor-panel/section-editor-panel.tsx"],"sourcesContent":["/**\n * Canvas Header Component Styles\n * ===============================\n *\n * Styling for canvas section headers with title badges and delete buttons.\n *\n * **Positioning**:\n * - Headers are rendered inside .canvas-wrapper (sibling to canvas-section)\n * - Headers overlay the top of their associated canvas using absolute positioning\n * - No gaps between canvases - headers use negative margin to overlap with canvas above\n *\n * **Negative Margin Pattern**:\n * - All headers EXCEPT the first one get negative top margin\n * - This pulls headers up to overlap with the canvas above\n * - Eliminates gaps between sections\n * - First header starts at top of its canvas (no overlap needed)\n *\n * **Active State Behavior**:\n * - Canvas title starts dimmed (opacity 0.6) when canvas is inactive\n * - Full opacity when canvas is active (isActive prop)\n */\n\n.canvas-header {\n  position: absolute; // Overlay canvas without adding vertical space\n  top: 0;\n  right: 0;\n  z-index: 10; // Above canvas content\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  padding: 12px;\n  margin: 0;\n  gap: 8px;\n\n  // Pull up all headers except the first one to eliminate gaps\n  // Tab effect: significant overlap creates clean tab appearance\n  .canvas-wrapper:not(:first-child) & {\n    margin-top: -38px;\n  }\n\n  .canvas-title {\n    display: inline-flex;\n    align-items: center;\n    padding: 6px 12px;\n    border-radius: 4px;\n    margin: 0;\n    background: #4a90e2;\n    box-shadow: 0 1px 3px rgba(74, 144, 226, 0.2);\n    color: white;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 500;\n    text-transform: none;\n    opacity: 0.6; // Dimmed by default\n    transition: all 0.15s;\n\n    &:hover {\n      background: #357abd;\n      box-shadow: 0 2px 6px rgba(74, 144, 226, 0.3);\n    }\n  }\n\n  // Undim title when canvas is active\n  &.is-active .canvas-title {\n    opacity: 1;\n  }\n\n  .canvas-actions {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n\n    .delete-canvas-btn {\n      display: flex;\n      width: 28px;\n      height: 28px;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      border: 1px solid #dee2e6;\n      border-radius: 4px;\n      background: white;\n      color: #dc3545;\n      cursor: pointer;\n      font-size: 20px;\n      font-weight: 300;\n      line-height: 1;\n      transition: all 0.15s;\n\n      &:hover {\n        border-color: #dc3545;\n        background: rgba(220, 53, 69, 0.1);\n        transform: scale(1.1);\n      }\n\n      &:active {\n        transform: scale(1);\n      }\n    }\n  }\n}\n","/**\n * Canvas Header Component\n * =======================\n *\n * Displays a header bar above each canvas section with title and optional delete button.\n *\n * ## Purpose\n *\n * - Shows section title as clickable badge\n * - Provides delete button for non-default sections\n * - Emits events for user interactions\n *\n * ## Usage\n *\n * ```tsx\n * <canvas-header\n * canvasId=\"hero-section\"\n * title=\"Hero Section\"\n * isDeletable={false}\n * onHeaderClick={() => handleClick()}\n * onDeleteClick={() => handleDelete()}\n * />\n * ```\n * @module canvas-header\n */\n\nimport { Component, Event, EventEmitter, h, Prop } from \"@stencil/core\";\n\n/**\n * CanvasHeader Component\n * ======================\n *\n * Declarative header component for canvas sections.\n *\n * **Tag**: `<canvas-header>`\n * **Shadow DOM**: Disabled (matches blog-app styling)\n */\n@Component({\n  tag: \"canvas-header\",\n  styleUrl: \"canvas-header.scss\",\n  shadow: false,\n})\nexport class CanvasHeader {\n  /**\n   * Canvas ID for data tracking\n   *\n   * **Purpose**: Identify which canvas this header belongs to\n   * **Required**: Yes\n   */\n  @Prop() canvasId!: string;\n\n  /**\n   * Display title for the canvas section\n   *\n   * **Purpose**: Text shown in the title badge\n   * **Required**: Yes\n   * **Note**: Named sectionTitle to avoid conflict with standard HTML title attribute\n   */\n  @Prop() sectionTitle!: string;\n\n  /**\n   * Whether this section can be deleted\n   *\n   * **Purpose**: Control delete button visibility\n   * **Default**: true\n   * **Note**: Default sections (hero, articles, footer) should set to false\n   */\n  @Prop() isDeletable: boolean = true;\n\n  /**\n   * Whether this canvas is currently active\n   *\n   * **Purpose**: Control header opacity (active = full opacity, inactive = dimmed)\n   * **Default**: false\n   */\n  @Prop() isActive: boolean = false;\n\n  /**\n   * Event emitted when header title is clicked\n   *\n   * **Detail**: { canvasId: string }\n   * **Use case**: Activate canvas and open section editor\n   */\n  @Event() headerClick: EventEmitter<{ canvasId: string }>;\n\n  /**\n   * Event emitted when delete button is clicked\n   *\n   * **Detail**: { canvasId: string }\n   * **Use case**: Delete the canvas section\n   */\n  @Event() deleteClick: EventEmitter<{ canvasId: string }>;\n\n  /**\n   * Handle title click\n   */\n  private handleTitleClick = () => {\n    this.headerClick.emit({ canvasId: this.canvasId });\n  };\n\n  /**\n   * Handle delete button click\n   */\n  private handleDeleteClick = () => {\n    this.deleteClick.emit({ canvasId: this.canvasId });\n  };\n\n  /**\n   * Render component template\n   */\n  render() {\n    const headerClass = `canvas-header ${this.isActive ? \"is-active\" : \"\"}`;\n\n    return (\n      <div class={headerClass} data-canvas-id={this.canvasId}>\n        <div class=\"canvas-actions\">\n          {/* Section title badge (clickable) */}\n          <span class=\"canvas-title\" onClick={this.handleTitleClick}>\n            {this.sectionTitle}\n          </span>\n\n          {/* Delete button (optional) */}\n          {this.isDeletable && (\n            <button\n              class=\"delete-canvas-btn\"\n              title=\"Delete this section\"\n              onClick={this.handleDeleteClick}\n            >\n              Ã—\n            </button>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","/**\n * Component Palette Styles\n * =========================\n *\n * Styles for component-palette component with draggable items and drag clone.\n */\n\n/* Component Palette */\n.palette {\n  width: 250px;\n  padding: 20px;\n  border-right: 1px solid #ddd;\n  background: white;\n  overflow-y: visible; /* Allow scrolling with parent container */\n}\n\n.palette h2 {\n  margin-bottom: 20px;\n  color: #333;\n  font-size: 18px;\n}\n\n/* Chromeless Mode - for embedding with custom structure */\n.palette-chromeless {\n  /* Remove default padding/border if you want minimal styling */\n  /* Consumers can override these via their own CSS if needed */\n\n  /* Remove top padding when there's no header */\n  padding-top: 10px;\n}\n\n.palette-empty {\n  color: #999;\n  font-size: 13px;\n  font-style: italic;\n}\n\n.palette-item {\n  margin-bottom: 10px;\n  cursor: move;\n  user-select: none;\n  touch-action: none; /* Enable touch dragging from palette on mobile/tablet */\n\n  /* Default styling for components without renderPaletteItem */\n  &:not(:has(> div)) {\n    padding: 15px;\n    border-radius: 4px;\n    background: #4a90e2;\n    color: white;\n    font-weight: 500;\n    text-align: center;\n    transition: transform 0.2s, box-shadow 0.2s;\n  }\n}\n\n.palette-item:hover {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 10%);\n  transform: translateY(-2px);\n}\n\n.palette-item.dragging-from-palette {\n  opacity: 0.5;\n}\n\n/* Drag Clone - only positioning, no visual styling */\n.dragging-clone {\n  position: fixed;\n  z-index: 10000;\n  pointer-events: none;\n}\n","/**\n * Component Palette Component (Library Version)\n * ===============================================\n *\n * Draggable component library providing visual component selection and drag-and-drop\n * functionality for adding new items to canvases.\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Hardcoded componentTemplates import\n * - Undo/redo UI controls (will be plugin/UI override)\n * - Complex/simple categorization (consumer can provide via props)\n *\n * **Library-specific features**:\n * - Renders from ComponentDefinition[] prop\n * - Clean component list without hardcoded data\n * - Fully customizable via props\n * - Chromeless mode for flexible embedding\n *\n * ## Component-Driven Design\n *\n * **Standard mode with header**:\n * ```typescript\n * <component-palette components={componentDefinitions} />\n * ```\n *\n * **Chromeless mode (no header)**:\n * ```typescript\n * <component-palette\n * components={componentDefinitions}\n * showHeader={false}\n * />\n * ```\n *\n * **Consumer provides**:\n * - Component types (via ComponentDefinition[])\n * - Icons, names, default sizes\n * - All visual content\n * - Optional: Header visibility preference\n *\n * **Library provides**:\n * - Drag initiation infrastructure\n * - Visual drag clone\n * - Cursor-centered positioning\n * - interact.js integration\n * - Flexible header display (chromeless mode)\n *\n * ## Drag Clone Strategy\n *\n * **Why create clone**:\n * - Original palette item stays in place\n * - Visual feedback at correct size\n * - Cursor centered on component (UX polish)\n * - Doesn't interfere with drop detection\n *\n * **Clone sizing**:\n * ```typescript\n * // Uses ComponentDefinition.defaultSize (or fallback 10Ã—6)\n * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n * const heightPx = gridToPixelsY(defaultSize.height);\n *\n * // Center cursor in clone\n * clone.style.left = event.clientX - halfWidth + 'px';\n * clone.style.top = event.clientY - halfHeight + 'px';\n * ```\n *\n * **Why half dimensions**:\n * - Centers cursor in dragged element\n * - Better visual alignment with drop target\n * - Matches user expectations from other tools\n *\n * ## Data Transfer Pattern\n *\n * **Component type stored in**:\n * - `data-component-type` attribute on palette item\n * - Read in `start` event: `event.target.getAttribute('data-component-type')`\n * - Canvas retrieves from dropzone event\n *\n * **Why data attribute**:\n * - Standard HTML pattern\n * - Accessible in event handlers\n * - No global state needed\n * - Works with interact.js events\n *\n * ## Performance Characteristics\n *\n * **Drag clone creation**: ~1-2ms (DOM creation + styling)\n * **Drag move**: <1ms (style updates only, no layout)\n * **Drag end**: <1ms (remove clone)\n * **Re-renders**: Only on components prop changes\n *\n * **Optimization**: Drag clone uses `position: fixed` + `pointer-events: none`\n * to avoid triggering layout recalculations during drag.\n * @module component-palette\n */\n\nimport { Component, h, Prop, State, Watch, Element } from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { ComponentRegistry } from \"../../services/component-registry\";\n\n// Utility imports\nimport { gridToPixelsX, gridToPixelsY } from \"../../utils/grid-calculations\";\n\n/**\n * ComponentPalette Component\n * ===========================\n *\n * Library component providing draggable component palette UI.\n *\n * **Tag**: `<component-palette>`\n * **Shadow DOM**: Disabled (for consistency with other components)\n * **Reactivity**: Re-renders when components prop changes\n *\n * ## Usage Patterns\n *\n * **Pattern 1: Default (inside grid-builder)**\n * ```typescript\n * // Palette automatically rendered by grid-builder\n * <grid-builder components={componentDefinitions} />\n * ```\n *\n * **Pattern 2: Independent placement**\n * ```typescript\n * // Place palette anywhere in your app\n * <div class=\"my-layout\">\n *   <aside class=\"sidebar\">\n *     <component-palette\n *       components={componentDefinitions}\n *       config={gridConfig}\n *     />\n *   </aside>\n *   <main>\n *     <grid-builder\n *       components={componentDefinitions}\n *       config={gridConfig}\n *       uiOverrides={{\n *         ComponentPalette: () => null  // Hide default palette\n *       }}\n *     />\n *   </main>\n * </div>\n * ```\n *\n * **Pattern 3: Custom wrapper component**\n * ```typescript\n * // Wrap in your own component for styling\n * @Component({ tag: 'my-palette-sidebar' })\n * export class MyPaletteSidebar {\n *   @Prop() components: ComponentDefinition[];\n *\n *   render() {\n *     return (\n *       <div class=\"custom-sidebar\">\n *         <h3>Components</h3>\n *         <component-palette components={this.components} />\n *       </div>\n *     );\n *   }\n * }\n * ```\n *\n * ## Key Features\n *\n * - **Self-contained**: Works independently of grid-builder\n * - **Drag/drop ready**: Uses interact.js for drag functionality\n * - **Flexible placement**: Can be rendered anywhere in DOM\n * - **Works across boundaries**: Drag from palette to any canvas-section\n */\n@Component({\n  tag: \"component-palette\",\n  styleUrl: \"component-palette.scss\",\n  shadow: false,\n})\nexport class ComponentPalette {\n  /**\n   * Host element reference\n   *\n   * **Used for**: Scoping querySelectorAll to only palette items in this instance\n   */\n  @Element() hostElement: HTMLElement;\n\n  /**\n   * Component definitions to render in palette\n   *\n   * **Deprecated**: Use componentRegistry prop for reactive updates\n   * **Backward compatibility**: Still supported for static component lists\n   * **Source**: Passed from grid-builder component or consumer code\n   *\n   * **Each definition provides**:\n   * - type: Unique identifier for component\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Size when dropped (for drag clone sizing)\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => <my-header itemId={itemId} config={config} />\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components?: ComponentDefinition[];\n\n  /**\n   * Component registry for reactive updates (Observer Pattern)\n   *\n   * **Recommended**: Use this instead of components prop for dynamic registration\n   * **Optional prop**: ComponentRegistry instance from grid-builder\n   * **Source**: Passed from grid-builder component\n   *\n   * **Benefits over components prop**:\n   * - Automatic palette updates when components are registered\n   * - No manual synchronization needed\n   * - Framework-driven reactive pattern\n   *\n   * **Use case - Dynamic component registration**:\n   * ```typescript\n   * // In grid-builder story or consumer code\n   * const builderEl = document.querySelector('grid-builder');\n   * const paletteEl = document.querySelector('component-palette');\n   *\n   * // Share the registry (automatic sync!)\n   * paletteEl.componentRegistry = builderEl.componentRegistry;\n   *\n   * // Register new component - palette updates automatically!\n   * const api = window.gridBuilderAPI;\n   * api.registerComponent(newComponentDef);\n   * ```\n   *\n   * **Priority**: If both components and componentRegistry are provided, componentRegistry takes precedence\n   */\n  @Prop() componentRegistry?: ComponentRegistry;\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Drag clone sizing (gridToPixelsX/Y calculations)\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Show palette header (title)\n   *\n   * **Optional prop**: Controls whether the \"Components\" header is displayed\n   * **Default**: true (shows header for backward compatibility)\n   *\n   * **Use cases**:\n   * - `showHeader={true}` (default): Standard palette with \"Components\" title\n   * - `showHeader={false}`: Chromeless mode - just the component list\n   *\n   * **Chromeless mode benefits**:\n   * - Embed palette in custom layouts\n   * - Add your own headers/titles\n   * - Integrate into existing UI structures\n   * - More flexible component placement\n   *\n   * **Example - Chromeless with custom wrapper**:\n   * ```typescript\n   * <div class=\"my-custom-sidebar\">\n   * <h3 class=\"my-title\">Available Components</h3>\n   * <p class=\"my-description\">Drag to add</p>\n   * <component-palette\n   * components={componentDefinitions}\n   * showHeader={false}\n   * />\n   * </div>\n   * ```\n   * @default true\n   */\n  @Prop() showHeader?: boolean = true;\n\n  /**\n   * Custom label for this palette instance\n   *\n   * **Optional prop**: Provides a descriptive label for this specific palette\n   * **Default**: \"Component palette\"\n   * **Used for**: ARIA label on toolbar container\n   *\n   * **Use case - Multiple palettes**:\n   * When multiple component palettes exist on the same page (e.g., categorized palettes),\n   * provide unique labels for screen reader users:\n   *\n   * ```typescript\n   * <component-palette\n   * components={contentComponents}\n   * paletteLabel=\"Content components\"\n   * />\n   * <component-palette\n   * components={mediaComponents}\n   * paletteLabel=\"Media components\"\n   * />\n   * <component-palette\n   * components={interactiveComponents}\n   * paletteLabel=\"Interactive components\"\n   * />\n   * ```\n   *\n   * **Accessibility benefit**:\n   * - Screen readers announce: \"Content components, toolbar\"\n   * - Users can navigate between palettes by their distinct labels\n   * - Each palette has unique ARIA IDs to avoid conflicts\n   * @default \"Component palette\"\n   */\n  @Prop() paletteLabel?: string = \"Component palette\";\n\n  /**\n   * Target grid-builder instance ID\n   *\n   * **Optional prop**: Specifies which grid-builder instance should receive click-to-add events\n   * **Default**: undefined (events received by all grid-builder instances)\n   * **Used for**: Multi-instance scenarios with multiple grid-builders on the same page\n   *\n   * **Use case - Multiple grid-builders**:\n   * When multiple grid-builder instances exist on the same page, use this prop\n   * to route palette events to a specific instance:\n   *\n   * ```typescript\n   * // Grid builders with different API keys\n   * <grid-builder api-ref={{ key: 'gridAPI1' }} components={...} />\n   * <grid-builder api-ref={{ key: 'gridAPI2' }} components={...} />\n   *\n   * // Palettes targeting specific builders\n   * <component-palette\n   *   components={components}\n   *   targetGridBuilderId=\"gridAPI1\"\n   * />\n   * <component-palette\n   *   components={components}\n   *   targetGridBuilderId=\"gridAPI2\"\n   * />\n   * ```\n   *\n   * **How it works**:\n   * - Palette includes `targetGridBuilderId` in `palette-item-click` event detail\n   * - Grid-builder filters events by matching against its own instance ID\n   * - If omitted, all grid-builders receive the event (backward compatible)\n   * @default undefined\n   */\n  @Prop() targetGridBuilderId?: string;\n\n  /**\n   * Currently dragging component type\n   *\n   * **Internal state**: Tracks which palette item is being dragged\n   * **Used for**: Adding 'dragging-from-palette' class to the dragged item\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - null: No item is being dragged\n   * - string: The component type of the item being dragged\n   */\n  @State() draggingItemType: string | null = null;\n\n  /**\n   * Cached component definitions (Internal State)\n   *\n   * **Purpose**: Store components for rendering, populated from either:\n   * - componentRegistry.getAll() if componentRegistry is provided (reactive)\n   * - components prop if provided (static)\n   *\n   * **Updated by**:\n   * - componentWillLoad(): Initial population\n   * - Registry onChange listener: When componentRegistry changes (reactive)\n   * - @Watch('components'): When components prop changes (static fallback)\n   *\n   * **Reactive pattern**: This @State triggers re-renders when updated\n   */\n  @State() private cachedComponents: ComponentDefinition[] = [];\n\n  /**\n   * Unique ID for this palette instance\n   *\n   * **Internal state**: Ensures unique ARIA IDs when multiple palettes exist\n   * **Generated**: Once on component load (timestamp + random)\n   * **Used for**: Creating unique `id` attributes for help text and aria-describedby\n   *\n   * **Why needed**:\n   * - Multiple palettes on same page would create duplicate IDs (invalid HTML)\n   * - Each palette needs unique `palette-help-{id}` for aria-describedby\n   * - Prevents ARIA reference conflicts\n   *\n   * **Example HTML output**:\n   * ```html\n   * <!-- Palette 1 -->\n   * <div role=\"toolbar\" aria-label=\"Content components\">\n   *   <div id=\"palette-help-1234567890\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-1234567890\">...</div>\n   * </div>\n   *\n   * <!-- Palette 2 -->\n   * <div role=\"toolbar\" aria-label=\"Media components\">\n   *   <div id=\"palette-help-0987654321\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-0987654321\">...</div>\n   * </div>\n   * ```\n   */\n  @State() private paletteId: string =\n    `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  /**\n   * Registry change listener unsubscribe function\n   *\n   * **Purpose**: Track subscription for cleanup in disconnectedCallback\n   * **Pattern**: Observer pattern cleanup to prevent memory leaks\n   *\n   * **Value**:\n   * - undefined: No subscription active\n   * - Function: Call to unsubscribe from registry changes\n   */\n  private unsubscribeFromRegistry?: () => void;\n\n  /**\n   * Watch for components prop changes\n   *\n   * **When triggered**: Parent passes updated component definitions\n   * **Actions**: Reinitialize drag handlers for new/changed palette items\n   *\n   * **Why needed**:\n   * - Component list may change dynamically (add/remove components)\n   * - New items need drag handlers attached\n   * - More efficient than componentDidUpdate (only runs on prop change)\n   */\n  @Watch(\"components\")\n  handleComponentsChange(\n    newComponents: ComponentDefinition[],\n    oldComponents: ComponentDefinition[],\n  ) {\n    // Skip if components reference hasn't changed\n    if (newComponents === oldComponents) return;\n\n    // Skip if not yet mounted AND no new value (both undefined)\n    // Allow update if new value provided (even if old value was undefined)\n    if (!oldComponents && !newComponents) return;\n\n    // Update cached components (only if not using registry)\n    if (!this.componentRegistry && newComponents) {\n      this.cachedComponents = newComponents;\n    } else if (!this.componentRegistry && !newComponents) {\n      this.cachedComponents = [];\n    }\n\n    // Reinitialize palette items with new component list\n    // Use requestAnimationFrame to ensure DOM has updated\n    requestAnimationFrame(() => {\n      this.initializePaletteItems();\n    });\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Config changes affect drag clone sizing\n   *\n   * **Note**: Config stored in closure by initializePaletteItems\n   * Will be used on next drag start, no immediate action needed\n   */\n  @Watch(\"config\")\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Config changes are rare but affect drag clone sizing\n    // No immediate action needed - next drag will use new config\n    // If we want to be explicit, could reinitialize handlers:\n    // requestAnimationFrame(() => this.initializePaletteItems());\n  }\n\n  /**\n   * Watch for componentRegistry prop changes\n   *\n   * **When triggered**: Parent passes updated ComponentRegistry instance\n   * **Actions**: Subscribe to new registry, update cached components\n   *\n   * **Use case**: Important for testing and dynamic registry swapping\n   * - Tests can set componentRegistry prop after mounting\n   * - Stories can share registry references between components\n   * - Allows late-binding of registry from grid-builder events\n   *\n   * **Implementation**:\n   * 1. Unsubscribe from old registry (if any)\n   * 2. Subscribe to new registry's onChange\n   * 3. Update cachedComponents with new registry's components\n   * 4. Re-initialize drag handlers for new component list\n   */\n  @Watch(\"componentRegistry\")\n  handleComponentRegistryChange(\n    newRegistry: ComponentRegistry,\n    oldRegistry: ComponentRegistry,\n  ) {\n    // Skip if registry reference hasn't changed\n    if (newRegistry === oldRegistry) return;\n\n    // Skip if not yet mounted (componentWillLoad will handle initialization)\n    if (!oldRegistry && !newRegistry) return;\n\n    // Unsubscribe from old registry\n    if (this.unsubscribeFromRegistry) {\n      this.unsubscribeFromRegistry();\n      this.unsubscribeFromRegistry = undefined;\n    }\n\n    // Subscribe to new registry (if provided)\n    if (newRegistry) {\n      // Update cached components\n      this.cachedComponents = newRegistry.getAll();\n\n      // Subscribe to registry changes\n      this.unsubscribeFromRegistry = newRegistry.onChange(() => {\n        // Update cached components when registry changes\n        this.cachedComponents = newRegistry.getAll();\n\n        // Reinitialize drag handlers for new components\n        requestAnimationFrame(() => {\n          this.initializePaletteItems();\n        });\n      });\n\n      // Reinitialize drag handlers for current component list\n      requestAnimationFrame(() => {\n        this.initializePaletteItems();\n      });\n    } else {\n      // No registry - clear components\n      this.cachedComponents = [];\n    }\n  }\n\n  /**\n   * Component will load lifecycle hook\n   *\n   * **Called**: Before first render\n   * **Purpose**: Initialize component definitions and subscribe to registry changes\n   *\n   * **Responsibilities**:\n   * 1. Populate cachedComponents from componentRegistry or components prop\n   * 2. Subscribe to registry onChange for reactive updates (if registry provided)\n   * 3. Set up observer pattern for automatic palette sync\n   *\n   * **Pattern**: Observer pattern - palette observes registry for changes\n   */\n  componentWillLoad() {\n    // Determine component source (registry takes precedence)\n    if (this.componentRegistry) {\n      // Use registry (reactive pattern)\n      this.cachedComponents = this.componentRegistry.getAll();\n\n      // Subscribe to registry changes for automatic updates\n      this.unsubscribeFromRegistry = this.componentRegistry.onChange(() => {\n        // Update cached components when registry changes\n        this.cachedComponents = this.componentRegistry!.getAll();\n\n        // Reinitialize drag handlers for new components\n        // Use requestAnimationFrame to ensure DOM has updated\n        requestAnimationFrame(() => {\n          this.initializePaletteItems();\n        });\n      });\n    } else if (this.components) {\n      // Fallback to components prop (static pattern)\n      this.cachedComponents = this.components;\n    } else {\n      // No components provided\n      this.cachedComponents = [];\n    }\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize drag functionality on palette items\n   *\n   * **Why after render**:\n   * - Needs DOM elements to exist\n   * - Queries `.palette-item` elements\n   * - Attaches interact.js drag handlers\n   *\n   * **One-time setup**:\n   * - Only runs once after mount\n   * - Doesn't re-run on state changes\n   * - Drag handlers persist across re-renders\n   */\n  componentDidLoad() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Component did update lifecycle hook\n   *\n   * **Called**: After props change and re-render\n   * **Purpose**: Re-initialize drag handlers if components changed\n   *\n   * **Why needed**:\n   * - New palette items need drag handlers\n   * - Components prop may change dynamically\n   * - Ensures all items are draggable\n   */\n  componentDidUpdate() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Render component template\n   *\n   * **Reactive**: Re-runs when cachedComponents state changes\n   * **Pure**: No side effects, only returns JSX\n   *\n   * **Component rendering**:\n   * - Maps over cachedComponents state (populated from componentRegistry or components prop)\n   * - Renders each as draggable palette item\n   * - Uses icon and name from definition\n   *\n   * **Data attributes**:\n   * - `data-component-type`: Used by drag handlers to identify component\n   * - `key`: React-style key for list rendering\n   *\n   * **Reactivity**:\n   * - cachedComponents updates trigger re-render\n   * - Updated by componentRegistry.onChange() or @Watch('components')\n   */\n  render() {\n    const paletteClasses = {\n      palette: true,\n      \"palette-chromeless\": !this.showHeader,\n    };\n\n    // Generate unique ID for this palette instance's help text\n    const helpTextId = `palette-help-${this.paletteId}`;\n\n    if (!this.cachedComponents || this.cachedComponents.length === 0) {\n      return (\n        <div class={paletteClasses}>\n          {this.showHeader && <h2>Components</h2>}\n          <p class=\"palette-empty\" role=\"status\" aria-live=\"polite\">\n            No components available\n          </p>\n        </div>\n      );\n    }\n\n    return (\n      <div\n        class={paletteClasses}\n        role=\"toolbar\"\n        aria-label={this.paletteLabel}\n        aria-orientation=\"vertical\"\n      >\n        {/* Screen reader help text with unique ID per instance */}\n        <div id={helpTextId} class=\"sr-only\">\n          {this.config?.enableClickToAdd !== false\n            ? \"Click or press Enter/Space to add component to active canvas, or drag to position on any canvas\"\n            : \"Drag component to canvas to add\"}\n        </div>\n\n        {this.showHeader && <h2 id=\"palette-heading\">Components</h2>}\n\n        {this.cachedComponents.map((component) => {\n          // Class binding with reactive state\n          const itemClasses = {\n            \"palette-item\": true,\n            \"palette-item-custom\": !!component.renderPaletteItem,\n            \"dragging-from-palette\": this.draggingItemType === component.type,\n          };\n\n          // Improved aria-label with interaction methods\n          const ariaLabel =\n            this.config?.enableClickToAdd !== false\n              ? `${component.name} component. Click to add to active canvas or drag to position`\n              : `${component.name} component. Drag to canvas`;\n\n          return (\n            <div\n              class={itemClasses}\n              data-component-type={component.type}\n              key={component.type}\n              role=\"button\"\n              tabindex={0}\n              aria-label={ariaLabel}\n              aria-describedby={helpTextId}\n              aria-pressed={\n                this.draggingItemType === component.type ? \"true\" : \"false\"\n              }\n              onClick={(e) => this.handlePaletteItemClick(e)}\n              onKeyDown={(e) => this.handlePaletteItemKeyDown(e)}\n            >\n              {component.renderPaletteItem\n                ? (() => {\n                    const rendered = component.renderPaletteItem({\n                      componentType: component.type,\n                      name: component.name,\n                      icon: component.icon,\n                    });\n\n                    // If render returns a DOM element (HTMLElement), wrap it in a div\n                    // This handles cases where consumer uses document.createElement()\n                    if (rendered instanceof HTMLElement) {\n                      return (\n                        <div\n                          ref={(el) =>\n                            el &&\n                            !el.hasChildNodes() &&\n                            el.appendChild(rendered)\n                          }\n                        />\n                      );\n                    }\n\n                    // Otherwise return the vNode directly (JSX)\n                    return rendered;\n                  })()\n                : `${component.icon} ${component.name}`}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  /**\n   * Initialize drag functionality for palette items\n   *\n   * **Called from**: componentDidLoad, componentDidUpdate\n   * **Purpose**: Attach interact.js drag handlers to all `.palette-item` elements\n   *\n   * ## Drag Lifecycle\n   *\n   * **Three phases**:\n   * 1. **start**: Create drag clone, store metadata\n   * 2. **move**: Update clone position\n   * 3. **end**: Clean up clone\n   *\n   * ## interact.js Configuration\n   *\n   * **Options**:\n   * - `inertia: false` - No momentum after release (precise control)\n   * - `autoScroll: false` - Manual scroll handling (prevents conflicts)\n   *\n   * **Why these settings**:\n   * - Inertia would interfere with drop detection\n   * - Auto-scroll conflicts with canvas scroll handling\n   * - Simpler, more predictable behavior\n   *\n   * ## Drag Clone Storage Pattern\n   *\n   * **Stores on event.target**:\n   * ```typescript\n   * (event.target as any)._dragClone = dragClone;\n   * (event.target as any)._halfWidth = halfWidth;\n   * (event.target as any)._halfHeight = halfHeight;\n   * ```\n   *\n   * **Why store on target**:\n   * - Available in move/end events\n   * - No closure needed\n   * - Automatic cleanup when element removed\n   * - Per-element isolation (multiple drags)\n   */\n  private initializePaletteItems = () => {\n    // IMPORTANT: Scope to only palette items within THIS component instance\n    // Multiple component-palette instances may exist (Content, Interactive, Media categories)\n    // Using document.querySelectorAll would find ALL palette items, causing\n    // drag handlers from one palette to try accessing component definitions from another\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n\n    paletteItems.forEach((element: HTMLElement) => {\n      // Check if already initialized to prevent duplicate handlers\n      if ((element as any)._dragInitialized) {\n        return;\n      }\n\n      interact(element).draggable({\n        inertia: false,\n        autoScroll: false,\n        listeners: {\n          /**\n           * Drag start event handler\n           *\n           * **Triggered**: User begins dragging palette item\n           * **Purpose**: Create visual drag clone with correct sizing\n           *\n           * ## Operations\n           *\n           * 1. **Add visual feedback**: `.dragging-from-palette` class\n           * 2. **Get component metadata**: Type and definition from components prop\n           * 3. **Calculate component size**: Convert grid units to pixels\n           * 4. **Create drag clone**: Fixed-position element following cursor\n           * 5. **Center cursor**: Offset by half dimensions\n           * 6. **Store references**: Clone and dimensions on event.target\n           *\n           * ## Sizing Strategy\n           *\n           * **Uses ComponentDefinition.defaultSize**:\n           * ```typescript\n           * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n           * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n           * const heightPx = gridToPixelsY(defaultSize.height);\n           * ```\n           *\n           * **Fallback**: 10 units wide Ã— 6 units tall if not specified\n           *\n           * ## Clone Styling\n           *\n           * **Key styles**:\n           * - `position: fixed` - Relative to viewport (follows scroll)\n           * - `pointer-events: none` - Doesn't block drop detection\n           * - `z-index: 10000` - Above all other elements\n           * - `background: rgba(74, 144, 226, 0.9)` - Semi-transparent blue\n           *\n           * ## Cursor Centering\n           *\n           * **Formula**:\n           * ```typescript\n           * left = clientX - halfWidth\n           * top = clientY - halfHeight\n           * ```\n           * @param event - interact.js drag start event\n           */\n          start: (event: any) => {\n            // Get the .palette-item element (in case event.target is a nested child)\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) {\n              console.warn(\"Could not find .palette-item element\");\n              return;\n            }\n\n            // Get component type and find definition\n            const componentType = paletteItem.getAttribute(\n              \"data-component-type\",\n            );\n\n            // Set dragging state (replaces classList.add)\n            this.draggingItemType = componentType;\n\n            // Store original palette item position for snap-back animation\n            const paletteRect = paletteItem.getBoundingClientRect();\n            (paletteItem as any)._originalPosition = {\n              left: paletteRect.left,\n              top: paletteRect.top,\n            };\n            (paletteItem as any)._dropWasValid = false; // Flag to track if drop occurred\n            const definition = this.cachedComponents.find(\n              (c) => c.type === componentType,\n            );\n\n            if (!definition) {\n              console.warn(\n                `Component definition not found for type: ${componentType}`,\n              );\n              return;\n            }\n\n            // Calculate actual component size from definition (or use default)\n            const defaultSize = definition.defaultSize || {\n              width: 10,\n              height: 6,\n            };\n\n            // Get first available canvas ID from grid-builder API instance for size calculation\n            // Use targetGridBuilderId to access the correct instance (supports multiple grid-builders)\n            const apiKey = this.targetGridBuilderId || \"gridBuilderAPI\";\n            const api = (window as any)[apiKey];\n            const state = api?.getState?.();\n            const canvasIds = state?.canvases\n              ? Object.keys(state.canvases)\n              : [];\n            const canvasId = canvasIds.length > 0 ? canvasIds[0] : null;\n\n            // Calculate size - if no canvas exists yet, use fallback calculation\n            let widthPx: number;\n            let heightPx: number;\n\n            if (canvasId) {\n              // Use actual canvas for accurate sizing\n              widthPx = gridToPixelsX(defaultSize.width, canvasId, this.config);\n              heightPx = gridToPixelsY(defaultSize.height, this.config);\n            } else {\n              // Fallback: estimate size based on default grid settings (2% of 1000px = 20px per unit)\n              const estimatedGridSize = 20; // Approximate default grid size\n              widthPx = defaultSize.width * estimatedGridSize;\n              heightPx = defaultSize.height * estimatedGridSize;\n            }\n\n            const halfWidth = widthPx / 2;\n            const halfHeight = heightPx / 2;\n\n            // Create drag clone container with base styling\n            const dragClone = document.createElement(\"div\");\n            dragClone.className = \"dragging-clone\";\n            dragClone.style.position = \"fixed\";\n            dragClone.style.left = event.clientX - halfWidth + \"px\";\n            dragClone.style.top = event.clientY - halfHeight + \"px\";\n            dragClone.style.width = widthPx + \"px\";\n            dragClone.style.height = heightPx + \"px\";\n            dragClone.style.overflow = \"hidden\"; // Clip content to size\n            dragClone.style.pointerEvents = \"none\";\n            dragClone.style.zIndex = \"10000\";\n            dragClone.style.border = \"2px solid rgba(74, 144, 226, 0.5)\";\n            dragClone.style.borderRadius = \"4px\";\n            dragClone.style.boxShadow = \"0 4px 12px rgba(0, 0, 0, 0.2)\";\n            dragClone.style.cursor = \"grabbing\";\n\n            // Render custom drag clone (supports both VNode and HTMLElement)\n            const cloneContent = definition.renderDragClone();\n\n            // Check if it's a real DOM element (from document.createElement)\n            if (cloneContent instanceof HTMLElement) {\n              // Direct DOM element - just append it\n              dragClone.appendChild(cloneContent);\n            } else {\n              // Stencil VNode - extract tag and create element\n              const vNode = cloneContent;\n              const tagName = vNode.$tag$;\n\n              // Create the drag clone element (components are pre-loaded in blog-app.tsx)\n              const contentElement = document.createElement(tagName);\n\n              // Copy any props from vNode to element\n              if (vNode.$attrs$) {\n                Object.keys(vNode.$attrs$).forEach((key) => {\n                  contentElement.setAttribute(key, vNode.$attrs$[key]);\n                });\n              }\n\n              dragClone.appendChild(contentElement);\n            }\n            document.body.appendChild(dragClone);\n\n            // Store clone reference, half dimensions, and default size for move/drop events\n            (paletteItem as any)._dragClone = dragClone;\n            (paletteItem as any)._halfWidth = halfWidth;\n            (paletteItem as any)._halfHeight = halfHeight;\n            (paletteItem as any)._defaultWidth = defaultSize.width;\n            (paletteItem as any)._defaultHeight = defaultSize.height;\n          },\n\n          /**\n           * Drag move event handler\n           *\n           * **Triggered**: Every mousemove while dragging (high frequency)\n           * **Purpose**: Update drag clone position to follow cursor\n           *\n           * ## Performance Optimization\n           *\n           * **Only style updates**: No layout/reflow\n           * ```typescript\n           * dragClone.style.left = event.clientX - halfWidth + 'px';\n           * dragClone.style.top = event.clientY - halfHeight + 'px';\n           * ```\n           *\n           * **Why fast**:\n           * - Changes `left/top` only (no width/height/padding)\n           * - `position: fixed` + `pointer-events: none` avoids reflow\n           * - No DOM queries (uses stored reference)\n           * - Runs at ~60fps even with 100+ items on canvas\n           * @param event - interact.js drag move event\n           */\n          move: (event: any) => {\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const halfWidth = (paletteItem as any)._halfWidth;\n            const halfHeight = (paletteItem as any)._halfHeight;\n            if (dragClone) {\n              dragClone.style.left = event.clientX - halfWidth + \"px\";\n              dragClone.style.top = event.clientY - halfHeight + \"px\";\n            }\n          },\n\n          /**\n           * Drag end event handler\n           *\n           * **Triggered**: User releases mouse button\n           * **Purpose**: Clean up drag clone and visual state\n           *\n           * ## Cleanup Operations\n           *\n           * 1. **Remove visual class**: `.dragging-from-palette`\n           * 2. **Remove drag clone**: `dragClone.remove()` from DOM\n           * 3. **Delete references**: Clean up element properties\n           *\n           * ## Memory Management\n           *\n           * **Deletes stored properties**:\n           * ```typescript\n           * delete (event.target as any)._dragClone;\n           * delete (event.target as any)._halfWidth;\n           * delete (event.target as any)._halfHeight;\n           * ```\n           *\n           * **Why important**:\n           * - Prevents memory leaks\n           * - Allows garbage collection of clone element\n           * - Clean state for next drag\n           * @param event - interact.js drag end event\n           */\n          end: (event: any) => {\n            // Clear dragging state (replaces classList.remove)\n            this.draggingItemType = null;\n\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const dropWasValid = (paletteItem as any)._dropWasValid;\n            const originalPos = (paletteItem as any)._originalPosition;\n\n            if (dragClone) {\n              if (!dropWasValid && originalPos) {\n                // Invalid drop - animate back to palette\n                dragClone.style.transition =\n                  \"all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)\";\n                dragClone.style.left = originalPos.left + \"px\";\n                dragClone.style.top = originalPos.top + \"px\";\n                dragClone.style.opacity = \"0\";\n\n                // Remove after animation completes\n                setTimeout(() => {\n                  dragClone.remove();\n                }, 300);\n              } else {\n                // Valid drop - remove immediately\n                dragClone.remove();\n              }\n\n              // Cleanup\n              delete (paletteItem as any)._dragClone;\n              delete (paletteItem as any)._halfWidth;\n              delete (paletteItem as any)._halfHeight;\n              delete (paletteItem as any)._dropWasValid;\n              delete (paletteItem as any)._originalPosition;\n            }\n          },\n        },\n      });\n\n      // Mark as initialized\n      (element as any)._dragInitialized = true;\n    });\n  };\n\n  /**\n   * Handle palette item click (for click-to-add feature)\n   *\n   * **Triggered**: User clicks on palette item\n   * **Purpose**: Emit event for grid-builder to add component to active canvas\n   *\n   * ## Implementation\n   *\n   * 1. **Check if enabled**: Only proceed if `config.enableClickToAdd !== false`\n   * 2. **Prevent drag conflict**: Don't trigger if currently dragging\n   * 3. **Get component type**: From `data-component-type` attribute\n   * 4. **Dispatch event**: Bubble up to grid-builder\n   *\n   * ## Event Details\n   *\n   * **Event name**: `palette-item-click`\n   * **Event detail**: `{ componentType: string }`\n   * **Bubbles**: true (so grid-builder can listen)\n   * **Composed**: true (crosses shadow DOM boundaries)\n   *\n   * ## Accessibility\n   *\n   * **Keyboard support**: Enter/Space keys also trigger (via handlePaletteItemKeyDown)\n   * **Screen reader**: Uses aria-label to announce action\n   * **Focus**: Palette items are focusable (tabindex=0)\n   *\n   * **Example event listener** (in grid-builder):\n   * ```typescript\n   * @Listen('palette-item-click')\n   * handlePaletteClick(event: CustomEvent<{ componentType: string }>) {\n   * const { componentType } = event.detail;\n   * this.addComponentToActiveCanvas(componentType);\n   * }\n   * ```\n   * @param event - Mouse click event\n   */\n  private handlePaletteItemClick = (event: MouseEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Don't trigger click if currently dragging\n    if (this.draggingItemType) {\n      return;\n    }\n\n    // Get the palette item element (in case event.target is a nested child)\n    const paletteItem = (event.target as HTMLElement).closest(\n      \".palette-item\",\n    ) as HTMLElement;\n    if (!paletteItem) {\n      return;\n    }\n\n    // Get component type from data attribute\n    const componentType = paletteItem.getAttribute(\"data-component-type\");\n    if (!componentType) {\n      console.warn(\"handlePaletteItemClick: Component type not found\");\n      return;\n    }\n\n    // Dispatch event for grid-builder to handle\n    // Include targetGridBuilderId for multi-instance routing\n    const clickEvent = new CustomEvent(\"palette-item-click\", {\n      detail: {\n        componentType,\n        targetGridBuilderId: this.targetGridBuilderId,\n      },\n      bubbles: true,\n      composed: true,\n    });\n    this.hostElement.dispatchEvent(clickEvent);\n  };\n\n  /**\n   * Handle palette item keyboard interaction (for accessibility)\n   *\n   * **Triggered**: User presses key on focused palette item\n   * **Purpose**: Enable keyboard users to add components via Enter/Space\n   *\n   * ## Implementation\n   *\n   * **Supported keys**:\n   * - Enter: Add component (same as click)\n   * - Space: Add component (same as click)\n   *\n   * **Behavior**:\n   * - Prevents default scrolling on Space\n   * - Calls handlePaletteItemClick for consistency\n   *\n   * ## Accessibility Impact\n   *\n   * **Benefits**:\n   * - Keyboard-only users can add components\n   * - Screen reader users can navigate and activate palette items\n   * - Matches standard button behavior (Enter/Space activation)\n   *\n   * **WCAG Compliance**:\n   * - 2.1.1 Keyboard (Level A): All functionality available via keyboard\n   * - 2.1.3 Keyboard (No Exception) (Level AAA): Enhanced keyboard access\n   * @param event - Keyboard event\n   */\n  private handlePaletteItemKeyDown = (event: KeyboardEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Handle Enter and Space keys\n    if (event.key === \"Enter\" || event.key === \" \") {\n      // Prevent default Space behavior (page scroll)\n      event.preventDefault();\n\n      // Trigger the same handler as click\n      this.handlePaletteItemClick(event as any);\n    }\n  };\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component is removed from DOM\n   * **Purpose**: Clean up interact.js instances to prevent memory leaks\n   *\n   * ## Cleanup Process\n   *\n   * 1. **Query all palette items**: Find all elements with `.palette-item` class\n   * 2. **Remove interact.js**: Call `interact(element).unset()` on each\n   * 3. **Clear flags**: Remove `_dragInitialized` marker\n   *\n   * ## Why Important\n   *\n   * **Without cleanup**:\n   * - interact.js event listeners persist after unmount\n   * - Memory leaks accumulate with mount/unmount cycles\n   * - References prevent garbage collection\n   *\n   * **With cleanup**:\n   * - All event listeners removed\n   * - Elements can be garbage collected\n   * - Clean state for future mounts\n   *\n   * ## Pattern Match\n   *\n   * This follows the same cleanup pattern as:\n   * - canvas-section.tsx: Cleans up dropzone interact instance\n   * - grid-item-wrapper.tsx: Cleans up drag/resize handlers\n   */\n  disconnectedCallback() {\n    // Cleanup registry subscription (Observer pattern)\n    if (this.unsubscribeFromRegistry) {\n      this.unsubscribeFromRegistry();\n      this.unsubscribeFromRegistry = undefined;\n    }\n\n    // Cleanup interact.js on all palette items (scoped to this instance)\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n    paletteItems.forEach((element: HTMLElement) => {\n      if ((element as any)._dragInitialized) {\n        interact(element).unset();\n        delete (element as any)._dragInitialized;\n      }\n    });\n  }\n}\n","confirmation-modal {\n  .confirmation-overlay {\n    position: fixed;\n    z-index: 10000;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: fadeIn 0.2s ease-out;\n    background: rgba(0, 0, 0, 0.5);\n  }\n\n  .confirmation-modal {\n    width: 90%;\n    max-width: 400px;\n    border-radius: 8px;\n    animation: slideUp 0.2s ease-out;\n    background: white;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  }\n\n  .modal-header {\n    padding: 20px 24px;\n    border-bottom: 1px solid #e9ecef;\n\n    .modal-title {\n      margin: 0;\n      color: #212529;\n      font-size: 18px;\n      font-weight: 600;\n    }\n  }\n\n  .modal-body {\n    padding: 24px;\n\n    .modal-message {\n      margin: 0;\n      color: #495057;\n      font-size: 14px;\n      line-height: 1.5;\n    }\n  }\n\n  .modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    padding: 16px 24px;\n    border-top: 1px solid #e9ecef;\n    gap: 12px;\n\n    button {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      transition: all 0.15s;\n\n      &.cancel-btn {\n        background: #f8f9fa;\n        color: #495057;\n\n        &:hover {\n          background: #e9ecef;\n        }\n      }\n\n      &.confirm-btn {\n        background: #dc3545;\n        color: white;\n\n        &:hover {\n          background: #c82333;\n        }\n      }\n    }\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n\n  @keyframes slideUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n}\n","import { Component, h, Prop, Event, EventEmitter } from \"@stencil/core\";\nimport { ConfirmationModalData } from \"../../types/confirmation-modal-data\";\n\n/**\n * Confirmation Modal Component\n * =============================\n *\n * Demo Component - NOT Part of Library\n *\n * This component demonstrates how to implement the grid-builder library's\n * deletion hook system with a custom confirmation modal.\n *\n * Library Feature Being Demonstrated:\n * -----------------------------------\n * This modal is used with the library's **onBeforeDelete hook** system.\n *\n * How It Works:\n * -------------\n * 1. Library calls onBeforeDelete hook when user deletes component\n * 2. Hook returns a Promise that doesn't resolve immediately\n * 3. Host app shows this modal (or any modal library)\n * 4. User clicks \"Delete\" or \"Cancel\"\n * 5. Modal fires confirm/cancel event\n * 6. Host app resolves Promise with true/false\n * 7. Library proceeds with or cancels deletion\n *\n * Code Flow Example:\n * ------------------\n * ```typescript\n * // In parent component (blog-app.tsx):\n * private handleBeforeDelete = (context: DeletionHookContext): Promise<boolean> => {\n *   return new Promise((resolve) => {\n *     this.deleteResolve = resolve;\n *     this.isConfirmModalOpen = true;  // Show this modal\n *   });\n * };\n *\n * private handleConfirmDelete = () => {\n *   this.deleteResolve(true);   // Tell library to proceed\n * };\n *\n * private handleCancelDelete = () => {\n *   this.deleteResolve(false);  // Tell library to cancel\n * };\n * ```\n *\n * Why This Pattern:\n * -----------------\n * - **Library agnostic**: Library doesn't provide modal UI\n * - **Flexibility**: Use any modal library (Material, Bootstrap, Ant Design, etc.)\n * - **Customization**: Full control over modal appearance and behavior\n * - **Async support**: Can make API calls before resolving\n *\n * Alternative Implementations:\n * ---------------------------\n * You could replace this component with:\n * - Material Design modal\n * - Bootstrap modal\n * - Ant Design modal\n * - Native browser confirm() (not recommended)\n * - Custom modal from your design system\n *\n * The library doesn't care what modal you use - it just waits for the\n * Promise to resolve with true/false.\n */\n@Component({\n  tag: \"confirmation-modal\",\n  styleUrl: \"confirmation-modal.scss\",\n  shadow: false,\n})\nexport class ConfirmationModal {\n  /**\n   * Modal open/closed state\n   * Controlled by parent component (blog-app)\n   */\n  @Prop() isOpen: boolean = false;\n\n  /**\n   * Modal content (title and message)\n   * Passed from parent when showing confirmation\n   */\n  @Prop() data: ConfirmationModalData | null = null;\n\n  /**\n   * Event: User confirmed deletion\n   * Parent resolves deletion hook Promise with `true`\n   */\n  @Event() confirm: EventEmitter<void>;\n\n  /**\n   * Event: User cancelled deletion\n   * Parent resolves deletion hook Promise with `false`\n   */\n  @Event() cancel: EventEmitter<void>;\n\n  /**\n   * Handle Confirm Button Click\n   * ----------------------------\n   * Fires confirm event â†’ Parent resolves Promise(true) â†’ Library deletes component\n   */\n  private handleConfirm = () => {\n    this.confirm.emit();\n  };\n\n  /**\n   * Handle Cancel Button Click\n   * ---------------------------\n   * Fires cancel event â†’ Parent resolves Promise(false) â†’ Library cancels deletion\n   */\n  private handleCancel = () => {\n    this.cancel.emit();\n  };\n\n  render() {\n    if (!this.isOpen || !this.data) {\n      return null;\n    }\n\n    return (\n      <div class=\"confirmation-overlay\" onClick={this.handleCancel}>\n        <div class=\"confirmation-modal\" onClick={(e) => e.stopPropagation()}>\n          <div class=\"modal-header\">\n            <h2 class=\"modal-title\">{this.data.title}</h2>\n          </div>\n\n          <div class=\"modal-body\">\n            <p class=\"modal-message\">{this.data.message}</p>\n          </div>\n\n          <div class=\"modal-footer\">\n            <button class=\"cancel-btn\" onClick={this.handleCancel}>\n              Cancel\n            </button>\n            <button class=\"confirm-btn\" onClick={this.handleConfirm}>\n              Delete\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","/**\n * Custom Config Panel Styles\n * ===========================\n *\n * Custom styling for the blog demo config panel.\n * Demonstrates how to match the panel UI to your app's branding.\n */\n\n.custom-config-panel {\n  position: fixed;\n  right: 0;\n  bottom: 0;\n  width: 400px;\n  max-width: 90vw;\n  max-height: 80vh;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  border-radius: 12px 0 0 0;\n  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);\n  display: flex;\n  flex-direction: column;\n  z-index: 1000;\n  transform: translateY(100%);\n  transition: transform 0.3s ease-in-out;\n  overflow: hidden;\n\n  &.panel-open {\n    transform: translateY(0);\n  }\n}\n\n.custom-panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n\n  .header-content {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    color: #ffffff;\n\n    .component-icon {\n      font-size: 24px;\n      line-height: 1;\n    }\n\n    h2 {\n      margin: 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #ffffff;\n    }\n  }\n\n  .close-btn {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: #ffffff;\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n    transition: all 0.2s ease;\n\n    &:hover {\n      background: rgba(255, 255, 255, 0.3);\n      transform: scale(1.1);\n    }\n\n    &:active {\n      transform: scale(0.95);\n    }\n  }\n}\n\n.custom-panel-body {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n  background: #ffffff;\n\n  .config-section {\n    margin-bottom: 24px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .section-label {\n      display: block;\n      font-size: 14px;\n      font-weight: 600;\n      color: #374151;\n      margin-bottom: 8px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    &.info-section {\n      background: #f9fafb;\n      border-radius: 8px;\n      padding: 16px;\n\n      .info-row {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 8px 0;\n        border-bottom: 1px solid #e5e7eb;\n\n        &:last-child {\n          border-bottom: none;\n          padding-bottom: 0;\n        }\n\n        &:first-child {\n          padding-top: 0;\n        }\n\n        .info-label {\n          font-size: 13px;\n          font-weight: 500;\n          color: #6b7280;\n        }\n\n        .info-value {\n          font-size: 13px;\n          color: #1f2937;\n          font-family: 'Monaco', 'Menlo', monospace;\n          background: #ffffff;\n          padding: 4px 8px;\n          border-radius: 4px;\n        }\n      }\n    }\n  }\n\n  .config-field {\n    margin-bottom: 16px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .field-label {\n      display: block;\n      font-size: 13px;\n      font-weight: 500;\n      color: #4b5563;\n      margin-bottom: 6px;\n    }\n  }\n\n  .text-input {\n    width: 100%;\n    padding: 10px 12px;\n    border: 2px solid #e5e7eb;\n    border-radius: 6px;\n    font-size: 14px;\n    color: #1f2937;\n    transition: all 0.2s ease;\n\n    &:focus {\n      outline: none;\n      border-color: #667eea;\n      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n    }\n\n    &:disabled {\n      background: #f9fafb;\n      color: #9ca3af;\n      cursor: not-allowed;\n    }\n\n    &::placeholder {\n      color: #9ca3af;\n    }\n  }\n\n  .textarea-input {\n    width: 100%;\n    padding: 10px 12px;\n    border: 2px solid #e5e7eb;\n    border-radius: 6px;\n    font-size: 14px;\n    color: #1f2937;\n    font-family: inherit;\n    line-height: 1.5;\n    min-height: 80px;\n    resize: vertical;\n    transition: all 0.2s ease;\n\n    &:focus {\n      outline: none;\n      border-color: #667eea;\n      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n    }\n\n    &:disabled {\n      background: #f9fafb;\n      color: #9ca3af;\n      cursor: not-allowed;\n    }\n\n    &::placeholder {\n      color: #9ca3af;\n    }\n  }\n\n  .select-input {\n    width: 100%;\n    padding: 10px 12px;\n    border: 2px solid #e5e7eb;\n    border-radius: 6px;\n    font-size: 14px;\n    color: #1f2937;\n    background: #ffffff;\n    cursor: pointer;\n    transition: all 0.2s ease;\n\n    &:focus {\n      outline: none;\n      border-color: #667eea;\n      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n    }\n  }\n\n  .checkbox-label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    cursor: pointer;\n    user-select: none;\n\n    input[type='checkbox'] {\n      width: 18px;\n      height: 18px;\n      cursor: pointer;\n      accent-color: #667eea;\n    }\n\n    .checkbox-text {\n      font-size: 14px;\n      color: #4b5563;\n    }\n  }\n\n  .color-input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n\n    .color-input {\n      width: 60px;\n      height: 40px;\n      border: 2px solid #e5e7eb;\n      border-radius: 6px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n\n      &:hover {\n        border-color: #667eea;\n      }\n    }\n\n    .color-value {\n      font-size: 13px;\n      font-family: 'Monaco', 'Menlo', monospace;\n      color: #6b7280;\n      background: #f9fafb;\n      padding: 8px 12px;\n      border-radius: 4px;\n    }\n  }\n\n  .no-config-message {\n    text-align: center;\n    color: #9ca3af;\n    font-size: 14px;\n    padding: 24px;\n    margin: 0;\n  }\n\n  .field-error {\n    color: #ef4444;\n    font-size: 13px;\n    margin: 0;\n    padding: 8px;\n    background: #fef2f2;\n    border-radius: 4px;\n  }\n}\n\n.custom-panel-footer {\n  display: flex;\n  gap: 12px;\n  padding: 20px 24px;\n  background: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n\n  .btn {\n    flex: 1;\n    padding: 12px 20px;\n    border: none;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n\n    &:active {\n      transform: translateY(1px);\n    }\n\n    &.btn-secondary {\n      background: #ffffff;\n      color: #6b7280;\n      border: 2px solid #e5e7eb;\n\n      &:hover {\n        background: #f9fafb;\n        border-color: #d1d5db;\n      }\n    }\n\n    &.btn-primary {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: #ffffff;\n      box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);\n\n      &:hover {\n        box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);\n        transform: translateY(-2px);\n      }\n\n      &:active {\n        transform: translateY(0);\n        box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);\n      }\n    }\n  }\n}\n\n/* Mobile responsive */\n@media (max-width: 768px) {\n  .custom-config-panel {\n    width: 100%;\n    max-width: 100vw;\n    max-height: 70vh;\n    border-radius: 12px 12px 0 0;\n  }\n}\n","/**\n * Custom Config Panel (Demo Component)\n * ======================================\n *\n * Custom configuration panel for the blog demo app.\n * Demonstrates how to create an external config panel that works alongside grid-builder.\n *\n * **Key Features**:\n * - Custom styling to match blog theme (purple gradient)\n * - Auto-close when selected item is deleted (via itemRemoved event)\n * - Uses manual event listeners for item-click events (Stencil @Listen doesn't work for custom events)\n * - Receives GridBuilderAPI as a prop from parent component\n * - Demonstrates proper event subscription/unsubscription pattern\n *\n * **API Access Pattern**:\n * - Parent (blog-app) stores API on component instance via api-ref={{ target: this, key: 'api' }}\n * - Parent passes API to this component via api prop\n * - This allows multiple grid-builder instances without window pollution\n */\n\nimport { Component, h, State, Prop, Watch } from \"@stencil/core\";\nimport { blogComponentDefinitions } from \"../../component-definitions\";\nimport { GridBuilderAPI } from \"../../../types/api\";\n\n@Component({\n  tag: \"custom-config-panel\",\n  styleUrl: \"custom-config-panel.scss\",\n  shadow: false,\n})\nexport class CustomConfigPanel {\n  /**\n   * Grid Builder API (accessed from window.gridBuilderAPI or passed as prop)\n   *\n   * **Source**: window.gridBuilderAPI (set by grid-builder component)\n   * **Purpose**: Access grid state and methods\n   * **Required**: Component won't work without valid API reference\n   */\n  @Prop() api?: GridBuilderAPI;\n\n  /**\n   * Panel open/closed state\n   */\n  @State() isOpen: boolean = false;\n\n  /**\n   * Currently selected item ID\n   */\n  @State() selectedItemId: string | null = null;\n\n  /**\n   * Currently selected canvas ID\n   */\n  @State() selectedCanvasId: string | null = null;\n\n  /**\n   * Component config (temporary edit state)\n   */\n  @State() componentConfig: Record<string, any> = {};\n\n  /**\n   * Component name (temporary edit state)\n   */\n  @State() componentName: string = \"\";\n\n  /**\n   * Original state for cancel functionality\n   */\n  private originalState: {\n    name: string;\n    zIndex: number;\n    config: Record<string, any>;\n  } | null = null;\n\n  /**\n   * Component registry (from blog component definitions)\n   */\n  private componentRegistry: Map<string, any> = new Map();\n\n  /**\n   * Flag to track if we've subscribed to events\n   */\n  private eventsSubscribed: boolean = false;\n\n  /**\n   * Callback for itemRemoved event (stored for unsubscribe)\n   */\n  private handleItemRemoved = (event: { itemId: string; canvasId: string }) => {\n    console.log(\"ðŸŽ¨ custom-config-panel received itemRemoved event\", {\n      eventItemId: event.itemId,\n      selectedItemId: this.selectedItemId,\n      isOpen: this.isOpen,\n    });\n\n    // Close panel if the deleted item is the currently selected one\n    if (\n      this.isOpen &&\n      this.selectedItemId &&\n      event.itemId === this.selectedItemId\n    ) {\n      console.log(\n        \"  âœ… Custom panel: Closing because selected item was deleted\",\n      );\n      this.closePanel();\n    }\n  };\n\n  /**\n   * Get API (from prop or window)\n   */\n  private getAPI(): GridBuilderAPI | null {\n    // Use prop if provided, otherwise try window\n    return this.api || (window as any).gridBuilderAPI || null;\n  }\n\n  /**\n   * Ensure event subscription is set up (lazy initialization)\n   */\n  private ensureEventSubscription() {\n    if (this.eventsSubscribed) {\n      return;\n    }\n\n    const api = this.getAPI();\n    if (!api) {\n      return; // API not ready yet, will try again later\n    }\n\n    // Subscribe to itemRemoved events via API\n    api.on(\"itemRemoved\", this.handleItemRemoved);\n    this.eventsSubscribed = true;\n    console.log(\"  âœ… Custom panel: Subscribed to itemRemoved event\");\n  }\n\n  /**\n   * Watch for API prop changes\n   */\n  @Watch(\"api\")\n  handleApiChange(newApi: GridBuilderAPI, oldApi: GridBuilderAPI) {\n    console.log(\"ðŸŽ¨ custom-config-panel API prop changed\", {\n      hadOldApi: !!oldApi,\n      hasNewApi: !!newApi,\n      newApiType: typeof newApi,\n    });\n\n    // When API becomes available, ensure event subscription\n    if (newApi && !this.eventsSubscribed) {\n      this.ensureEventSubscription();\n    }\n  }\n\n  componentDidLoad() {\n    console.log(\n      \"ðŸŽ¨ custom-config-panel componentDidLoad - setting up component registry\",\n    );\n    const api = this.getAPI();\n    console.log(\"  ðŸ”§ API status:\", {\n      apiExists: !!api,\n      apiType: typeof api,\n      fromProp: !!this.api,\n      fromWindow: !!(window as any).gridBuilderAPI,\n    });\n\n    // Build component registry from blog component definitions\n    // This doesn't depend on the API being available\n    this.componentRegistry = new Map(\n      blogComponentDefinitions.map((def) => [def.type, def]),\n    );\n\n    // Try to subscribe to events (will retry on first item click if API not ready)\n    this.ensureEventSubscription();\n\n    // Listen for item-click events\n    // Note: Stencil's @Listen decorator doesn't work reliably for custom events on document\n    // so we use manual event listeners instead\n    document.addEventListener(\n      \"item-click\",\n      this.handleItemClick as EventListener,\n    );\n    console.log(\"  âœ… Custom panel: Listening for item-click events\");\n  }\n\n  disconnectedCallback() {\n    console.log(\"ðŸŽ¨ custom-config-panel disconnectedCallback - cleaning up\");\n\n    // Unsubscribe from itemRemoved events\n    const api = this.getAPI();\n    if (api && this.eventsSubscribed) {\n      api.off(\"itemRemoved\", this.handleItemRemoved);\n      this.eventsSubscribed = false;\n    }\n\n    // Remove item-click event listener\n    document.removeEventListener(\n      \"item-click\",\n      this.handleItemClick as EventListener,\n    );\n  }\n\n  /**\n   * Handle item-click events from the document\n   */\n  private handleItemClick = (event: CustomEvent) => {\n    console.log(\"ðŸŽ¨ custom-config-panel handleItemClick called\", event.detail);\n\n    // Ensure event subscription is set up (retry if it failed in componentDidLoad)\n    this.ensureEventSubscription();\n\n    const { itemId, canvasId } = event.detail;\n    this.selectedItemId = itemId;\n    this.selectedCanvasId = canvasId;\n\n    // Get item from API\n    const api = this.getAPI();\n    console.log(\"  ðŸ”§ API exists:\", !!api);\n\n    const item = api?.getItem(itemId);\n    console.log(\"  ðŸ”§ Item retrieved:\", !!item, item);\n\n    if (!item) {\n      console.log(\"  âŒ No item found - exiting\");\n      return;\n    }\n\n    // Get component definition\n    const definition = this.componentRegistry.get(item.type);\n    console.log(\"  ðŸ”§ Definition found:\", !!definition, definition?.name);\n\n    // Save original state for cancel functionality\n    this.originalState = {\n      name: item.name || definition?.name || item.type,\n      zIndex: item.zIndex,\n      config: item.config ? { ...item.config } : {},\n    };\n\n    // Populate form\n    this.componentName = this.originalState.name;\n    this.componentConfig = { ...this.originalState.config };\n\n    // Open panel\n    console.log(\"  ðŸšª Opening panel - setting isOpen = true\");\n    this.isOpen = true;\n    console.log(\"  âœ… Panel should now be open, isOpen =\", this.isOpen);\n  };\n\n  /**\n   * Close panel and revert changes\n   */\n  private closePanel = () => {\n    // Revert changes on cancel by restoring original state\n    const api = this.getAPI();\n    if (\n      this.selectedItemId &&\n      this.selectedCanvasId &&\n      this.originalState &&\n      api\n    ) {\n      // Revert config changes\n      api.updateConfig(this.selectedItemId, this.originalState.config);\n\n      // Revert name changes\n      const state = api.getState();\n      for (const canvasId in state.canvases) {\n        const canvas = state.canvases[canvasId];\n        const itemIndex = canvas.items.findIndex(\n          (i) => i.id === this.selectedItemId,\n        );\n        if (itemIndex !== -1) {\n          canvas.items[itemIndex] = {\n            ...canvas.items[itemIndex],\n            name: this.originalState.name,\n          };\n          // Trigger reactivity\n          state.canvases = { ...state.canvases };\n          break;\n        }\n      }\n    }\n\n    this.isOpen = false;\n    this.selectedItemId = null;\n    this.selectedCanvasId = null;\n    this.componentName = \"\";\n    this.componentConfig = {};\n    this.originalState = null;\n  };\n\n  /**\n   * Save config changes\n   */\n  private saveConfig = () => {\n    // Changes are already applied live, so just close without reverting\n    this.isOpen = false;\n    this.selectedItemId = null;\n    this.selectedCanvasId = null;\n    this.componentName = \"\";\n    this.componentConfig = {};\n    this.originalState = null;\n  };\n\n  /**\n   * Handle component name change\n   */\n  private handleNameChange = (event: Event) => {\n    const value = (event.target as HTMLInputElement).value;\n    this.componentName = value;\n\n    // Update the item name (live preview)\n    const api = this.getAPI();\n    if (this.selectedItemId && api) {\n      // Get the full state to access canvases\n      const state = api.getState();\n\n      // Find and update the item across all canvases\n      for (const canvasId in state.canvases) {\n        const canvas = state.canvases[canvasId];\n        const itemIndex = canvas.items.findIndex(\n          (i) => i.id === this.selectedItemId,\n        );\n        if (itemIndex !== -1) {\n          // Update the name property\n          canvas.items[itemIndex] = {\n            ...canvas.items[itemIndex],\n            name: value,\n          };\n          // Trigger reactivity by reassigning canvases object\n          state.canvases = { ...state.canvases };\n          break;\n        }\n      }\n    }\n  };\n\n  /**\n   * Handle config field change\n   */\n  private handleConfigChange = (fieldName: string, value: any) => {\n    // Update local config state\n    this.componentConfig = { ...this.componentConfig, [fieldName]: value };\n\n    // Apply changes immediately (live preview) via API\n    const api = this.getAPI();\n    if (this.selectedItemId && api) {\n      api.updateConfig(this.selectedItemId, this.componentConfig);\n    }\n  };\n\n  render() {\n    if (!this.isOpen) {\n      return null;\n    }\n\n    // Get item from API\n    const api = this.getAPI();\n    const item = api?.getItem(this.selectedItemId);\n    if (!item) {\n      return null;\n    }\n\n    const definition = this.componentRegistry.get(item.type);\n    if (!definition) {\n      return null;\n    }\n\n    const panelClasses = {\n      \"custom-config-panel\": true,\n      \"panel-open\": this.isOpen,\n    };\n\n    return (\n      <div class={panelClasses}>\n        <div class=\"custom-panel-header\">\n          <div class=\"header-content\">\n            <span class=\"component-icon\">{definition.icon}</span>\n            <h2>Edit Component</h2>\n          </div>\n          <button\n            class=\"close-btn\"\n            onClick={() => this.closePanel()}\n            title=\"Close\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        <div class=\"custom-panel-body\">\n          {/* Component Name */}\n          <div class=\"config-section\">\n            <label class=\"section-label\">Component Name</label>\n            <input\n              type=\"text\"\n              class=\"text-input\"\n              value={this.componentName}\n              placeholder=\"Enter component name\"\n              onInput={(e) => this.handleNameChange(e)}\n            />\n          </div>\n\n          {/* Component Type Info */}\n          <div class=\"config-section info-section\">\n            <div class=\"info-row\">\n              <span class=\"info-label\">Type:</span>\n              <span class=\"info-value\">{definition.name}</span>\n            </div>\n            <div class=\"info-row\">\n              <span class=\"info-label\">ID:</span>\n              <span class=\"info-value\">{item.id}</span>\n            </div>\n          </div>\n\n          {/* Config Fields */}\n          {definition.configSchema && definition.configSchema.length > 0 ? (\n            <div class=\"config-section\">\n              <label class=\"section-label\">Configuration</label>\n              {definition.configSchema.map((field: any) => (\n                <div class=\"config-field\" key={field.name}>\n                  <label class=\"field-label\">{field.label}</label>\n                  {this.renderConfigField(field)}\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div class=\"config-section\">\n              <p class=\"no-config-message\">\n                No configuration options available for this component.\n              </p>\n            </div>\n          )}\n        </div>\n\n        <div class=\"custom-panel-footer\">\n          <button class=\"btn btn-secondary\" onClick={() => this.closePanel()}>\n            Cancel\n          </button>\n          <button class=\"btn btn-primary\" onClick={() => this.saveConfig()}>\n            Save Changes\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Render a single config field\n   */\n  private renderConfigField(field: any) {\n    const value = this.componentConfig[field.name] ?? field.defaultValue ?? \"\";\n\n    switch (field.type) {\n      case \"text\":\n        return (\n          <input\n            type=\"text\"\n            class=\"text-input\"\n            value={value}\n            onInput={(e) =>\n              this.handleConfigChange(\n                field.name,\n                (e.target as HTMLInputElement).value,\n              )\n            }\n            placeholder={field.placeholder}\n          />\n        );\n\n      case \"textarea\":\n        return (\n          <textarea\n            class=\"textarea-input\"\n            value={value}\n            onInput={(e) =>\n              this.handleConfigChange(\n                field.name,\n                (e.target as HTMLTextAreaElement).value,\n              )\n            }\n            placeholder={field.placeholder}\n            rows={field.rows || 3}\n          />\n        );\n\n      case \"number\":\n        return (\n          <input\n            type=\"number\"\n            class=\"text-input\"\n            value={value}\n            onInput={(e) =>\n              this.handleConfigChange(\n                field.name,\n                Number((e.target as HTMLInputElement).value),\n              )\n            }\n            min={field.min}\n            max={field.max}\n            step={field.step}\n          />\n        );\n\n      case \"select\":\n        return (\n          <select\n            class=\"select-input\"\n            onChange={(e) =>\n              this.handleConfigChange(\n                field.name,\n                (e.target as HTMLSelectElement).value,\n              )\n            }\n          >\n            {field.options?.map((option: any) => {\n              const optionValue =\n                typeof option === \"string\" ? option : option.value;\n              const optionLabel =\n                typeof option === \"string\" ? option : option.label;\n              return (\n                <option\n                  key={optionValue}\n                  value={optionValue}\n                  selected={value === optionValue}\n                >\n                  {optionLabel}\n                </option>\n              );\n            })}\n          </select>\n        );\n\n      case \"checkbox\":\n        return (\n          <label class=\"checkbox-label\">\n            <input\n              type=\"checkbox\"\n              checked={!!value}\n              onChange={(e) =>\n                this.handleConfigChange(\n                  field.name,\n                  (e.target as HTMLInputElement).checked,\n                )\n              }\n            />\n            <span class=\"checkbox-text\">{field.label}</span>\n          </label>\n        );\n\n      case \"color\":\n        return (\n          <div class=\"color-input-wrapper\">\n            <input\n              type=\"color\"\n              class=\"color-input\"\n              value={value}\n              onInput={(e) =>\n                this.handleConfigChange(\n                  field.name,\n                  (e.target as HTMLInputElement).value,\n                )\n              }\n            />\n            <span class=\"color-value\">{value}</span>\n          </div>\n        );\n\n      default:\n        return <p class=\"field-error\">Unknown field type: {field.type}</p>;\n    }\n  }\n}\n","/**\n * Virtual Renderer Service - Lazy Loading System\n * ===============================================\n *\n * Performance optimization using IntersectionObserver to lazy-load component content\n * only when visible in the viewport. Reduces initial render time, memory usage, and\n * improves page load performance for pages with 100+ grid items.\n *\n * ## Problem\n *\n * Grid builders with many items face performance challenges:\n * - **Initial render cost**: Rendering 100+ components at page load is expensive\n * - **Memory overhead**: All components in memory even if off-screen\n * - **Slow page load**: Long time to interactive (TTI)\n * - **Poor scrolling**: Heavy DOM operations during scroll\n * - **Wasted rendering**: Complex components rendered but never seen\n *\n * **Example scenario**:\n * - Page with 100 grid items\n * - 10 items visible initially\n * - 90 items rendered but off-screen (wasted work)\n * - Each complex component: ~5-50ms to render\n * - Total wasted: 450-4500ms (almost 5 seconds!)\n *\n * ## Solution\n *\n * IntersectionObserver pattern providing:\n * 1. **Lazy initialization**: Items start with placeholder content\n * 2. **Viewport detection**: Observe when items enter viewport\n * 3. **Callback notification**: Notify components when visible\n * 4. **Component rendering**: Replace placeholder with actual content\n * 5. **Pre-rendering**: Start loading 200px before entering viewport\n * 6. **Memory cleanup**: Unobserve removed components\n *\n * ## Architecture: IntersectionObserver Pattern\n *\n * **Observer setup**:\n * ```typescript\n * // In grid-builder-app.tsx componentDidLoad:\n * (window as any).virtualRenderer = new VirtualRendererService();\n *\n * // In grid-item-wrapper.tsx componentDidLoad:\n * virtualRenderer.observe(this.itemRef, this.item.id, (isVisible) => {\n * this.isVisible = isVisible;  // Triggers re-render\n * });\n * ```\n *\n * **Flow**:\n * ```\n * 1. Grid item mounts â†’ observe(element, callback)\n * 2. Item scrolls into viewport (200px before visible)\n * 3. IntersectionObserver fires â†’ callback(true)\n * 4. Component sets isVisible = true â†’ re-renders\n * 5. Placeholder replaced with actual component\n * 6. User sees smooth transition\n * ```\n *\n * **Cleanup**:\n * ```\n * 1. Grid item unmounts â†’ disconnectedCallback()\n * 2. unobserve(element, id) â†’ stop watching\n * 3. Remove callback from map â†’ allow GC\n * 4. Observer continues for other elements\n * ```\n *\n * ## IntersectionObserver Configuration\n *\n * **Root margin strategy** (`rootMargin: '200px'`):\n * - Pre-render items 200px before they enter viewport\n * - Ensures content ready when user scrolls\n * - Prevents \"pop-in\" effect (flash of placeholder)\n * - Balance between performance and UX\n *\n * **Why 200px**:\n * - Typical scroll speed: ~100-300px per second\n * - 200px gives ~1 second to render before visible\n * - Complex component: ~50-200ms to render\n * - Comfortable buffer for smooth loading\n *\n * **Threshold setting** (`threshold: 0.01`):\n * - Trigger when even 1% of element is visible\n * - Very early detection (as soon as edge appears)\n * - Maximizes pre-render time\n * - Prevents late loading\n *\n * **Why 0.01 not 0**:\n * - 0 = fully outside viewport\n * - 0.01 = edge just entering\n * - Better cross-browser behavior\n * - More reliable than 0\n *\n * ## Observer Callback Pattern\n *\n * **Callback signature**:\n * ```typescript\n * type VisibilityCallback = (isVisible: boolean) => void;\n * ```\n *\n * **Callback invocation**:\n * ```typescript\n * entries.forEach((entry) => {\n * const callback = this.observedElements.get(elementId);\n * if (callback) {\n * callback(entry.isIntersecting);  // true when entering, false when exiting\n * }\n * });\n * ```\n *\n * **Component handler**:\n * ```typescript\n * // In grid-item-wrapper.tsx:\n * virtualRenderer.observe(this.itemRef, this.item.id, (isVisible) => {\n * this.isVisible = isVisible;  // @State update triggers re-render\n * });\n * ```\n *\n * **Render method**:\n * ```typescript\n * renderComponent() {\n * if (!this.isVisible) {\n * return <div class=\"component-placeholder\">Loading...</div>;\n * }\n * // Render actual component (expensive)\n * return <component-image-gallery itemId={this.item.id} />;\n * }\n * ```\n *\n * ## Memory Management\n *\n * **Callback storage**:\n * ```typescript\n * private observedElements: Map<string, VisibilityCallback> = new Map();\n * ```\n *\n * **Why Map**:\n * - O(1) lookup by element ID\n * - Easy cleanup (delete)\n * - Prevents memory leaks\n * - Standard pattern\n *\n * **Cleanup strategy**:\n * 1. Component unmounts â†’ unobserve(element, id)\n * 2. Delete callback from map â†’ allow GC\n * 3. Observer stops watching element\n * 4. Element can be garbage collected\n *\n * **Memory impact**:\n * - Each callback: ~100 bytes\n * - 100 items: ~10KB total\n * - Negligible overhead\n *\n * ## Performance Characteristics\n *\n * **Initial page load** (100 items, 10 visible):\n * - Without virtual rendering: ~500-5000ms (render all)\n * - With virtual rendering: ~50-500ms (render 10)\n * - **10Ã— faster initial load**\n *\n * **Scroll performance**:\n * - Observer overhead: ~1-2ms per event\n * - Component render: ~5-50ms (varies by type)\n * - Pre-render buffer: Items ready when visible\n * - Smooth 60fps scrolling maintained\n *\n * **Memory usage** (100 items):\n * - Without virtual rendering: ~50-500MB (all components)\n * - With virtual rendering: ~5-50MB (visible + buffered)\n * - **10Ã— lower memory usage**\n *\n * ## Complex Component Targeting\n *\n * **Simple components** (always render):\n * - header, text, button (fast ~1-5ms)\n * - No lazy loading needed\n * - Always visible immediately\n *\n * **Complex components** (lazy load):\n * - image-gallery: Multiple images to load (~50-200ms)\n * - dashboard-widget: Chart rendering (~100-500ms)\n * - live-data: API calls + updates (~100ms+)\n *\n * **How wrapper decides**:\n * ```typescript\n * // In grid-item-wrapper.tsx:\n * componentDidLoad() {\n * // Always observe, component decides if needed\n * virtualRenderer.observe(this.itemRef, this.item.id, (isVisible) => {\n * this.isVisible = isVisible;\n * });\n * }\n *\n * renderComponent() {\n * // Simple components ignore isVisible flag\n * if (!this.isVisible && this.item.type === 'imageGallery') {\n * return <div class=\"component-placeholder\">Loading...</div>;\n * }\n * // Complex types use isVisible guard\n * }\n * ```\n *\n * ## Browser Compatibility\n *\n * **IntersectionObserver support**:\n * - Chrome 51+ (2016)\n * - Firefox 55+ (2017)\n * - Safari 12.1+ (2019)\n * - Edge 15+ (2017)\n * - ~97% global browser coverage (2024)\n *\n * **Polyfill option**:\n * ```typescript\n * // If needed for older browsers:\n * import 'intersection-observer'; // polyfill\n * ```\n *\n * **Graceful degradation**:\n * - If IntersectionObserver unavailable\n * - Could fallback to immediate rendering\n * - Or use scroll event listener (less efficient)\n *\n * ## Extracting This Pattern\n *\n * To adapt virtual rendering for your project:\n *\n * **Minimal implementation**:\n * ```typescript\n * // 1. Create observer service\n * class VirtualRenderer {\n * private observer: IntersectionObserver;\n * private callbacks = new Map<string, (visible: boolean) => void>();\n *\n * constructor() {\n * this.observer = new IntersectionObserver(\n * (entries) => entries.forEach(e =>\n * this.callbacks.get(e.target.id)?.(e.isIntersecting)\n * ),\n * { rootMargin: '200px', threshold: 0.01 }\n * );\n * }\n *\n * observe(el: Element, id: string, cb: (visible: boolean) => void) {\n * this.callbacks.set(id, cb);\n * this.observer.observe(el);\n * }\n *\n * unobserve(el: Element, id: string) {\n * this.callbacks.delete(id);\n * this.observer.unobserve(el);\n * }\n * }\n *\n * // 2. Create singleton\n * export const virtualRenderer = new VirtualRenderer();\n *\n * // 3. Use in component\n * useEffect(() => {\n * virtualRenderer.observe(ref.current, id, setIsVisible);\n * return () => virtualRenderer.unobserve(ref.current, id);\n * }, []);\n *\n * return isVisible ? <ComplexComponent /> : <Placeholder />;\n * ```\n *\n * **For different frameworks**:\n * - **React**: Use useEffect for lifecycle, useState for visibility\n * - **Vue**: Use onMounted/onUnmounted, ref() for visibility\n * - **Angular**: Use ngAfterViewInit/ngOnDestroy, signals for visibility\n * - **Svelte**: Use onMount/onDestroy, stores for visibility\n *\n * **Key patterns to preserve**:\n * 1. Singleton service (one observer for all components)\n * 2. Callback map for O(1) lookups\n * 3. 200px root margin for pre-rendering\n * 4. 0.01 threshold for early detection\n * 5. Cleanup on component unmount\n *\n * **Customization options**:\n * ```typescript\n * // Adjust root margin based on needs\n * rootMargin: '200px'  // Standard (1 second buffer)\n * rootMargin: '400px'  // Aggressive (2 second buffer, more memory)\n * rootMargin: '100px'  // Conservative (less memory, might see pop-in)\n *\n * // Adjust threshold based on needs\n * threshold: 0.01      // Trigger immediately\n * threshold: 0.1       // Trigger when 10% visible\n * threshold: 0.5       // Trigger when 50% visible (not recommended)\n * ```\n * @module virtual-renderer\n */\n\n/**\n * Visibility callback function type\n *\n * **Signature**: `(isVisible: boolean) => void`\n * **Called when**: Element enters or exits viewport\n * **Parameter**: `isVisible` - true when entering, false when exiting\n *\n * **Usage**:\n * ```typescript\n * virtualRenderer.observe(element, id, (isVisible) => {\n *   this.isVisible = isVisible;  // Update component state\n * });\n * ```\n */\nexport type VisibilityCallback = (isVisible: boolean) => void;\n\n/**\n * VirtualRendererService Class\n * ==============================\n *\n * Singleton service managing IntersectionObserver for all grid items.\n *\n * **Lifecycle**:\n * 1. Created once in grid-builder-app.tsx componentDidLoad\n * 2. Shared across all grid-item-wrapper components\n * 3. Lives for entire application lifetime\n * 4. Destroyed only on page unload\n *\n * **Properties**:\n * - `observer`: IntersectionObserver instance (null during initialization)\n * - `observedElements`: Map of element IDs to visibility callbacks\n *\n * **Methods**:\n * - `constructor()`: Initialize observer with configuration\n * - `initialize()`: Create IntersectionObserver with rootMargin and threshold\n * - `observe(element, id, callback)`: Start observing element\n * - `unobserve(element, id)`: Stop observing element\n * - `destroy()`: Cleanup all observations\n */\nexport class VirtualRendererService {\n  /**\n   * IntersectionObserver instance\n   *\n   * **Lifecycle**: Created in initialize(), destroyed in destroy()\n   * **Configuration**: rootMargin: '200px', threshold: 0.01\n   * **Purpose**: Watch all grid items for viewport intersection\n   *\n   * **Null during**:\n   * - Before initialize() completes\n   * - After destroy() called\n   * - Error during initialization\n   */\n  private observer: IntersectionObserver | null = null;\n\n  /**\n   * Map of element IDs to visibility callbacks\n   *\n   * **Structure**: `Map<elementId: string, callback: VisibilityCallback>`\n   * **Lookup**: O(1) by element ID\n   * **Cleanup**: Entries deleted in unobserve()\n   *\n   * **Memory**: ~100 bytes per entry, ~10KB for 100 items\n   *\n   * **Why Map**:\n   * - Fast lookups in observer callback\n   * - Easy cleanup (delete by key)\n   * - Prevents memory leaks\n   * - Standard pattern for observer registries\n   */\n  private observedElements: Map<string, VisibilityCallback> = new Map();\n\n  /**\n   * Constructor - Initialize virtual renderer\n   *\n   * **Called**: Once when VirtualRendererService instantiated\n   * **Purpose**: Create IntersectionObserver with configuration\n   *\n   * **Delegates to**: initialize()\n   * - Sets up observer with rootMargin and threshold\n   * - Registers callback handler for intersection events\n   *\n   * **Usage**:\n   * ```typescript\n   * // In grid-builder-app.tsx componentDidLoad:\n   * (window as any).virtualRenderer = new VirtualRendererService();\n   * ```\n   */\n  constructor() {\n    this.initialize();\n  }\n\n  /**\n   * Initialize IntersectionObserver\n   *\n   * **Called by**: constructor (once)\n   * **Purpose**: Create and configure IntersectionObserver instance\n   *\n   * ## Observer Configuration\n   *\n   * **Observer callback**:\n   * ```typescript\n   * (entries) => {\n   * entries.forEach((entry) => {\n   * const elementId = entry.target.id;\n   * const callback = this.observedElements.get(elementId);\n   * if (callback) {\n   * callback(entry.isIntersecting);  // true = entering, false = exiting\n   * }\n   * });\n   * }\n   * ```\n   *\n   * **Why forEach entries**:\n   * - IntersectionObserver can fire for multiple elements at once\n   * - Batch processing is more efficient\n   * - Each element gets independent callback\n   *\n   * **Element ID lookup**:\n   * ```typescript\n   * const elementId = entry.target.id;  // From element.id attribute\n   * const callback = this.observedElements.get(elementId);  // O(1) lookup\n   * ```\n   *\n   * **Why use element ID**:\n   * - Direct mapping to callback\n   * - No need to store element references\n   * - Simpler memory management\n   * - Works across DOM mutations\n   *\n   * ## Observer Options\n   *\n   * **Root margin** (`rootMargin: '200px'`):\n   * - Expand viewport bounds by 200px in all directions\n   * - Items render 200px before actually visible\n   * - 1 second buffer at typical scroll speed\n   * - Prevents \"pop-in\" effect\n   *\n   * **Threshold** (`threshold: 0.01`):\n   * - Fire when 1% of element visible\n   * - Very early detection\n   * - Maximizes pre-render time\n   * - More reliable than 0 across browsers\n   *\n   * **Why these specific values**:\n   * - 200px root margin: Balance between performance and UX\n   * - 0.01 threshold: As early as possible without false positives\n   * - Tested with 100+ items for optimal performance\n   *\n   * ## Callback Execution\n   *\n   * **entry.isIntersecting**:\n   * - `true`: Element entering viewport (or 200px buffer)\n   * - `false`: Element exiting viewport\n   * - Component can show/hide content accordingly\n   *\n   * **Callback guard** (`if (callback)`):\n   * - Handles race conditions\n   * - Element may have been unobserved but event still fires\n   * - Prevents errors from missing callbacks\n   * - Graceful degradation\n   *\n   * ## Performance Impact\n   *\n   * **Observer overhead**: ~1-2ms per intersection event\n   * **Callback execution**: ~0.1ms per callback\n   * **Total overhead**: Negligible compared to component rendering\n   *\n   * **Scalability**:\n   * - Single observer for all elements (efficient)\n   * - Map lookups O(1)\n   * - No DOM queries needed\n   * - Works well with 100+ elements\n   */\n  private initialize() {\n    // Create observer with 200px margin (pre-render before entering viewport)\n    this.observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          const elementId = entry.target.id;\n          const callback = this.observedElements.get(elementId);\n\n          if (callback) {\n            // Call callback with visibility state\n            callback(entry.isIntersecting);\n          }\n        });\n      },\n      {\n        rootMargin: \"200px\", // Start loading 200px before entering viewport\n        threshold: [0, 0.01], // Fire at 0% (just entered) AND 0.01% (already visible)\n      },\n    );\n  }\n\n  /**\n   * Observe element for visibility changes\n   *\n   * **Called from**: grid-item-wrapper.tsx componentDidLoad\n   * **Purpose**: Register element for lazy loading when it enters viewport\n   *\n   * ## Registration Process\n   *\n   * **Validation**:\n   * ```typescript\n   * if (!this.observer || !element) return;  // Guard against invalid state\n   * ```\n   *\n   * **Why validation needed**:\n   * - Observer may not be initialized (edge case)\n   * - Element may be null if ref not set\n   * - Fail gracefully without errors\n   * - Defensive programming\n   *\n   * **Store callback**:\n   * ```typescript\n   * this.observedElements.set(elementId, callback);  // Map: id â†’ callback\n   * ```\n   *\n   * **Why store before observing**:\n   * - Callback ready when first intersection fires\n   * - No race condition between observe and callback\n   * - Guaranteed handler availability\n   *\n   * **Start observing**:\n   * ```typescript\n   * this.observer.observe(element);  // Add to observer's watch list\n   * ```\n   *\n   * ## Callback Invocation\n   *\n   * **When callback fires**:\n   * 1. Element enters viewport (or 200px buffer)\n   * 2. Observer callback runs\n   * 3. Looks up callback by elementId\n   * 4. Calls callback(true)\n   * 5. Component updates isVisible state\n   * 6. Component re-renders with actual content\n   *\n   * **Callback signature**:\n   * ```typescript\n   * (isVisible: boolean) => void\n   * ```\n   *\n   * **Typical usage**:\n   * ```typescript\n   * virtualRenderer.observe(this.itemRef, this.item.id, (isVisible) => {\n   * this.isVisible = isVisible;  // @State update â†’ re-render\n   * });\n   * ```\n   *\n   * ## Multiple Observations\n   *\n   * **Same element, different callback**:\n   * - New callback replaces old one\n   * - Map key is elementId (unique)\n   * - No duplicate observations\n   * - Latest callback wins\n   *\n   * **Multiple elements**:\n   * - Each gets own callback\n   * - All share single observer\n   * - Efficient batch processing\n   * - Scalable to 100+ items\n   *\n   * ## Memory Impact\n   *\n   * **Per observation**:\n   * - Map entry: ~100 bytes\n   * - Observer tracking: ~50 bytes\n   * - Total: ~150 bytes per item\n   *\n   * **100 items**:\n   * - Map overhead: ~10KB\n   * - Observer overhead: ~5KB\n   * - Total: ~15KB (negligible)\n   *\n   * ## Edge Cases\n   *\n   * **Element already observed**:\n   * - IntersectionObserver handles gracefully\n   * - No duplicate tracking\n   * - Callback map updated\n   *\n   * **Element without ID**:\n   * - Callback stored with undefined key\n   * - Lookups will fail\n   * - Element won't lazy load\n   * - Should ensure ID set\n   *\n   * **Observer not initialized**:\n   * - Guard returns early\n   * - No error thrown\n   * - Element renders immediately\n   * - Graceful degradation\n   * @param element - DOM element to observe (must have id attribute)\n   * @param elementId - Unique ID for callback lookup (should match element.id)\n   * @param callback - Function called when visibility changes\n   * @example\n   * ```typescript\n   * // In grid-item-wrapper.tsx componentDidLoad:\n   * virtualRenderer.observe(this.itemRef, this.item.id, (isVisible) => {\n   *   this.isVisible = isVisible;  // Trigger re-render\n   * });\n   * // â†’ Element now monitored\n   * // â†’ Callback fires when scrolled into view\n   * // â†’ Component renders content instead of placeholder\n   * ```\n   */\n  observe(\n    element: HTMLElement,\n    elementId: string,\n    callback: VisibilityCallback,\n  ) {\n    if (!this.observer || !element) {\n      return;\n    }\n\n    // Store callback\n    this.observedElements.set(elementId, callback);\n\n    // Start observing\n    this.observer.observe(element);\n\n    // IMPORTANT: IntersectionObserver doesn't fire immediately for already-visible elements\n    // Check if element is already in viewport and call callback synchronously\n    // This prevents \"Loading...\" flash for items that are initially visible\n    const rect = element.getBoundingClientRect();\n    const windowHeight =\n      window.innerHeight || document.documentElement.clientHeight;\n    const windowWidth =\n      window.innerWidth || document.documentElement.clientWidth;\n\n    // Check if element is in viewport (with 200px margin matching rootMargin)\n    const isInViewport =\n      rect.top < windowHeight + 200 &&\n      rect.bottom > -200 &&\n      rect.left < windowWidth + 200 &&\n      rect.right > -200;\n\n    // Call callback immediately if already visible\n    if (isInViewport) {\n      callback(true);\n    }\n  }\n\n  /**\n   * Stop observing element (cleanup)\n   *\n   * **Called from**: grid-item-wrapper.tsx disconnectedCallback\n   * **Purpose**: Remove element from observation and free callback memory\n   *\n   * ## Cleanup Process\n   *\n   * **Validation**:\n   * ```typescript\n   * if (!this.observer || !element) return;  // Guard against invalid state\n   * ```\n   *\n   * **Why validation needed**:\n   * - Observer may be destroyed\n   * - Element may be null during unmount\n   * - Fail gracefully without errors\n   * - Safe cleanup pattern\n   *\n   * **Remove callback**:\n   * ```typescript\n   * this.observedElements.delete(elementId);  // Free callback from map\n   * ```\n   *\n   * **Why delete first**:\n   * - Prevents callback from firing during unobserve\n   * - Immediate cleanup of memory\n   * - No race conditions\n   * - Clean separation\n   *\n   * **Stop observing**:\n   * ```typescript\n   * this.observer.unobserve(element);  // Remove from observer's watch list\n   * ```\n   *\n   * ## Memory Management\n   *\n   * **Callback deletion**:\n   * - Removes Map entry\n   * - Allows callback garbage collection\n   * - Frees ~100 bytes per element\n   * - Critical for long-running apps\n   *\n   * **Observer cleanup**:\n   * - Removes element from internal list\n   * - Stops firing intersection events\n   * - Frees ~50 bytes per element\n   * - Reduces observer overhead\n   *\n   * **What if not called**:\n   * - Callback remains in memory (leak)\n   * - Observer still tracks element (leak)\n   * - ~150 bytes leaked per unmounted item\n   * - Adds up with many mount/unmount cycles\n   *\n   * ## Cleanup Timing\n   *\n   * **Component lifecycle**:\n   * ```\n   * 1. Component mounts â†’ componentDidLoad â†’ observe()\n   * 2. Component unmounts â†’ disconnectedCallback â†’ unobserve()\n   * 3. Element removed from DOM\n   * 4. Callback deleted from map\n   * 5. Observer stops watching\n   * 6. Garbage collector can free memory\n   * ```\n   *\n   * **Why in disconnectedCallback**:\n   * - Called when component removed from DOM\n   * - Guaranteed cleanup point\n   * - Standard web component lifecycle\n   * - No memory leaks\n   *\n   * ## Edge Cases\n   *\n   * **Element not observed**:\n   * - IntersectionObserver handles gracefully\n   * - No error thrown\n   * - Map.delete() returns false but safe\n   * - Idempotent operation\n   *\n   * **Called multiple times**:\n   * - First call removes callback and stops observing\n   * - Subsequent calls are no-ops\n   * - Safe to call multiple times\n   * - Defensive cleanup\n   *\n   * **Observer already destroyed**:\n   * - Guard returns early\n   * - No error thrown\n   * - Map cleanup still happens\n   * - Graceful degradation\n   *\n   * ## Performance Impact\n   *\n   * **Per unobserve**:\n   * - Map.delete(): ~0.01ms\n   * - observer.unobserve(): ~0.1ms\n   * - Total: ~0.11ms (negligible)\n   *\n   * **Batch cleanup** (100 items):\n   * - Sequential unobserve: ~11ms\n   * - Observer.disconnect() + Map.clear(): ~1ms\n   * - destroy() method more efficient for bulk\n   * @param element - DOM element to stop observing\n   * @param elementId - Element's ID for callback removal\n   * @example\n   * ```typescript\n   * // In grid-item-wrapper.tsx disconnectedCallback:\n   * disconnectedCallback() {\n   *   if (this.itemRef) {\n   *     virtualRenderer.unobserve(this.itemRef, this.item.id);\n   *   }\n   * }\n   * // â†’ Callback removed from map\n   * // â†’ Observer stops watching element\n   * // â†’ Memory freed for garbage collection\n   * ```\n   */\n  unobserve(element: HTMLElement, elementId: string) {\n    if (!this.observer || !element) {\n      return;\n    }\n\n    // Remove callback\n    this.observedElements.delete(elementId);\n\n    // Stop observing\n    this.observer.unobserve(element);\n  }\n\n  /**\n   * Cleanup all observations (bulk cleanup)\n   *\n   * **Called**: Manually when destroying service (rare, typically page unload)\n   * **Purpose**: Completely tear down observer and free all memory\n   *\n   * ## Cleanup Operations\n   *\n   * **Disconnect observer**:\n   * ```typescript\n   * if (this.observer) {\n   * this.observer.disconnect();  // Stop watching all elements\n   * this.observer = null;         // Allow GC\n   * }\n   * ```\n   *\n   * **Why disconnect**:\n   * - Stops all intersection callbacks\n   * - Removes all elements from watch list\n   * - More efficient than unobserve for each element\n   * - Single operation vs N operations\n   *\n   * **Why set to null**:\n   * - Signals observer destroyed\n   * - Guards in other methods will return early\n   * - Allows IntersectionObserver GC\n   * - Clean state reset\n   *\n   * **Clear callbacks**:\n   * ```typescript\n   * this.observedElements.clear();  // Remove all Map entries\n   * ```\n   *\n   * **Why clear**:\n   * - Frees all callback references\n   * - Allows callback GC\n   * - Prevents memory leaks\n   * - Complete cleanup\n   *\n   * ## Performance Comparison\n   *\n   * **destroy() vs unobserve all** (100 items):\n   * - destroy(): disconnect + clear = ~1ms\n   * - unobserve Ã— 100: ~11ms\n   * - **11Ã— faster for bulk cleanup**\n   *\n   * **Memory freed** (100 items):\n   * - Callbacks: ~10KB\n   * - Observer tracking: ~5KB\n   * - Observer instance: ~1KB\n   * - Total: ~16KB\n   *\n   * ## When to Use\n   *\n   * **Appropriate scenarios**:\n   * - Page unload / navigation away\n   * - Application teardown\n   * - Test cleanup (afterEach)\n   * - Hot module reload (HMR)\n   *\n   * **Not appropriate**:\n   * - Individual component unmount (use unobserve)\n   * - Removing some items (use unobserve per item)\n   * - Temporary pause (no such feature needed)\n   *\n   * ## State After Destroy\n   *\n   * **Observer state**:\n   * - `this.observer = null`\n   * - All observe/unobserve calls become no-ops\n   * - Guards prevent errors\n   *\n   * **Callbacks state**:\n   * - `this.observedElements` empty\n   * - All callbacks freed\n   * - No memory leaks\n   *\n   * **Service unusable**:\n   * - Must create new instance to use again\n   * - Or call initialize() if made public\n   * - Current design: create new service\n   *\n   * ## Edge Cases\n   *\n   * **Observer not initialized**:\n   * - Guard skips disconnect\n   * - Only clears callbacks\n   * - Safe even if never initialized\n   *\n   * **Called multiple times**:\n   * - First call destroys everything\n   * - Subsequent calls are no-ops\n   * - Idempotent operation\n   * - Safe defensive cleanup\n   *\n   * **Active intersections**:\n   * - disconnect() cancels all pending callbacks\n   * - No callbacks fire after destroy\n   * - Clean shutdown\n   *\n   * ## Memory Leak Prevention\n   *\n   * **Without destroy**:\n   * - Observer remains in memory\n   * - All callbacks remain referenced\n   * - Elements can't be GC'd\n   * - ~16KB leak per 100 items\n   *\n   * **With destroy**:\n   * - Observer freed\n   * - Callbacks freed\n   * - Elements can be GC'd\n   * - No memory leaks\n   * @example\n   * ```typescript\n   * // On page unload:\n   * window.addEventListener('beforeunload', () => {\n   *   virtualRenderer.destroy();\n   * });\n   *\n   * // In tests:\n   * afterEach(() => {\n   *   virtualRenderer.destroy();\n   * });\n   *\n   * // Hot module reload:\n   * if (module.hot) {\n   *   module.hot.dispose(() => {\n   *     virtualRenderer.destroy();\n   *   });\n   * }\n   * ```\n   */\n  destroy() {\n    if (this.observer) {\n      this.observer.disconnect();\n      this.observer = null;\n    }\n    this.observedElements.clear();\n  }\n}\n\n/**\n * Backward Compatibility Layer\n * ==============================\n *\n * Singleton instance export for backward compatibility.\n * Existing code can continue using this while we migrate to instance-based architecture.\n */\n","/**\n * Event Manager Service\n * ======================\n *\n * Simple event emitter for grid builder events. Provides on/off/emit pattern\n * for plugins and API consumers to subscribe to grid builder actions.\n *\n * ## Design Pattern\n *\n * **EventEmitter pattern**:\n * - on(event, callback) - Subscribe to event\n * - off(event, callback) - Unsubscribe from event\n * - emit(event, data) - Fire event to all subscribers\n *\n * **Callback storage**: Map<eventName, Set<callback>>\n * - O(1) subscription/unsubscription\n * - Set prevents duplicate callbacks\n * - Easy cleanup (delete entire event Set)\n *\n * ## Usage Example\n *\n * ```typescript\n * import { eventManager } from './event-manager';\n *\n * // Subscribe\n * const callback = (data) => console.log('Item added:', data);\n * eventManager.on('componentAdded', callback);\n *\n * // Fire event\n * eventManager.emit('componentAdded', { itemId: '123', canvasId: 'canvas1' });\n *\n * // Unsubscribe\n * eventManager.off('componentAdded', callback);\n * ```\n *\n * ## Memory Management\n *\n * **Plugin cleanup**:\n * - Plugins MUST unsubscribe in destroy()\n * - Use same callback reference for on/off\n * - Prevents memory leaks\n *\n * **Internal cleanup**:\n * - Empty event Sets auto-deleted\n * - No memory retention for unused events\n * @module event-manager\n */\n\nimport { EventCallback } from \"../types/api\";\n\n/**\n * EventManager Class\n * ==================\n *\n * Simple event emitter for grid builder events.\n *\n * **Storage structure**:\n * ```typescript\n * Map {\n *   'componentAdded' => Set([callback1, callback2, ...]),\n *   'componentDeleted' => Set([callback3, callback4, ...]),\n *   ...\n * }\n * ```\n *\n * **Why Set instead of Array**:\n * - O(1) lookup for has/delete\n * - Prevents duplicate callbacks\n * - Better performance for large subscriber counts\n */\nexport class EventManager {\n  /**\n   * Event listeners storage\n   *\n   * **Key**: Event name (e.g., 'componentAdded')\n   * **Value**: Set of callback functions\n   *\n   * **Why Map instead of plain object**:\n   * - Better type safety\n   * - No prototype pollution\n   * - Better performance for dynamic keys\n   */\n  private listeners: Map<string, Set<EventCallback>> = new Map();\n\n  /**\n   * Debounce timers for events\n   *\n   * **Key**: Event name\n   * **Value**: setTimeout timer ID\n   *\n   * **Purpose**: Store timers for debounced events\n   */\n  private debounceTimers: Map<string, NodeJS.Timeout> = new Map();\n\n  /**\n   * Debounce delay in milliseconds\n   *\n   * **Default**: 300ms\n   * **Configured by**: grid-builder via setDebounceDelay()\n   */\n  private debounceDelay: number = 300;\n\n  /**\n   * Events that should be debounced\n   *\n   * **Events**: componentDragged, componentResized, stateChanged\n   * **Reason**: Fire on every pixel during drag/resize\n   */\n  private debouncedEvents: Set<string> = new Set([\n    \"componentDragged\",\n    \"componentResized\",\n    \"stateChanged\",\n  ]);\n\n  /**\n   * Subscribe to event\n   *\n   * **Idempotent**: Calling multiple times with same callback does nothing\n   * **Thread-safe**: Uses Set which handles concurrent additions\n   * @param eventName - Event to subscribe to\n   * @param callback - Function called when event fires\n   * @example\n   * ```typescript\n   * eventManager.on('componentAdded', (data) => {\n   *   console.log(`Added ${data.item.type} to ${data.canvasId}`);\n   * });\n   * ```\n   */\n  on<T = any>(eventName: string, callback: EventCallback<T>): void {\n    if (!this.listeners.has(eventName)) {\n      this.listeners.set(eventName, new Set());\n    }\n    this.listeners.get(eventName)!.add(callback as EventCallback);\n  }\n\n  /**\n   * Unsubscribe from event\n   *\n   * **Requirements**:\n   * - Must pass EXACT same callback reference used in on()\n   * - Callback stored as property or bound method\n   *\n   * **Cleanup**: If event has no more listeners, delete the Set\n   * @param eventName - Event to unsubscribe from\n   * @param callback - Exact callback reference used in on()\n   * @example\n   * ```typescript\n   * // âœ… Correct pattern\n   * class MyPlugin {\n   *   private handleAdd = (data) => console.log(data);\n   *\n   *   init(api) {\n   *     eventManager.on('componentAdded', this.handleAdd);\n   *   }\n   *\n   *   destroy() {\n   *     eventManager.off('componentAdded', this.handleAdd);\n   *   }\n   * }\n   * ```\n   */\n  off<T = any>(eventName: string, callback: EventCallback<T>): void {\n    const callbacks = this.listeners.get(eventName);\n    if (callbacks) {\n      callbacks.delete(callback as EventCallback);\n\n      // Cleanup empty event listeners\n      if (callbacks.size === 0) {\n        this.listeners.delete(eventName);\n      }\n    }\n  }\n\n  /**\n   * Fire event to all subscribers\n   *\n   * **Debouncing**: Some events are automatically debounced:\n   * - componentDragged (fires on every pixel)\n   * - componentResized (fires on every pixel)\n   * - stateChanged (fires on every state update)\n   *\n   * **Immediate events** (not debounced):\n   * - componentSelected, componentDeleted, componentAdded, etc.\n   *\n   * **Execution order**: Subscribers called in insertion order\n   * **Error handling**: One callback error doesn't prevent others\n   *\n   * **Performance**: O(n) where n = number of callbacks for this event\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   * @example\n   * ```typescript\n   * // Internal usage (in state-manager.ts)\n   * eventManager.emit('componentAdded', {\n   *   item: newItem,\n   *   canvasId: 'canvas1',\n   *   timestamp: Date.now()\n   * });\n   * ```\n   */\n  emit<T = any>(eventName: string, data: T): void {\n    // Check if this event should be debounced\n    if (this.debouncedEvents.has(eventName)) {\n      this.emitDebounced(eventName, data);\n    } else {\n      this.emitImmediate(eventName, data);\n    }\n  }\n\n  /**\n   * Fire event immediately (no debouncing)\n   *\n   * **Private method**: Called by emit()\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   */\n  private emitImmediate<T = any>(eventName: string, data: T): void {\n    const callbacks = this.listeners.get(eventName);\n    if (callbacks) {\n      callbacks.forEach((callback) => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`Error in event callback for \"${eventName}\":`, error);\n        }\n      });\n    }\n  }\n\n  /**\n   * Fire event with debouncing\n   *\n   * **How it works**:\n   * 1. Clear any existing timer for this event\n   * 2. Set new timer with debounceDelay\n   * 3. When timer fires, call emitImmediate()\n   * 4. If emit() called again before timer fires, restart timer\n   *\n   * **Result**: Event only fires once after activity stops\n   *\n   * **Private method**: Called by emit()\n   * @param eventName - Event to fire\n   * @param data - Data to pass to callbacks\n   */\n  private emitDebounced<T = any>(eventName: string, data: T): void {\n    // Clear existing timer for this event\n    const existingTimer = this.debounceTimers.get(eventName);\n    if (existingTimer) {\n      clearTimeout(existingTimer);\n    }\n\n    // Set new timer\n    const timer = setTimeout(() => {\n      this.emitImmediate(eventName, data);\n      this.debounceTimers.delete(eventName);\n    }, this.debounceDelay);\n\n    this.debounceTimers.set(eventName, timer);\n  }\n\n  /**\n   * Set debounce delay for all debounced events\n   *\n   * **Configurable**: Called by grid-builder with config.eventDebounceDelay\n   * @param delay - Delay in milliseconds\n   * @example\n   * ```typescript\n   * // In grid-builder componentDidLoad\n   * eventManager.setDebounceDelay(config?.eventDebounceDelay || 300);\n   * ```\n   */\n  setDebounceDelay(delay: number): void {\n    this.debounceDelay = delay;\n  }\n\n  /**\n   * Get current debounce delay\n   *\n   * **Use case**: Debugging, testing\n   * @returns Debounce delay in milliseconds\n   */\n  getDebounceDelay(): number {\n    return this.debounceDelay;\n  }\n\n  /**\n   * Remove all listeners for specific event\n   *\n   * **Use case**: Cleanup during component unmount\n   * @param eventName - Event to remove all listeners from\n   * @example\n   * ```typescript\n   * // Clear all componentAdded listeners\n   * eventManager.removeAllListeners('componentAdded');\n   * ```\n   */\n  removeAllListeners(eventName?: string): void {\n    if (eventName) {\n      this.listeners.delete(eventName);\n    } else {\n      this.listeners.clear();\n    }\n  }\n\n  /**\n   * Get listener count for debugging\n   *\n   * **Use case**: Check for memory leaks (too many listeners)\n   * @param eventName - Event to count listeners for\n   * @returns Number of listeners or 0 if event not registered\n   * @example\n   * ```typescript\n   * const count = eventManager.listenerCount('componentAdded');\n   * console.log(`${count} listeners for componentAdded`);\n   * ```\n   */\n  listenerCount(eventName: string): number {\n    return this.listeners.get(eventName)?.size || 0;\n  }\n}\n\n/**\n * Backward Compatibility Layer\n * ==============================\n *\n * Singleton instance export for backward compatibility.\n * Existing code can continue using this while we migrate to instance-based architecture.\n */\n\n// Create singleton instance (for backward compatibility only)\nconst defaultManager = new EventManager();\n\n// Export singleton instance\nexport const eventManager = defaultManager;\n","/**\n * Component Registry Service\n * ==========================\n *\n * Centralized service for managing component definitions in the grid builder.\n * Provides type-safe component lookup and registration.\n *\n * ## Purpose\n *\n * The ComponentRegistry replaces the pattern of passing componentRegistry as a prop\n * through multiple component layers. Instead, it provides:\n * - Centralized component definition storage\n * - Type-safe component lookup by type string\n * - Instance-based architecture (multiple registries can coexist)\n * - Clear API for registering and retrieving definitions\n *\n * ## Instance-Based Architecture\n *\n * Each grid-builder/grid-viewer component gets its own ComponentRegistry instance:\n * - Supports multiple independent grids on the same page\n * - Each grid can have different component definitions\n * - No global singleton state\n *\n * ## Usage Example\n *\n * ```typescript\n * // Create registry instance\n * const registry = new ComponentRegistry();\n *\n * // Register component definitions\n * registry.register({\n * type: 'header',\n * name: 'Header',\n * icon: 'ðŸ“„',\n * defaultSize: { width: 20, height: 6 },\n * render: (item) => <div>Header Component</div>\n * });\n *\n * // Retrieve component definition\n * const definition = registry.get('header');\n *\n * // Check if component type exists\n * if (registry.has('header')) {\n * // ...\n * }\n *\n * // Get all registered types\n * const types = registry.getTypes();\n *\n * // Get all definitions\n * const definitions = registry.getAll();\n * ```\n *\n * ## Integration with Components\n *\n * Components receive registry instance as a prop:\n * ```typescript\n * @Prop() componentRegistry?: ComponentRegistry;\n * ```\n *\n * This replaces the previous pattern:\n * ```typescript\n * // Old pattern (prop drilling)\n * @Prop() componentRegistry?: Map<string, ComponentDefinition>;\n *\n * // New pattern (service instance)\n * @Prop() componentRegistry?: ComponentRegistry;\n * ```\n * @module component-registry\n */\n\nimport { ComponentDefinition } from \"../types/component-definition\";\n\n/**\n * ComponentRegistry - Centralized component definition management\n *\n * **Instance-based design**: Each grid-builder gets its own registry instance\n *\n * **Type safety**: All lookups return ComponentDefinition or undefined\n *\n * **Performance**: Uses Map internally for O(1) lookups\n */\nexport class ComponentRegistry {\n  /**\n   * Internal storage using Map for O(1) lookups\n   * Key: component type string (e.g., 'header', 'gallery')\n   * Value: ComponentDefinition object\n   */\n  private definitions: Map<string, ComponentDefinition>;\n\n  /**\n   * Change listeners for reactive updates\n   * Set of callbacks to notify when registry changes\n   *\n   * **Observer Pattern**: Components can subscribe to registry changes\n   * **Use case**: component-palette auto-updates when components are registered\n   */\n  private changeListeners: Set<() => void> = new Set();\n\n  /**\n   * Create a new ComponentRegistry instance\n   *\n   * **Instance-based architecture**: Each grid-builder gets its own registry\n   *\n   * **Optional initial definitions**: Can provide definitions at construction time\n   * @param initialDefinitions - Optional array of component definitions to register\n   * @example\n   * ```typescript\n   * // Empty registry\n   * const registry = new ComponentRegistry();\n   *\n   * // Registry with initial definitions\n   * const registry = new ComponentRegistry([\n   *   { type: 'header', name: 'Header', ... },\n   *   { type: 'gallery', name: 'Gallery', ... }\n   * ]);\n   * ```\n   */\n  constructor(initialDefinitions?: ComponentDefinition[]) {\n    this.definitions = new Map();\n\n    // Register initial definitions if provided\n    if (initialDefinitions) {\n      initialDefinitions.forEach((def) => this.register(def));\n    }\n  }\n\n  /**\n   * Register a component definition\n   *\n   * **Overwrites existing**: If component type already registered, replaces it\n   *\n   * **Validation**: Ensures component type is non-empty string\n   * @param definition - Component definition to register\n   * @throws Error if component type is empty or invalid\n   * @example\n   * ```typescript\n   * registry.register({\n   *   type: 'header',\n   *   name: 'Header',\n   *   icon: 'ðŸ“„',\n   *   defaultSize: { width: 20, height: 6 },\n   *   render: (item) => <div>Header</div>\n   * });\n   * ```\n   */\n  register(definition: ComponentDefinition): void {\n    if (!definition.type || typeof definition.type !== \"string\") {\n      throw new Error(\"Component definition must have a valid type string\");\n    }\n\n    this.definitions.set(definition.type, definition);\n    this.notifyListeners(); // Notify observers of change\n  }\n\n  /**\n   * Register multiple component definitions at once\n   *\n   * **Batch registration**: Convenience method for registering multiple components\n   *\n   * **Overwrites existing**: Same behavior as individual register() calls\n   *\n   * **Optimization**: Only notifies listeners once after all registrations\n   * @param definitions - Array of component definitions to register\n   * @example\n   * ```typescript\n   * registry.registerAll([\n   *   { type: 'header', name: 'Header', ... },\n   *   { type: 'gallery', name: 'Gallery', ... },\n   *   { type: 'text', name: 'Text', ... }\n   * ]);\n   * ```\n   */\n  registerAll(definitions: ComponentDefinition[]): void {\n    // Register all without notifications (for performance)\n    definitions.forEach((def) => {\n      if (!def.type || typeof def.type !== \"string\") {\n        throw new Error(\"Component definition must have a valid type string\");\n      }\n      this.definitions.set(def.type, def);\n    });\n\n    // Single notification after all registrations\n    this.notifyListeners();\n  }\n\n  /**\n   * Retrieve a component definition by type\n   *\n   * **Returns undefined**: If component type not registered\n   *\n   * **Type-safe**: Caller must handle undefined case\n   * @param type - Component type string\n   * @returns Component definition or undefined\n   * @example\n   * ```typescript\n   * const definition = registry.get('header');\n   * if (definition) {\n   *   // Use definition.render(), definition.defaultSize, etc.\n   * } else {\n   *   console.warn('Component type not found');\n   * }\n   * ```\n   */\n  get(type: string): ComponentDefinition | undefined {\n    return this.definitions.get(type);\n  }\n\n  /**\n   * Check if a component type is registered\n   *\n   * **Use before get()**: Avoid undefined checks\n   * @param type - Component type string\n   * @returns True if type is registered, false otherwise\n   * @example\n   * ```typescript\n   * if (registry.has('header')) {\n   *   const definition = registry.get('header')!; // Safe to use !\n   * }\n   * ```\n   */\n  has(type: string): boolean {\n    return this.definitions.has(type);\n  }\n\n  /**\n   * Get all registered component types\n   *\n   * **Returns array**: Useful for validation, debugging, UI lists\n   * @returns Array of component type strings\n   * @example\n   * ```typescript\n   * const types = registry.getTypes();\n   * // ['header', 'gallery', 'text', 'dashboard']\n   * ```\n   */\n  getTypes(): string[] {\n    return Array.from(this.definitions.keys());\n  }\n\n  /**\n   * Get all registered component definitions\n   *\n   * **Returns array**: Useful for component palette, debugging\n   * @returns Array of all component definitions\n   * @example\n   * ```typescript\n   * const definitions = registry.getAll();\n   * // Render component palette\n   * definitions.forEach(def => {\n   *   renderPaletteItem(def.name, def.icon);\n   * });\n   * ```\n   */\n  getAll(): ComponentDefinition[] {\n    return Array.from(this.definitions.values());\n  }\n\n  /**\n   * Remove a component definition by type\n   *\n   * **Use sparingly**: Most applications don't need to unregister components\n   *\n   * **Returns boolean**: True if component was removed, false if not found\n   *\n   * **Notifies observers**: Triggers onChange listeners if component was removed\n   * @param type - Component type string to remove\n   * @returns True if component was removed, false otherwise\n   * @example\n   * ```typescript\n   * const removed = registry.unregister('old-component');\n   * if (removed) {\n   *   console.log('Component unregistered');\n   * }\n   * ```\n   */\n  unregister(type: string): boolean {\n    const wasDeleted = this.definitions.delete(type);\n\n    // Only notify if something was actually removed\n    if (wasDeleted) {\n      this.notifyListeners();\n    }\n\n    return wasDeleted;\n  }\n\n  /**\n   * Remove all component definitions\n   *\n   * **Use sparingly**: Most applications don't need to clear registry\n   *\n   * **Resets state**: After clear(), registry is empty\n   *\n   * **Notifies observers**: Triggers onChange listeners\n   * @example\n   * ```typescript\n   * registry.clear();\n   * console.log(registry.getTypes()); // []\n   * ```\n   */\n  clear(): void {\n    const hadDefinitions = this.definitions.size > 0;\n    this.definitions.clear();\n\n    // Only notify if there were definitions to clear\n    if (hadDefinitions) {\n      this.notifyListeners();\n    }\n  }\n\n  /**\n   * Get the number of registered components\n   *\n   * **Useful for validation**: Ensure components were registered\n   * @returns Number of registered components\n   * @example\n   * ```typescript\n   * console.log(`Registry has ${registry.size()} components`);\n   * ```\n   */\n  size(): number {\n    return this.definitions.size;\n  }\n\n  /**\n   * Subscribe to registry changes (Observer Pattern)\n   *\n   * **Use case**: component-palette subscribes to auto-update when components are registered\n   *\n   * **Returns unsubscribe function**: Call to remove listener and prevent memory leaks\n   *\n   * **When notified**: Callback fires on register(), registerAll(), unregister(), clear()\n   *\n   * **Pattern**: Observer pattern for reactive updates\n   * @param listener - Callback function to invoke on registry changes\n   * @returns Unsubscribe function to remove the listener\n   * @example\n   * ```typescript\n   * // Subscribe to changes\n   * const unsubscribe = registry.onChange(() => {\n   *   console.log('Registry changed!');\n   *   this.components = registry.getAll(); // Refresh component list\n   * });\n   *\n   * // Later: cleanup to prevent memory leaks\n   * unsubscribe();\n   * ```\n   */\n  onChange(listener: () => void): () => void {\n    this.changeListeners.add(listener);\n\n    // Return unsubscribe function\n    return () => {\n      this.changeListeners.delete(listener);\n    };\n  }\n\n  /**\n   * Notify all change listeners (private method)\n   *\n   * **Called by**: register(), registerAll(), unregister(), clear()\n   *\n   * **Observers**: component-palette and other reactive consumers\n   */\n  private notifyListeners(): void {\n    this.changeListeners.forEach((listener) => listener());\n  }\n}\n","/**\n * Undo/Redo Service\n * ==================\n *\n * Command pattern implementation for undo/redo functionality in the grid builder.\n * Provides stack-based history management with keyboard shortcuts and UI state tracking.\n *\n * ## Problem\n *\n * Interactive applications need undo/redo capabilities for:\n * - Recovering from mistakes (accidental delete)\n * - Experimenting with layouts (try different arrangements)\n * - Learning the interface (undo to see what changed)\n * - Building confidence (knowing you can undo)\n *\n * **Without undo/redo**:\n * - Users hesitant to experiment\n * - Mistakes are permanent\n * - No way to review history\n * - Poor user experience\n *\n * ## Solution\n *\n * Implement **Command Pattern** with stack-based history:\n *\n * 1. **Command Interface**: Each undoable action implements undo() and redo()\n * 2. **History Stack**: Array of command objects\n * 3. **Position Pointer**: Tracks current position in history\n * 4. **Bounded History**: Limited to 50 commands to prevent memory bloat\n * 5. **Branching**: New actions after undo discard \"future\" history\n *\n * ## Architecture: Command Pattern\n *\n * **Classic Gang of Four pattern** for undo/redo:\n *\n * **Key Components**:\n * - **Command Interface**: Defines undo() and redo() methods\n * - **Concrete Commands**: AddItemCommand, DeleteItemCommand, MoveItemCommand, ResizeCommand\n * - **Invoker**: undo-redo.ts (this file) manages command execution\n * - **Receiver**: state-manager.ts (receives state mutations)\n *\n * **Flow**:\n * ```\n * User Action â†’ Create Command â†’ pushCommand() â†’ Execute & Store\n * Undo (Ctrl+Z) â†’ Get command at position â†’ command.undo() â†’ Update position\n * Redo (Ctrl+Y) â†’ Advance position â†’ command.redo() â†’ Execute\n * ```\n *\n * **Why Command Pattern**:\n * - âœ… Encapsulates actions as objects\n * - âœ… Enables undo/redo without coupling to specific operations\n * - âœ… Supports macro commands (batch operations)\n * - âœ… Easy to extend with new command types\n * - âœ… History can be serialized/persisted\n *\n * ## History Management\n *\n * **Stack-based with position pointer**:\n * ```\n * commandHistory = [cmd1, cmd2, cmd3, cmd4, cmd5]\n * â†‘\n * historyPosition = 2\n * ```\n *\n * **Operations**:\n * - **Push new command**: Discard commands after position, append new command\n * - **Undo**: Execute command.undo() at position, decrement position\n * - **Redo**: Increment position, execute command.redo() at new position\n *\n * **Branching behavior** (discarding future on new action):\n * ```\n * Initial:  [cmd1, cmd2, cmd3, cmd4, cmd5]\n * â†‘ position = 2\n *\n * Undo 2x:  [cmd1, cmd2, cmd3, cmd4, cmd5]\n * â†‘ position = 0\n *\n * New cmd:  [cmd1, cmd6]  â† cmd2-cmd5 discarded!\n * â†‘ position = 1\n * ```\n *\n * **Why branching (not tree)**:\n * - Simpler mental model for users\n * - No UI complexity for branch navigation\n * - Standard undo/redo UX pattern\n *\n * ## Memory Management\n *\n * **Bounded history** (MAX_HISTORY = 50):\n * - Prevents unbounded memory growth\n * - Removes oldest command when limit reached\n * - 50 commands â‰ˆ typical user session\n *\n * **Memory per command**:\n * - Command object: ~200-500 bytes\n * - State snapshots: ~1-5 KB (JSON serialized GridItem)\n * - Total for 50 commands: ~50-250 KB (acceptable)\n *\n * **Sliding window approach**:\n * ```\n * When history full:\n * [cmd1, cmd2, ..., cmd50]  â† At capacity\n * Push cmd51:\n * [cmd2, cmd3, ..., cmd51]  â† cmd1 removed\n * ```\n *\n * ## State Snapshot Strategy\n *\n * Each command stores **before/after snapshots**:\n * ```typescript\n * class MoveItemCommand implements Command {\n * beforeState = JSON.parse(JSON.stringify(item));  // Deep clone\n * afterState = JSON.parse(JSON.stringify(updatedItem));\n *\n * undo() { restoreState(beforeState); }\n * redo() { restoreState(afterState); }\n * }\n * ```\n *\n * **Deep cloning required because**:\n * - Prevents mutations from affecting snapshots\n * - Ensures independent state copies\n * - Simple and reliable (no reference tracking needed)\n *\n * **Trade-off**:\n * - âœ… Simple implementation\n * - âœ… No reference bugs\n * - âŒ Higher memory usage than delta-based\n * - âŒ Slower than structural sharing (acceptable for this use case)\n *\n * ## Keyboard Shortcuts\n *\n * Implemented in grid-builder-app.tsx:\n * - **Ctrl+Z** (Cmd+Z on Mac): Undo last command\n * - **Ctrl+Y** (Cmd+Y on Mac): Redo next command\n * - **Ctrl+Shift+Z**: Alternative redo (common in design tools)\n *\n * ## UI Integration\n *\n * **Reactive state for buttons**:\n * ```typescript\n * undoRedoState = {\n * canUndo: boolean,  // Enable/disable undo button\n * canRedo: boolean   // Enable/disable redo button\n * }\n * ```\n *\n * **Updates on**:\n * - New command pushed\n * - Undo executed\n * - Redo executed\n * - History cleared\n *\n * **Button rendering**:\n * ```tsx\n * <button disabled={!undoRedoState.canUndo} onClick={undo}>\n * Undo\n * </button>\n * ```\n *\n * ## Extracting This Pattern\n *\n * To adapt Command pattern for your project:\n *\n * **Minimal implementation**:\n * ```typescript\n * interface Command {\n * undo(): void;\n * redo(): void;\n * }\n *\n * class UndoRedoManager {\n * private history: Command[] = [];\n * private position = -1;\n *\n * push(command: Command) {\n * this.history.splice(this.position + 1);  // Discard future\n * this.history.push(command);\n * this.position++;\n * }\n *\n * undo() {\n * if (this.position >= 0) {\n * this.history[this.position].undo();\n * this.position--;\n * }\n * }\n *\n * redo() {\n * if (this.position < this.history.length - 1) {\n * this.position++;\n * this.history[this.position].redo();\n * }\n * }\n * }\n * ```\n *\n * **Example commands**:\n * ```typescript\n * class AddItemCommand implements Command {\n * constructor(\n * private canvasId: string,\n * private item: GridItem\n * ) {}\n *\n * undo() { removeItemFromCanvas(this.canvasId, this.item.id); }\n * redo() { addItemToCanvas(this.canvasId, this.item); }\n * }\n * ```\n *\n * **For different frameworks**:\n * - React: Use useReducer or Zustand middleware\n * - Vue: Use Pinia plugin or custom composable\n * - Angular: Use NgRx effects or service\n * @module undo-redo\n */\n\nimport { createStore } from \"@stencil/store\";\nimport { createDebugLogger } from \"../utils/debug\";\n\nconst debug = createDebugLogger(\"undo-redo\");\n\n/**\n * Command Interface\n * =================\n *\n * Core abstraction for undoable operations. All commands must implement\n * both undo() and redo() methods to reverse and reapply their effects.\n *\n * **Design principle**: Commands are **self-contained** - they store all\n * data needed to both undo and redo without external dependencies.\n *\n * **Typical implementation**:\n * ```typescript\n * class MyCommand implements Command {\n * private beforeState: any;\n * private afterState: any;\n *\n * constructor(initialState) {\n * this.beforeState = JSON.parse(JSON.stringify(initialState));\n * // ... perform operation ...\n * this.afterState = JSON.parse(JSON.stringify(finalState));\n * }\n *\n * undo() { restoreState(this.beforeState); }\n * redo() { restoreState(this.afterState); }\n * }\n * ```\n *\n * **Why separate undo/redo methods**:\n * - âŒ Not: Single execute(reverse: boolean) method\n * - âœ… Yes: Separate undo() and redo() methods\n * - Reason: Clearer intent, easier to implement, matches user mental model\n *\n * **Concrete implementations**:\n * - AddItemCommand: Add/remove grid item\n * - DeleteItemCommand: Remove/restore grid item with index preservation\n * - MoveItemCommand: Update item position (cross-canvas support)\n * - ResizeCommand: Update item dimensions\n * @example\n * ```typescript\n * class DeleteItemCommand implements Command {\n *   constructor(\n *     private canvasId: string,\n *     private item: GridItem,\n *     private itemIndex: number\n *   ) {}\n *\n *   undo() {\n *     // Restore item at original index\n *     const canvas = gridState.canvases[this.canvasId];\n *     canvas.items.splice(this.itemIndex, 0, this.item);\n *     gridState.canvases = { ...gridState.canvases };\n *   }\n *\n *   redo() {\n *     // Remove item again\n *     removeItemFromCanvas(this.canvasId, this.item.id);\n *   }\n * }\n * ```\n */\nexport interface Command {\n  /**\n   * Reverse the effect of this command\n   *\n   * **Idempotent**: Calling undo() multiple times has same effect as once\n   * **Side effects**: May update global state, trigger re-renders\n   * **Error handling**: Should not throw (use try/catch internally)\n   */\n  undo(): void;\n\n  /**\n   * Reapply the effect of this command\n   *\n   * **Idempotent**: Calling redo() multiple times has same effect as once\n   * **Side effects**: May update global state, trigger re-renders\n   * **Error handling**: Should not throw (use try/catch internally)\n   */\n  redo(): void;\n\n  /**\n   * Get a description of this command (string or structured object)\n   *\n   * **Purpose**: Display in undo/redo UI, debugging, logging\n   * **Format**: Can be a string or object with action details (coordinates, dimensions, etc.)\n   * **Examples**:\n   * - String: \"Move item to x=5, y=3\"\n   * - Object: { action: 'move', position: { x: 5, y: 3 }, size: { width: 10, height: 6 } }\n   */\n  getDescription(): string | object;\n}\n\n/**\n * Undo/Redo State\n * ================\n *\n * Reactive state for UI button enable/disable logic.\n * Components subscribe to this state to update undo/redo button states.\n *\n * **Why reactive**:\n * - Automatic button state updates (no manual DOM manipulation)\n * - Components re-render when canUndo/canRedo changes\n * - Declarative UI logic\n *\n * **Usage in components**:\n * ```tsx\n * import { undoRedoState } from './undo-redo';\n *\n * render() {\n *   return (\n *     <div>\n *       <button\n *         disabled={!undoRedoState.canUndo}\n *         onClick={() => undo()}>\n *         Undo\n *       </button>\n *       <button\n *         disabled={!undoRedoState.canRedo}\n *         onClick={() => redo()}>\n *         Redo\n *       </button>\n *     </div>\n *   );\n * }\n * ```\n */\nexport interface UndoRedoState {\n  /** Whether undo operation is available (historyPosition >= 0) */\n  canUndo: boolean;\n\n  /** Whether redo operation is available (historyPosition < commandHistory.length - 1) */\n  canRedo: boolean;\n}\n\n/**\n * Maximum number of commands in history\n *\n * **Why 50**: Balance between:\n * - âœ… Enough for typical user session\n * - âœ… Reasonable memory usage (~50-250 KB)\n * - âŒ Not unlimited (prevents memory bloat)\n *\n * **Behavior when exceeded**: Oldest command removed (sliding window)\n */\nconst MAX_HISTORY = 50;\n\n/**\n * UndoRedoManager Class\n * =====================\n *\n * Instance-based undo/redo management for grid builder.\n * Each grid-builder component can create its own UndoRedoManager instance.\n *\n * ## Architecture\n *\n * **Before (Singleton)**:\n * - Single global history shared by all grid-builder instances\n * - Multiple instances pollute each other's history\n * - Storybook stories contaminate each other\n *\n * **After (Instance-based)**:\n * - Each grid-builder creates its own UndoRedoManager\n * - Isolated history per instance\n * - Multiple grid-builders on same page work independently\n *\n * ## Usage\n *\n * **New code (instance-based)**:\n * ```typescript\n * // In grid-builder component\n * componentWillLoad() {\n *   this.undoRedoManager = new UndoRedoManager();\n *   this.undoRedoState = this.undoRedoManager.state;\n * }\n * ```\n *\n * **Legacy code (backward compatible)**:\n * ```typescript\n * // Still works via singleton export\n * import { undoRedo } from './services/undo-redo';\n * undoRedo.push(new AddItemCommand(...));\n * ```\n *\n * ## Instance State\n *\n * Each instance has:\n * - Independent reactive state (StencilJS store)\n * - Own command history stack\n * - Own history position pointer\n * - Own lifecycle (dispose() cleanup)\n */\nexport class UndoRedoManager {\n  /**\n   * Reactive state for button enable/disable\n   *\n   * **Access pattern**:\n   * ```typescript\n   * const canUndoNow = undoRedoManager.state.canUndo;\n   * ```\n   *\n   * **Updates**: Automatically triggered after each operation\n   */\n  public state: UndoRedoState;\n\n  /**\n   * Cleanup subscriptions (called on component unmount)\n   *\n   * **Usage**:\n   * ```typescript\n   * disconnectedCallback() {\n   *   this.undoRedoManager.dispose();\n   * }\n   * ```\n   */\n  public dispose: () => void;\n\n  /**\n   * Command history stack\n   *\n   * **Structure**: Array of Command objects in chronological order\n   * **Growth**: Appends new commands to end\n   * **Bounded**: Limited to MAX_HISTORY commands (50)\n   * **Branching**: Discards commands after current position on new push\n   */\n  private commandHistory: Command[] = [];\n\n  /**\n   * Current position in command history\n   *\n   * **Range**: -1 (empty history) to commandHistory.length - 1\n   * **Meaning**:\n   * - -1: No commands or all undone\n   * - 0: First command is current state\n   * - N: Command at index N is current state\n   */\n  private historyPosition: number = -1;\n\n  /**\n   * Create new UndoRedoManager instance\n   * @example\n   * ```typescript\n   * // Empty history (default)\n   * const manager = new UndoRedoManager();\n   * ```\n   */\n  constructor() {\n    // Create StencilJS reactive store\n    const { state, dispose } = createStore<UndoRedoState>({\n      canUndo: false,\n      canRedo: false,\n    });\n\n    this.state = state;\n    this.dispose = dispose;\n  }\n\n  /**\n   * Update reactive state for undo/redo button enablement\n   *\n   * **Called after**:\n   * - push() - New command added\n   * - undo() - Position moved backward\n   * - redo() - Position moved forward\n   * - clearHistory() - History reset\n   *\n   * **Updates**:\n   * - `canUndo`: true if historyPosition >= 0 (commands available to undo)\n   * - `canRedo`: true if historyPosition < commandHistory.length - 1 (commands available to redo)\n   */\n  private updateButtonStates(): void {\n    this.state.canUndo = this.historyPosition >= 0;\n    this.state.canRedo = this.historyPosition < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Push a new command to the history stack\n   *\n   * **Use cases**:\n   * - After drag operation completes\n   * - After resize operation completes\n   * - After adding new item\n   * - After deleting item\n   *\n   * **Branching behavior** (discards future):\n   * ```\n   * Before: [cmd1, cmd2, cmd3, cmd4]\n   * â†‘ position = 1 (undid twice)\n   *\n   * Push cmd5: [cmd1, cmd2, cmd5]\n   * â†‘ position = 2\n   *\n   * Note: cmd3 and cmd4 discarded!\n   * ```\n   *\n   * **Why discard future**:\n   * - Matches user mental model (new action erases \"undone\" history)\n   * - Simpler implementation than tree-based history\n   * - Standard undo/redo UX pattern\n   *\n   * **Memory management**:\n   * - If history exceeds MAX_HISTORY (50), oldest command removed\n   * - Position adjusted to maintain integrity\n   *\n   * **Operation sequence**:\n   * 1. Discard commands after current position (splice)\n   * 2. Append new command to history\n   * 3. If over limit, remove oldest (shift)\n   * 4. Update position pointer\n   * 5. Update button states (triggers UI)\n   *\n   * **Typical usage**:\n   * ```typescript\n   * // After drag end\n   * const command = new MoveItemCommand(item, oldPos, newPos);\n   * pushCommand(command);\n   * ```\n   *\n   * **Important**: Command should be fully constructed (with snapshots taken)\n   * before being pushed. This function does NOT execute the command - it's\n   * assumed the operation already happened.\n   * @param command - Fully constructed command with before/after snapshots\n   * @example\n   * ```typescript\n   * // Delete item example\n   * handleDelete(itemId: string, canvasId: string) {\n   *   const item = getItem(canvasId, itemId);\n   *   const index = gridState.canvases[canvasId].items.indexOf(item);\n   *\n   *   // Perform the delete\n   *   removeItemFromCanvas(canvasId, itemId);\n   *\n   *   // Push command for undo (AFTER operation)\n   *   const command = new DeleteItemCommand(canvasId, item, index);\n   *   pushCommand(command);\n   * }\n   * ```\n   * @param command - Fully constructed command with before/after snapshots\n   */\n  push(command: Command): void {\n    debug.log(\n      \"âž• PUSH: Adding command to history:\",\n      (command as any).description || command,\n    );\n\n    // Remove any commands after current position\n    this.commandHistory.splice(this.historyPosition + 1);\n\n    // Add new command\n    this.commandHistory.push(command);\n\n    // Limit history size\n    if (this.commandHistory.length > MAX_HISTORY) {\n      this.commandHistory.shift();\n    } else {\n      this.historyPosition++;\n    }\n\n    debug.log(\n      \"  History position now:\",\n      this.historyPosition,\n      \", Total commands:\",\n      this.commandHistory.length,\n    );\n\n    // Update button states\n    this.updateButtonStates();\n  }\n\n  /**\n   * Undo the last command in history\n   *\n   * **Triggered by**:\n   * - Ctrl+Z / Cmd+Z keyboard shortcut\n   * - Undo button click\n   * - Programmatic undo (rare)\n   *\n   * **Operation sequence**:\n   * 1. Check if undo available (historyPosition >= 0)\n   * 2. Get command at current position\n   * 3. Execute command.undo() (reverses operation)\n   * 4. Decrement position pointer\n   * 5. Update button states (triggers UI)\n   *\n   * **Side effects**:\n   * - Mutates global state (via command.undo())\n   * - Triggers component re-renders\n   * - Updates undo/redo button states\n   * - May deselect items (depending on command)\n   *\n   * **Position before/after**:\n   * ```\n   * Before: [cmd1, cmd2, cmd3]\n   * â†‘ position = 2\n   *\n   * After:  [cmd1, cmd2, cmd3]\n   * â†‘ position = 1\n   * ```\n   *\n   * **Safety**: No-op if historyPosition < 0 (nothing to undo)\n   *\n   * **Multiple undo**: Can be called repeatedly to undo multiple commands\n   * @returns Command description object or string, or undefined if nothing to undo\n   * @example\n   * ```typescript\n   * // Keyboard shortcut handler\n   * window.addEventListener('keydown', (e) => {\n   *   if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n   *     const description = undo();\n   *     console.log('Undid:', description);\n   *     e.preventDefault();\n   *   }\n   * });\n   * ```\n   */\n  undo(): string | object | undefined {\n    if (this.historyPosition < 0) {\n      return undefined;\n    }\n\n    const command = this.commandHistory[this.historyPosition];\n    debug.log(\n      \"ðŸ”™ UNDO: Executing command at position\",\n      this.historyPosition,\n      \":\",\n      command,\n    );\n    debug.log(\"  Command description:\", (command as any).description);\n    const description = command.getDescription();\n    command.undo();\n    this.historyPosition--;\n    debug.log(\"  New position after undo:\", this.historyPosition);\n\n    this.updateButtonStates();\n    return description;\n  }\n\n  /**\n   * Redo the next command in history\n   *\n   * **Triggered by**:\n   * - Ctrl+Y / Cmd+Y keyboard shortcut\n   * - Ctrl+Shift+Z / Cmd+Shift+Z (alternative)\n   * - Redo button click\n   * - Programmatic redo (rare)\n   *\n   * **Operation sequence**:\n   * 1. Check if redo available (historyPosition < commandHistory.length - 1)\n   * 2. Increment position pointer\n   * 3. Get command at new position\n   * 4. Execute command.redo() (reapplies operation)\n   * 5. Update button states (triggers UI)\n   *\n   * **Side effects**:\n   * - Mutates global state (via command.redo())\n   * - Triggers component re-renders\n   * - Updates undo/redo button states\n   * - May select items (depending on command)\n   *\n   * **Position before/after**:\n   * ```\n   * Before: [cmd1, cmd2, cmd3]\n   * â†‘ position = 1\n   *\n   * After:  [cmd1, cmd2, cmd3]\n   * â†‘ position = 2\n   * ```\n   *\n   * **Safety**: No-op if no commands to redo (position at end)\n   *\n   * **Multiple redo**: Can be called repeatedly to redo multiple commands\n   *\n   * **Redo after new action**: Redo becomes unavailable after new command\n   * pushed (future history discarded)\n   * @returns Command description object or string, or undefined if nothing to redo\n   * @example\n   * ```typescript\n   * // Keyboard shortcut handler\n   * window.addEventListener('keydown', (e) => {\n   *   if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n   *     const description = redo();\n   *     console.log('Redid:', description);\n   *     e.preventDefault();\n   *   }\n   * });\n   * ```\n   */\n  redo(): string | object | undefined {\n    if (this.historyPosition >= this.commandHistory.length - 1) {\n      return undefined;\n    }\n\n    this.historyPosition++;\n    const command = this.commandHistory[this.historyPosition];\n    const description = command.getDescription();\n    command.redo();\n\n    this.updateButtonStates();\n    return description;\n  }\n\n  /**\n   * Check if undo operation is available\n   *\n   * **Use cases**:\n   * - Enabling/disabling undo button\n   * - Showing undo keyboard hint\n   * - Programmatic checks before undo\n   *\n   * **Returns true when**: historyPosition >= 0 (commands in history)\n   * **Returns false when**: historyPosition = -1 (no history or all undone)\n   *\n   * **Note**: Prefer using `undoRedoState.canUndo` in UI components\n   * for automatic reactivity. This function is for imperative checks.\n   * @returns true if undo() can be called, false otherwise\n   * @example\n   * ```typescript\n   * // Imperative check\n   * if (canUndo()) {\n   *   debug.log('Undo available');\n   *   undo();\n   * }\n   *\n   * // Prefer reactive state in UI\n   * <button disabled={!undoRedoState.canUndo}>Undo</button>\n   * ```\n   */\n  canUndo(): boolean {\n    return this.historyPosition >= 0;\n  }\n\n  /**\n   * Check if redo operation is available\n   *\n   * **Use cases**:\n   * - Enabling/disabling redo button\n   * - Showing redo keyboard hint\n   * - Programmatic checks before redo\n   *\n   * **Returns true when**: historyPosition < commandHistory.length - 1\n   * **Returns false when**: At end of history or history empty\n   *\n   * **Becomes false after**: New command pushed (future discarded)\n   *\n   * **Note**: Prefer using `undoRedoState.canRedo` in UI components\n   * for automatic reactivity. This function is for imperative checks.\n   * @returns true if redo() can be called, false otherwise\n   * @example\n   * ```typescript\n   * // Imperative check\n   * if (canRedo()) {\n   *   debug.log('Redo available');\n   *   redo();\n   * }\n   *\n   * // Prefer reactive state in UI\n   * <button disabled={!undoRedoState.canRedo}>Redo</button>\n   * ```\n   */\n  canRedo(): boolean {\n    return this.historyPosition < this.commandHistory.length - 1;\n  }\n\n  /**\n   * Clear all command history\n   *\n   * **Use cases**:\n   * - Application reset\n   * - Loading new project\n   * - Test cleanup\n   * - Memory management (rare)\n   *\n   * **Effects**:\n   * - Empties command history array\n   * - Resets position to -1\n   * - Disables both undo and redo buttons\n   * - Does NOT affect current state (only history)\n   *\n   * **Memory**: Allows garbage collection of command objects and snapshots\n   *\n   * **Cannot be undone**: This operation itself is not undoable\n   *\n   * **Safety**: Safe to call even if history already empty\n   * @example\n   * ```typescript\n   * // Reset application\n   * function resetApp() {\n   *   clearHistory();\n   *   reset(); // Reset state\n   *   debug.log('Application reset');\n   * }\n   *\n   * // Test cleanup\n   * afterEach(() => {\n   *   clearHistory();\n   * });\n   * ```\n   */\n  clearHistory(): void {\n    this.commandHistory.length = 0;\n    this.historyPosition = -1;\n    this.updateButtonStates();\n  }\n}\n\n/**\n * Backward Compatibility Layer\n * ==============================\n *\n * Singleton instance and helper function exports for backward compatibility.\n * Existing code can continue using these while we migrate to instance-based architecture.\n *\n */\n\n// Create singleton instance (for backward compatibility only)\nconst defaultManager = new UndoRedoManager();\n\n// Export singleton state (backward compatible)\nexport const undoRedoState = defaultManager.state;\n\n// Export singleton instance methods as standalone functions (backward compatible)\nexport const pushCommand = (command: Command) => defaultManager.push(command);\nexport const undo = (): string | object | undefined => defaultManager.undo();\nexport const redo = (): string | object | undefined => defaultManager.redo();\nexport const canUndo = () => defaultManager.canUndo();\nexport const canRedo = () => defaultManager.canRedo();\nexport const clearHistory = () => defaultManager.clearHistory();\n\n// Export object wrapper for backward compatibility (deprecated, use standalone functions)\nexport const undoRedo = {\n  push: pushCommand,\n  undo,\n  redo,\n  canUndo,\n  canRedo,\n  clearHistory,\n};\n","/**\n * Grid Builder Styles\n * ====================\n *\n * Main styles for the grid builder library component.\n * Uses CSS variables for theming support.\n */\n\n:host {\n  // Theme CSS variables with defaults\n  --grid-builder-primary-color: #007bff;\n  --grid-builder-palette-bg: #f5f5f5;\n  --grid-builder-canvas-bg: #ffffff;\n  --grid-builder-grid-line-color: rgba(0, 0, 0, 0.1);\n  --grid-builder-selection-color: #007bff;\n  --grid-builder-resize-handle-color: #007bff;\n  --grid-builder-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell',\n    'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n\n  display: block;\n  width: 100%;\n  height: 100%;\n  font-family: var(--grid-builder-font-family);\n}\n\n/**\n * Screen Reader Only (sr-only)\n * =============================\n *\n * Standard accessibility pattern to hide content visually\n * while keeping it accessible to screen readers.\n *\n * **Use Cases**:\n * - ARIA live regions for announcements\n * - Skip navigation links\n * - Hidden form labels\n * - Status messages\n *\n * **Technique**:\n * - Positioned off-screen instead of display:none\n * - display:none would hide from screen readers too\n * - clip prevents visual rendering\n *\n * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n */\n.sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.grid-builder-container {\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n}\n\n.canvas-area {\n  position: relative;\n  flex: 1;\n  background: var(--grid-builder-canvas-bg);\n  overflow-y: auto;\n}\n\n.canvases-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100%;\n  gap: 0; /* No gaps between canvas sections */\n}\n\n/**\n * Canvas Wrapper\n * ==============\n *\n * Wrapper around each canvas-section providing a mounting point for custom canvas headers.\n * Headers are positioned automatically with their canvases - no manual offset calculations needed.\n *\n * **Layout Pattern**:\n * ```html\n * <div class=\"canvas-wrapper\">\n *   <canvas-header /> <!-- Custom header from uiOverrides.CanvasHeader -->\n *   <canvas-section />\n * </div>\n * ```\n *\n * **Positioning**:\n * - Wrapper uses relative positioning (provides context for absolute children)\n * - Headers can position themselves relative to their canvas\n * - No gaps between canvases (flex column layout)\n *\n * **Performance**:\n * - Negligible overhead (~0.05ms per canvas)\n * - Natural DOM hierarchy (header + canvas siblings)\n */\n.canvas-wrapper {\n  position: relative; // Positioning context for custom headers\n  display: flex;\n  flex-direction: column;\n  gap: 0; // No gap between header and canvas\n\n  // First canvas needs top padding so header doesn't get cut off at page top\n  // Matches the negative margin amount used on other headers\n  &:first-child {\n    padding-top: 38px;\n  }\n}\n\n.config-area {\n  position: fixed;\n  z-index: 1000;\n  right: 0;\n  bottom: 0;\n  display: none; // Hidden by default, shown when item selected\n  width: 350px;\n  max-height: 60%;\n  border: 1px solid #ddd;\n  border-radius: 8px 8px 0 0;\n  background: white;\n  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\n\n  &.visible {\n    display: block;\n  }\n}\n","/**\n * Grid Builder - Main Library Component\n * =======================================\n *\n * Main entry point for the grid builder library. Accepts component definitions,\n * configuration, and customization options via props to create a fully functional\n * drag-and-drop page builder.\n *\n * ## Library Design Philosophy\n *\n * **Consumer-driven configuration**:\n * - Library provides infrastructure (drag/drop, undo/redo, state management)\n * - Consumer provides content (component types, initial layout, styling)\n * - Clean separation of concerns\n * - Maximum flexibility\n *\n * **Props-based API**:\n * ```typescript\n * <grid-builder\n * components={componentDefinitions}     // Required: Component type registry\n * config={gridConfig}                   // Optional: Grid system config\n * theme={gridTheme}                     // Optional: Visual customization\n * plugins={pluginInstances}             // Optional: Plugin extensions\n * uiOverrides={customUIComponents}      // Optional: Custom UI rendering\n * initialState={savedState}             // Optional: Restore saved layout\n * />\n * ```\n *\n * ## Component Lifecycle\n *\n * **Initialization flow**:\n * 1. componentWillLoad: Validate props, set defaults, restore initial state\n * 2. componentDidLoad: Initialize plugins, setup global dependencies, attach event listeners\n * 3. render: Render UI structure (palette, canvases, config panel)\n * 4. disconnectedCallback: Cleanup plugins, remove listeners, dispose resources\n *\n * **State management**:\n * - Uses global gridState from state-manager.ts\n * - Components subscribe via StencilJS reactivity\n * - Plugins access via GridBuilderAPI\n * - Clean separation of library vs consumer state\n * @module grid-builder\n */\n\nimport {\n  Component,\n  Element,\n  Event,\n  EventEmitter,\n  h,\n  Host,\n  Listen,\n  Method,\n  Prop,\n  State,\n  Watch,\n} from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { GridBuilderTheme } from \"../../types/theme\";\nimport { GridBuilderPlugin } from \"../../types/plugin\";\nimport { UIComponentOverrides } from \"../../types/ui-overrides\";\nimport { GridBuilderAPI } from \"../../types/api\";\nimport { DeletionHook } from \"../../types/deletion-hook\";\nimport { GridExport } from \"../../types/grid-export\";\nimport {\n  ComponentAddedEvent,\n  ComponentDeletedEvent,\n  ComponentMovedEvent,\n  CanvasActivatedEvent,\n} from \"../../types/events\";\n\n// Service imports\nimport {\n  StateManager,\n  GridState,\n  GridItem,\n  generateItemId,\n} from \"../../services/state-manager\";\nimport { VirtualRendererService } from \"../../services/virtual-renderer\";\nimport { EventManager } from \"../../services/event-manager\";\nimport { ComponentRegistry } from \"../../services/component-registry\";\nimport {\n  BatchAddCommand,\n  BatchDeleteCommand,\n  BatchUpdateConfigCommand,\n  AddCanvasCommand,\n  RemoveCanvasCommand,\n  MoveItemCommand,\n  ChangeZIndexCommand,\n} from \"../../services/undo-redo-commands\";\nimport { UndoRedoManager, undoRedoState } from \"../../services/undo-redo\";\nimport { DOMCache } from \"../../utils/dom-cache\";\n\n// Utility imports\nimport {\n  pixelsToGridX,\n  pixelsToGridY,\n  clearGridSizeCache,\n} from \"../../utils/grid-calculations\";\nimport {\n  applyBoundaryConstraints,\n  constrainPositionToCanvas,\n  CANVAS_WIDTH_UNITS,\n} from \"../../utils/boundary-constraints\";\nimport { createDebugLogger } from \"../../utils/debug\";\n\nconst debug = createDebugLogger(\"grid-builder\");\n\n/**\n * GridBuilder Component\n * ======================\n *\n * Main library component providing complete grid builder functionality.\n *\n * **Tag**: `<grid-builder>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: \"grid-builder\",\n  styleUrl: \"grid-builder.scss\",\n  shadow: false, // Light DOM required for interact.js\n})\nexport class GridBuilder {\n  /**\n   * Component definitions registry\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Purpose**: Defines available component types (header, text, button, etc.)\n   *\n   * **Each definition includes**:\n   * - type: Unique identifier (e.g., 'header', 'text-block')\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Initial size when dropped\n   * - render: Function returning component to render\n   * - configSchema: Optional auto-generated config form\n   * - renderConfigPanel: Optional custom config UI\n   * - Lifecycle hooks: onVisible, onHidden for virtual rendering\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => (\n   *       <my-header itemId={itemId} config={config} />\n   *     ),\n   *     configSchema: [\n   *       { name: 'text', label: 'Text', type: 'text', defaultValue: 'Header' }\n   *     ]\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Default**: Standard 2% grid with 10px-50px constraints\n   *\n   * **Configuration options**:\n   * - gridSizePercent: Grid unit as % of width (default: 2)\n   * - minGridSize: Minimum size in pixels (default: 10)\n   * - maxGridSize: Maximum size in pixels (default: 50)\n   * - snapToGrid: Enable snap-to-grid (default: true)\n   * - showGridLines: Show visual grid (default: true)\n   * - minItemSize: Minimum item dimensions (default: { width: 5, height: 4 })\n   * - virtualRenderMargin: Pre-render margin (default: '20%')\n   *\n   * **Example**:\n   * ```typescript\n   * const config = {\n   *   gridSizePercent: 3,           // 3% grid (33 units per 100%)\n   *   minGridSize: 15,              // 15px minimum\n   *   maxGridSize: 60,              // 60px maximum\n   *   snapToGrid: true,\n   *   virtualRenderMargin: '30%'    // Aggressive pre-loading\n   * };\n   * ```\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Visual theme customization\n   *\n   * **Optional prop**: Customizes colors, fonts, and styling\n   * **Default**: Bootstrap-inspired blue theme\n   *\n   * **Theme options**:\n   * - primaryColor: Accent color (default: '#007bff')\n   * - paletteBackground: Palette sidebar color (default: '#f5f5f5')\n   * - canvasBackground: Canvas background (default: '#ffffff')\n   * - gridLineColor: Grid line color (default: 'rgba(0,0,0,0.1)')\n   * - selectionColor: Selection outline (default: '#007bff')\n   * - resizeHandleColor: Resize handle color (default: '#007bff')\n   * - fontFamily: UI font (default: system font stack)\n   * - customProperties: CSS variables for advanced theming\n   *\n   * **Example**:\n   * ```typescript\n   * const theme = {\n   *   primaryColor: '#ff6b6b',        // Brand red\n   *   paletteBackground: '#fff5f5',   // Light red\n   *   customProperties: {\n   *     '--text-color': '#ffffff',\n   *     '--border-radius': '8px'\n   *   }\n   * };\n   * ```\n   */\n  @Prop() theme?: GridBuilderTheme;\n\n  /**\n   * Plugin instances for extending functionality\n   *\n   * **Optional prop**: Array of GridBuilderPlugin instances\n   * **Purpose**: Add custom features, analytics, integrations\n   *\n   * **Plugin lifecycle**:\n   * 1. Library calls plugin.init(api) on componentDidLoad\n   * 2. Plugin subscribes to events, adds UI, etc.\n   * 3. Library calls plugin.destroy() on disconnectedCallback\n   *\n   * **Example**:\n   * ```typescript\n   * class AnalyticsPlugin implements GridBuilderPlugin {\n   *   name = 'analytics';\n   *\n   *   init(api: GridBuilderAPI) {\n   *     api.on('componentAdded', (e) => {\n   *       analytics.track('Component Added', { type: e.item.type });\n   *     });\n   *   }\n   *\n   *   destroy() {\n   *     // Cleanup\n   *   }\n   * }\n   *\n   * const plugins = [new AnalyticsPlugin()];\n   * ```\n   */\n  @Prop() plugins?: GridBuilderPlugin[];\n\n  /**\n   * Custom UI component overrides\n   *\n   * **Optional prop**: Replace default UI components\n   * **Purpose**: Fully customize visual appearance\n   *\n   * **Overridable components**:\n   * - ConfigPanel: Configuration panel UI\n   * - ComponentPalette: Component palette sidebar\n   * - Toolbar: Top toolbar with controls\n   *\n   * **Example**:\n   * ```typescript\n   * const uiOverrides = {\n   *   Toolbar: (props) => (\n   *     <div class=\"my-toolbar\">\n   *       <button onClick={props.onUndo}>Undo</button>\n   *       <button onClick={props.onRedo}>Redo</button>\n   *     </div>\n   *   )\n   * };\n   * ```\n   */\n  @Prop() uiOverrides?: UIComponentOverrides;\n\n  /**\n   * Initial state to restore\n   *\n   * **Optional prop**: Restore saved layout\n   * **Purpose**: Load previously saved grid state\n   *\n   * **State structure**: Same as gridState (canvases, viewport, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const savedState = JSON.parse(localStorage.getItem('grid-state'));\n   * <grid-builder initialState={savedState} ... />\n   * ```\n   */\n  @Prop() initialState?: Partial<GridState>;\n\n  /**\n   * Canvas metadata storage (host app responsibility)\n   *\n   * **Optional prop**: Store canvas-level presentation metadata\n   * **Purpose**: Host app owns canvas metadata (titles, colors, settings)\n   *\n   * **Separation of concerns**:\n   * - Library owns placement state (items, layouts, zIndex)\n   * - Host app owns presentation state (colors, titles, custom metadata)\n   *\n   * **Structure**: Record<canvasId, any>\n   *\n   * **Example**:\n   * ```typescript\n   * const canvasMetadata = {\n   *   'hero-section': {\n   *     title: 'Hero Section',\n   *     backgroundColor: '#f0f4f8',\n   *     customSettings: { ... }\n   *   },\n   *   'articles-grid': {\n   *     title: 'Articles Grid',\n   *     backgroundColor: '#ffffff'\n   *   }\n   * };\n   * <grid-builder canvasMetadata={canvasMetadata} ... />\n   * ```\n   *\n   * **Use with canvas-click events**:\n   * - Library fires canvas-click event when canvas background clicked\n   * - Host app shows canvas settings panel\n   * - Host app updates canvasMetadata state\n   * - Library passes metadata to canvas-section via props\n   */\n  @Prop() canvasMetadata?: Record<string, any>;\n\n  /**\n   * Hook called before deleting a component\n   *\n   * **Optional prop**: Intercept deletion requests for custom workflows\n   * **Purpose**: Allow host app to show confirmation, make API calls, etc.\n   *\n   * **Hook behavior**:\n   * - Return `true` to proceed with deletion\n   * - Return `false` to cancel the deletion\n   * - Return a Promise for async operations (modals, API calls)\n   *\n   * **Example - Confirmation modal**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   const confirmed = await showConfirmModal(\n   *     `Delete ${context.item.name}?`,\n   *     'This action cannot be undone.'\n   *   );\n   *   return confirmed;\n   * };\n   * <grid-builder onBeforeDelete={onBeforeDelete} ... />\n   * ```\n   *\n   * **Example - API call + confirmation**:\n   * ```typescript\n   * const onBeforeDelete = async (context) => {\n   *   // Show loading modal\n   *   const modal = showLoadingModal('Deleting...');\n   *\n   *   try {\n   *     // Make API call\n   *     await fetch(`/api/components/${context.itemId}`, {\n   *       method: 'DELETE'\n   *     });\n   *     modal.close();\n   *     return true; // Proceed with deletion\n   *   } catch (error) {\n   *     modal.close();\n   *     showErrorModal('Failed to delete component');\n   *     return false; // Cancel deletion\n   *   }\n   * };\n   * ```\n   *\n   * **Default behavior**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: DeletionHook;\n\n  /**\n   * Custom API exposure configuration\n   *\n   * **Optional prop**: Control where and how the Grid Builder API is exposed\n   * **Default**: `{ key: 'gridBuilderAPI' }`\n   * **Purpose**: Allows multiple grid-builder instances on the same page\n   *\n   * **Options**:\n   * 1. **Custom key on window** (multiple instances):\n   * ```typescript\n   * <grid-builder api-ref={{ key: 'gridAPI1' }}></grid-builder>\n   * <grid-builder api-ref={{ key: 'gridAPI2' }}></grid-builder>\n   * // Access: window.gridAPI1, window.gridAPI2\n   * ```\n   *\n   * 2. **Disable automatic exposure** (use ref instead):\n   * ```typescript\n   * <grid-builder api-ref={null}></grid-builder>\n   * // Access via ref: <grid-builder ref={el => this.api = el?.api}></grid-builder>\n   * ```\n   */\n  @Prop() apiRef?: { key?: string } | null = {\n    key: \"gridBuilderAPI\",\n  };\n\n  /**\n   * Component registry (public property)\n   *\n   * **Purpose**: Map component type â†’ definition for lookup\n   * **Built from**: components prop\n   * **Used by**: grid-item-wrapper for dynamic rendering, component-palette for Observable pattern\n   * **Visibility**: Public to allow sharing with component-palette for automatic sync\n   *\n   * **Structure**: ComponentRegistry service with get(), has(), getAll() methods\n   *\n   * **Why public**: Allows external code (e.g., Storybook stories) to access and share the registry\n   * with component-palette for Observer pattern. The palette subscribes to onChange() for reactive updates.\n   *\n   * **Not @State()**: Changes to registry trigger updates via Observer pattern (onChange callbacks),\n   * not via StencilJS reactivity. Subscribers update their own @State when notified.\n   */\n  public componentRegistry: ComponentRegistry = new ComponentRegistry();\n\n  /**\n   * Component registry ready event\n   *\n   * **Purpose**: Notifies external code when componentRegistry has been initialized\n   * **Fired**: After componentWillLoad creates the registry with component definitions\n   * **Use case**: Allows Storybook stories and other consumers to know when registry is ready for sharing\n   *\n   * **Event detail**: { registry: ComponentRegistry } - Reference to the initialized registry\n   *\n   * **Example usage**:\n   * ```typescript\n   * builderEl.addEventListener('registryReady', (event) => {\n   *   const { registry } = event.detail;\n   *   paletteEl.componentRegistry = registry;\n   * });\n   * ```\n   */\n  @Event({\n    eventName: \"registryReady\",\n    composed: true,\n    cancelable: false,\n    bubbles: true,\n  })\n  registryReady: EventEmitter<{ registry: ComponentRegistry }>;\n\n  /**\n   * Initialized plugins (internal state)\n   *\n   * **Purpose**: Track plugin instances for cleanup\n   * **Lifecycle**: Set in componentDidLoad, cleared in disconnectedCallback\n   */\n  @State() private initializedPlugins: GridBuilderPlugin[] = [];\n\n  /**\n   * Screen reader announcement (ARIA live region)\n   *\n   * **Purpose**: Announce dynamic changes to screen reader users\n   * **Updated by**: Event listeners for component operations\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Announces**:\n   * - Component added/deleted\n   * - Drag/drop operations\n   * - Undo/redo actions\n   * - Canvas switching\n   */\n  @State() private announcement: string = \"\";\n\n  /**\n   * GridBuilderAPI instance (internal state)\n   *\n   * **Purpose**: Provides API to plugins and external code\n   * **Lifecycle**: Created in componentDidLoad\n   */\n  private api?: GridBuilderAPI;\n\n  /**\n   * Service instances (Phase 2: Instance-based architecture)\n   *\n   * **Purpose**: Per-component service instances for isolated state\n   * **Lifecycle**: Created in componentWillLoad, disposed in disconnectedCallback\n   * **Migration**: Replacing singleton imports with instance-based approach\n   */\n  private stateManager?: StateManager;\n  private undoRedoManager?: UndoRedoManager;\n  private eventManagerInstance?: EventManager;\n  private virtualRendererInstance?: VirtualRendererService;\n  private domCacheInstance?: DOMCache;\n\n  /**\n   * Instance-specific ID for cache isolation\n   *\n   * **Purpose**: Unique identifier for this grid-builder instance\n   * **Used for**: Cache namespacing to prevent collisions between instances\n   * **Generated from**: apiRef.key prop (defaults to 'gridBuilderAPI')\n   * **Lifecycle**: Set in componentWillLoad, used throughout component lifetime\n   */\n  private instanceId: string;\n\n  /**\n   * Host element reference\n   *\n   * **Purpose**: Access to host element for event listeners\n   */\n  @Element() private hostElement!: HTMLElement;\n\n  /**\n   * Event listener references for cleanup\n   */\n  private canvasDropHandler?: (e: Event) => void;\n  private canvasMoveHandler?: (e: Event) => void;\n  private canvasActivatedHandler?: (e: Event) => void;\n  private keyboardHandler?: (e: KeyboardEvent) => void;\n\n  /**\n   * ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window width)\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private viewportResizeObserver?: ResizeObserver;\n\n  /**\n   * Component will load lifecycle\n   *\n   * **Purpose**: Validate props and initialize component registry\n   *\n   * **Validation**:\n   * - Components prop is required\n   * - Each component must have unique type\n   * - Basic structure validation\n   *\n   * **Registry building**:\n   * - Convert array to Map for O(1) lookups\n   * - Key = component type, Value = ComponentDefinition\n   *\n   * **Initial state restoration**:\n   * - If initialState provided, merge into gridState\n   * - Otherwise use empty canvases\n   */\n\n  /**\n   * Handle item deletion from grid-item-wrapper\n   * Internal event dispatched by grid-item-wrapper after user clicks delete\n   */\n  @Listen(\"grid-item:delete\")\n  handleGridItemDelete(event: CustomEvent) {\n    debug.log(\"ðŸ—‘ï¸ @Listen(grid-item:delete) in grid-builder\", {\n      detail: event.detail,\n    });\n\n    const { itemId } = event.detail;\n    if (itemId) {\n      debug.log(\"  âœ… Deleting item via API (with undo support):\", itemId);\n      // Use API method instead of direct deleteItemsBatch to enable undo/redo\n      this.api?.deleteComponent(itemId);\n    }\n  }\n\n  /**\n   * Handle palette item click (click-to-add feature)\n   *\n   * **Triggered**: User clicks palette item (emitted by component-palette)\n   * **Purpose**: Add component to active canvas using smart positioning\n   *\n   * **Event Listener Target**: `document` (not component host element)\n   * - Listens at document level to hear events from palette even when it's a DOM sibling\n   * - Critical for Storybook stories where palette and grid-builder are rendered as siblings\n   * - Events with `bubbles: true` and `composed: true` propagate to document level\n   * - This pattern works in all scenarios: parent-child, siblings, or separate component trees\n   *\n   * ## Implementation Steps\n   *\n   * 1. **Check if enabled**: Only proceed if `config.enableClickToAdd !== false`\n   * 2. **Get active canvas**: Use this.stateManager!.state.activeCanvasId or auto-select first\n   * 3. **Find component definition**: Look up in component registry\n   * 4. **Find free space**: Use findFreeSpace() for collision-free placement\n   * 5. **Create grid item**: Generate ID, build item object with found position\n   * 6. **Add to state**: Use api.addComponent() for undo/redo support\n   * 7. **Visual feedback**: Highlight canvas, show position indicator, animate component\n   * 8. **Emit event**: componentAdded event for plugins\n   *\n   * ## Edge Cases Handled\n   *\n   * - **No active canvas**: Auto-selects first canvas\n   * - **No canvases exist**: Logs warning, exits gracefully\n   * - **Component definition not found**: Logs error, exits\n   * - **No free space**: Places at canvas bottom (auto-expands canvas)\n   *\n   * ## Visual Feedback Sequence\n   *\n   * 1. **Canvas highlight** (600ms pulse on border)\n   * 2. **Position indicator** (800ms ghost outline at target position)\n   * 3. **Component animation** (400ms fade + scale when added)\n   *\n   * **Example flow**:\n   * ```\n   * User clicks \"Header\" in palette\n   * â†’ Canvas border pulses\n   * â†’ Ghost outline shows where header will appear\n   * â†’ Header component fades/scales in at position\n   * â†’ Canvas height adjusts if needed\n   * ```\n   * @param event - Custom event with { componentType: string }\n   */\n  @Listen(\"palette-item-click\", { target: \"document\" })\n  async handlePaletteItemClick(\n    event: CustomEvent<{ componentType: string; targetGridBuilderId?: string }>,\n  ) {\n    debug.log(\"âž• @Listen(palette-item-click) in grid-builder\", {\n      detail: event.detail,\n    });\n\n    // Filter events by target instance ID (for multi-instance support)\n    // If targetGridBuilderId is specified, only respond if it matches our instance ID\n    const { targetGridBuilderId } = event.detail;\n    if (targetGridBuilderId) {\n      const myInstanceId = this.apiRef?.key || \"gridBuilderAPI\";\n      if (targetGridBuilderId !== myInstanceId) {\n        debug.log(\n          `  â­ï¸ Skipping - event targeted at ${targetGridBuilderId}, this instance is ${myInstanceId}`,\n        );\n        return;\n      }\n      debug.log(`  âœ… Event matches this instance (${myInstanceId})`);\n    }\n\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      debug.log(\"  â­ï¸ Click-to-add disabled via config\");\n      return;\n    }\n\n    const { componentType } = event.detail;\n    if (!componentType) {\n      debug.warn(\"handlePaletteItemClick: Component type not provided\");\n      return;\n    }\n\n    // Get or auto-select active canvas\n    let canvasId = this.stateManager!.state.activeCanvasId;\n\n    if (!canvasId) {\n      // Auto-select first canvas\n      const canvasIds = Object.keys(this.stateManager!.state.canvases);\n      if (canvasIds.length === 0) {\n        debug.warn(\"handlePaletteItemClick: No canvases available\");\n        return;\n      }\n      canvasId = canvasIds[0];\n      this.api?.setActiveCanvas(canvasId);\n      debug.log(`  ðŸŽ¯ Auto-selected first canvas: ${canvasId}`);\n    }\n\n    // Get component definition\n    const definition = this.componentRegistry.get(componentType);\n    if (!definition) {\n      debug.error(\n        `handlePaletteItemClick: Component definition not found for type: ${componentType}`,\n      );\n      return;\n    }\n\n    // Get default size from definition (or use fallback)\n    const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n\n    // Import space-finder utility (dynamic import to avoid circular dependency)\n    const { findFreeSpace } = await import(\"../../utils/space-finder\");\n\n    // Find free space on canvas (pass state instance for multi-instance support)\n    const position = findFreeSpace(\n      canvasId,\n      defaultSize.width,\n      defaultSize.height,\n      this.stateManager!.state,\n    );\n\n    if (!position) {\n      debug.error(\n        `handlePaletteItemClick: Could not find space on canvas ${canvasId}`,\n      );\n      return;\n    }\n\n    debug.log(\"  ðŸ“ Found free space:\", position);\n\n    // Import visual feedback utilities (dynamic import)\n    const visualFeedback = await import(\"../../utils/visual-feedback\");\n\n    // Show visual feedback (canvas highlight + position indicator)\n    visualFeedback.highlightCanvas(canvasId);\n    visualFeedback.showPositionIndicator(\n      canvasId,\n      position.x,\n      position.y,\n      defaultSize.width,\n      defaultSize.height,\n      this.config,\n    );\n\n    debug.log(\"  âž• Adding component via API\");\n\n    // Add via API for undo/redo support (correct signature)\n    const newItemId = this.api?.addComponent(\n      canvasId,\n      componentType,\n      {\n        x: position.x,\n        y: position.y,\n        width: defaultSize.width,\n        height: defaultSize.height,\n      },\n      {}, // Empty config object\n    );\n\n    if (!newItemId) {\n      debug.error(\"Failed to add component to canvas\");\n      return;\n    }\n\n    // Activate the canvas where the component was dropped\n    this.api?.setActiveCanvas(canvasId);\n    debug.log(`  ðŸŽ¯ Activated canvas: ${canvasId}`);\n\n    // Animate component in (after DOM update completes)\n    // Use double requestAnimationFrame to ensure:\n    // 1. First rAF: Current frame completes\n    // 2. Second rAF: Next frame starts (after StencilJS render + positioning)\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        visualFeedback.animateComponentIn(newItemId);\n      });\n    });\n\n    // Set as selected (focus on newly added item)\n    this.stateManager!.state.selectedItemId = newItemId;\n    this.stateManager!.state.selectedCanvasId = canvasId;\n\n    // Emit componentAdded event for plugins\n    // Must include full item object to match ComponentAddedEvent interface\n    const canvas = this.stateManager!.state.canvases[canvasId];\n    const newItem = canvas?.items.find((item) => item.id === newItemId);\n\n    if (newItem) {\n      this.eventManagerInstance?.emit(\"componentAdded\", {\n        item: newItem,\n        canvasId,\n      });\n    }\n\n    debug.log(\"  âœ… Component added successfully\");\n  }\n\n  componentWillLoad() {\n    // Validate required props\n    if (!this.components || this.components.length === 0) {\n      console.error(\"GridBuilder: components prop is required\");\n      return;\n    }\n\n    // Build component registry\n    this.componentRegistry = new ComponentRegistry(this.components);\n\n    // Validate unique component types\n    if (this.componentRegistry.size() !== this.components.length) {\n      debug.warn(\"GridBuilder: Duplicate component types detected\");\n    }\n\n    // Emit registry-ready event for external consumers (e.g., Storybook stories)\n    // This allows component-palette to be notified when registry is available for sharing\n    this.registryReady.emit({ registry: this.componentRegistry });\n\n    // Expose interact.js globally (required for drag/drop handlers)\n    (window as any).interact = interact;\n\n    // Phase 2: Create service instances (instance-based architecture)\n    // Each grid-builder component gets its own isolated service instances\n    this.stateManager = new StateManager();\n    this.undoRedoManager = new UndoRedoManager();\n    this.eventManagerInstance = new EventManager();\n    this.virtualRendererInstance = new VirtualRendererService();\n    this.domCacheInstance = new DOMCache();\n\n    debug.log(\"GridBuilder: Service instances created\", {\n      stateManager: !!this.stateManager,\n      undoRedoManager: !!this.undoRedoManager,\n      eventManagerInstance: !!this.eventManagerInstance,\n      virtualRendererInstance: !!this.virtualRendererInstance,\n      domCacheInstance: !!this.domCacheInstance,\n    });\n\n    // Set instanceId for cache isolation (stored as private property to avoid mutating config prop)\n    // This prevents cache collisions when multiple instances share canvasIds\n    this.instanceId = this.apiRef?.key || \"gridBuilderAPI\";\n\n    debug.log(\"GridBuilder: Instance ID set\", {\n      instanceId: this.instanceId,\n      hasCustomConfig: !!this.config,\n    });\n\n    // Clear this instance's cache on load to prevent stale values when remounting\n    // Critical for Storybook tab switching: prevents cache from previous tab (Docs/Canvas)\n    // ResizeObserver only fires on changes, not initial load, so we must clear here\n    clearGridSizeCache(this.instanceId);\n    debug.log(\"GridBuilder: Cleared instance cache on load\", {\n      instanceId: this.instanceId,\n    });\n\n    // Restore initial state if provided\n    if (this.initialState) {\n      Object.assign(this.stateManager!.state, this.initialState);\n    }\n  }\n\n  /**\n   * Component did load lifecycle\n   *\n   * **Purpose**: Initialize global dependencies and plugins\n   *\n   * **Initialization sequence**:\n   * 1. Expose virtualRenderer singleton globally\n   * 2. Create GridBuilderAPI instance\n   * 3. Initialize plugins via plugin.init(api)\n   * 4. Apply theme via CSS variables\n   * 5. Expose debug helpers\n   */\n  componentDidLoad() {\n    // Create GridBuilderAPI instance\n    this.api = this.createAPI();\n\n    // Expose API and service instances based on apiRef configuration\n    debug.log(\"ðŸ”§ grid-builder exposing API and service instances\", {\n      hasApiRef: !!this.apiRef,\n      apiRefKey: this.apiRef?.key,\n      apiCreated: !!this.api,\n    });\n\n    if (this.apiRef && this.apiRef.key) {\n      debug.log(\"  ðŸ“¤ Setting API and services on window\", {\n        key: this.apiRef.key,\n      });\n      // Expose main API\n      window[this.apiRef.key] = this.api;\n\n      // Phase 2: Expose service instances globally (for debugging)\n      // Use namespaced keys to support multiple grid-builder instances\n      (window as any)[`${this.apiRef.key}_virtualRenderer`] =\n        this.virtualRendererInstance;\n\n      debug.log(\"  âœ… API and services set on window\", {\n        key: this.apiRef.key,\n        apiExists: !!window[this.apiRef.key],\n        virtualRendererExists: !!(window as any)[\n          `${this.apiRef.key}_virtualRenderer`\n        ],\n      });\n    }\n\n    // Initialize plugins\n    if (this.plugins && this.plugins.length > 0) {\n      this.initializedPlugins = this.plugins.filter((plugin) => {\n        try {\n          plugin.init(this.api!);\n          debug.log(`GridBuilder: Initialized plugin \"${plugin.name}\"`);\n          return true;\n        } catch (e) {\n          console.error(\n            `GridBuilder: Failed to initialize plugin \"${plugin.name}\":`,\n            e,\n          );\n          return false;\n        }\n      });\n    }\n\n    // Apply theme\n    if (this.theme) {\n      this.applyTheme(this.theme);\n    }\n\n    // Configure event debouncing (Phase 2: use instance)\n    const debounceDelay = this.config?.eventDebounceDelay ?? 300;\n    this.eventManagerInstance?.setDebounceDelay(debounceDelay);\n    debug.log(`GridBuilder: Event debounce delay set to ${debounceDelay}ms`);\n\n    // Debug helper\n    (window as any).debugInteractables = () => {\n      const interactables = (interact as any).interactables.list;\n      debug.log(\"Total interactables:\", interactables.length);\n      interactables.forEach((interactable: any, index: number) => {\n        debug.log(`Interactable ${index}:`, {\n          target: interactable.target,\n          actions: interactable._actions,\n          options: interactable.options,\n        });\n      });\n    };\n\n    // Setup canvas drop event handler for palette items\n    this.canvasDropHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId, componentType, x, y } = customEvent.detail;\n\n      debug.log(\"ðŸŽ¯ canvas-drop event received:\", {\n        canvasId,\n        componentType,\n        x,\n        y,\n      });\n\n      // Get component definition to determine default size\n      const definition = this.componentRegistry.get(componentType);\n      if (!definition) {\n        debug.warn(`Component definition not found for type: ${componentType}`);\n        return;\n      }\n\n      // Convert pixel position to grid units\n      const gridX = pixelsToGridX(x, canvasId, this.config);\n      const gridY = pixelsToGridY(y, this.config);\n\n      debug.log(\"  Converting to grid units (before constraints):\", {\n        gridX,\n        gridY,\n        defaultWidth: definition.defaultSize.width,\n        defaultHeight: definition.defaultSize.height,\n      });\n\n      // Apply boundary constraints (validate, adjust size, constrain position)\n      const constrained = applyBoundaryConstraints(definition, gridX, gridY);\n\n      if (!constrained) {\n        debug.warn(\n          `Cannot place component \"${definition.name}\" - minimum size exceeds canvas width`,\n        );\n        return;\n      }\n\n      debug.log(\"  After boundary constraints:\", constrained);\n\n      // Use existing addComponent API method with constrained values\n      const newItem = this.api?.addComponent(canvasId, componentType, {\n        x: constrained.x,\n        y: constrained.y,\n        width: constrained.width,\n        height: constrained.height,\n      });\n\n      debug.log(\"  Created item:\", newItem);\n\n      // Set the target canvas as active when item is dropped\n      this.api?.setActiveCanvas(canvasId);\n    };\n\n    this.hostElement.addEventListener(\"canvas-drop\", this.canvasDropHandler);\n\n    // Setup canvas move event handler for cross-canvas moves\n    this.canvasMoveHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { itemId, sourceCanvasId, targetCanvasId, x, y } =\n        customEvent.detail;\n\n      debug.log(\"ðŸ”„ canvas-move event received:\", {\n        itemId,\n        sourceCanvasId,\n        targetCanvasId,\n        x,\n        y,\n      });\n\n      // 1. Get item from source canvas\n      const sourceCanvas = this.stateManager!.state.canvases[sourceCanvasId];\n      if (!sourceCanvas) {\n        console.error(\"Source canvas not found:\", sourceCanvasId);\n        return;\n      }\n\n      const itemIndex = sourceCanvas.items.findIndex((i) => i.id === itemId);\n      if (itemIndex === -1) {\n        console.error(\"Item not found in source canvas:\", itemId);\n        return;\n      }\n\n      const item = sourceCanvas.items[itemIndex];\n\n      // 2. Capture state BEFORE move (for undo)\n      const sourcePosition = {\n        x: item.layouts.desktop.x,\n        y: item.layouts.desktop.y,\n      };\n      const sourceMobileLayout = {\n        x: item.layouts.mobile.x,\n        y: item.layouts.mobile.y,\n        width: item.layouts.mobile.width,\n        height: item.layouts.mobile.height,\n        customized: item.layouts.mobile.customized,\n      };\n\n      // 3. Convert drop position (pixels) to grid units for target canvas\n      let gridX = pixelsToGridX(x, targetCanvasId, this.config);\n      let gridY = pixelsToGridY(y, this.config);\n\n      // 4. Constrain position to target canvas boundaries\n      const constrained = constrainPositionToCanvas(\n        gridX,\n        gridY,\n        item.layouts.desktop.width,\n        item.layouts.desktop.height,\n        CANVAS_WIDTH_UNITS,\n      );\n\n      gridX = constrained.x;\n      gridY = constrained.y;\n\n      const targetPosition = { x: gridX, y: gridY };\n\n      // 5. Capture source z-index before modification\n      const sourceZIndex = item.zIndex;\n\n      // 6. Update item position in desktop layout\n      item.layouts.desktop.x = gridX;\n      item.layouts.desktop.y = gridY;\n\n      // 7. Move item between canvases (updates canvasId, removes from source, adds to target)\n      // Remove from source canvas\n      sourceCanvas.items = sourceCanvas.items.filter((i) => i.id !== itemId);\n\n      // Update item's canvasId\n      item.canvasId = targetCanvasId;\n\n      // Add to target canvas\n      const targetCanvas = this.stateManager!.state.canvases[targetCanvasId];\n      targetCanvas.items.push(item);\n\n      // 8. Assign new z-index in target canvas (prevents z-index conflicts)\n      const targetZIndex = targetCanvas.zIndexCounter++;\n      item.zIndex = targetZIndex;\n      this.stateManager!.state.canvases = {\n        ...this.stateManager!.state.canvases,\n      }; // Trigger reactivity\n\n      // 9. Set target canvas as active\n      this.api?.setActiveCanvas(targetCanvasId);\n\n      // 10. Update selection state if item was selected\n      if (this.stateManager!.state.selectedItemId === itemId) {\n        this.stateManager!.state.selectedCanvasId = targetCanvasId;\n      }\n\n      // 11. Create undo/redo command with z-index tracking (with instance state)\n      const command = new MoveItemCommand(\n        itemId,\n        sourceCanvasId,\n        targetCanvasId,\n        sourcePosition,\n        targetPosition,\n        itemIndex,\n        sourceZIndex,\n        targetZIndex,\n        undefined, // sourceSize (not tracked for drag operations)\n        undefined, // targetSize (not tracked for drag operations)\n        this.stateManager!.state, // Pass instance state\n        this.stateManager!.state.currentViewport, // Pass active viewport for viewport-specific undo/redo\n        sourceMobileLayout, // Mobile layout (unchanged during cross-canvas move)\n        sourceMobileLayout, // Mobile layout (unchanged during cross-canvas move)\n      );\n      this.undoRedoManager?.push(command);\n\n      // 11. Emit events for plugins\n      this.eventManagerInstance?.emit(\"componentMoved\", {\n        item,\n        sourceCanvasId,\n        targetCanvasId,\n        position: targetPosition,\n      });\n\n      // 12. Auto-scroll to component after cross-canvas move\n      // Wait for DOM to update after position changes\n      requestAnimationFrame(() => {\n        const itemElement = document.getElementById(itemId);\n        if (itemElement) {\n          itemElement.scrollIntoView({\n            behavior: \"smooth\",\n            block: \"center\",\n            inline: \"nearest\",\n          });\n        }\n      });\n\n      debug.log(\"âœ… Cross-canvas move completed:\", {\n        itemId,\n        from: sourceCanvasId,\n        to: targetCanvasId,\n        position: targetPosition,\n      });\n    };\n\n    this.hostElement.addEventListener(\"canvas-move\", this.canvasMoveHandler);\n\n    // Setup canvas activated event handler\n    this.canvasActivatedHandler = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { canvasId } = customEvent.detail;\n\n      debug.log(\"ðŸŽ¨ canvas-activated event received:\", { canvasId });\n\n      // Emit plugin event\n      this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n    };\n\n    this.hostElement.addEventListener(\n      \"canvas-activated\",\n      this.canvasActivatedHandler,\n    );\n\n    // Setup keyboard shortcuts\n    this.keyboardHandler = (event: KeyboardEvent) => {\n      // Get modifier keys (Cmd on Mac, Ctrl on Windows/Linux)\n      const isUndo =\n        (event.metaKey || event.ctrlKey) &&\n        event.key === \"z\" &&\n        !event.shiftKey;\n      const isRedo =\n        (event.metaKey || event.ctrlKey) &&\n        ((event.key === \"z\" && event.shiftKey) || // Ctrl/Cmd+Shift+Z\n          event.key === \"y\"); // Ctrl/Cmd+Y\n\n      // Handle undo/redo\n      if (isUndo) {\n        debug.log(\"âŒ¨ï¸ Keyboard: Undo triggered\");\n        event.preventDefault();\n        this.api?.undo();\n        return;\n      }\n\n      if (isRedo) {\n        debug.log(\"âŒ¨ï¸ Keyboard: Redo triggered\");\n        event.preventDefault();\n        this.api?.redo();\n        return;\n      }\n\n      // Handle Delete key (delete selected component)\n      if (event.key === \"Delete\" || event.key === \"Backspace\") {\n        if (\n          this.stateManager!.state.selectedItemId &&\n          this.stateManager!.state.selectedCanvasId\n        ) {\n          debug.log(\"âŒ¨ï¸ Keyboard: Delete triggered\", {\n            itemId: this.stateManager!.state.selectedItemId,\n          });\n          event.preventDefault();\n\n          // Capture the item ID and canvas ID before deletion\n          const deletedItemId = this.stateManager!.state.selectedItemId;\n          const deletedCanvasId = this.stateManager!.state.selectedCanvasId;\n\n          // Delete the selected item (async - respects onBeforeDelete hook)\n          this.api\n            ?.deleteComponent(this.stateManager!.state.selectedItemId)\n            .then((deleted) => {\n              if (deleted) {\n                // Announce deletion only if actually deleted (not cancelled by modal)\n                this.announce(\"Component deleted\");\n\n                // Move focus to next logical item for keyboard users\n                this.moveFocusAfterDeletion(deletedCanvasId, deletedItemId);\n              }\n            });\n\n          return;\n        }\n      }\n\n      // Handle Escape key (deselect component)\n      if (event.key === \"Escape\") {\n        if (\n          this.stateManager!.state.selectedItemId ||\n          this.stateManager!.state.selectedCanvasId\n        ) {\n          debug.log(\"âŒ¨ï¸ Keyboard: Escape triggered (deselecting)\");\n          event.preventDefault();\n\n          // Clear selection\n          this.stateManager!.state.selectedItemId = null;\n          this.stateManager!.state.selectedCanvasId = null;\n\n          // Announce deselection\n          this.announce(\"Selection cleared\");\n\n          return;\n        }\n      }\n\n      // Handle arrow key nudging (only if component is selected)\n      if (\n        !this.stateManager!.state.selectedItemId ||\n        !this.stateManager!.state.selectedCanvasId\n      ) {\n        return;\n      }\n\n      const isArrowKey = [\n        \"ArrowUp\",\n        \"ArrowDown\",\n        \"ArrowLeft\",\n        \"ArrowRight\",\n      ].includes(event.key);\n      if (!isArrowKey) {\n        return;\n      }\n\n      event.preventDefault();\n\n      // Get selected item\n      const canvas =\n        this.stateManager!.state.canvases[\n          this.stateManager!.state.selectedCanvasId\n        ];\n      if (!canvas) {\n        return;\n      }\n\n      const item = canvas.items.find(\n        (i) => i.id === this.stateManager!.state.selectedItemId,\n      );\n      if (!item) {\n        return;\n      }\n\n      // Get current viewport layout\n      const viewport = this.stateManager!.state.currentViewport;\n      const layout = item.layouts[viewport];\n\n      // Calculate nudge amount (1 grid unit in each direction)\n      const nudgeAmount = 1;\n      let deltaX = 0;\n      let deltaY = 0;\n\n      switch (event.key) {\n        case \"ArrowUp\":\n          deltaY = -nudgeAmount;\n          break;\n        case \"ArrowDown\":\n          deltaY = nudgeAmount;\n          break;\n        case \"ArrowLeft\":\n          deltaX = -nudgeAmount;\n          break;\n        case \"ArrowRight\":\n          deltaX = nudgeAmount;\n          break;\n      }\n\n      debug.log(\"âŒ¨ï¸ Keyboard: Nudging component\", {\n        key: event.key,\n        deltaX,\n        deltaY,\n        itemId: item.id,\n      });\n\n      // Capture old position for undo\n      const oldX = layout.x;\n      const oldY = layout.y;\n\n      // Update position with boundary checks\n      const newX = Math.max(0, layout.x + deltaX);\n      const newY = Math.max(0, layout.y + deltaY);\n\n      // Check right boundary (100 grid units = 100%)\n      const maxX = 100 - layout.width;\n      const constrainedX = Math.min(newX, maxX);\n      const constrainedY = newY; // No vertical limit\n\n      // Only update if position actually changed\n      if (oldX === constrainedX && oldY === constrainedY) {\n        return; // No change, don't create undo command\n      }\n\n      // Update item layout (mutate in place to preserve all properties like 'customized')\n      layout.x = constrainedX;\n      layout.y = constrainedY;\n\n      // Create undo command for nudge (same canvas = z-index unchanged)\n      const mobileLayout = {\n        x: item.layouts.mobile.x,\n        y: item.layouts.mobile.y,\n        width: item.layouts.mobile.width,\n        height: item.layouts.mobile.height,\n        customized: item.layouts.mobile.customized,\n      };\n      const nudgeCommand = new MoveItemCommand(\n        item.id,\n        this.stateManager!.state.selectedCanvasId,\n        this.stateManager!.state.selectedCanvasId,\n        { x: oldX, y: oldY },\n        { x: constrainedX, y: constrainedY },\n        canvas.items.findIndex((i) => i.id === item.id),\n        item.zIndex, // sourceZIndex\n        item.zIndex, // targetZIndex (same canvas = no change)\n        undefined, // sourceSize (not tracked for nudge operations)\n        undefined, // targetSize (not tracked for nudge operations)\n        this.stateManager!.state, // Pass instance state\n        viewport, // Pass active viewport for viewport-specific undo/redo\n        mobileLayout, // Mobile layout (unchanged during keyboard nudge)\n        mobileLayout, // Mobile layout (unchanged during keyboard nudge)\n      );\n      this.undoRedoManager?.push(nudgeCommand);\n\n      // Trigger state update\n      this.stateManager!.state.canvases = {\n        ...this.stateManager!.state.canvases,\n      };\n\n      // Emit event\n      this.eventManagerInstance?.emit(\"componentDragged\", {\n        itemId: item.id,\n        canvasId: this.stateManager!.state.selectedCanvasId,\n        position: { x: constrainedX, y: constrainedY },\n      });\n    };\n\n    document.addEventListener(\"keydown\", this.keyboardHandler);\n\n    // Setup container-based viewport switching\n    this.setupViewportResizeObserver();\n\n    // Setup screen reader announcements (ARIA live region)\n    this.setupScreenReaderAnnouncements();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Purpose**: Clean up resources when component unmounts\n   *\n   * **Cleanup sequence**:\n   * 1. Remove event listeners\n   * 2. Destroy all plugins\n   * 3. Clear global references\n   */\n  disconnectedCallback() {\n    // Remove event listeners\n    if (this.canvasDropHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-drop\",\n        this.canvasDropHandler,\n      );\n    }\n    if (this.canvasMoveHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-move\",\n        this.canvasMoveHandler,\n      );\n    }\n    if (this.canvasActivatedHandler) {\n      this.hostElement.removeEventListener(\n        \"canvas-activated\",\n        this.canvasActivatedHandler,\n      );\n    }\n    if (this.keyboardHandler) {\n      document.removeEventListener(\"keydown\", this.keyboardHandler);\n    }\n\n    // Cleanup ResizeObserver\n    if (this.viewportResizeObserver) {\n      this.viewportResizeObserver.disconnect();\n    }\n\n    // Destroy plugins\n    if (this.initializedPlugins.length > 0) {\n      this.initializedPlugins.forEach((plugin) => {\n        try {\n          plugin.destroy();\n          debug.log(`GridBuilder: Destroyed plugin \"${plugin.name}\"`);\n        } catch (e) {\n          console.error(\n            `GridBuilder: Failed to destroy plugin \"${plugin.name}\":`,\n            e,\n          );\n        }\n      });\n      this.initializedPlugins = [];\n    }\n\n    // Phase 2: Cleanup service instances\n    if (this.undoRedoManager) {\n      this.undoRedoManager.dispose();\n      debug.log(\"GridBuilder: Disposed undoRedoManager\");\n    }\n    if (this.virtualRendererInstance) {\n      this.virtualRendererInstance.destroy();\n      debug.log(\"GridBuilder: Destroyed virtualRendererInstance\");\n    }\n    if (this.eventManagerInstance) {\n      this.eventManagerInstance.removeAllListeners();\n      debug.log(\"GridBuilder: Cleared eventManagerInstance listeners\");\n    }\n    if (this.domCacheInstance) {\n      this.domCacheInstance.clear();\n      debug.log(\"GridBuilder: Cleared domCacheInstance\");\n    }\n    // StateManager will be garbage collected (no explicit cleanup needed)\n\n    // Clear grid size cache for this instance only (instance-aware cleanup)\n    if (this.instanceId) {\n      clearGridSizeCache(this.instanceId);\n      debug.log(\"GridBuilder: Cleared grid size cache for instance\", {\n        instanceId: this.instanceId,\n      });\n    }\n\n    // Clear global references\n    if (this.apiRef && this.apiRef.key) {\n      // Clear API\n      delete window[this.apiRef.key];\n\n      // Clear namespaced service instances\n      delete (window as any)[`${this.apiRef.key}_virtualRenderer`];\n    }\n  }\n\n  /**\n   * Watch components prop for changes\n   *\n   * **Purpose**: Rebuild component registry when components prop changes\n   */\n  @Watch(\"components\")\n  handleComponentsChange(newComponents: ComponentDefinition[]) {\n    this.componentRegistry = new ComponentRegistry(newComponents);\n  }\n\n  /**\n   * Watch theme prop changes and reapply theme\n   *\n   * **When triggered**: Theme prop changes (e.g., from Storybook controls)\n   * **Purpose**: Reapply CSS custom properties when theme colors change\n   */\n  @Watch(\"theme\")\n  handleThemeChange(newTheme: GridBuilderTheme) {\n    if (newTheme) {\n      this.applyTheme(newTheme);\n    }\n  }\n\n  /**\n   * Create GridBuilderAPI instance\n   *\n   * **Purpose**: Provide API to plugins and external code\n   * **Returns**: GridBuilderAPI implementation\n   *\n   * **Implementation**: Full API with event system integration\n   */\n  private createAPI(): GridBuilderAPI {\n    return {\n      // ======================\n      // Event Subscriptions\n      // ======================\n\n      on: <T = any,>(eventName: string, callback: (data: T) => void) => {\n        this.eventManagerInstance?.on(eventName, callback);\n      },\n\n      off: <T = any,>(eventName: string, callback: (data: T) => void) => {\n        this.eventManagerInstance?.off(eventName, callback);\n      },\n\n      // ======================\n      // State Access (Read)\n      // ======================\n\n      getState: () => this.stateManager!.state,\n\n      getItems: (canvasId: string) => {\n        return this.stateManager!.state.canvases[canvasId]?.items || [];\n      },\n\n      getItem: (itemId: string) => {\n        // Search across all canvases\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            return item;\n          }\n        }\n        return null;\n      },\n\n      // ======================\n      // Programmatic Operations\n      // ======================\n\n      addComponent: (\n        canvasId: string,\n        componentType: string,\n        position: { x: number; y: number; width: number; height: number },\n        config?: Record<string, any>,\n      ) => {\n        const canvas = this.stateManager!.state.canvases[canvasId];\n        if (!canvas) {\n          console.error(`Canvas not found: ${canvasId}`);\n          return null;\n        }\n\n        // Look up component definition to get proper name\n        const definition = this.componentRegistry.get(componentType);\n        const componentName = definition?.name || componentType;\n\n        // Create new item\n        const newItem = {\n          id: generateItemId(),\n          canvasId,\n          name: componentName,\n          type: componentType,\n          zIndex: ++canvas.zIndexCounter,\n          layouts: {\n            desktop: { ...position },\n            mobile: {\n              x: 0,\n              y: 0,\n              width: 50,\n              height: position.height,\n              customized: false,\n            },\n          },\n          config: config || {},\n        };\n\n        // Add to canvas (immutable update)\n        const newItems = [...canvas.items, newItem];\n        const newCanvas = { ...canvas, items: newItems };\n        const newCanvases = {\n          ...this.stateManager!.state.canvases,\n          [canvasId]: newCanvas,\n        };\n        this.stateManager!.state.canvases = newCanvases;\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(\n          new BatchAddCommand([newItem.id], this.stateManager!.state),\n        );\n\n        // Emit event\n        this.eventManagerInstance?.emit(\"componentAdded\", {\n          item: newItem,\n          canvasId,\n        });\n\n        return newItem.id;\n      },\n\n      deleteComponent: async (itemId: string) => {\n        // Find item and canvas across all canvases\n        let targetCanvasId: string | null = null;\n        let targetItem: GridItem | null = null;\n\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            targetCanvasId = canvasId;\n            targetItem = item;\n            break;\n          }\n        }\n\n        if (!targetCanvasId || !targetItem) {\n          return false;\n        }\n\n        // Call onBeforeDelete hook if provided (for deletion confirmation)\n        if (this.onBeforeDelete) {\n          try {\n            const shouldDelete = await this.onBeforeDelete({\n              item: targetItem,\n              canvasId: targetCanvasId,\n              itemId,\n            });\n\n            if (!shouldDelete) {\n              // Deletion cancelled by hook\n              return false;\n            }\n          } catch (error) {\n            console.error(\"Error in onBeforeDelete hook:\", error);\n            return false;\n          }\n        }\n\n        // Proceed with deletion\n        const canvas = this.stateManager!.state.canvases[targetCanvasId];\n        const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n        if (itemIndex !== -1) {\n          // Add to undo/redo history BEFORE deletion (need state for undo)\n          this.undoRedoManager?.push(\n            new BatchDeleteCommand([itemId], this.stateManager!.state),\n          );\n\n          // Delete item\n          canvas.items.splice(itemIndex, 1);\n          this.stateManager!.state.canvases = {\n            ...this.stateManager!.state.canvases,\n          };\n\n          // Deselect if deleted item was selected\n          if (this.stateManager!.state.selectedItemId === itemId) {\n            this.stateManager!.state.selectedItemId = null;\n            this.stateManager!.state.selectedCanvasId = null;\n          }\n\n          // Emit event\n          this.eventManagerInstance?.emit(\"componentDeleted\", {\n            itemId,\n            canvasId: targetCanvasId,\n          });\n\n          return true;\n        }\n        return false;\n      },\n\n      updateConfig: (itemId: string, config: Record<string, any>) => {\n        // Find and update item across all canvases\n        for (const canvasId in this.stateManager!.state.canvases) {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const itemIndex = canvas.items.findIndex((i) => i.id === itemId);\n          if (itemIndex !== -1) {\n            const item = canvas.items[itemIndex];\n            const newConfig = { ...item.config, ...config };\n\n            // Create undo command BEFORE making changes\n            const batchUpdate = [\n              {\n                itemId,\n                canvasId,\n                updates: { config: newConfig },\n              },\n            ];\n            this.undoRedoManager?.push(\n              new BatchUpdateConfigCommand(\n                batchUpdate,\n                this.stateManager!.state,\n              ),\n            );\n\n            // Merge config\n            canvas.items[itemIndex] = {\n              ...canvas.items[itemIndex],\n              config: newConfig,\n            };\n            this.stateManager!.state.canvases = {\n              ...this.stateManager!.state.canvases,\n            };\n\n            // Emit event\n            this.eventManagerInstance?.emit(\"configChanged\", {\n              itemId,\n              canvasId,\n              config,\n            });\n\n            return true;\n          }\n        }\n        return false;\n      },\n\n      // ======================\n      // Batch Operations\n      // ======================\n\n      addComponentsBatch: (\n        components: {\n          canvasId: string;\n          type: string;\n          position: { x: number; y: number; width: number; height: number };\n          config?: Record<string, any>;\n        }[],\n      ) => {\n        // Convert API format to state-manager format\n        const partialItems = components.map(\n          ({ canvasId, type, position, config }) => {\n            // Look up component definition to get proper name\n            const definition = this.componentRegistry.get(type);\n            const componentName = definition?.name || type;\n\n            return {\n              canvasId,\n              type,\n              name: componentName,\n              layouts: {\n                desktop: { ...position },\n                mobile: {\n                  x: 0,\n                  y: 0,\n                  width: 50,\n                  height: position.height,\n                  customized: false,\n                },\n              },\n              config: config || {},\n            };\n          },\n        );\n\n        // Use state-manager instance method (not global function)\n        const itemIds = this.stateManager!.addItemsBatch(partialItems);\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(\n          new BatchAddCommand(itemIds, this.stateManager!.state),\n        );\n\n        // Emit batch event\n        const createdItems = itemIds\n          .map((id) => {\n            const item = this.api?.getItem(id);\n            return item ? { item, canvasId: item.canvasId } : null;\n          })\n          .filter(Boolean);\n        this.eventManagerInstance?.emit(\"componentsBatchAdded\", {\n          items: createdItems,\n        });\n\n        return itemIds;\n      },\n\n      deleteComponentsBatch: (itemIds: string[]) => {\n        // Store deleted items for event\n        const deletedItems = itemIds\n          .map((itemId) => {\n            const item = this.api?.getItem(itemId);\n            return item ? { itemId, canvasId: item.canvasId } : null;\n          })\n          .filter(Boolean);\n\n        // Add to undo/redo history BEFORE deletion (need state for undo)\n        this.undoRedoManager?.push(\n          new BatchDeleteCommand(itemIds, this.stateManager!.state),\n        );\n\n        // Use state-manager instance method (not global function)\n        this.stateManager!.deleteItemsBatch(itemIds);\n\n        // Clear selection if any deleted item was selected\n        if (\n          this.stateManager!.state.selectedItemId &&\n          itemIds.includes(this.stateManager!.state.selectedItemId)\n        ) {\n          this.stateManager!.state.selectedItemId = null;\n          this.stateManager!.state.selectedCanvasId = null;\n        }\n\n        // Emit batch event\n        this.eventManagerInstance?.emit(\"componentsBatchDeleted\", {\n          items: deletedItems,\n        });\n      },\n\n      updateConfigsBatch: (\n        updates: { itemId: string; config: Record<string, any> }[],\n      ) => {\n        // Convert to state-manager format (need canvasId)\n        const batchUpdates = updates\n          .map(({ itemId, config }) => {\n            const item = this.api?.getItem(itemId);\n            if (!item) {\n              debug.warn(`Item ${itemId} not found for config update`);\n              return null;\n            }\n            return {\n              itemId,\n              canvasId: item.canvasId,\n              updates: { config: { ...item.config, ...config } },\n            };\n          })\n          .filter(Boolean) as {\n          itemId: string;\n          canvasId: string;\n          updates: Partial<any>;\n        }[];\n\n        // Add to undo/redo history\n        this.undoRedoManager?.push(\n          new BatchUpdateConfigCommand(batchUpdates, this.stateManager!.state),\n        );\n\n        // Use state-manager instance method (not global function)\n        this.stateManager!.updateItemsBatch(batchUpdates);\n\n        // Emit batch event\n        const updatedItems = batchUpdates.map(\n          ({ itemId, canvasId, updates }) => ({\n            itemId,\n            canvasId,\n            config: updates.config,\n          }),\n        );\n        this.eventManagerInstance?.emit(\"configsBatchChanged\", {\n          items: updatedItems,\n        });\n      },\n\n      // ======================\n      // Canvas Access\n      // ======================\n\n      getCanvasElement: (canvasId: string) => {\n        return document.getElementById(canvasId);\n      },\n\n      // ======================\n      // Undo/Redo Operations\n      // ======================\n\n      undo: () => {\n        const description = this.undoRedoManager?.undo();\n        // Emit event with structured description (coordinates and dimensions)\n        if (description) {\n          const actionType =\n            typeof description === \"object\" && \"action\" in description\n              ? (description as any).action\n              : \"undo\";\n          this.eventManagerInstance?.emit(\"undoExecuted\", {\n            description,\n            actionType,\n          });\n        }\n      },\n\n      redo: () => {\n        const description = this.undoRedoManager?.redo();\n        // Emit event with structured description (coordinates and dimensions)\n        if (description) {\n          const actionType =\n            typeof description === \"object\" && \"action\" in description\n              ? (description as any).action\n              : \"redo\";\n          this.eventManagerInstance?.emit(\"redoExecuted\", {\n            description,\n            actionType,\n          });\n        }\n      },\n\n      canUndo: () => {\n        return this.undoRedoManager?.canUndo();\n      },\n\n      canRedo: () => {\n        return this.undoRedoManager?.canRedo();\n      },\n\n      undoRedoState,\n\n      // ======================\n      // Canvas Management\n      // ======================\n\n      addCanvas: (canvasId: string) => {\n        // Create command with instance state and event manager\n        const command = new AddCanvasCommand(\n          canvasId,\n          this.stateManager!.state,\n          this.eventManagerInstance,\n        );\n\n        // Add to undo/redo stack\n        this.undoRedoManager?.push(command);\n\n        // Execute the command\n        command.redo();\n\n        // Set newly added canvas as active\n        this.stateManager!.state.activeCanvasId = canvasId;\n        this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n\n        // Scroll to the new canvas after DOM has updated\n        requestAnimationFrame(() => {\n          const canvasElement = this.domCacheInstance?.getCanvas(canvasId);\n          if (canvasElement) {\n            canvasElement.scrollIntoView({\n              behavior: \"smooth\",\n              block: \"center\",\n            });\n          }\n        });\n      },\n\n      removeCanvas: (canvasId: string) => {\n        // Create command with instance state and event manager\n        const command = new RemoveCanvasCommand(\n          canvasId,\n          this.stateManager!.state,\n          this.eventManagerInstance,\n        );\n\n        // Add to undo/redo stack\n        this.undoRedoManager?.push(command);\n\n        // Execute the command\n        command.redo();\n      },\n\n      setActiveCanvas: (canvasId: string) => {\n        this.stateManager!.state.activeCanvasId = canvasId;\n        this.eventManagerInstance?.emit(\"canvasActivated\", { canvasId });\n      },\n\n      getActiveCanvas: () => {\n        return this.stateManager!.state.activeCanvasId;\n      },\n\n      // ======================\n      // Z-Index Management\n      // ======================\n\n      moveItem: (fromCanvasId: string, toCanvasId: string, itemId: string) => {\n        // Find item in source canvas\n        const sourceCanvas = this.stateManager!.state.canvases[fromCanvasId];\n        if (!sourceCanvas) {\n          console.warn(`Source canvas ${fromCanvasId} not found`);\n          return;\n        }\n\n        const item = sourceCanvas.items.find((i) => i.id === itemId);\n        if (!item) {\n          console.warn(`Item ${itemId} not found in canvas ${fromCanvasId}`);\n          return;\n        }\n\n        const sourceIndex = sourceCanvas.items.findIndex(\n          (i) => i.id === itemId,\n        );\n        const sourceZIndex = item.zIndex;\n\n        // Get current viewport to use viewport-specific positions\n        const currentViewport = this.stateManager!.state.currentViewport;\n        const currentLayout = item.layouts[currentViewport];\n\n        const sourcePosition = {\n          x: currentLayout.x,\n          y: currentLayout.y,\n        };\n        const targetPosition = {\n          x: currentLayout.x,\n          y: currentLayout.y,\n        };\n        const mobileLayout = {\n          x: item.layouts.mobile.x,\n          y: item.layouts.mobile.y,\n          width: item.layouts.mobile.width,\n          height: item.layouts.mobile.height,\n          customized: item.layouts.mobile.customized,\n        };\n\n        // Calculate target z-index\n        let targetZIndex = sourceZIndex;\n        if (fromCanvasId !== toCanvasId) {\n          const targetCanvas = this.stateManager!.state.canvases[toCanvasId];\n          if (targetCanvas) {\n            targetZIndex = ++targetCanvas.zIndexCounter;\n          }\n        }\n\n        // Create and execute command (with instance state)\n        const command = new MoveItemCommand(\n          itemId,\n          fromCanvasId,\n          toCanvasId,\n          sourcePosition,\n          targetPosition,\n          sourceIndex,\n          sourceZIndex,\n          targetZIndex,\n          undefined, // sourceSize (not tracked for simple moves)\n          undefined, // targetSize (not tracked for simple moves)\n          this.stateManager!.state, // Pass instance state\n          currentViewport, // Pass active viewport for viewport-specific undo/redo\n          mobileLayout, // Mobile layout (unchanged during API move)\n          mobileLayout, // Mobile layout (unchanged during API move)\n        );\n        command.redo();\n        this.undoRedoManager?.push(command);\n\n        // Emit event\n        this.eventManagerInstance?.emit(\"componentMoved\", {\n          itemId,\n          fromCanvasId,\n          toCanvasId,\n        });\n\n        // Auto-scroll to component if moved to different canvas\n        if (fromCanvasId !== toCanvasId) {\n          // Wait for DOM to update after command execution\n          requestAnimationFrame(() => {\n            const itemElement = document.getElementById(itemId);\n            if (itemElement) {\n              itemElement.scrollIntoView({\n                behavior: \"smooth\",\n                block: \"center\",\n                inline: \"nearest\",\n              });\n            }\n          });\n        }\n      },\n\n      setItemsZIndexBatch: (\n        changes: {\n          itemId: string;\n          canvasId: string;\n          newZIndex: number;\n        }[],\n      ) => {\n        if (changes.length === 0) {\n          return;\n        }\n\n        // Capture old z-index values before making changes\n        const changesWithOldValues = changes\n          .map(({ itemId, canvasId, newZIndex }) => {\n            const canvas = this.stateManager!.state.canvases[canvasId];\n            if (!canvas) {\n              console.warn(\n                `Canvas ${canvasId} not found for item ${itemId}, skipping`,\n              );\n              return null;\n            }\n\n            const item = canvas.items.find((i) => i.id === itemId);\n            if (!item) {\n              console.warn(\n                `Item ${itemId} not found in canvas ${canvasId}, skipping`,\n              );\n              return null;\n            }\n\n            const oldZIndex = item.zIndex;\n\n            // Skip if already at target z-index\n            if (oldZIndex === newZIndex) {\n              return null;\n            }\n\n            return {\n              itemId,\n              canvasId,\n              oldZIndex,\n              newZIndex,\n            };\n          })\n          .filter(Boolean) as {\n          itemId: string;\n          canvasId: string;\n          oldZIndex: number;\n          newZIndex: number;\n        }[];\n\n        // No valid changes after filtering\n        if (changesWithOldValues.length === 0) {\n          return;\n        }\n\n        // Apply all changes to instance state\n        changesWithOldValues.forEach(({ itemId, canvasId, newZIndex }) => {\n          const canvas = this.stateManager!.state.canvases[canvasId];\n          const item = canvas.items.find((i) => i.id === itemId);\n          if (item) {\n            item.zIndex = newZIndex;\n          }\n        });\n\n        // Trigger reactivity (single state update for all changes)\n        this.stateManager!.state.canvases = {\n          ...this.stateManager!.state.canvases,\n        };\n\n        // Create instance-aware undo/redo command using ChangeZIndexCommand\n        const command = new ChangeZIndexCommand(\n          changesWithOldValues,\n          this.eventManagerInstance!,\n          this.stateManager!.state,\n        );\n\n        this.undoRedoManager?.push(command);\n\n        // Emit batch event\n        this.eventManagerInstance?.emit(\"zIndexBatchChanged\", {\n          changes: changesWithOldValues,\n        });\n      },\n\n      // ======================\n      // Custom Command Support\n      // ======================\n\n      pushCommand: (command: any) => {\n        this.undoRedoManager?.push(command);\n      },\n\n      // ======================\n      // Component Registry Management\n      // ======================\n\n      registerComponent: (definition: ComponentDefinition) => {\n        // Validate definition\n        if (!definition.type || typeof definition.type !== \"string\") {\n          console.error(\n            \"registerComponent: Component definition must have a valid type string\",\n          );\n          return;\n        }\n\n        // Register the new component\n        // The registry's onChange listeners will automatically notify subscribers (like component-palette)\n        this.componentRegistry.register(definition);\n\n        debug.log(`âœ… Registered component: ${definition.type}`, {\n          name: definition.name,\n          icon: definition.icon,\n          totalComponents: this.componentRegistry.size(),\n        });\n\n        // Emit event for plugins\n        this.eventManagerInstance?.emit(\"componentRegistered\", {\n          type: definition.type,\n          name: definition.name,\n        });\n      },\n\n      getComponents: () => {\n        return this.componentRegistry.getAll();\n      },\n    };\n  }\n\n  /**\n   * Apply theme via CSS variables\n   *\n   * **Purpose**: Apply theme customization to host element\n   * **Implementation**: Set CSS custom properties on :host\n   */\n  private applyTheme(theme: GridBuilderTheme) {\n    const host = this.el;\n    if (!host) return;\n\n    // Apply predefined theme properties\n    if (theme.primaryColor) {\n      host.style.setProperty(\n        \"--grid-builder-primary-color\",\n        theme.primaryColor,\n      );\n    }\n    if (theme.paletteBackground) {\n      host.style.setProperty(\n        \"--grid-builder-palette-bg\",\n        theme.paletteBackground,\n      );\n    }\n    if (theme.canvasBackground) {\n      host.style.setProperty(\n        \"--grid-builder-canvas-bg\",\n        theme.canvasBackground,\n      );\n    }\n    if (theme.gridLineColor) {\n      host.style.setProperty(\n        \"--grid-builder-grid-line-color\",\n        theme.gridLineColor,\n      );\n    }\n    if (theme.selectionColor) {\n      host.style.setProperty(\n        \"--grid-builder-selection-color\",\n        theme.selectionColor,\n      );\n    }\n    if (theme.resizeHandleColor) {\n      host.style.setProperty(\n        \"--grid-builder-resize-handle-color\",\n        theme.resizeHandleColor,\n      );\n    }\n    if (theme.fontFamily) {\n      host.style.setProperty(\"--grid-builder-font-family\", theme.fontFamily);\n    }\n\n    // Apply custom properties\n    if (theme.customProperties) {\n      Object.entries(theme.customProperties).forEach(([key, value]) => {\n        host.style.setProperty(key, value);\n      });\n    }\n  }\n\n  /**\n   * Setup ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window viewport)\n   *\n   * **Observer callback**:\n   * 1. Get container width from ResizeObserver entry\n   * 2. Determine target viewport (mobile if < 768px, desktop otherwise)\n   * 3. Update this.stateManager!.state.currentViewport if changed\n   *\n   * **Why container-based**:\n   * - More flexible than window.resize (e.g., sidebar layouts, embedded widgets)\n   * - Grid-builder can be embedded at any size\n   * - Multiple instances can have different viewports on same page\n   *\n   * **Debouncing**: Not needed - ResizeObserver is already efficient\n   */\n  private setupViewportResizeObserver = () => {\n    if (!this.hostElement) {\n      return;\n    }\n\n    // Watch for grid-builder container size changes\n    this.viewportResizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Get container width directly from the element\n        // Note: We use offsetWidth instead of entry.contentRect.width because\n        // the grid-builder uses Shadow DOM and contentRect can return 0 for elements with height: 100%\n        const width =\n          this.hostElement.offsetWidth ||\n          entry.borderBoxSize?.[0]?.inlineSize ||\n          entry.contentRect.width;\n\n        // Skip viewport switching if width is 0 or very small (container not yet laid out)\n        // This prevents premature switching to mobile before CSS layout is complete\n        if (width < 100) {\n          debug.log(\n            `ðŸ“± Skipping viewport switch - container not yet laid out (width: ${Math.round(width)}px)`,\n          );\n          return;\n        }\n\n        // Determine target viewport based on container width\n        const targetViewport = width < 768 ? \"mobile\" : \"desktop\";\n\n        // Only update if viewport changed\n        if (this.stateManager!.state.currentViewport !== targetViewport) {\n          debug.log(\n            `ðŸ“± Container-based viewport switch: ${this.stateManager!.state.currentViewport} â†’ ${targetViewport} (width: ${Math.round(width)}px)`,\n          );\n          this.stateManager!.state.currentViewport = targetViewport;\n        }\n      }\n    });\n\n    this.viewportResizeObserver.observe(this.hostElement);\n  };\n\n  /**\n   * Setup screen reader announcements for dynamic changes\n   *\n   * **Purpose**: Subscribe to events and announce changes via ARIA live region\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Subscribes to**:\n   * - componentAdded: \"Component added to canvas\"\n   * - componentDeleted: \"Component deleted\"\n   * - componentMoved: \"Component moved to new canvas\"\n   * - undoExecuted: \"Undo action performed\"\n   * - redoExecuted: \"Redo action performed\"\n   * - canvasActivated: \"Canvas activated\"\n   *\n   * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n   */\n  private setupScreenReaderAnnouncements = () => {\n    // Component added\n    this.eventManagerInstance?.on(\n      \"componentAdded\",\n      (data: ComponentAddedEvent) => {\n        const definition = this.componentRegistry.get(data.item.type);\n        const componentName = definition?.name || data.item.type;\n        this.announce(`${componentName} component added to canvas`);\n      },\n    );\n\n    // Component deleted\n    this.eventManagerInstance?.on(\n      \"componentDeleted\",\n      (_data: ComponentDeletedEvent) => {\n        this.announce(`Component deleted`);\n      },\n    );\n\n    // Component moved (cross-canvas)\n    this.eventManagerInstance?.on(\n      \"componentMoved\",\n      (_data: ComponentMovedEvent) => {\n        this.announce(`Component moved to new canvas`);\n      },\n    );\n\n    // Undo/Redo with focus management\n    this.eventManagerInstance?.on(\"undoExecuted\", () => {\n      this.announce(`Undo action performed`);\n\n      // Restore focus to selected item after undo (if any)\n      this.restoreFocusToSelection();\n    });\n\n    this.eventManagerInstance?.on(\"redoExecuted\", () => {\n      this.announce(`Redo action performed`);\n\n      // Restore focus to selected item after redo (if any)\n      this.restoreFocusToSelection();\n    });\n\n    // Canvas activated\n    this.eventManagerInstance?.on(\n      \"canvasActivated\",\n      (data: CanvasActivatedEvent) => {\n        const metadata = this.canvasMetadata?.[data.canvasId];\n        const canvasTitle = metadata?.title || data.canvasId;\n        this.announce(`${canvasTitle} canvas activated`);\n      },\n    );\n  };\n\n  /**\n   * Announce message to screen readers via ARIA live region\n   *\n   * **Purpose**: Update announcement state for screen reader users\n   * **Non-visual**: Only affects screen readers, no visual impact\n   *\n   * **Implementation**:\n   * - Updates @State() announcement property\n   * - Triggers re-render of ARIA live region\n   * - Screen reader automatically announces new content\n   * - Clears announcement after 100ms (prevents repeat announcements)\n   *\n   * **WCAG Compliance**: 4.1.3 Status Messages (Level AA)\n   * @param message - Message to announce to screen reader users\n   */\n  private announce = (message: string) => {\n    this.announcement = message;\n\n    // Clear announcement after brief delay to allow re-announcing same message\n    setTimeout(() => {\n      this.announcement = \"\";\n    }, 100);\n  };\n\n  /**\n   * Move focus to next logical item after deletion\n   *\n   * **Purpose**: Improve keyboard navigation by maintaining focus context after deletion\n   * **Non-visual**: Uses programmatic focus, no visual changes\n   *\n   * **Focus strategy**:\n   * 1. Try to focus the next item in the same canvas (by y position, then x)\n   * 2. If no next item, try to focus the previous item\n   * 3. If no items left in canvas, focus the canvas container\n   * 4. If canvas not found, focus the component palette\n   *\n   * **WCAG Compliance**: 2.4.3 Focus Order (Level A)\n   * @param canvasId - Canvas that contained the deleted item\n   * @param _deletedItemId - ID of the item that was deleted (unused, for documentation)\n   */\n  private moveFocusAfterDeletion = (\n    canvasId: string,\n    _deletedItemId: string,\n  ) => {\n    // Get the canvas that contained the deleted item\n    const canvas = this.stateManager!.state.canvases[canvasId];\n    if (!canvas) {\n      debug.log(\"âŒ¨ï¸ Focus: Canvas not found, focusing palette\");\n      // Focus the component palette as fallback\n      const paletteElement = this.hostElement.querySelector(\n        \"component-palette\",\n      ) as HTMLElement;\n      if (paletteElement) {\n        paletteElement.focus();\n      }\n      return;\n    }\n\n    // Get remaining items in the canvas\n    const remainingItems = canvas.items;\n\n    if (remainingItems.length === 0) {\n      debug.log(\"âŒ¨ï¸ Focus: No items left, focusing canvas\");\n      // No items left in canvas - focus the canvas container\n      const canvasElement = this.hostElement.querySelector(\n        `canvas-section[canvas-id=\"${canvasId}\"]`,\n      ) as HTMLElement;\n      if (canvasElement) {\n        canvasElement.focus();\n      } else {\n        // Fallback to component palette\n        const paletteElement = this.hostElement.querySelector(\n          \"component-palette\",\n        ) as HTMLElement;\n        if (paletteElement) {\n          paletteElement.focus();\n        }\n      }\n      return;\n    }\n\n    // Sort items by position (top-to-bottom, left-to-right) to find next logical item\n    const sortedItems = [...remainingItems].sort((a, b) => {\n      const aLayout = a.layouts.desktop;\n      const bLayout = b.layouts.desktop;\n\n      // Sort by y position first (top to bottom)\n      if (aLayout.y !== bLayout.y) {\n        return aLayout.y - bLayout.y;\n      }\n\n      // If same y, sort by x position (left to right)\n      return aLayout.x - bLayout.x;\n    });\n\n    // Focus the first item in the sorted list\n    const nextItem = sortedItems[0];\n    debug.log(\"âŒ¨ï¸ Focus: Focusing next item\", {\n      itemId: nextItem.id,\n      position: {\n        x: nextItem.layouts.desktop.x,\n        y: nextItem.layouts.desktop.y,\n      },\n    });\n\n    // Find the DOM element for the next item\n    const nextItemElement = this.hostElement.querySelector(\n      `#${nextItem.id}`,\n    ) as HTMLElement;\n    if (nextItemElement) {\n      // Focus the item element\n      nextItemElement.focus();\n\n      // Also select it in the state\n      this.stateManager!.state.selectedItemId = nextItem.id;\n      this.stateManager!.state.selectedCanvasId = nextItem.canvasId;\n    }\n  };\n\n  /**\n   * Restore focus to currently selected item (for undo/redo)\n   *\n   * **Purpose**: Maintain focus context after undo/redo operations\n   * **Non-visual**: Uses programmatic focus, no visual changes\n   *\n   * **Implementation**:\n   * - Check if an item is selected in state\n   * - Find the DOM element for that item\n   * - Focus it programmatically\n   * - Use setTimeout to ensure DOM has updated after state change\n   *\n   * **WCAG Compliance**: 2.4.3 Focus Order (Level A)\n   */\n  private restoreFocusToSelection = () => {\n    // Wait for DOM to update after state change\n    setTimeout(() => {\n      if (this.stateManager!.state.selectedItemId) {\n        debug.log(\"âŒ¨ï¸ Focus: Restoring focus to selected item\", {\n          itemId: this.stateManager!.state.selectedItemId,\n        });\n\n        const selectedElement = this.hostElement.querySelector(\n          `#${this.stateManager!.state.selectedItemId}`,\n        ) as HTMLElement;\n\n        if (selectedElement) {\n          selectedElement.focus();\n        }\n      }\n    }, 10);\n  };\n\n  /**\n   * Export current state to JSON-serializable format\n   *\n   * **Purpose**: Export grid layout for saving or transferring to viewer app\n   *\n   * **Use Cases**:\n   * - Save layout to database/localStorage\n   * - Transfer layout to viewer app via API\n   * - Create layout templates/presets\n   * - Backup/restore functionality\n   *\n   * **Example - Save to API**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const exportData = await builder.exportState();\n   * await fetch('/api/layouts', {\n   * method: 'POST',\n   * headers: { 'Content-Type': 'application/json' },\n   * body: JSON.stringify(exportData)\n   * });\n   * ```\n   *\n   * **Example - Save to localStorage**:\n   * ```typescript\n   * const exportData = await builder.exportState();\n   * localStorage.setItem('grid-layout', JSON.stringify(exportData));\n   * ```\n   * @returns Promise<GridExport> - JSON-serializable export object\n   */\n  @Method()\n  async exportState(): Promise<GridExport> {\n    // Build export data from current gridState\n    const exportData: GridExport = {\n      version: \"1.0.0\",\n      canvases: {},\n      viewport: this.stateManager!.state.currentViewport,\n      metadata: {\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      },\n    };\n\n    // Export each canvas with its items\n    for (const canvasId in this.stateManager!.state.canvases) {\n      const canvas = this.stateManager!.state.canvases[canvasId];\n\n      exportData.canvases[canvasId] = {\n        items: canvas.items.map((item) => ({\n          id: item.id,\n          canvasId: item.canvasId,\n          type: item.type,\n          name: item.name,\n          layouts: {\n            desktop: { ...item.layouts.desktop },\n            mobile: { ...item.layouts.mobile },\n          },\n          zIndex: item.zIndex,\n          config: { ...item.config }, // Deep copy to avoid mutations\n        })),\n      };\n    }\n\n    return exportData;\n  }\n\n  /**\n   * Import state from JSON-serializable format\n   *\n   * **Purpose**: Restore previously exported grid state\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const savedState = JSON.parse(localStorage.getItem('grid-layout'));\n   * await builder.importState(savedState);\n   * ```\n   * @param state - GridExport or partial GridState object\n   */\n  @Method()\n  async importState(state: Partial<GridState> | GridExport) {\n    // Import grid state\n    Object.assign(this.stateManager!.state, state);\n  }\n\n  /**\n   * Get current grid state\n   *\n   * **Purpose**: Direct access to grid state for reading\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const state = await builder.getState();\n   * console.log('Current viewport:', state.currentViewport);\n   * ```\n   * @returns Promise<GridState> - Current grid state\n   */\n  @Method()\n  async getState(): Promise<GridState> {\n    return this.stateManager!.state;\n  }\n\n  /**\n   * Add a new canvas programmatically\n   *\n   * **Purpose**: Create new section/canvas in the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.addCanvas('new-section');\n   * ```\n   * @param canvasId - Unique canvas identifier\n   */\n  @Method()\n  async addCanvas(canvasId: string) {\n    this.api?.addCanvas(canvasId);\n  }\n\n  /**\n   * Remove a canvas programmatically\n   *\n   * **Purpose**: Delete section/canvas from the grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.removeCanvas('old-section');\n   * ```\n   * @param canvasId - Canvas identifier to remove\n   */\n  @Method()\n  async removeCanvas(canvasId: string) {\n    this.api?.removeCanvas(canvasId);\n  }\n\n  /**\n   * Set active canvas programmatically\n   *\n   * **Purpose**: Activate a specific canvas for focused editing\n   *\n   * **Use cases**:\n   * - Focus specific section after adding items\n   * - Programmatic navigation between sections\n   * - Show canvas-specific settings panel\n   *\n   * **Events triggered**: 'canvasActivated'\n   * @param canvasId - Canvas to activate\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.setActiveCanvas('canvas2');\n   * ```\n   */\n  @Method()\n  async setActiveCanvas(canvasId: string) {\n    this.api?.setActiveCanvas(canvasId);\n  }\n\n  /**\n   * Get currently active canvas ID\n   *\n   * **Purpose**: Check which canvas is currently active/focused\n   * @returns Promise<string | null> - Active canvas ID or null if none active\n   * @example\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const activeId = await builder.getActiveCanvas();\n   * if (activeId === 'canvas1') {\n   *   console.log('Canvas 1 is active');\n   * }\n   * ```\n   */\n  @Method()\n  async getActiveCanvas(): Promise<string | null> {\n    return this.api?.getActiveCanvas() || null;\n  }\n\n  /**\n   * Undo last action\n   *\n   * **Purpose**: Revert last user action (move, resize, add, delete, etc.)\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.undo();\n   * ```\n   */\n  @Method()\n  async undo() {\n    this.api?.undo();\n  }\n\n  /**\n   * Redo last undone action\n   *\n   * **Purpose**: Re-apply last undone action\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * await builder.redo();\n   * ```\n   */\n  @Method()\n  async redo() {\n    this.api?.redo();\n  }\n\n  /**\n   * Check if undo is available\n   *\n   * **Purpose**: Determine if there are actions to undo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canUndo = await builder.canUndo();\n   * undoButton.disabled = !canUndo;\n   * ```\n   * @returns Promise<boolean> - True if undo is available\n   */\n  @Method()\n  async canUndo(): Promise<boolean> {\n    return this.api?.canUndo() || false;\n  }\n\n  /**\n   * Check if redo is available\n   *\n   * **Purpose**: Determine if there are actions to redo\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const canRedo = await builder.canRedo();\n   * redoButton.disabled = !canRedo;\n   * ```\n   * @returns Promise<boolean> - True if redo is available\n   */\n  @Method()\n  async canRedo(): Promise<boolean> {\n    return this.api?.canRedo() || false;\n  }\n\n  /**\n   * Add a component programmatically\n   *\n   * **Purpose**: Add new component to canvas without dragging from palette\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const itemId = await builder.addComponent('canvas1', 'header', {\n   * x: 10, y: 10, width: 30, height: 6\n   * }, { title: 'My Header' });\n   * ```\n   * @param canvasId - Canvas to add component to\n   * @param componentType - Component type from registry\n   * @param position - Grid position and size\n   * @param config - Optional component configuration\n   * @returns Promise<string | null> - New item ID or null if failed\n   */\n  @Method()\n  async addComponent(\n    canvasId: string,\n    componentType: string,\n    position: { x: number; y: number; width: number; height: number },\n    config?: Record<string, any>,\n  ): Promise<string | null> {\n    return (\n      this.api?.addComponent(canvasId, componentType, position, config) || null\n    );\n  }\n\n  /**\n   * Delete a component programmatically\n   *\n   * **Purpose**: Remove component from grid\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.deleteComponent('item-123');\n   * ```\n   * @param itemId - Item ID to delete\n   * @returns Promise<boolean> - True if deleted successfully\n   */\n  @Method()\n  async deleteComponent(itemId: string): Promise<boolean> {\n    return this.api?.deleteComponent(itemId) || false;\n  }\n\n  /**\n   * Update component configuration\n   *\n   * **Purpose**: Update component properties/config\n   *\n   * **Example**:\n   * ```typescript\n   * const builder = document.querySelector('grid-builder');\n   * const success = await builder.updateConfig('item-123', {\n   * title: 'Updated Title',\n   * color: '#ff0000'\n   * });\n   * ```\n   * @param itemId - Item ID to update\n   * @param config - Configuration updates\n   * @returns Promise<boolean> - True if updated successfully\n   */\n  @Method()\n  async updateConfig(\n    itemId: string,\n    config: Record<string, any>,\n  ): Promise<boolean> {\n    return this.api?.updateConfig(itemId, config) || false;\n  }\n\n  /**\n   * Reference to host element\n   */\n  private el?: HTMLElement;\n\n  /**\n   * Render component template\n   *\n   * **Purpose**: Render main UI structure\n   *\n   * **Structure**:\n   * - Host element with theme classes\n   * - Component palette (sidebar or custom)\n   * - Canvas area with sections\n   *\n   * **Note**: Actual rendering delegates to child components:\n   * - <component-palette> or custom ComponentPalette\n   * - <canvas-section> for each canvas\n   *\n   * **Config Panel**: Users should implement their own config panels\n   * - See custom-config-panel in demo for reference implementation\n   * - Listen to 'item-click' events to show your config UI\n   */\n  render() {\n    const canvasIds = Object.keys(this.stateManager!.state.canvases);\n\n    // Merge instanceId into config for child components (avoids mutating prop)\n    const configWithInstance = this.config\n      ? { ...this.config, instanceId: this.instanceId }\n      : { instanceId: this.instanceId };\n\n    return (\n      <Host ref={(el) => (this.el = el)}>\n        {/* ARIA Live Region for Screen Reader Announcements */}\n        <div\n          class=\"sr-only\"\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-atomic=\"true\"\n        >\n          {this.announcement}\n        </div>\n\n        <div\n          class=\"grid-builder-container\"\n          role=\"application\"\n          aria-label=\"Grid builder\"\n        >\n          {/* Canvas Area */}\n          <div class=\"canvas-area\">\n            {/* Canvases */}\n            <div class=\"canvases-container\">\n              {canvasIds.map((canvasId) => {\n                const isActive =\n                  this.stateManager!.state.activeCanvasId === canvasId;\n                const metadata = this.canvasMetadata?.[canvasId] || {};\n\n                // Render custom canvas header if provided\n                const headerElement = this.uiOverrides?.CanvasHeader?.({\n                  canvasId,\n                  metadata,\n                  isActive,\n                });\n\n                // Handle both vNode and HTMLElement returns\n                const headerContent =\n                  headerElement instanceof HTMLElement ? (\n                    <div\n                      ref={(el) => {\n                        if (el) {\n                          // Clear existing children to allow updates when active state changes\n                          el.innerHTML = \"\";\n                          el.appendChild(headerElement);\n                        }\n                      }}\n                    />\n                  ) : (\n                    headerElement\n                  );\n\n                return (\n                  <div key={canvasId} class=\"canvas-wrapper\">\n                    {headerContent}\n                    <canvas-section\n                      canvasId={canvasId}\n                      isActive={isActive}\n                      config={configWithInstance}\n                      componentRegistry={this.componentRegistry}\n                      backgroundColor={metadata.backgroundColor}\n                      canvasTitle={metadata.title}\n                      onBeforeDelete={this.onBeforeDelete}\n                      virtualRendererInstance={this.virtualRendererInstance}\n                      eventManagerInstance={this.eventManagerInstance}\n                      undoRedoManagerInstance={this.undoRedoManager}\n                      stateInstance={this.stateManager!.state}\n                      onStateChange={(key: string, callback: Function) =>\n                        this.stateManager!.onChange(key, callback)\n                      }\n                      domCacheInstance={this.domCacheInstance}\n                      theme={this.theme}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n","/**\n * Grid Viewer Styles\n * ===================\n *\n * Simplified styling for rendering-only grid viewer.\n * Based on grid-builder styles but without editing UI (palette, config panel).\n *\n * ## Key Differences from grid-builder.scss\n *\n * **Excluded**:\n * - âŒ Palette area styles (no component palette)\n * - âŒ Config panel styles (no configuration editing)\n * - âŒ Selection styles (no item selection)\n * - âŒ Resize handle styles (no resizing)\n *\n * **Included**:\n * - âœ… Canvas area layout\n * - âœ… Responsive container\n * - âœ… Theme variables\n *\n * @module grid-viewer-styles\n */\n\n/**\n * CSS Custom Properties (Theme Variables)\n *\n * **Default theme**: Bootstrap-inspired blue\n * **Overridable**: Via theme prop\n */\n:host {\n  // Color scheme\n  --grid-viewer-primary-color: #007bff;\n  --grid-viewer-canvas-bg: #ffffff;\n  --grid-viewer-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n\n  // Layout\n  display: block;\n  width: 100%;\n  height: 100%;\n  font-family: var(--grid-viewer-font-family);\n}\n\n/**\n * Main Container\n *\n * **Layout**: Full width/height for embedding\n * **Simplified**: No grid layout (only canvas area)\n */\n.grid-viewer-container {\n  width: 100%;\n  height: 100%;\n  background: var(--grid-viewer-canvas-bg);\n  overflow: auto;\n}\n\n/**\n * Canvas Area\n *\n * **Layout**: Full width/height (no palette or config panel)\n * **Scrolling**: Vertical scroll for multiple canvases\n */\n.canvas-area {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n/**\n * Canvases Container\n *\n * **Layout**: Vertical stack of canvas sections\n * **Spacing**: Gap between canvases\n */\n.canvases-container {\n  display: flex;\n  flex-direction: column;\n  gap: 0; // No gap - canvases stack seamlessly\n  width: 100%;\n  min-height: 100%;\n}\n","/**\n * Grid Viewer - Rendering-Only Component\n * ========================================\n *\n * Lightweight component for rendering grid layouts without editing functionality.\n * Designed to be used in viewer apps where layouts are created in grid-builder\n * and displayed in grid-viewer.\n *\n * ## Design Philosophy\n *\n * **Separation of concerns**:\n * - Builder app: grid-builder with full editing (~150KB with interact.js)\n * - Viewer app: grid-viewer for display only (~30KB, 80% smaller)\n * - Same component definitions, different rendering modes\n *\n * **Export/Import workflow**:\n * ```typescript\n * // Builder App â†’ Export layout\n * const builder = document.querySelector('grid-builder');\n * const exportData = await builder.exportState();\n * await saveToAPI(exportData);\n *\n * // Viewer App â†’ Import and display layout\n * const layout = await loadFromAPI();\n * const viewer = document.querySelector('grid-viewer');\n * viewer.initialState = layout;\n * ```\n *\n * ## What's Excluded from Viewer\n *\n * **No editing features**:\n * - âŒ No drag-and-drop (no interact.js)\n * - âŒ No component palette\n * - âŒ No config panel\n * - âŒ No item selection\n * - âŒ No resize handles\n * - âŒ No undo/redo\n *\n * **Only rendering features**:\n * - âœ… Responsive layouts (desktop/mobile)\n * - âœ… Container-based viewport switching\n * - âœ… Virtual rendering for performance\n * - âœ… Theme customization\n * - âœ… Component registry for dynamic rendering\n *\n * ## Bundle Size Impact\n *\n * **Builder**: ~150KB (includes interact.js ~45KB)\n * **Viewer**: ~30KB (no interact.js, no editing logic)\n * **Reduction**: 80% smaller bundle\n * @module grid-viewer\n */\n\nimport { Component, Element, h, Host, Prop, State, Watch } from \"@stencil/core\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { GridBuilderTheme } from \"../../types/theme\";\nimport { ComponentRegistry } from \"../../services/component-registry\";\nimport { GridExport } from \"../../types/grid-export\";\n\n// Service imports - only rendering-related, no editing\nimport { ViewerState } from \"../../services/state-manager\";\nimport { createStore } from \"@stencil/store\";\nimport { createDebugLogger } from \"../../utils/debug\";\nimport { VirtualRendererService } from \"../../services/virtual-renderer\";\n\nconst debug = createDebugLogger(\"grid-viewer\");\n\n/**\n * GridViewer Component\n * ====================\n *\n * Rendering-only grid component for displaying layouts created in grid-builder.\n *\n * **Tag**: `<grid-viewer>`\n * **Shadow DOM**: Disabled (consistent with grid-builder)\n * **Reactivity**: Uses local store for viewer state\n *\n * **Key differences from grid-builder**:\n * - No interact.js dependency (80% bundle size reduction)\n * - No palette, config panel, or editing UI\n * - Simplified state (no selection, no z-index tracking)\n * - Rendering-only canvas sections\n */\n@Component({\n  tag: \"grid-viewer\",\n  styleUrl: \"grid-viewer.scss\",\n  shadow: false, // Light DOM for consistency with grid-builder\n})\nexport class GridViewer {\n  /**\n   * Component definitions registry\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Purpose**: Defines how to render each component type\n   *\n   * **Must match builder definitions**: Same component types as used in builder\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     render: ({ itemId, config }) => (\n   *       <my-header itemId={itemId} config={config} />\n   *     )\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Grid system configuration\n   * **Default**: Standard 2% grid with 10px-50px constraints\n   *\n   * **Should match builder config**: Use same config as builder for consistent rendering\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Visual theme customization\n   *\n   * **Optional prop**: Customizes colors, fonts, and styling\n   * **Default**: Bootstrap-inspired blue theme\n   */\n  @Prop() theme?: GridBuilderTheme;\n\n  /**\n   * Initial state to display\n   *\n   * **Optional prop**: Layout data to render\n   * **Accepts**: ViewerState or GridExport (both compatible)\n   *\n   * **From builder export**:\n   * ```typescript\n   * const exportData = await builder.exportState();\n   * viewer.initialState = exportData; // Type-safe!\n   * ```\n   *\n   * **From API**:\n   * ```typescript\n   * const layout = await fetch('/api/layouts/123').then(r => r.json());\n   * viewer.initialState = layout;\n   * ```\n   */\n  @Prop() initialState?: Partial<ViewerState> | GridExport;\n\n  /**\n   * Canvas metadata storage (host app responsibility)\n   *\n   * **Optional prop**: Store canvas-level presentation metadata\n   * **Purpose**: Host app owns canvas metadata (titles, colors, settings)\n   *\n   * **Structure**: Record<canvasId, any>\n   *\n   * **Example**:\n   * ```typescript\n   * const canvasMetadata = {\n   *   'hero-section': {\n   *     backgroundColor: '#f0f4f8',\n   *     customSettings: { ... }\n   *   }\n   * };\n   * ```\n   */\n  @Prop() canvasMetadata?: Record<string, any>;\n\n  /**\n   * Component registry (internal state)\n   *\n   * **Purpose**: Map component type â†’ definition for lookup\n   * **Built from**: components prop\n   */\n  @State() private componentRegistry: ComponentRegistry =\n    new ComponentRegistry();\n\n  /**\n   * Local viewer state store\n   *\n   * **Purpose**: Minimal state for rendering (no editing state)\n   * **Structure**: ViewerState with canvases and currentViewport\n   */\n  private viewerState!: { state: ViewerState };\n\n  /**\n   * Host element reference\n   */\n  @Element() private hostElement!: HTMLElement;\n\n  /**\n   * ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window width)\n   */\n  private viewportResizeObserver?: ResizeObserver;\n\n  /**\n   * Virtual renderer service instance (passed from grid-builder)\n   *\n   * **Optional**: Created if config.enableVirtualRendering !== false\n   * **Purpose**: Lazy loading of grid items for better performance with large layouts\n   */\n  private virtualRendererInstance?: VirtualRendererService;\n\n  /**\n   * Component will load lifecycle\n   *\n   * **Purpose**: Initialize component registry and viewer state\n   */\n  componentWillLoad() {\n    // Validate required props\n    if (!this.components || this.components.length === 0) {\n      console.error(\"GridViewer: components prop is required\");\n      return;\n    }\n\n    // Build component registry\n    this.componentRegistry = new ComponentRegistry(this.components);\n\n    // Validate unique component types\n    if (this.componentRegistry.size() !== this.components.length) {\n      debug.warn(\"GridViewer: Duplicate component types detected\");\n    }\n\n    // Initialize local viewer state store with editing-only fields set to null\n    // This allows grid-item-wrapper to access these fields without defensive guards\n    // while maintaining viewer mode as display-only (no actual selection/editing)\n    const initialViewerState: ViewerState = {\n      canvases: {},\n      currentViewport: \"desktop\",\n      selectedItemId: null, // Always null in viewer mode (no selection)\n      selectedCanvasId: null, // Always null in viewer mode (no selection)\n      activeCanvasId: null, // Always null in viewer mode (no active canvas)\n    };\n\n    // Restore initial state if provided\n    if (this.initialState) {\n      // Handle both ViewerState and GridExport formats\n      if (\"viewport\" in this.initialState) {\n        // GridExport format\n        initialViewerState.currentViewport = this.initialState.viewport;\n        initialViewerState.canvases = this.initialState.canvases as Record<\n          string,\n          any\n        >;\n      } else {\n        // ViewerState format\n        Object.assign(initialViewerState, this.initialState);\n      }\n    }\n\n    // Create local store (not global like grid-builder)\n    this.viewerState = createStore<ViewerState>(initialViewerState);\n\n    // Create virtual renderer if enabled (Performance for large layouts)\n    if (this.config?.enableVirtualRendering !== false) {\n      this.virtualRendererInstance = new VirtualRendererService();\n    }\n  }\n\n  /**\n   * Component did load lifecycle\n   *\n   * **Purpose**: Apply theme and setup viewport switching\n   */\n  componentDidLoad() {\n    // Apply theme\n    if (this.theme) {\n      this.applyTheme(this.theme);\n    }\n\n    // Setup container-based viewport switching\n    this.setupViewportResizeObserver();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Purpose**: Clean up ResizeObserver\n   */\n  disconnectedCallback() {\n    // Cleanup ResizeObserver\n    if (this.viewportResizeObserver) {\n      this.viewportResizeObserver.disconnect();\n    }\n  }\n\n  /**\n   * Watch components prop for changes\n   *\n   * **Purpose**: Rebuild component registry when components prop changes\n   */\n  @Watch(\"components\")\n  handleComponentsChange(newComponents: ComponentDefinition[]) {\n    this.componentRegistry = new ComponentRegistry(newComponents);\n  }\n\n  /**\n   * Watch initialState prop for changes\n   *\n   * **Purpose**: Update viewer state when initialState prop changes\n   */\n  @Watch(\"initialState\")\n  handleInitialStateChange(newState: Partial<ViewerState> | GridExport) {\n    if (newState) {\n      // Handle both ViewerState and GridExport formats\n      if (\"viewport\" in newState) {\n        // GridExport format\n        this.viewerState.state.currentViewport = newState.viewport;\n        this.viewerState.state.canvases = newState.canvases as Record<\n          string,\n          any\n        >;\n      } else {\n        // ViewerState format\n        Object.assign(this.viewerState.state, newState);\n      }\n    }\n  }\n\n  /**\n   * Apply theme via CSS variables\n   *\n   * **Purpose**: Apply theme customization to host element\n   * **Implementation**: Set CSS custom properties on :host\n   */\n  private applyTheme(theme: GridBuilderTheme) {\n    const host = this.el;\n    if (!host) return;\n\n    // Apply predefined theme properties\n    if (theme.primaryColor) {\n      host.style.setProperty(\"--grid-viewer-primary-color\", theme.primaryColor);\n    }\n    if (theme.canvasBackground) {\n      host.style.setProperty(\"--grid-viewer-canvas-bg\", theme.canvasBackground);\n    }\n    if (theme.fontFamily) {\n      host.style.setProperty(\"--grid-viewer-font-family\", theme.fontFamily);\n    }\n\n    // Apply custom properties\n    if (theme.customProperties) {\n      Object.entries(theme.customProperties).forEach(([key, value]) => {\n        host.style.setProperty(key, value);\n      });\n    }\n  }\n\n  /**\n   * Setup ResizeObserver for container-based viewport switching\n   *\n   * **Purpose**: Automatically switch between desktop/mobile viewports based on container width\n   * **Breakpoint**: 768px (container width, not window viewport)\n   *\n   * **Reused from grid-builder**: Same implementation for consistency\n   */\n  private setupViewportResizeObserver = () => {\n    if (!this.hostElement) {\n      return;\n    }\n\n    // Watch for grid-viewer container size changes\n    this.viewportResizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Get container width directly from the element\n        // Note: We use offsetWidth instead of entry.contentRect.width because\n        // the grid-viewer uses Light DOM and contentRect returns 0 for elements with height: 100%\n        const width =\n          this.hostElement.offsetWidth ||\n          entry.borderBoxSize?.[0]?.inlineSize ||\n          entry.contentRect.width;\n\n        // Skip viewport switching if width is 0 or very small (container not yet laid out)\n        // This prevents premature switching to mobile before CSS layout is complete\n        if (width < 100) {\n          debug.log(\n            `ðŸ“± [Viewer] Skipping viewport switch - container not yet laid out (width: ${Math.round(width)}px)`,\n          );\n          return;\n        }\n\n        // Determine target viewport based on container width\n        const targetViewport = width < 768 ? \"mobile\" : \"desktop\";\n\n        // Only update if viewport changed\n        if (this.viewerState.state.currentViewport !== targetViewport) {\n          debug.log(\n            `ðŸ“± [Viewer] Container-based viewport switch: ${this.viewerState.state.currentViewport} â†’ ${targetViewport} (width: ${Math.round(width)}px)`,\n          );\n          this.viewerState.state.currentViewport = targetViewport;\n        }\n      }\n    });\n\n    this.viewportResizeObserver.observe(this.hostElement);\n  };\n\n  /**\n   * Reference to host element\n   */\n  private el?: HTMLElement;\n\n  /**\n   * Render component template\n   *\n   * **Purpose**: Render canvases with items (no palette, no config panel)\n   *\n   * **Structure**:\n   * - Host element with theme classes\n   * - Canvas area with sections\n   * - No palette (viewing only)\n   * - No config panel (viewing only)\n   */\n  render() {\n    const canvasIds = Object.keys(this.viewerState.state.canvases);\n\n    return (\n      <Host ref={(el) => (this.el = el)}>\n        <div class=\"grid-viewer-container\">\n          {/* Canvas Area Only (no palette, no config panel) */}\n          <div class=\"canvas-area\">\n            <div class=\"canvases-container\">\n              {canvasIds.map((canvasId) => (\n                <canvas-section-viewer\n                  key={canvasId}\n                  canvasId={canvasId}\n                  config={this.config}\n                  componentRegistry={this.componentRegistry}\n                  items={this.viewerState.state.canvases[canvasId].items}\n                  currentViewport={this.viewerState.state.currentViewport}\n                  backgroundColor={\n                    this.canvasMetadata?.[canvasId]?.backgroundColor\n                  }\n                  virtualRendererInstance={this.virtualRendererInstance}\n                  stateInstance={this.viewerState.state}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n","/**\n * Layer Panel Styles\n * ==================\n *\n * Main layer panel container with virtual scrolling list.\n */\n\n.layer-panel {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  background: #fafafa;\n  overflow: hidden;\n  box-sizing: border-box;\n\n  &__header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    border-bottom: 1px solid #e0e0e0;\n    background: #ffffff;\n  }\n\n  &__title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: #333;\n  }\n\n  &__count {\n    font-size: 12px;\n    color: #757575;\n    background: #f5f5f5;\n    padding: 2px 8px;\n    border-radius: 12px;\n  }\n\n  &__search {\n    padding: 12px 16px;\n    border-bottom: 1px solid #e0e0e0;\n    background: #ffffff;\n  }\n\n  &__search-input {\n    width: 100%;\n    padding: 8px 12px;\n    border: 1px solid #e0e0e0;\n    border-radius: 4px;\n    font-size: 14px;\n    outline: none;\n    transition: border-color 0.2s ease;\n    box-sizing: border-box;\n\n    &:focus {\n      border-color: #4a90e2;\n      box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.1);\n    }\n\n    &::placeholder {\n      color: #9e9e9e;\n    }\n  }\n\n  &__list {\n    overflow-x: hidden;\n    padding: 8px;\n    background: #fafafa;\n    width: 100%;\n    box-sizing: border-box;\n    min-height: 400px; /* Show at least 3-4 rows of items */\n\n    /* Scrollbar styling */\n    &::-webkit-scrollbar {\n      width: 8px;\n    }\n\n    &::-webkit-scrollbar-track {\n      background: #f5f5f5;\n    }\n\n    &::-webkit-scrollbar-thumb {\n      background: #ccc;\n      border-radius: 4px;\n\n      &:hover {\n        background: #aaa;\n      }\n    }\n  }\n\n  &__list-inner {\n    position: relative;\n    min-height: 100%;\n    width: 100%;\n    box-sizing: border-box;\n  }\n\n  &__visible-items {\n    position: absolute;\n    width: 100%;\n    will-change: transform;\n  }\n\n  &__empty {\n    text-align: center;\n    padding: 32px 16px;\n    color: #9e9e9e;\n    font-size: 14px;\n  }\n\n  &__footer {\n    padding: 8px 16px;\n    border-top: 1px solid #e0e0e0;\n    background: #ffffff;\n  }\n\n  &__hint {\n    font-size: 11px;\n    color: #757575;\n    text-align: center;\n  }\n}\n","/**\n * Layer Panel Component\n * =====================\n *\n * Displays all grid items across all canvases sorted by z-index (stacking order).\n * Supports drag-to-reorder, search/filter, and virtual scrolling for performance.\n *\n * ## Features\n *\n * - **Global view**: Shows items from all canvases in one unified list\n * - **Z-index sorting**: Items sorted by z-index (descending, top items first)\n * - **Virtual scrolling**: Renders only ~50 visible items for performance (handles 1000+ items)\n * - **Search/filter**: Debounced text search across item names\n * - **Drag-to-reorder**: Change z-index by dragging items in the list\n * - **Visual feedback**: Shows active canvas and selected item\n *\n * ## Performance Targets\n *\n * Based on `/tmp/z-index-performance-assessment.md`:\n * - **1000 items**: Baseline target, excellent performance\n * - **5000 items**: Extended capacity with optimizations\n * - **Virtual scrolling**: 50-item render window (200px pre-render buffer)\n * - **Search debounce**: 300ms delay\n * - **Batch updates**: Single undo/redo command for reordering\n *\n * ## Usage\n *\n * ```typescript\n * <layer-panel />\n * ```\n *\n * The layer panel automatically subscribes to grid state and updates reactively.\n * @module layer-panel\n */\n\nimport {\n  Component,\n  h,\n  State,\n  Listen,\n  Element,\n  Prop,\n  Watch,\n} from \"@stencil/core\";\nimport { type GridItem } from \"../../../services/state-manager\";\n\n/**\n * Extended grid item with canvas information for display\n */\ninterface LayerItem extends GridItem {\n  canvasId: string;\n}\n\n/**\n * Virtual scrolling item with height information\n */\ninterface VirtualItem {\n  type: \"folder\" | \"item\";\n  data:\n    | LayerItem\n    | {\n        canvasId: string;\n        title: string;\n        itemCount: number;\n        totalItemCount?: number;\n        isEmpty?: boolean;\n      };\n  height: number;\n  offset: number; // Cumulative offset from top\n}\n\n@Component({\n  tag: \"layer-panel\",\n  styleUrl: \"layer-panel.scss\",\n  shadow: false,\n})\nexport class LayerPanel {\n  @Element() hostElement: HTMLElement;\n\n  /**\n   * Grid Builder API instance (instance-based architecture)\n   *\n   * **Required**: Must be provided or component won't display items\n   * **Source**: Host app (blog-app) passes this via prop\n   * **Purpose**: Access instance-based state for multi-instance support\n   *\n   * **Why needed**: Grid-builder uses its own state instance. The layer panel\n   * must access that same instance to display items correctly.\n   */\n  @Prop() api?: any;\n\n  /**\n   * Canvas metadata for folder titles\n   * Map of canvasId â†’ { title: string }\n   */\n  @Prop() canvasMetadata?: Record<string, { title: string }> = {};\n\n  /**\n   * Height of folder header in pixels\n   * @default 40\n   */\n  @Prop() folderHeight?: number = 40;\n\n  /**\n   * Height of layer item in pixels\n   * @default 40\n   */\n  @Prop() itemHeight?: number = 40;\n\n  /**\n   * Number of items to render in virtual window\n   * @default 50\n   */\n  @Prop() virtualWindowSize?: number = 50;\n\n  /**\n   * Pre-render buffer in pixels (renders items outside viewport)\n   * @default 200\n   */\n  @Prop() virtualBufferPx?: number = 200;\n\n  /**\n   * Search input debounce delay in milliseconds\n   * @default 300\n   */\n  @Prop() searchDebounceMs?: number = 300;\n\n  /**\n   * All items from all canvases, sorted by z-index (descending)\n   */\n  @State() allItems: LayerItem[] = [];\n\n  /**\n   * Filtered items (after search)\n   */\n  @State() filteredItems: LayerItem[] = [];\n\n  /**\n   * Search query for filtering items\n   */\n  @State() searchQuery: string = \"\";\n\n  /**\n   * Folder expand/collapse state\n   * Map of canvasId â†’ isExpanded\n   * Default: active canvas expanded, others collapsed\n   */\n  @State() folderExpandedState: Record<string, boolean> = {};\n\n  /**\n   * Current search debounce timer\n   */\n  private searchDebounceTimer: number | null = null;\n\n  /**\n   * Virtual scrolling: first visible item index\n   */\n  @State() virtualScrollOffset: number = 0;\n\n  /**\n   * Event listener cleanup functions\n   */\n  private cleanupFunctions: (() => void)[] = [];\n\n  /**\n   * Drag state tracking\n   * Stores information about the item currently being dragged\n   */\n  private draggedItem: {\n    itemId: string;\n    canvasId: string;\n    zIndex: number;\n  } | null = null;\n\n  /**\n   * Watch API prop for changes\n   *\n   * **Why needed**: Layer panel's componentDidLoad() runs before blog-app\n   * has retrieved and passed the API prop. We need to initialize when\n   * the API prop becomes available.\n   */\n  @Watch(\"api\")\n  handleApiChange(newApi: any) {\n    console.log(\"ðŸ”§ Layer panel: API prop changed\", { hasApi: !!newApi });\n\n    if (newApi) {\n      this.setupLayerPanel();\n    }\n  }\n\n  /**\n   * Component did load - subscribe to events\n   */\n  componentDidLoad() {\n    console.log(\"ðŸ”§ Layer panel componentDidLoad called\");\n    console.log(\"  API available:\", !!this.api);\n\n    // If API is already available, initialize immediately\n    // Otherwise, @Watch(\"api\") will initialize when API prop is set\n    if (this.api) {\n      this.setupLayerPanel();\n    } else {\n      console.warn(\"  âš ï¸ API not yet available, waiting for prop...\");\n    }\n  }\n\n  /**\n   * Setup layer panel (called when API becomes available)\n   */\n  private setupLayerPanel = () => {\n    console.log(\"ðŸ”§ setupLayerPanel called\");\n\n    if (!this.api) {\n      console.warn(\"  âš ï¸ No API - aborting\");\n      return;\n    }\n\n    // Prevent double initialization\n    if (this.cleanupFunctions.length > 0) {\n      console.log(\"  â„¹ï¸ Already initialized, skipping\");\n      return;\n    }\n\n    // Initialize folder expanded state\n    // Default: active canvas expanded, others collapsed\n    this.initializeFolderState();\n\n    // Initial data load\n    this.refreshItems();\n\n    // Subscribe to API events for state changes\n    const refreshHandler = () => {\n      this.refreshItems();\n    };\n\n    // Listen to all events that modify items\n    this.api.on(\"componentAdded\", refreshHandler);\n    this.api.on(\"componentDeleted\", refreshHandler);\n    this.api.on(\"componentDragged\", refreshHandler);\n    this.api.on(\"componentResized\", refreshHandler);\n    this.api.on(\"componentsBatchAdded\", refreshHandler);\n    this.api.on(\"componentsBatchDeleted\", refreshHandler);\n    this.api.on(\"zIndexChanged\", refreshHandler);\n    this.api.on(\"zIndexBatchChanged\", refreshHandler);\n\n    // Store cleanup functions\n    this.cleanupFunctions.push(() => {\n      this.api.off(\"componentAdded\", refreshHandler);\n      this.api.off(\"componentDeleted\", refreshHandler);\n      this.api.off(\"componentDragged\", refreshHandler);\n      this.api.off(\"componentResized\", refreshHandler);\n      this.api.off(\"componentsBatchAdded\", refreshHandler);\n      this.api.off(\"componentsBatchDeleted\", refreshHandler);\n      this.api.off(\"zIndexChanged\", refreshHandler);\n      this.api.off(\"zIndexBatchChanged\", refreshHandler);\n    });\n\n    // Subscribe to selection/canvas changes for visual feedback\n    const visualUpdateHandler = () => {\n      // Force re-render to update visual feedback\n      this.allItems = [...this.allItems];\n    };\n\n    this.api.on(\"componentSelected\", visualUpdateHandler);\n    this.api.on(\"canvasActivated\", visualUpdateHandler);\n\n    this.cleanupFunctions.push(() => {\n      this.api.off(\"componentSelected\", visualUpdateHandler);\n      this.api.off(\"canvasActivated\", visualUpdateHandler);\n    });\n\n    // Subscribe to canvas activation to auto-expand the active section\n    const canvasActivationHandler = () => {\n      const state = this.api.getState();\n      const activeCanvasId = state.activeCanvasId;\n\n      if (activeCanvasId) {\n        console.log(\"ðŸ“ Canvas activated, expanding folder:\", activeCanvasId);\n        // Update folder state to expand only the active canvas\n        const newFolderState: Record<string, boolean> = {};\n        Object.keys(state.canvases).forEach((canvasId) => {\n          newFolderState[canvasId] = canvasId === activeCanvasId;\n        });\n        this.folderExpandedState = newFolderState;\n      }\n    };\n\n    this.api.on(\"canvasActivated\", canvasActivationHandler);\n\n    this.cleanupFunctions.push(() => {\n      this.api.off(\"canvasActivated\", canvasActivationHandler);\n    });\n\n    // Initialize virtual scrolling\n    this.initializeVirtualScrolling();\n  };\n\n  /**\n   * Initialize folder expanded state\n   * Default: active canvas expanded, others collapsed\n   */\n  private initializeFolderState = () => {\n    console.log(\"ðŸ“ initializeFolderState called\");\n\n    if (!this.api) {\n      console.warn(\"  âš ï¸ No API - aborting\");\n      return;\n    }\n\n    const state = this.api.getState();\n    const activeCanvasId = state.activeCanvasId;\n    console.log(\"  Active canvas:\", activeCanvasId);\n\n    const folderState: Record<string, boolean> = {};\n\n    Object.keys(state.canvases).forEach((canvasId) => {\n      folderState[canvasId] = canvasId === activeCanvasId;\n    });\n\n    console.log(\"  Folder state:\", folderState);\n    this.folderExpandedState = folderState;\n  };\n\n  /**\n   * Cleanup event subscriptions\n   */\n  disconnectedCallback() {\n    this.cleanupFunctions.forEach((cleanup) => cleanup());\n    this.cleanupFunctions = [];\n\n    if (this.searchDebounceTimer) {\n      clearTimeout(this.searchDebounceTimer);\n    }\n  }\n\n  /**\n   * Refresh item list from grid state\n   *\n   * Aggregates all items from all canvases and sorts by z-index (descending).\n   * Top items (highest z-index) appear first in the list.\n   */\n  private refreshItems = () => {\n    console.log(\"ðŸ”„ refreshItems called\");\n\n    if (!this.api) {\n      console.warn(\"  âš ï¸ No API - aborting\");\n      return;\n    }\n\n    const state = this.api.getState();\n    console.log(\"  State from API:\", state);\n    console.log(\"  Canvases:\", Object.keys(state.canvases || {}));\n\n    const items: LayerItem[] = [];\n\n    // Collect all items from all canvases\n    Object.entries(state.canvases).forEach(\n      ([canvasId, canvas]: [string, any]) => {\n        console.log(`  Canvas ${canvasId}: ${canvas.items?.length || 0} items`);\n        canvas.items.forEach((item) => {\n          items.push({\n            ...item,\n            canvasId,\n          });\n        });\n      },\n    );\n\n    console.log(`  Total items collected: ${items.length}`);\n\n    // Sort by z-index (descending - highest first)\n    items.sort((a, b) => b.zIndex - a.zIndex);\n\n    this.allItems = items;\n    console.log(\"  this.allItems set to:\", this.allItems.length, \"items\");\n\n    this.applySearchFilter();\n    console.log(\"  After filter:\", this.filteredItems.length, \"items\");\n  };\n\n  /**\n   * Apply search filter to items\n   *\n   * Filters items by name (case-insensitive substring match).\n   * Performance: <5ms for 1000 items, <10ms for 5000 items\n   */\n  private applySearchFilter = () => {\n    if (!this.searchQuery) {\n      this.filteredItems = this.allItems;\n      return;\n    }\n\n    const query = this.searchQuery.toLowerCase();\n    this.filteredItems = this.allItems.filter((item) =>\n      item.name.toLowerCase().includes(query),\n    );\n  };\n\n  /**\n   * Handle search input change with debouncing\n   *\n   * Debounces search input using configurable delay (default 300ms)\n   * to prevent excessive filtering on every keystroke.\n   */\n  private handleSearchInput = (event: Event) => {\n    const input = event.target as HTMLInputElement;\n    const value = input.value;\n\n    // Clear existing timer\n    if (this.searchDebounceTimer) {\n      clearTimeout(this.searchDebounceTimer);\n    }\n\n    // Debounce by configurable delay\n    this.searchDebounceTimer = window.setTimeout(() => {\n      this.searchQuery = value;\n      this.applySearchFilter();\n    }, this.searchDebounceMs);\n  };\n\n  /**\n   * Group items by canvas for folder rendering\n   */\n  private groupItemsByCanvas = (\n    items: LayerItem[],\n  ): Record<string, LayerItem[]> => {\n    const grouped: Record<string, LayerItem[]> = {};\n\n    items.forEach((item) => {\n      if (!grouped[item.canvasId]) {\n        grouped[item.canvasId] = [];\n      }\n      grouped[item.canvasId].push(item);\n    });\n\n    return grouped;\n  };\n\n  /**\n   * Get canvas title from metadata or fallback to canvasId\n   */\n  private getCanvasTitle = (canvasId: string): string => {\n    return this.canvasMetadata?.[canvasId]?.title || canvasId;\n  };\n\n  /**\n   * Toggle folder expand/collapse state\n   */\n  private toggleFolder = (canvasId: string) => {\n    this.folderExpandedState = {\n      ...this.folderExpandedState,\n      [canvasId]: !this.folderExpandedState[canvasId],\n    };\n  };\n\n  /**\n   * Initialize virtual scrolling\n   *\n   * Sets up scroll event listener for variable-height virtual rendering.\n   * Supports configurable item/folder heights and buffer zones.\n   *\n   * Performance target: <16ms per scroll frame (60fps)\n   */\n  private initializeVirtualScrolling = () => {\n    const scrollContainer = this.hostElement.querySelector(\n      \".layer-panel__list\",\n    ) as HTMLElement;\n    if (!scrollContainer) return;\n\n    // Track scroll position for virtual rendering\n    scrollContainer.addEventListener(\"scroll\", () => {\n      const scrollTop = scrollContainer.scrollTop;\n      this.virtualScrollOffset = scrollTop;\n    });\n  };\n\n  /**\n   * Build virtual items list with position cache\n   *\n   * Creates a flattened list of folders and items with their heights and cumulative offsets.\n   * This allows for accurate virtual scrolling with variable-height items.\n   * @returns Array of virtual items with position information\n   */\n  private buildVirtualItemsList = (): VirtualItem[] => {\n    const virtualItems: VirtualItem[] = [];\n    let currentOffset = 0;\n\n    // Group items by canvas\n    const allItemsByCanvas = this.groupItemsByCanvas(this.allItems);\n    const filteredItemsByCanvas = this.groupItemsByCanvas(this.filteredItems);\n\n    // Build virtual items list (folders + items)\n    // Iterate in canvasMetadata order to match visual order on page\n    const canvasOrder = this.canvasMetadata\n      ? Object.keys(this.canvasMetadata)\n      : Object.keys(allItemsByCanvas);\n\n    canvasOrder.forEach((canvasId) => {\n      // Skip canvases that don't exist in state (e.g., removed canvases)\n      if (!allItemsByCanvas[canvasId]) return;\n      const allCanvasItems = allItemsByCanvas[canvasId] || [];\n      const filteredCanvasItems = filteredItemsByCanvas[canvasId] || [];\n      const isExpanded = this.folderExpandedState[canvasId] ?? true;\n      const isEmpty = this.searchQuery && filteredCanvasItems.length === 0;\n\n      // Add folder header\n      virtualItems.push({\n        type: \"folder\",\n        data: {\n          canvasId,\n          title: this.getCanvasTitle(canvasId),\n          itemCount: filteredCanvasItems.length,\n          totalItemCount: allCanvasItems.length,\n          isEmpty,\n        },\n        height: this.folderHeight,\n        offset: currentOffset,\n      });\n      currentOffset += this.folderHeight;\n\n      // Add items if folder is expanded\n      if (isExpanded) {\n        filteredCanvasItems.forEach((item) => {\n          virtualItems.push({\n            type: \"item\",\n            data: item,\n            height: this.itemHeight,\n            offset: currentOffset,\n          });\n          currentOffset += this.itemHeight;\n        });\n      }\n    });\n\n    return virtualItems;\n  };\n\n  /**\n   * Get visible items for virtual scrolling\n   *\n   * Returns only the items/folders that should be rendered based on scroll position.\n   * Uses configurable heights and buffer zones for optimal performance.\n   *\n   * Performance: Reduces DOM nodes from 1000+ to ~50-100 (10-20Ã— improvement)\n   * @returns Object with visible items and total scroll height\n   */\n  private calculateVirtualScrolling = (): {\n    visibleItems: VirtualItem[];\n    totalHeight: number;\n  } => {\n    const allVirtualItems = this.buildVirtualItemsList();\n\n    // Calculate total height\n    const totalHeight =\n      allVirtualItems.length > 0\n        ? allVirtualItems[allVirtualItems.length - 1].offset +\n          allVirtualItems[allVirtualItems.length - 1].height\n        : 0;\n\n    // Find visible range with buffer\n    const scrollTop = this.virtualScrollOffset;\n    const scrollContainer = this.hostElement.querySelector(\n      \".layer-panel__list\",\n    ) as HTMLElement;\n    const viewportHeight = scrollContainer?.clientHeight || 600;\n\n    const startY = Math.max(0, scrollTop - this.virtualBufferPx);\n    const endY = scrollTop + viewportHeight + this.virtualBufferPx;\n\n    // Binary search for start index\n    let startIndex = 0;\n    for (let i = 0; i < allVirtualItems.length; i++) {\n      if (allVirtualItems[i].offset + allVirtualItems[i].height >= startY) {\n        startIndex = i;\n        break;\n      }\n    }\n\n    // Find end index\n    let endIndex = startIndex;\n    for (let i = startIndex; i < allVirtualItems.length; i++) {\n      if (allVirtualItems[i].offset > endY) {\n        break;\n      }\n      endIndex = i;\n    }\n\n    // Extract visible items\n    const visibleItems = allVirtualItems.slice(startIndex, endIndex + 1);\n\n    return { visibleItems, totalHeight };\n  };\n\n  /**\n   * Handle layer item selection\n   *\n   * Updates grid state to select the clicked item.\n   */\n  @Listen(\"layerItemSelect\")\n  handleLayerItemSelect(\n    event: CustomEvent<{ itemId: string; canvasId: string }>,\n  ) {\n    if (!this.api) return;\n\n    const { itemId, canvasId } = event.detail;\n\n    // Update grid state via API\n    const state = this.api.getState();\n    state.selectedItemId = itemId;\n    state.selectedCanvasId = canvasId;\n    state.activeCanvasId = canvasId;\n  }\n\n  /**\n   * Handle folder toggle (expand/collapse)\n   */\n  @Listen(\"toggleFolder\")\n  handleToggleFolder(event: CustomEvent<{ canvasId: string }>) {\n    this.toggleFolder(event.detail.canvasId);\n  }\n\n  /**\n   * Handle canvas activation (set as active canvas)\n   */\n  @Listen(\"activateCanvas\")\n  handleActivateCanvas(event: CustomEvent<{ canvasId: string }>) {\n    if (!this.api) return;\n\n    const state = this.api.getState();\n    state.activeCanvasId = event.detail.canvasId;\n  }\n\n  /**\n   * Handle scroll to canvas (double-click on folder header)\n   */\n  @Listen(\"scrollToCanvas\")\n  handleScrollToCanvas(event: CustomEvent<{ canvasId: string }>) {\n    const { canvasId } = event.detail;\n    console.log(\"ðŸ“œ Scrolling to canvas:\", canvasId);\n\n    // Find the canvas element in the DOM\n    const canvasElement = document.getElementById(canvasId);\n    if (canvasElement) {\n      canvasElement.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"center\",\n        inline: \"nearest\",\n      });\n      console.log(\"  âœ… Scrolled to canvas element\");\n    } else {\n      console.warn(\"  âš ï¸ Canvas element not found:\", canvasId);\n    }\n  }\n\n  /**\n   * Handle drag start for layer item reordering\n   *\n   * Stores drag metadata for drop calculation.\n   */\n  @Listen(\"layerItemDragStart\")\n  handleLayerItemDragStart(\n    event: CustomEvent<{ itemId: string; canvasId: string; zIndex: number }>,\n  ) {\n    const { itemId, canvasId, zIndex } = event.detail;\n\n    // Store drag state\n    this.draggedItem = {\n      itemId,\n      canvasId,\n      zIndex,\n    };\n  }\n\n  /**\n   * Handle drop for layer item reordering\n   *\n   * Calculates new z-index and handles cross-canvas movement.\n   * Supports Photoshop-like behavior: drop above/below target item.\n   *\n   * Uses GridBuilderAPI methods for proper event emission and undo/redo support.\n   */\n  @Listen(\"layer-item-dropped\")\n  handleLayerItemDropped(\n    event: CustomEvent<{\n      targetItemId: string;\n      targetCanvasId: string;\n      targetZIndex: number;\n      dropAbove: boolean;\n    }>,\n  ) {\n    console.log(\"ðŸŽ¯ Layer item dropped\", {\n      event: event.detail,\n      draggedItem: this.draggedItem,\n      hasApi: !!this.api,\n    });\n\n    if (!this.draggedItem || !this.api) {\n      console.warn(\"  âš ï¸ No draggedItem or API, aborting\");\n      return;\n    }\n\n    const state = this.api.getState();\n    const { targetItemId, targetCanvasId, targetZIndex, dropAbove } =\n      event.detail;\n    const {\n      itemId: draggedItemId,\n      canvasId: draggedCanvasId,\n      zIndex: draggedZIndex,\n    } = this.draggedItem;\n\n    // Don't drop on self\n    if (draggedItemId === targetItemId && draggedCanvasId === targetCanvasId) {\n      console.log(\"  â„¹ï¸ Dropped on self, ignoring\");\n      this.draggedItem = null;\n      return;\n    }\n\n    console.log(\"  ðŸ“¦ Processing drop:\", {\n      draggedItemId,\n      draggedCanvasId,\n      draggedZIndex,\n      targetItemId,\n      targetCanvasId,\n      targetZIndex,\n      dropAbove,\n    });\n\n    // Collect all z-index changes to apply in batch\n    const zIndexChanges: {\n      itemId: string;\n      canvasId: string;\n      newZIndex: number;\n    }[] = [];\n\n    // Handle cross-canvas movement\n    if (draggedCanvasId !== targetCanvasId) {\n      const sourceCanvas = state.canvases[draggedCanvasId];\n      const targetCanvas = state.canvases[targetCanvasId];\n\n      if (!sourceCanvas || !targetCanvas) return;\n\n      // Move item to target canvas using API\n      this.api.moveItem(draggedCanvasId, targetCanvasId, draggedItemId);\n\n      // Get updated state after move\n      const updatedTargetCanvas = this.api.getState().canvases[targetCanvasId];\n      const sortedItems = [...updatedTargetCanvas.items].sort(\n        (a, b) => a.zIndex - b.zIndex,\n      );\n\n      // Find target item index in sorted list\n      const targetIndex = sortedItems.findIndex((i) => i.id === targetItemId);\n\n      // Calculate new z-index based on drop position\n      let newZIndex: number;\n      if (dropAbove) {\n        // Drop above target: use target's z-index\n        newZIndex = targetZIndex;\n        // Collect z-index changes for items that need to shift up\n        sortedItems.forEach((item) => {\n          if (item.id !== draggedItemId && item.zIndex >= newZIndex) {\n            zIndexChanges.push({\n              itemId: item.id,\n              canvasId: targetCanvasId,\n              newZIndex: item.zIndex + 1,\n            });\n          }\n        });\n      } else {\n        // Drop below target: use z-index between target and next item\n        if (targetIndex < sortedItems.length - 1) {\n          const nextItem = sortedItems[targetIndex + 1];\n          newZIndex = nextItem.zIndex;\n          // Collect z-index changes for items that need to shift up\n          sortedItems.forEach((item) => {\n            if (item.id !== draggedItemId && item.zIndex >= newZIndex) {\n              zIndexChanges.push({\n                itemId: item.id,\n                canvasId: targetCanvasId,\n                newZIndex: item.zIndex + 1,\n              });\n            }\n          });\n        } else {\n          // Dropping at the bottom\n          newZIndex = targetZIndex + 1;\n        }\n      }\n\n      // Add dragged item's new z-index\n      zIndexChanges.push({\n        itemId: draggedItemId,\n        canvasId: targetCanvasId,\n        newZIndex,\n      });\n    } else {\n      // Same canvas reordering\n      const canvas = state.canvases[draggedCanvasId];\n      const sortedItems = [...canvas.items].sort((a, b) => a.zIndex - b.zIndex);\n\n      // Find indices\n      const draggedIndex = sortedItems.findIndex((i) => i.id === draggedItemId);\n      const targetIndex = sortedItems.findIndex((i) => i.id === targetItemId);\n\n      // Calculate new z-index\n      let newZIndex: number;\n      if (dropAbove) {\n        // Drop above target\n        newZIndex = targetZIndex;\n        // Collect z-index changes for items between old and new position\n        sortedItems.forEach((item) => {\n          if (item.id !== draggedItemId) {\n            if (draggedIndex < targetIndex) {\n              // Moving down: decrement items between\n              if (item.zIndex > draggedZIndex && item.zIndex <= targetZIndex) {\n                zIndexChanges.push({\n                  itemId: item.id,\n                  canvasId: draggedCanvasId,\n                  newZIndex: item.zIndex - 1,\n                });\n              }\n            } else {\n              // Moving up: increment items between\n              if (item.zIndex >= targetZIndex && item.zIndex < draggedZIndex) {\n                zIndexChanges.push({\n                  itemId: item.id,\n                  canvasId: draggedCanvasId,\n                  newZIndex: item.zIndex + 1,\n                });\n              }\n            }\n          }\n        });\n      } else {\n        // Drop below target\n        if (targetIndex < sortedItems.length - 1) {\n          newZIndex = targetZIndex + 1;\n          // Collect z-index changes\n          sortedItems.forEach((item) => {\n            if (item.id !== draggedItemId) {\n              if (draggedIndex < targetIndex) {\n                // Moving down\n                if (item.zIndex > draggedZIndex && item.zIndex <= newZIndex) {\n                  zIndexChanges.push({\n                    itemId: item.id,\n                    canvasId: draggedCanvasId,\n                    newZIndex: item.zIndex - 1,\n                  });\n                }\n              } else {\n                // Moving up\n                if (item.zIndex >= newZIndex && item.zIndex < draggedZIndex) {\n                  zIndexChanges.push({\n                    itemId: item.id,\n                    canvasId: draggedCanvasId,\n                    newZIndex: item.zIndex + 1,\n                  });\n                }\n              }\n            }\n          });\n        } else {\n          // Dropping at bottom\n          newZIndex = targetZIndex + 1;\n        }\n      }\n\n      // Add dragged item's new z-index\n      zIndexChanges.push({\n        itemId: draggedItemId,\n        canvasId: draggedCanvasId,\n        newZIndex,\n      });\n    }\n\n    // Apply all z-index changes in one batch operation\n    if (zIndexChanges.length > 0) {\n      this.api.setItemsZIndexBatch(zIndexChanges);\n    }\n\n    // Clear drag state (refreshItems() is no longer needed as API events will trigger re-render)\n    this.draggedItem = null;\n  }\n\n  render() {\n    const { visibleItems, totalHeight } = this.calculateVirtualScrolling();\n\n    // Get state for selection/active canvas checks\n    const state = this.api?.getState();\n    const activeCanvasId = state?.activeCanvasId;\n    const selectedItemId = state?.selectedItemId;\n    const selectedCanvasId = state?.selectedCanvasId;\n\n    return (\n      <div class=\"layer-panel\">\n        {/* Header */}\n        <div class=\"layer-panel__header\">\n          <h3 class=\"layer-panel__title\">Layers</h3>\n          <div class=\"layer-panel__count\">\n            {this.filteredItems.length} items\n          </div>\n        </div>\n\n        {/* Search */}\n        <div class=\"layer-panel__search\">\n          <input\n            type=\"text\"\n            class=\"layer-panel__search-input\"\n            placeholder=\"Search layers...\"\n            onInput={this.handleSearchInput}\n          />\n        </div>\n\n        {/* Layer list with virtual scrolling */}\n        <div class=\"layer-panel__list\">\n          <div\n            class=\"layer-panel__list-inner\"\n            style={{ height: `${totalHeight}px`, position: \"relative\" }}\n          >\n            {visibleItems.length === 0 && (\n              <div class=\"layer-panel__empty\">No items found</div>\n            )}\n\n            {visibleItems.map((virtualItem) => {\n              if (virtualItem.type === \"folder\") {\n                // Render folder header\n                const folderData = virtualItem.data as {\n                  canvasId: string;\n                  title: string;\n                  itemCount: number;\n                  totalItemCount?: number;\n                  isEmpty?: boolean;\n                };\n\n                return (\n                  <layer-panel-folder-header\n                    key={`folder-${folderData.canvasId}`}\n                    canvasId={folderData.canvasId}\n                    canvasTitle={folderData.title}\n                    itemCount={folderData.itemCount}\n                    totalItemCount={folderData.totalItemCount}\n                    isExpanded={\n                      this.folderExpandedState[folderData.canvasId] ?? true\n                    }\n                    isActive={folderData.canvasId === activeCanvasId}\n                    isEmpty={folderData.isEmpty}\n                    style={{\n                      position: \"absolute\",\n                      top: `${virtualItem.offset}px`,\n                      left: \"0\",\n                      right: \"0\",\n                      height: `${virtualItem.height}px`,\n                    }}\n                  />\n                );\n              } else {\n                // Render layer item\n                const item = virtualItem.data as LayerItem;\n\n                return (\n                  <layer-panel-item\n                    key={item.id}\n                    itemId={item.id}\n                    canvasId={item.canvasId}\n                    name={item.name}\n                    type={item.type}\n                    zIndex={item.zIndex}\n                    isActive={\n                      item.id === selectedItemId &&\n                      item.canvasId === selectedCanvasId\n                    }\n                    style={{\n                      position: \"absolute\",\n                      top: `${virtualItem.offset}px`,\n                      left: \"0\",\n                      right: \"0\",\n                      height: `${virtualItem.height}px`,\n                    }}\n                  />\n                );\n              }\n            })}\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div class=\"layer-panel__footer\">\n          <div class=\"layer-panel__hint\">\n            Click folder to expand/collapse Â· Click item to select\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","section-editor-panel {\n  .section-editor-overlay {\n    position: fixed;\n    z-index: 10000;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: fadeIn 0.2s ease-out;\n    background: rgba(0, 0, 0, 0.5);\n  }\n\n  .section-editor-panel {\n    width: 90%;\n    max-width: 440px;\n    border-radius: 12px;\n    animation: slideUp 0.2s ease-out;\n    background: white;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n  }\n\n  .panel-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 28px 32px 24px;\n    border-bottom: 1px solid #e9ecef;\n\n    .panel-title {\n      margin: 0;\n      color: #212529;\n      font-size: 20px;\n      font-weight: 600;\n      letter-spacing: -0.02em;\n    }\n\n    .close-btn {\n      display: flex;\n      width: 32px;\n      height: 32px;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      border: none;\n      border-radius: 6px;\n      background: transparent;\n      color: #6c757d;\n      cursor: pointer;\n      font-size: 24px;\n      font-weight: 300;\n      line-height: 1;\n      transition: all 0.15s;\n\n      &:hover {\n        background: #f8f9fa;\n        color: #212529;\n      }\n\n      &:active {\n        transform: scale(0.95);\n      }\n    }\n  }\n\n  .panel-body {\n    padding: 32px;\n\n    .form-group {\n      margin-bottom: 28px;\n\n      &:last-child {\n        margin-bottom: 0;\n      }\n\n      label {\n        display: block;\n        margin-bottom: 10px;\n        color: #495057;\n        font-size: 13px;\n        font-weight: 600;\n        letter-spacing: 0.01em;\n        text-transform: uppercase;\n      }\n\n      .section-title-input {\n        width: 100%;\n        box-sizing: border-box;\n        padding: 12px 16px;\n        border: 1.5px solid #e1e4e8;\n        border-radius: 8px;\n        background: #f8f9fa;\n        color: #212529;\n        font-size: 15px;\n        transition: all 0.2s;\n\n        &:hover {\n          background: white;\n          border-color: #cbd3da;\n        }\n\n        &:focus {\n          border-color: #4a90e2;\n          background: white;\n          box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.08);\n          outline: none;\n        }\n\n        &::placeholder {\n          color: #adb5bd;\n        }\n      }\n\n      .color-picker-wrapper {\n        display: flex;\n        align-items: stretch;\n        gap: 14px;\n\n        .section-color-input {\n          width: 64px;\n          height: 48px;\n          padding: 6px;\n          border: 1.5px solid #e1e4e8;\n          border-radius: 8px;\n          cursor: pointer;\n          transition: all 0.2s;\n\n          &:hover {\n            border-color: #4a90e2;\n            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.15);\n          }\n\n          &:focus {\n            border-color: #4a90e2;\n            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.08);\n            outline: none;\n          }\n        }\n\n        .color-hex-input {\n          flex: 1;\n          padding: 12px 16px;\n          border: 1.5px solid #e1e4e8;\n          border-radius: 8px;\n          background: #f8f9fa;\n          color: #495057;\n          font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;\n          font-size: 14px;\n          transition: all 0.2s;\n\n          &:hover {\n            background: white;\n            border-color: #cbd3da;\n          }\n\n          &:focus {\n            border-color: #4a90e2;\n            background: white;\n            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.08);\n            outline: none;\n          }\n\n          &::placeholder {\n            color: #adb5bd;\n          }\n        }\n      }\n    }\n  }\n\n  .panel-footer {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 24px 32px 28px;\n    border-top: 1px solid #e9ecef;\n\n    .footer-actions {\n      display: flex;\n      gap: 12px;\n    }\n\n    button {\n      padding: 12px 24px;\n      border: none;\n      border-radius: 8px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 600;\n      transition: all 0.2s;\n\n      &:active {\n        transform: translateY(1px);\n      }\n    }\n\n    .delete-btn {\n      padding: 12px 16px;\n      margin-right: 16px;\n      border: 1.5px solid #dc3545;\n      background: transparent;\n      color: #dc3545;\n      font-weight: 500;\n\n      &:hover {\n        background: #fff5f5;\n        border-color: #c82333;\n        color: #c82333;\n      }\n\n      &:active {\n        background: #ffe5e5;\n      }\n    }\n\n    .cancel-btn {\n      border: 1.5px solid #e1e4e8;\n      background: white;\n      color: #495057;\n\n      &:hover {\n        border-color: #cbd3da;\n        background: #f8f9fa;\n      }\n\n      &:active {\n        background: #e9ecef;\n      }\n    }\n\n    .save-btn {\n      background: #4a90e2;\n      color: white;\n      box-shadow: 0 2px 8px rgba(74, 144, 226, 0.2);\n\n      &:hover {\n        background: #357abd;\n        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.25);\n        transform: translateY(-1px);\n      }\n\n      &:active {\n        background: #2a5f8f;\n        box-shadow: 0 1px 4px rgba(74, 144, 226, 0.2);\n        transform: translateY(0);\n      }\n    }\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n\n  @keyframes slideUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n}\n","import {\n  Component,\n  h,\n  Prop,\n  Event,\n  EventEmitter,\n  State,\n  Watch,\n} from \"@stencil/core\";\nimport { SectionEditorData } from \"../../types/section-editor-data\";\n\n/**\n * Section Editor Panel Component\n * ===============================\n *\n * Demo Component - NOT Part of Library\n *\n * This component demonstrates how to build custom UI for editing canvas metadata\n * in applications using the grid-builder library.\n *\n * Purpose:\n * --------\n * Shows how to create a side panel for editing section/canvas settings.\n * This is completely custom to your application - the library doesn't provide this.\n *\n * Library Relationship:\n * ---------------------\n * - Library owns: Component placement, layouts, zIndex (grid state)\n * - Host app owns: Canvas metadata (titles, colors, settings) - THIS COMPONENT\n * - Metadata flows: App â†’ Library via canvasMetadata prop\n *\n * Pattern Demonstrated:\n * ---------------------\n * 1. User clicks section header (demo UI)\n * 2. App opens this panel (demo component)\n * 3. User edits title/color\n * 4. App updates canvasMetadata state\n * 5. Library receives updated metadata via prop\n * 6. Library passes backgroundColor to canvas-section\n *\n * Why This Approach:\n * ------------------\n * - Library stays focused on grid logic\n * - Host app controls all presentation/metadata UI\n * - You can use any UI framework (Material, Bootstrap, etc.)\n * - Complete flexibility over settings panel design\n */\n@Component({\n  tag: \"section-editor-panel\",\n  styleUrl: \"section-editor-panel.scss\",\n  shadow: false,\n})\nexport class SectionEditorPanel {\n  /**\n   * Panel open/closed state\n   * Controlled by parent component (blog-app)\n   */\n  @Prop() isOpen: boolean = false;\n\n  /**\n   * Section data being edited\n   * Passed from parent when user clicks section header\n   */\n  @Prop() sectionData: SectionEditorData | null = null;\n\n  /**\n   * Event: Close panel\n   * Fired when user clicks Cancel, Save, or overlay\n   */\n  @Event() closePanel: EventEmitter<void>;\n\n  /**\n   * Event: Update section\n   * Fired when user clicks Save with edited values\n   * Parent updates canvasMetadata state in response\n   */\n  @Event() updateSection: EventEmitter<{\n    canvasId: string;\n    title: string;\n    backgroundColor: string;\n  }>;\n\n  /**\n   * Event: Preview color change\n   * Fired when user changes color picker (live preview)\n   * Parent temporarily updates canvas background\n   */\n  @Event() previewColorChange: EventEmitter<{\n    canvasId: string;\n    backgroundColor: string;\n  }>;\n\n  /**\n   * Event: Preview title change\n   * Fired when user types in title input (live preview)\n   * Parent temporarily updates canvas title\n   */\n  @Event() previewTitleChange: EventEmitter<{\n    canvasId: string;\n    title: string;\n  }>;\n\n  /**\n   * Event: Delete section\n   * Fired when user clicks Delete button\n   * Parent handles canvas removal\n   */\n  @Event() deleteSection: EventEmitter<{ canvasId: string }>;\n\n  /**\n   * Internal editing state\n   * These track user's changes before saving\n   */\n  @State() editedTitle: string = \"\";\n  @State() editedColor: string = \"\";\n\n  /**\n   * Original values when modal opened\n   * Used to revert on cancel\n   */\n  private originalColor: string = \"\";\n  private originalTitle: string = \"\";\n\n  @Watch(\"sectionData\")\n  handleSectionDataChange(newData: SectionEditorData | null) {\n    if (newData) {\n      this.editedTitle = newData.title;\n      this.editedColor = newData.backgroundColor;\n      // Store original values for revert on cancel\n      this.originalColor = newData.backgroundColor;\n      this.originalTitle = newData.title;\n    }\n  }\n\n  componentWillLoad() {\n    if (this.sectionData) {\n      this.editedTitle = this.sectionData.title;\n      this.editedColor = this.sectionData.backgroundColor;\n      // Store original values for revert on cancel\n      this.originalColor = this.sectionData.backgroundColor;\n      this.originalTitle = this.sectionData.title;\n    }\n  }\n\n  private handleClose = () => {\n    // Revert to original values on cancel\n    if (this.sectionData) {\n      this.previewColorChange.emit({\n        canvasId: this.sectionData.canvasId,\n        backgroundColor: this.originalColor,\n      });\n      this.previewTitleChange.emit({\n        canvasId: this.sectionData.canvasId,\n        title: this.originalTitle,\n      });\n    }\n    this.closePanel.emit();\n  };\n\n  private handleSave = () => {\n    if (this.sectionData) {\n      this.updateSection.emit({\n        canvasId: this.sectionData.canvasId,\n        title: this.editedTitle,\n        backgroundColor: this.editedColor,\n      });\n      this.closePanel.emit();\n    }\n  };\n\n  private handleDelete = () => {\n    if (this.sectionData) {\n      this.deleteSection.emit({\n        canvasId: this.sectionData.canvasId,\n      });\n      this.closePanel.emit();\n    }\n  };\n\n  private handleTitleInput = (e: Event) => {\n    this.editedTitle = (e.target as HTMLInputElement).value;\n\n    // Emit preview event for live title update\n    if (this.sectionData) {\n      this.previewTitleChange.emit({\n        canvasId: this.sectionData.canvasId,\n        title: this.editedTitle,\n      });\n    }\n  };\n\n  private handleColorInput = (e: Event) => {\n    this.editedColor = (e.target as HTMLInputElement).value;\n\n    // Emit preview event for live color update\n    if (this.sectionData) {\n      this.previewColorChange.emit({\n        canvasId: this.sectionData.canvasId,\n        backgroundColor: this.editedColor,\n      });\n    }\n  };\n\n  render() {\n    if (!this.isOpen || !this.sectionData) {\n      return null;\n    }\n\n    return (\n      <div class=\"section-editor-overlay\" onClick={this.handleClose}>\n        <div class=\"section-editor-panel\" onClick={(e) => e.stopPropagation()}>\n          <div class=\"panel-header\">\n            <h2 class=\"panel-title\">Edit Section</h2>\n            <button class=\"close-btn\" onClick={this.handleClose} title=\"Close\">\n              Ã—\n            </button>\n          </div>\n\n          <div class=\"panel-body\">\n            <div class=\"form-group\">\n              <label htmlFor=\"section-title\">Section Name</label>\n              <input\n                type=\"text\"\n                id=\"section-title\"\n                class=\"section-title-input\"\n                value={this.editedTitle}\n                onInput={this.handleTitleInput}\n                placeholder=\"Enter section name\"\n              />\n            </div>\n\n            <div class=\"form-group\">\n              <label htmlFor=\"section-color\">Background Color</label>\n              <div class=\"color-picker-wrapper\">\n                <input\n                  type=\"color\"\n                  id=\"section-color\"\n                  class=\"section-color-input\"\n                  value={this.editedColor}\n                  onInput={this.handleColorInput}\n                />\n                <input\n                  type=\"text\"\n                  class=\"color-hex-input\"\n                  value={this.editedColor}\n                  onInput={this.handleColorInput}\n                  placeholder=\"#ffffff\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"panel-footer\">\n            <button class=\"delete-btn\" onClick={this.handleDelete}>\n              Delete Section\n            </button>\n            <div class=\"footer-actions\">\n              <button class=\"cancel-btn\" onClick={this.handleClose}>\n                Cancel\n              </button>\n              <button class=\"save-btn\" onClick={this.handleSave}>\n                Save Changes\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"],"names":["debug"],"mappings":"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"}