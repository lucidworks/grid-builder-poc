import{a as t,f as e}from"./p-4Z_c7dK2.js";const n=(t,e,n)=>{const s=t.get(e);if(!s){t.set(e,[n])}else if(!s.includes(n)){s.push(n)}};const s=(t,e)=>{let n;return(...s)=>{if(n){clearTimeout(n)}n=setTimeout((()=>{n=0;t(...s)}),e)}};const o=t=>!("isConnected"in t)||t.isConnected;const i=s((t=>{for(let e of t.keys()){t.set(e,t.get(e).filter(o))}}),2e3);const r=()=>{if(typeof t!=="function"){return{}}const s=new Map;return{dispose:()=>s.clear(),get:e=>{const o=t();if(o){n(s,e,o)}},set:t=>{const n=s.get(t);if(n){s.set(t,n.filter(e))}i(s)},reset:()=>{s.forEach((t=>t.forEach(e)));i(s)}}};const c=t=>typeof t==="function"?t():t;const u=(t,e=(t,e)=>t!==e)=>{const n=c(t);let s=new Map(Object.entries(n??{}));const o={dispose:[],get:[],set:[],reset:[]};const i=new Map;const r=()=>{s=new Map(Object.entries(c(t)??{}));o.reset.forEach((t=>t()))};const u=()=>{o.dispose.forEach((t=>t()));r()};const f=t=>{o.get.forEach((e=>e(t)));return s.get(t)};const l=(t,n)=>{const i=s.get(t);if(e(n,i,t)){s.set(t,n);o.set.forEach((e=>e(t,n,i)))}};const d=typeof Proxy==="undefined"?{}:new Proxy(n,{get(t,e){return f(e)},ownKeys(t){return Array.from(s.keys())},getOwnPropertyDescriptor(){return{enumerable:true,configurable:true}},has(t,e){return s.has(e)},set(t,e,n){l(e,n);return true}});const m=(t,e)=>{o[t].push(e);return()=>{a(o[t],e)}};const h=(e,n)=>{const s=(t,s)=>{if(t===e){n(s)}};const o=()=>n(c(t)[e]);const r=m("set",s);const u=m("reset",o);i.set(n,{setHandler:s,resetHandler:o,propName:e});return()=>{r();u();i.delete(n)}};const p=(...t)=>{const e=t.reduce(((t,e)=>{if(e.set){t.push(m("set",e.set))}if(e.get){t.push(m("get",e.get))}if(e.reset){t.push(m("reset",e.reset))}if(e.dispose){t.push(m("dispose",e.dispose))}return t}),[]);return()=>e.forEach((t=>t()))};const b=t=>{const e=s.get(t);o.set.forEach((n=>n(t,e,e)))};const I=(t,e)=>{const n=i.get(e);if(n&&n.propName===t){a(o.set,n.setHandler);a(o.reset,n.resetHandler);i.delete(e)}};return{state:d,get:f,set:l,on:m,onChange:h,use:p,dispose:u,reset:r,forceUpdate:b,removeListener:I}};const a=(t,e)=>{const n=t.indexOf(e);if(n>=0){t[n]=t[t.length-1];t.length--}};const f=(t,e)=>{const n=u(t,e);n.use(r());return n};function l(){if(typeof process!=="undefined"&&process.env&&"production"==="development");if(typeof process!=="undefined"&&process.env&&"production"==="test");return false}const d={log(...t){if(l()){console.log(...t)}},warn(...t){if(l()){console.warn(...t)}},error(...t){if(l()){console.error(...t)}},group(t,e){if(l()){console.group(t);e();console.groupEnd()}},isEnabled(){return l()}};function m(t){return{log(...e){d.log(`[${t}]`,...e)},warn(...e){d.warn(`[${t}]`,...e)},error(...e){d.error(`[${t}]`,...e)},group(e,n){d.group(`[${t}] ${e}`,n)},isEnabled(){return d.isEnabled()}}}const h={x:{min:0},y:{min:0},width:{min:1,max:50},height:{min:1,max:100}};function p(t,e){const n=[];if(!t){n.push(`${e} layout is missing or undefined`);return{valid:false,errors:n}}const s=["x","y","width","height"];for(const o of s){if(typeof t[o]!=="number"||!Number.isFinite(t[o])){n.push(`${e} layout.${o} must be a finite number, got: ${t[o]}`)}}if(Number.isFinite(t.x)&&t.x<h.x.min){n.push(`${e} layout.x must be >= ${h.x.min}, got: ${t.x}`)}if(Number.isFinite(t.y)&&t.y<h.y.min){n.push(`${e} layout.y must be >= ${h.y.min}, got: ${t.y}`)}if(Number.isFinite(t.width)&&(t.width<h.width.min||t.width>h.width.max)){n.push(`${e} layout.width must be between ${h.width.min}-${h.width.max}, got: ${t.width}`)}if(Number.isFinite(t.height)&&(t.height<h.height.min||t.height>h.height.max)){n.push(`${e} layout.height must be between ${h.height.min}-${h.height.max}, got: ${t.height}`)}return{valid:n.length===0,errors:n}}function b(t){const e=[];if(!t){e.push("Item is null or undefined");return{valid:false,errors:e}}if(typeof t.id!=="string"||t.id.trim()===""){e.push(`Item.id must be a non-empty string, got: ${t.id}`)}if(typeof t.canvasId!=="string"||t.canvasId.trim()===""){e.push(`Item.canvasId must be a non-empty string, got: ${t.canvasId}`)}if(typeof t.type!=="string"||t.type.trim()===""){e.push(`Item.type must be a non-empty string, got: ${t.type}`)}if(typeof t.zIndex!=="number"||!Number.isFinite(t.zIndex)){e.push(`Item.zIndex must be a finite number, got: ${t.zIndex} (type: ${typeof t.zIndex})`)}if(!t.layouts||typeof t.layouts!=="object"){e.push("Item.layouts must be an object");return{valid:false,errors:e}}const n=p(t.layouts.desktop,"desktop");if(!n.valid){e.push(...n.errors)}if(t.layouts.mobile){const n=p(t.layouts.mobile,"mobile");if(!n.valid){e.push(...n.errors)}}return{valid:e.length===0,errors:e}}function I(t){const e=[];if(!t||typeof t!=="object"){e.push("Updates must be an object");return{valid:false,errors:e}}if(t.layouts){if(typeof t.layouts!=="object"){e.push("Updates.layouts must be an object")}else{if(t.layouts.desktop){const n=p(t.layouts.desktop,"desktop");if(!n.valid){e.push(...n.errors)}}if(t.layouts.mobile){const n=p(t.layouts.mobile,"mobile");if(!n.valid){e.push(...n.errors)}}}}if("zIndex"in t&&(typeof t.zIndex!=="number"||!Number.isFinite(t.zIndex))){e.push(`Updates.zIndex must be a finite number, got: ${t.zIndex}`)}if("config"in t&&typeof t.config!=="object"){e.push(`Updates.config must be an object, got: ${typeof t.config}`)}return{valid:e.length===0,errors:e}}const g={canvases:{},selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,currentViewport:"desktop",showGrid:true};const v=m("state-manager");class y{constructor(t){this.itemIdCounter=0;const e=Object.assign(Object.assign({},g),t);const{state:n,onChange:s,dispose:o}=f(e);this.state=n;this.onChange=s;this.dispose=o;this.initialState=JSON.parse(JSON.stringify(e))}reset(){this.itemIdCounter=0;this.state.canvases=JSON.parse(JSON.stringify(this.initialState.canvases));this.state.selectedItemId=this.initialState.selectedItemId;this.state.selectedCanvasId=this.initialState.selectedCanvasId;this.state.activeCanvasId=this.initialState.activeCanvasId;this.state.currentViewport=this.initialState.currentViewport;this.state.showGrid=this.initialState.showGrid}addItemToCanvas(t,e){const n=this.state.canvases[t];if(!n){return}const s=b(e);if(!s.valid){v.warn("⚠️ [addItemToCanvas] with validation issues:",{itemId:e.id,canvasId:t,errors:s.errors})}n.items.push(e);this.state.canvases=Object.assign({},this.state.canvases)}removeItemFromCanvas(t,e){const n=this.state.canvases[t];if(!n){return}n.items=n.items.filter((t=>t.id!==e));this.state.canvases=Object.assign({},this.state.canvases)}updateItem(t,e,n){const s=this.state.canvases[t];if(!s){return}const o=s.items.find((t=>t.id===e));if(!o){return}const i=I(n);if(!i.valid){v.warn("⚠️ [updateItem] with validation issues:",{itemId:e,canvasId:t,updates:n,errors:i.errors})}Object.assign(o,n);this.state.canvases=Object.assign({},this.state.canvases)}getItem(t,e){const n=this.state.canvases[t];if(!n){return null}return n.items.find((t=>t.id===e))||null}moveItemToCanvas(t,e,n){const s=this.state.canvases[t];const o=this.state.canvases[e];if(!s||!o){return}const i=s.items.find((t=>t.id===n));if(!i){return}const r=b(i);if(!r.valid){v.warn("⚠️ [moveItemToCanvas] with validation issues:",{itemId:n,fromCanvasId:t,toCanvasId:e,errors:r.errors})}s.items=s.items.filter((t=>t.id!==n));i.canvasId=e;o.items.push(i);this.state.canvases=Object.assign({},this.state.canvases)}generateItemId(){return`item-${++this.itemIdCounter}`}setItemZIndex(t,e,n){const s=this.state.canvases[t];if(!s){return null}const o=s.items.find((t=>t.id===e));if(!o){return null}const i=o.zIndex;o.zIndex=n;if(n>=s.zIndexCounter){s.zIndexCounter=n+1}this.state.canvases=Object.assign({},this.state.canvases);return{oldZIndex:i,newZIndex:n}}moveItemForward(t,e){const n=this.state.canvases[t];if(!n){return null}const s=n.items.find((t=>t.id===e));if(!s){return null}const o=[...n.items].sort(((t,e)=>t.zIndex-e.zIndex));const i=o.findIndex((t=>t.id===e));if(i===o.length-1){return null}const r=o[i+1];const c=s.zIndex;const u=r.zIndex;s.zIndex=u;r.zIndex=c;this.state.canvases=Object.assign({},this.state.canvases);return{oldZIndex:c,newZIndex:u}}moveItemBackward(t,e){const n=this.state.canvases[t];if(!n){return null}const s=n.items.find((t=>t.id===e));if(!s){return null}const o=[...n.items].sort(((t,e)=>t.zIndex-e.zIndex));const i=o.findIndex((t=>t.id===e));if(i===0){return null}const r=o[i-1];const c=s.zIndex;const u=r.zIndex;s.zIndex=u;r.zIndex=c;this.state.canvases=Object.assign({},this.state.canvases);return{oldZIndex:c,newZIndex:u}}bringItemToFront(t,e){const n=this.state.canvases[t];if(!n){return null}const s=n.items.find((t=>t.id===e));if(!s){return null}const o=s.zIndex;const i=Math.max(...n.items.map((t=>t.zIndex)));if(o===i){return null}const r=n.zIndexCounter++;s.zIndex=r;this.state.canvases=Object.assign({},this.state.canvases);return{oldZIndex:o,newZIndex:r}}sendItemToBack(t,e){const n=this.state.canvases[t];if(!n){return null}const s=n.items.find((t=>t.id===e));if(!s){return null}const o=s.zIndex;const i=Math.min(...n.items.map((t=>t.zIndex)));if(o===i){return null}const r=i-1;s.zIndex=r;this.state.canvases=Object.assign({},this.state.canvases);return{oldZIndex:o,newZIndex:r}}selectItem(t,e){this.state.selectedItemId=t;this.state.selectedCanvasId=e}deselectItem(){this.state.selectedItemId=null;this.state.selectedCanvasId=null}setActiveCanvas(t){this.state.activeCanvasId=t}clearActiveCanvas(){this.state.activeCanvasId=null}addItemsBatch(t){const e=[];const n=Object.assign({},this.state.canvases);for(const s of t){const t=this.generateItemId();const o=s.canvasId;const i=n[o];if(!i){console.warn(`Canvas ${o} not found, skipping item`);continue}const r={id:t,canvasId:o,type:s.type||"unknown",name:s.name||"Unnamed",layouts:s.layouts||{desktop:{x:0,y:0,width:20,height:10},mobile:{x:null,y:null,width:null,height:null,customized:false}},zIndex:i.zIndexCounter++,config:s.config||{}};const c=b(r);if(!c.valid){v.warn("⚠️ [addItemsBatch] with validation issues:",{itemId:t,canvasId:o,errors:c.errors})}i.items.push(r);e.push(t)}this.state.canvases=n;return e}deleteItemsBatch(t){const e=new Set(t);const n=Object.assign({},this.state.canvases);for(const t in n){n[t]=Object.assign(Object.assign({},n[t]),{items:n[t].items.filter((t=>!e.has(t.id)))})}this.state.canvases=n}updateItemsBatch(t){const e=Object.assign({},this.state.canvases);for(const{itemId:n,canvasId:s,updates:o}of t){const t=e[s];if(!t){console.warn(`Canvas ${s} not found, skipping item ${n}`);continue}const i=t.items.find((t=>t.id===n));if(!i){console.warn(`Item ${n} not found in canvas ${s}`);continue}Object.assign(i,o)}this.state.canvases=e}}const $=new y;const w=$.state;const j=()=>$.generateItemId();const x=(t,e)=>$.selectItem(t,e);const O=t=>$.setActiveCanvas(t);const C=t=>$.addItemsBatch(t);const N=t=>$.deleteItemsBatch(t);const Z=t=>$.updateItemsBatch(t);export{y as S,x as a,f as b,m as c,N as d,C as e,j as f,w as g,O as s,Z as u};
//# sourceMappingURL=p-DhZJyO2V.js.map