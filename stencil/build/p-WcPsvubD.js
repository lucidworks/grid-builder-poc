import{f as t}from"./p-BiM0xz1T.js";const e=t("undo-redo-commands");class i{constructor(t,e,i,s,n,o,r,c,d,a,h,u,l,v){this.itemId=t;this.sourceCanvasId=e;this.targetCanvasId=i;this.sourcePosition=Object.assign({},s);this.targetPosition=Object.assign({},n);this.sourceIndex=o;this.sourceZIndex=r;this.targetZIndex=c;this.sourceSize=d?Object.assign({},d):undefined;this.targetSize=a?Object.assign({},a):undefined;this.stateInstance=h;this.activeViewport=u;this.sourceMobileLayout=l?Object.assign({},l):undefined;this.targetMobileLayout=v?Object.assign({},v):undefined}undo(){e.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let t=this.stateInstance.canvases[this.targetCanvasId];let i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){for(const e in this.stateInstance.canvases){const s=this.stateInstance.canvases[e];i=s.items.find((t=>t.id===this.itemId));if(i){t=s;break}}}if(!i||!t){console.warn("  âŒ Item or canvas not found, aborting undo");return}e.log("  ðŸ“ Found item, current position:",{viewport:this.activeViewport,x:i.layouts[this.activeViewport].x,y:i.layouts[this.activeViewport].y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.sourceCanvasId;i.zIndex=this.sourceZIndex;i.layouts[this.activeViewport].x=this.sourcePosition.x;i.layouts[this.activeViewport].y=this.sourcePosition.y;e.log("  âœ… Updated item position and z-index to:",{viewport:this.activeViewport,x:i.layouts[this.activeViewport].x,y:i.layouts[this.activeViewport].y,zIndex:i.zIndex});if(this.sourceSize){i.layouts[this.activeViewport].width=this.sourceSize.width;i.layouts[this.activeViewport].height=this.sourceSize.height}if(this.activeViewport==="desktop"&&this.sourceMobileLayout){i.layouts.mobile=Object.assign({},this.sourceMobileLayout)}const s=this.stateInstance.canvases[this.sourceCanvasId];if(!s){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=s.items.length){s.items.splice(this.sourceIndex,0,i)}else{s.items.push(i)}this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);const n=document.getElementById(this.itemId);if(n){e.log("  ðŸŽ¨ Clearing inline transform style");n.style.transform=""}e.log("  âœ… Undo complete")}redo(){e.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const t=this.stateInstance.canvases[this.sourceCanvasId];const i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){console.warn("  âŒ Item not found, aborting redo");return}e.log("  ðŸ“ Found item, current position:",{viewport:this.activeViewport,x:i.layouts[this.activeViewport].x,y:i.layouts[this.activeViewport].y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.targetCanvasId;i.zIndex=this.targetZIndex;i.layouts[this.activeViewport].x=this.targetPosition.x;i.layouts[this.activeViewport].y=this.targetPosition.y;e.log("  âœ… Updated item position and z-index to:",{viewport:this.activeViewport,x:i.layouts[this.activeViewport].x,y:i.layouts[this.activeViewport].y,zIndex:i.zIndex});if(this.targetSize){i.layouts[this.activeViewport].width=this.targetSize.width;i.layouts[this.activeViewport].height=this.targetSize.height}if(this.activeViewport==="desktop"&&this.targetMobileLayout){i.layouts.mobile=Object.assign({},this.targetMobileLayout)}const s=this.stateInstance.canvases[this.targetCanvasId];if(!s){console.warn("  âŒ Target canvas not found, aborting redo");return}s.items.push(i);this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);const n=document.getElementById(this.itemId);if(n){e.log("  ðŸŽ¨ Clearing inline transform style");n.style.transform=""}e.log("  âœ… Redo complete")}getDescription(){const t=this.sourceSize&&this.targetSize&&(this.sourceSize.width!==this.targetSize.width||this.sourceSize.height!==this.targetSize.height);return{action:t?"resize":"move",source:{position:this.sourcePosition,size:this.sourceSize},target:{position:this.targetPosition,size:this.targetSize}}}}class s{constructor(t,e){this.stateInstance=e;this.itemsData=t.map((t=>{const e=Object.values(this.stateInstance.canvases).flatMap((t=>t.items)).find((e=>e.id===t));return e?JSON.parse(JSON.stringify(e)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));const e=Object.assign({},this.stateInstance.canvases);for(const i in e){const s=e[i];s.items=s.items.filter((e=>!t.includes(e.id)))}this.stateInstance.canvases=e}redo(){const t=Object.assign({},this.stateInstance.canvases);for(const e of this.itemsData){const i=t[e.canvasId];if(i){const t=i.items.some((t=>t.id===e.id));if(!t){i.items.push(e)}}}this.stateInstance.canvases=t}getDescription(){return{action:"batchAdd",itemCount:this.itemsData.length,items:this.itemsData.map((t=>({id:t.id,type:t.type,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y},size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}})))}}}class n{constructor(t,e){this.stateInstance=e;this.itemsData=t.map((t=>{const e=Object.values(this.stateInstance.canvases).flatMap((t=>t.items)).find((e=>e.id===t));return e?JSON.parse(JSON.stringify(e)):null})).filter(Boolean)}undo(){const t=Object.assign({},this.stateInstance.canvases);for(const e of this.itemsData){const i=t[e.canvasId];if(i){const t=i.items.some((t=>t.id===e.id));if(!t){i.items.push(e)}}}this.stateInstance.canvases=t}redo(){const t=this.itemsData.map((t=>t.id));const e=Object.assign({},this.stateInstance.canvases);for(const i in e){const s=e[i];s.items=s.items.filter((e=>!t.includes(e.id)))}this.stateInstance.canvases=e}getDescription(){return{action:"batchDelete",itemCount:this.itemsData.length,items:this.itemsData.map((t=>({id:t.id,type:t.type,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y},size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}})))}}}class o{constructor(t,e){this.stateInstance=e;this.updates=t.map((({itemId:t,canvasId:e,updates:i})=>{const s=this.stateInstance.canvases[e];const n=s===null||s===void 0?void 0:s.items.find((e=>e.id===t));if(!n){return null}return{itemId:t,canvasId:e,oldItem:JSON.parse(JSON.stringify(n)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},n),i)))}})).filter(Boolean)}undo(){const t=Object.assign({},this.stateInstance.canvases);this.updates.forEach((({itemId:e,canvasId:i,oldItem:s})=>{const n=t[i];const o=n===null||n===void 0?void 0:n.items.find((t=>t.id===e));if(o){Object.assign(o,s)}}));this.stateInstance.canvases=t}redo(){const t=Object.assign({},this.stateInstance.canvases);this.updates.forEach((({itemId:e,canvasId:i,newItem:s})=>{const n=t[i];const o=n===null||n===void 0?void 0:n.items.find((t=>t.id===e));if(o){Object.assign(o,s)}}));this.stateInstance.canvases=t}getDescription(){return{action:"batchUpdateConfig",updateCount:this.updates.length,updates:this.updates.map((({itemId:t,canvasId:e,oldItem:i,newItem:s})=>({itemId:t,canvasId:e,oldConfig:i.config,newConfig:s.config})))}}}class r{constructor(t,e,i){this.description="Add Canvas";this.canvasId=t;this.stateInstance=e;this.eventManagerInstance=i}undo(){e.log("ðŸ”™ AddCanvasCommand.undo() - removing canvas:",this.canvasId);delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);e.log("  ðŸ“¢ Emitting canvasRemoved event for:",this.canvasId);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}redo(){this.stateInstance.canvases[this.canvasId]={zIndexCounter:1,items:[]};this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}getDescription(){return{action:"addCanvas",canvasId:this.canvasId}}}class c{constructor(t,e,i){this.description="Remove Canvas";this.canvasSnapshot=null;this.canvasId=t;this.stateInstance=e;this.eventManagerInstance=i;const s=this.stateInstance.canvases[t];if(s){this.canvasSnapshot=JSON.parse(JSON.stringify(s))}}undo(){if(this.canvasSnapshot){this.stateInstance.canvases[this.canvasId]=JSON.parse(JSON.stringify(this.canvasSnapshot));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}}redo(){delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}getDescription(){var t;return{action:"removeCanvas",canvasId:this.canvasId,itemCount:((t=this.canvasSnapshot)===null||t===void 0?void 0:t.items.length)||0}}}class d{constructor(t,e,i){this.changes=t;this.eventManager=e;this.stateInstance=i;if(t.length===1){const e=t[0];this.description=`Change Z-Index (${e.oldZIndex} â†’ ${e.newZIndex})`}else{this.description=`Reorder ${t.length} Layers`}}undo(){this.changes.forEach((t=>{const i=this.stateInstance.canvases[t.canvasId];const s=i===null||i===void 0?void 0:i.items.find((e=>e.id===t.itemId));if(s){s.zIndex=t.oldZIndex;e.log(`Undo z-index change: ${t.itemId} from ${t.newZIndex} to ${t.oldZIndex}`)}}));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);if(this.changes.length===1){const t=this.changes[0];this.eventManager.emit("zIndexChanged",{itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.newZIndex,newZIndex:t.oldZIndex})}else{this.eventManager.emit("zIndexBatchChanged",{changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.newZIndex,newZIndex:t.oldZIndex})))})}}redo(){this.changes.forEach((t=>{const i=this.stateInstance.canvases[t.canvasId];const s=i===null||i===void 0?void 0:i.items.find((e=>e.id===t.itemId));if(s){s.zIndex=t.newZIndex;e.log(`Redo z-index change: ${t.itemId} from ${t.oldZIndex} to ${t.newZIndex}`)}}));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);if(this.changes.length===1){const t=this.changes[0];this.eventManager.emit("zIndexChanged",{itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})}else{this.eventManager.emit("zIndexBatchChanged",{changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})))})}}getDescription(){return{action:"changeZIndex",changeCount:this.changes.length,changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})))}}}function a(t){const e=t.name.toLowerCase();const i=t.message.toLowerCase();if(e.includes("network")||i.includes("network")||i.includes("fetch")||i.includes("timeout")||i.includes("offline")){return{type:"network",severity:"error",recoverable:true,shouldReport:true,userMessage:"Network error. Please check your connection and try again."}}if(e.includes("validation")||i.includes("invalid")||i.includes("required")||i.includes("must be")){return{type:"validation",severity:"warning",recoverable:true,shouldReport:false,userMessage:"Please check your input and try again."}}if(e.includes("auth")||e.includes("permission")||i.includes("unauthorized")||i.includes("forbidden")||i.includes("access denied")){return{type:"permission",severity:"critical",recoverable:false,shouldReport:true,userMessage:"You do not have permission to perform this action."}}if(i.includes("timeout")||i.includes("timed out")){return{type:"timeout",severity:"warning",recoverable:true,shouldReport:true,userMessage:"Operation timed out. Please try again."}}if(e==="typeerror"||e==="referenceerror"||e==="rangeerror"||i.includes("undefined")||i.includes("null")){return{type:"runtime",severity:"error",recoverable:true,shouldReport:true,userMessage:"An unexpected error occurred. Please try again."}}return{type:"unknown",severity:"error",recoverable:true,shouldReport:true,userMessage:"Something went wrong. Please try again."}}function h(t){if(!t.stack){return undefined}const e=/(?:at )?([a-z]+-[a-z-]+)/gi;const i=t.stack.match(e);if(!i||i.length===0){return undefined}const s=Array.from(new Set(i.map((t=>t.replace(/^at /,"")))));return s.join(" > ")}function u(t,e,i=false){if(i){return`${t.name}: ${t.message}`}if(e.userMessage){return e.userMessage}if(t.message&&t.message.length<100){return t.message}return"An error occurred. Please try again."}function l(t,e,i){const s=a(t);const n=h(t);const o=Object.assign({errorBoundary:e,timestamp:Date.now(),userAgent:typeof navigator!=="undefined"?navigator.userAgent:undefined,componentStack:n},i);return{error:t,errorInfo:o,severity:s.severity,recoverable:s.recoverable}}function v(t){switch(t){case"critical":return"ðŸ”´";case"error":return"âš ï¸";case"warning":return"âš¡";case"info":return"â„¹ï¸";default:return"â“"}}function f(t,e){const i=Object.entries(e).sort((([,t],[,e])=>e.minWidth-t.minWidth));for(const[e,s]of i){if(t>=s.minWidth)return e}return i[i.length-1][0]}function m(t,e,i){var s,n;const o=t.layouts[e];const r=i[e];if(o===null||o===void 0?void 0:o.customized){return{layout:o,sourceBreakpoint:e}}if((r===null||r===void 0?void 0:r.layoutMode)==="stack"&&o&&(o.x!==null||o.y!==null||o.width!==null||o.height!==null)){const n=(s=r===null||r===void 0?void 0:r.minWidth)!==null&&s!==void 0?s:0;const c=Object.keys(i).filter((e=>{var i;return(i=t.layouts[e])===null||i===void 0?void 0:i.customized})).sort(((t,e)=>Math.abs(i[t].minWidth-n)-Math.abs(i[e].minWidth-n)));let d=e;if(c.length>0){d=c[0]}else{const t=Object.entries(i).sort((([,t],[,e])=>e.minWidth-t.minWidth))[0][0];d=t}return{layout:o,sourceBreakpoint:d}}if((r===null||r===void 0?void 0:r.layoutMode)==="inherit"&&r.inheritFrom){const e=r.inheritFrom;if(t.layouts[e]){return m(t,e,i)}}const c=(n=r===null||r===void 0?void 0:r.minWidth)!==null&&n!==void 0?n:0;const d=Object.keys(i).filter((e=>{var i;return(i=t.layouts[e])===null||i===void 0?void 0:i.customized})).sort(((t,e)=>Math.abs(i[t].minWidth-c)-Math.abs(i[e].minWidth-c)));if(d.length>0){return{layout:t.layouts[d[0]],sourceBreakpoint:d[0]}}const a=Object.entries(i).sort((([,t],[,e])=>e.minWidth-t.minWidth))[0][0];return{layout:t.layouts[a],sourceBreakpoint:a}}function g(t,e){const i=e[t];return(i===null||i===void 0?void 0:i.layoutMode)==="stack"}function I(t,e,i){var s,n;const o=[...e].sort(((t,e)=>{var s,n,o,r;const c=t.layouts[i];const d=e.layouts[i];const a=(s=c===null||c===void 0?void 0:c.y)!==null&&s!==void 0?s:0;const h=(n=d===null||d===void 0?void 0:d.y)!==null&&n!==void 0?n:0;if(a!==h){return a-h}const u=(o=t.zIndex)!==null&&o!==void 0?o:0;const l=(r=e.zIndex)!==null&&r!==void 0?r:0;return u-l}));const r=o.findIndex((e=>e.id===t.id));let c=0;if(r>0){for(let t=0;t<r;t++){const e=o[t];const n=e.layouts[i];c+=(s=n===null||n===void 0?void 0:n.height)!==null&&s!==void 0?s:6}}const d=t.layouts[i];return{x:0,y:c,width:50,height:(n=d===null||d===void 0?void 0:d.height)!==null&&n!==void 0?n:6,customized:false}}function p(t,e){const i={};const s=Object.entries(t).sort((([,t],[,e])=>e.minWidth-t.minWidth)).map((([t])=>t));const n=s[0];i[n]=Object.assign(Object.assign({},e),{customized:true});for(const n of s.slice(1)){const s=t[n];if(s.layoutMode==="stack"){i[n]={x:0,y:0,width:50,height:e.height,customized:false}}else if(s.layoutMode==="inherit"){i[n]={x:null,y:null,width:null,height:null,customized:false}}else{i[n]=Object.assign(Object.assign({},e),{customized:false})}}return i}const b=50;function O(t,e=b){var i;const s=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;return s<=e}function j(t,e=b){var i,s,n,o;const r=t.defaultSize.width;const c=t.defaultSize.height;const d=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;const a=((s=t.maxSize)===null||s===void 0?void 0:s.width)||Infinity;let h=r;let u=c;let l=false;if(h>e){h=e;l=true}if(h<d){h=d}if(h>a){h=a}const v=((n=t.minSize)===null||n===void 0?void 0:n.height)||0;const f=((o=t.maxSize)===null||o===void 0?void 0:o.height)||Infinity;if(u<v){u=v}if(u>f){u=f}return{width:h,height:u,wasAdjusted:l}}function y(t,e,i,s,n=b){let o=t;let r=e;let c=false;if(o<0){o=0;c=true}if(o+i>n){o=n-i;c=true}if(r<0){r=0;c=true}o=Math.max(0,o);r=Math.max(0,r);return{x:o,y:r,width:i,height:s,positionAdjusted:c,sizeAdjusted:false}}function x(t,e,i,s=b){var n;if(!O(t,s)){console.warn(`Component "${t.name}" minSize (${(n=t.minSize)===null||n===void 0?void 0:n.width}) `+`exceeds canvas width (${s}). Placement rejected.`);return null}const o=j(t,s);const r=y(e,i,o.width,o.height,s);return Object.assign(Object.assign({},r),{sizeAdjusted:o.wasAdjusted})}export{r as A,o as B,b as C,i as M,c as R,y as a,l as b,a as c,m as d,I as e,u as f,v as g,f as h,x as i,d as j,n as k,p as l,s as m,g as s};
//# sourceMappingURL=p-WcPsvubD.js.map