{"file":"grid-calculations-121375de.js","mappings":"AAAA;;;;;;;AAQA;;;AAGA,MAAM,QAAQ;IAAd;QACU,aAAQ,GAA6B,IAAI,GAAG,EAAE,CAAC;KAoCxD;;;;;IA9BC,SAAS,CAAC,QAAgB;;QAExB,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC/B,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAE,CAAC;SACrC;;QAGD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACjD,IAAI,MAAM,EAAE;YACV,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SACrC;QAED,OAAO,MAAM,CAAC;KACf;;;;;IAMD,UAAU,CAAC,QAAgB;QACzB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;KAChC;;;;;IAMD,KAAK;QACH,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;KACvB;CACF;AAED;MACa,QAAQ,GAAG,IAAI,QAAQ;;ACnDpC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA,MAAM,kBAAkB,GAAG,EAAE,CAAC;AAE9B;;;;AAIA,MAAM,4BAA4B,GAAG,IAAI,CAAC;AAE1C;;;;;AAKA,MAAM,aAAa,GAAG,IAAI,GAAG,EAAkB,CAAC;AAEhD;;;;SAIgB,kBAAkB;IAChC,aAAa,CAAC,KAAK,EAAE,CAAC;AACxB,CAAC;AAED;;;;SAIgB,qBAAqB,CAAC,QAAgB,EAAE,cAAuB,KAAK;IAClF,MAAM,QAAQ,GAAG,GAAG,QAAQ,IAAI,CAAC;IAEjC,IAAI,CAAC,WAAW,IAAI,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;QAC/C,OAAO,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAE,CAAC;KACrC;;IAGD,MAAM,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;IAC/C,IAAI,CAAC,SAAS,EAAE;QACd,OAAO,CAAC,IAAI,CAAC,+BAA+B,QAAQ,EAAE,CAAC,CAAC;QACxD,OAAO,CAAC,CAAC;KACV;IAED,MAAM,IAAI,GAAG,SAAS,CAAC,WAAW,GAAG,4BAA4B,CAAC;IAClE,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAClC,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;SAGgB,mBAAmB;IACjC,OAAO,kBAAkB,CAAC;AAC5B,CAAC;AAED;;;;SAIgB,aAAa,CAAC,SAAiB,EAAE,QAAgB;;IAE/D,MAAM,QAAQ,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC;IACjD,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC,CAAC;AAC1C,CAAC;AAED;;;;SAIgB,aAAa,CAAC,SAAiB;IAC7C,OAAO,SAAS,GAAG,kBAAkB,CAAC;AACxC,CAAC;AAED;;;SAGgB,aAAa,CAAC,MAAc,EAAE,QAAgB;;IAE5D,MAAM,QAAQ,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC;IACjD,IAAI,QAAQ,KAAK,CAAC,EAAE;QAClB,OAAO,CAAC,CAAC;KACV;IACD,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,CAAC,CAAC;AACvC,CAAC;AAED;;;SAGgB,aAAa,CAAC,MAAc;IAC1C,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,kBAAkB,CAAC,CAAC;AACjD;;;;","names":[],"sources":["src/utils/dom-cache.ts","src/utils/grid-calculations.ts"],"sourcesContent":["/**\n * DOM Cache Utility\n * Cache DOM queries for performance\n *\n * Purpose: Reduce repeated document.getElementById() calls\n * which can be slow when called frequently during drag/resize operations\n */\n\n/**\n * DOM Cache for canvas containers and frequently accessed elements\n */\nclass DOMCache {\n  private canvases: Map<string, HTMLElement> = new Map();\n\n  /**\n   * Get canvas element by ID (cached)\n   * Falls back to document.getElementById if not cached\n   */\n  getCanvas(canvasId: string): HTMLElement | null {\n    // Check cache first\n    if (this.canvases.has(canvasId)) {\n      return this.canvases.get(canvasId)!;\n    }\n\n    // Query DOM and cache\n    const canvas = document.getElementById(canvasId);\n    if (canvas) {\n      this.canvases.set(canvasId, canvas);\n    }\n\n    return canvas;\n  }\n\n  /**\n   * Invalidate cache for a specific canvas\n   * Call this when canvas is removed or replaced\n   */\n  invalidate(canvasId: string): void {\n    this.canvases.delete(canvasId);\n  }\n\n  /**\n   * Clear entire cache\n   * Call this on major DOM restructuring\n   */\n  clear(): void {\n    this.canvases.clear();\n  }\n}\n\n// Export singleton instance\nexport const domCache = new DOMCache();\n","/**\n * Grid Calculations Utility\n * ========================\n *\n * Core system for converting between pixel coordinates and grid units in the drag-and-drop\n * grid builder. This module provides pure functions with performance optimizations through\n * intelligent caching.\n *\n * ## Grid System Architecture\n *\n * The grid uses a hybrid approach combining responsive and fixed sizing:\n *\n * ### Horizontal Grid (Responsive)\n * - **Size**: 2% of container width (50 units across full width)\n * - **Behavior**: Scales proportionally with canvas width changes\n * - **Use case**: Enables responsive layouts that adapt to different screen sizes\n * - **Example**: At 1000px width, each grid unit = 20px (1000 * 0.02)\n *\n * ### Vertical Grid (Fixed)\n * - **Size**: Fixed 20px per grid unit\n * - **Behavior**: Remains constant regardless of viewport size\n * - **Use case**: Provides consistent vertical spacing and predictable heights\n * - **Rationale**: Vertical scrolling is unlimited, so fixed sizing provides better UX\n *\n * ## Performance Optimization Strategy\n *\n * ### Grid Size Caching\n * The horizontal grid size is calculated from DOM elements (container.clientWidth),\n * which is an expensive operation. To minimize performance impact:\n *\n * 1. **First access**: Calculate once per canvas and cache the result\n * 2. **Subsequent access**: Return cached value (no DOM reads)\n * 3. **Cache invalidation**: Clear when canvas resizes (via ResizeObserver)\n *\n * **Performance Impact**:\n * - Without caching: 100 items = 100+ DOM reads during viewport switch\n * - With caching: 100 items = 1 DOM read per canvas during viewport switch\n * - Prevents layout thrashing and reduces reflows\n *\n * ### DOM Caching Integration\n * Uses `domCache` utility to avoid repeated `getElementById` calls, providing\n * a second layer of performance optimization.\n *\n * ## Usage Examples\n *\n * ```typescript\n * // Convert grid position to pixels for rendering\n * const pixelX = gridToPixelsX(10, 'canvas1'); // Grid unit 10 → pixels\n * const pixelY = gridToPixelsY(5);              // Grid unit 5 → 100px\n *\n * // Convert mouse position to grid coordinates\n * const gridX = pixelsToGridX(250, 'canvas1');  // Pixels → grid units\n * const gridY = pixelsToGridY(120);             // 120px → 6 grid units\n *\n * // Clear cache on canvas resize\n * resizeObserver.observe(canvasContainer);\n * resizeObserver.addEventListener(() => clearGridSizeCache());\n * ```\n *\n * @module grid-calculations\n */\n\nimport { domCache } from './dom-cache';\n\n/** Fixed vertical grid size in pixels - provides consistent vertical spacing */\nconst GRID_SIZE_VERTICAL = 20;\n\n/**\n * Horizontal grid size as percentage of container width\n * 0.02 = 2% = 50 grid units across full width\n */\nconst GRID_SIZE_HORIZONTAL_PERCENT = 0.02;\n\n/**\n * Grid size cache to avoid repeated DOM queries\n * Key format: `${canvasId}-h` for horizontal grid sizes\n * Cleared on canvas resize events\n */\nconst gridSizeCache = new Map<string, number>();\n\n/**\n * Clear grid size cache\n * Call this when canvas containers are resized\n */\nexport function clearGridSizeCache() {\n  gridSizeCache.clear();\n}\n\n/**\n * Calculate horizontal grid size (responsive, based on container width)\n * Uses cache to avoid repeated DOM queries\n */\nexport function getGridSizeHorizontal(canvasId: string, forceRecalc: boolean = false): number {\n  const cacheKey = `${canvasId}-h`;\n\n  if (!forceRecalc && gridSizeCache.has(cacheKey)) {\n    return gridSizeCache.get(cacheKey)!;\n  }\n\n  // Use DOM cache instead of getElementById\n  const container = domCache.getCanvas(canvasId);\n  if (!container) {\n    console.warn(`Canvas container not found: ${canvasId}`);\n    return 0;\n  }\n\n  const size = container.clientWidth * GRID_SIZE_HORIZONTAL_PERCENT;\n  gridSizeCache.set(cacheKey, size);\n  return size;\n}\n\n/**\n * Calculate vertical grid size (fixed 20px)\n */\nexport function getGridSizeVertical(): number {\n  return GRID_SIZE_VERTICAL;\n}\n\n/**\n * Convert grid units to pixels for horizontal values (x, width)\n * Uses percentage calculation to match CSS background grid\n */\nexport function gridToPixelsX(gridUnits: number, canvasId: string): number {\n  // Use cached grid size for better performance\n  const gridSize = getGridSizeHorizontal(canvasId);\n  return Math.round(gridUnits * gridSize);\n}\n\n/**\n * Convert grid units to pixels for vertical values (y, height)\n * Uses fixed 20px grid size\n */\nexport function gridToPixelsY(gridUnits: number): number {\n  return gridUnits * GRID_SIZE_VERTICAL;\n}\n\n/**\n * Convert pixels to grid units for horizontal values (x, width)\n */\nexport function pixelsToGridX(pixels: number, canvasId: string): number {\n  // Use cached grid size for better performance\n  const gridSize = getGridSizeHorizontal(canvasId);\n  if (gridSize === 0) {\n    return 0;\n  }\n  return Math.round(pixels / gridSize);\n}\n\n/**\n * Convert pixels to grid units for vertical values (y, height)\n */\nexport function pixelsToGridY(pixels: number): number {\n  return Math.round(pixels / GRID_SIZE_VERTICAL);\n}\n"],"version":3}