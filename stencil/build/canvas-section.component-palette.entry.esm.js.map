{"version":3,"file":"canvas-section.component-palette.entry.esm.js","sources":["src/components/canvas-section/canvas-section.scss?tag=canvas-section","src/components/canvas-section/canvas-section.tsx","src/components/component-palette/component-palette.scss?tag=component-palette","src/components/component-palette/component-palette.tsx"],"sourcesContent":["/**\n * Canvas Section Styles\n * ======================\n *\n * Styles for canvas-section component providing grid background and container.\n */\n\n/* Canvas Section Container - Flush sections with title tab on right */\n.canvas-section {\n  position: relative;\n  display: flex;\n  width: 100%;\n  margin: 0; /* Flush sections - no gaps */\n  padding: 0; /* Flush sections - no gaps */\n  flex-direction: column;\n}\n\n/* Grid Container */\n.grid-container {\n  position: relative;\n  width: 100%;\n  /* min-height set dynamically via inline style (grid-based) */\n  background-image: linear-gradient(rgba(0, 0, 0, 5%) 1px, transparent 1px),\n    linear-gradient(90deg, rgba(0, 0, 0, 5%) 1px, transparent 1px);\n  /* background-size set dynamically via inline style (config-based) */\n  transition: background-color 0.2s;\n}\n\n/* Hide grid when toggle disabled */\n.grid-container.hide-grid {\n  background-image: none;\n}\n\n/* Active canvas highlighting */\n.grid-container.active {\n  outline: 2px solid var(--primary-color, #007bff);\n  outline-offset: -2px;\n  box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.3);\n}\n\n/* Drop target highlighting (when dragging over canvas) */\n/* Only show drop target styling if canvas is not already active */\n.grid-container.drop-target:not(.active) {\n  outline: 3px dashed var(--primary-color, #007bff);\n  outline-offset: -3px;\n  box-shadow:\n    0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent),\n    inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);\n  background-color: color-mix(in srgb, var(--primary-color) 8%, transparent);\n}\n\n/* Canvas title styling - consumer can override */\n.canvas-title {\n  opacity: 0.3;\n  transition: opacity 0.2s ease;\n}\n\n/* Undim canvas title when canvas is active */\n/* Targets .canvas-header that precedes an active canvas-section */\n.canvas-header:has(+ canvas-section .grid-container.active) .canvas-title {\n  opacity: 1;\n}\n\n/* ========================================\n * Click-to-Add Visual Feedback Animations\n * ========================================\n * Animations for click-to-add feature providing visual feedback\n * when users click palette items to add components.\n */\n\n/* Canvas Highlight Animation (Pulse on Border) */\n@keyframes canvas-highlight-pulse {\n  0%,\n  100% {\n    box-shadow: 0 0 0 0 var(--primary-color, #f59e0b);\n    opacity: 1;\n  }\n  50% {\n    box-shadow: 0 0 0 4px var(--primary-color, #f59e0b);\n    opacity: 0.7;\n  }\n}\n\n.canvas-highlight {\n  animation: canvas-highlight-pulse 600ms ease-out;\n}\n\n/* Position Indicator (Ghost Outline) */\n@keyframes position-indicator-fade {\n  0% {\n    opacity: 0.8;\n  }\n  70% {\n    opacity: 0.8;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.position-indicator {\n  position: absolute;\n  border: 2px dashed var(--primary-color, #007bff);\n  opacity: 0.8;\n  pointer-events: none;\n  z-index: 9999;\n  animation: position-indicator-fade 800ms ease-out forwards;\n}\n","/**\n * Canvas Section Component\n * ========================\n *\n * Individual canvas dropzone with grid background and item rendering.\n * This is a library component designed to work with the grid-builder component.\n *\n * ## Purpose\n *\n * Provides a single canvas section with:\n * - **Dropzone**: Accepts palette items and grid items via interact.js\n * - **Grid background**: Visual 2% horizontal Ã— 20px vertical grid\n * - **Item rendering**: Renders all items on this canvas\n * - **ResizeObserver**: Invalidates grid cache on resize\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Section controls (background color picker, clear button, delete button)\n * - Section header with number\n * - Confirm dialogs\n * - section-delete events\n *\n * **Library-specific features**:\n * - Clean canvas without UI controls\n * - Grid background based on GridConfig\n * - Designed to be used inside grid-builder component\n *\n * ## Dropzone Behavior\n *\n * **Accepts two types of drops**:\n *\n * ### 1. Palette Item (Create New)\n * ```typescript\n * new CustomEvent('canvas-drop', {\n *   detail: { canvasId, componentType, x, y },\n *   bubbles: true,\n *   composed: true\n * })\n * ```\n *\n * ### 2. Grid Item (Cross-Canvas Move)\n * ```typescript\n * new CustomEvent('canvas-move', {\n *   detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n *   bubbles: true,\n *   composed: true\n * })\n * ```\n *\n * ## Grid Background\n *\n * **CSS grid pattern**:\n * - Horizontal: 2% of container width (responsive)\n * - Vertical: 20px (fixed)\n * - Color: rgba(0,0,0,0.05)\n * - Toggleable via gridState.showGrid\n *\n * ## Performance\n *\n * **ResizeObserver**: Clears grid cache on container resize\n * **Virtual rendering**: Items use VirtualRenderer for lazy loading\n * **Render version**: Forces item recalculation on resize\n *\n * @module canvas-section\n */\n\nimport { Component, h, Prop, State, Watch } from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Internal imports\nimport {\n  Canvas,\n  GridItem,\n  gridState,\n  onChange,\n  setActiveCanvas,\n} from \"../../services/state-manager\";\nimport {\n  clearGridSizeCache,\n  gridToPixelsX,\n  gridToPixelsY,\n  getGridSizeVertical,\n} from \"../../utils/grid-calculations\";\nimport { calculateCanvasHeight } from \"../../utils/canvas-height-calculator\";\nimport { GridConfig } from \"../../types/grid-config\";\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { DeletionHook } from \"../../types/deletion-hook\";\n\n/**\n * CanvasSection Component\n * =======================\n *\n * Library component providing individual canvas dropzone.\n *\n * **Tag**: `<canvas-section>`\n * **Shadow DOM**: Disabled (required for interact.js compatibility)\n * **Reactivity**: Listens to gridState changes via StencilJS store\n */\n@Component({\n  tag: \"canvas-section\",\n  styleUrl: \"canvas-section.scss\",\n  shadow: false, // Light DOM required for interact.js\n})\nexport class CanvasSection {\n  /**\n   * Canvas ID for state management\n   *\n   * **Format**: 'canvas1', 'canvas2', etc.\n   * **Purpose**: Key for accessing canvas data in gridState.canvases\n   * **Required**: Component won't render without valid canvasId\n   */\n  @Prop() canvasId!: string;\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Grid size calculations, constraints\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Component registry (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (built from components prop)\n   * **Structure**: Map<type, ComponentDefinition>\n   * **Purpose**: Pass to grid-item-wrapper for dynamic rendering\n   */\n  @Prop() componentRegistry?: Map<string, ComponentDefinition>;\n\n  /**\n   * Background color for this canvas\n   *\n   * **Host app responsibility**: Pass canvas styling from host app\n   * **Library does NOT store**: backgroundColor is presentation concern\n   * **Optional**: Defaults to '#ffffff'\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   backgroundColor=\"#f0f4f8\"\n   * />\n   * ```\n   */\n  @Prop() backgroundColor?: string;\n\n  /**\n   * Canvas title (from canvasMetadata)\n   *\n   * **Optional**: Display title for this section\n   * **Renders as**: Rotated tab on right side, outside section bounds\n   * **Builder mode only**: Title tabs visible in builder, not viewer\n   * **Source**: Passed from grid-builder via canvasMetadata[canvasId].title\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   canvasTitle=\"Hero Section\"\n   * />\n   * ```\n   */\n  @Prop() canvasTitle?: string;\n\n  /**\n   * Whether this canvas is currently active\n   *\n   * **Purpose**: Indicate which canvas is currently focused/active\n   * **Source**: Computed from gridState.activeCanvasId in grid-builder\n   * **Default**: false\n   * **Visual effect**: Applies 'active' CSS class to grid-container\n   *\n   * **Canvas becomes active when**:\n   * - User clicks item on canvas\n   * - User clicks canvas background\n   * - User starts dragging item on canvas\n   * - User starts resizing item on canvas\n   * - Programmatically via api.setActiveCanvas()\n   *\n   * **Consumer styling hook**:\n   * Consumer can style active canvas via CSS:\n   * ```css\n   * .grid-container.active .canvas-title {\n   *   opacity: 1;\n   * }\n   * ```\n   *\n   * @example\n   * ```tsx\n   * <canvas-section\n   *   canvasId=\"hero-section\"\n   *   isActive={gridState.activeCanvasId === 'hero-section'}\n   * />\n   * ```\n   */\n  @Prop() isActive?: boolean = false;\n\n  /**\n   * Deletion hook (from parent grid-builder)\n   *\n   * **Source**: grid-builder component (from onBeforeDelete prop)\n   * **Purpose**: Pass through to grid-item-wrapper for deletion interception\n   * **Optional**: If not provided, components delete immediately\n   */\n  @Prop() onBeforeDelete?: DeletionHook;\n\n  /**\n   * Canvas state (reactive)\n   *\n   * **Source**: gridState.canvases[canvasId]\n   * **Updates**: componentWillLoad, componentWillUpdate, onChange subscription\n   * **Contains**: items array, zIndexCounter (NO backgroundColor - that's a prop now)\n   */\n  @State() canvas: Canvas;\n\n  /**\n   * Render version counter (forces re-renders)\n   *\n   * **Purpose**: Trigger re-renders when grid calculations change\n   * **Incremented on**: ResizeObserver events, state changes\n   * **Passed to**: grid-item-wrapper as prop\n   * **Why needed**: Grid calculations cached, need to recalculate on resize\n   */\n  @State() renderVersion: number = 0;\n\n  /**\n   * Calculated canvas height (content-based)\n   *\n   * **Purpose**: Dynamic canvas height based on bottommost item\n   * **Calculation**: `(bottommost item y + height) + 5 grid units margin`\n   * **Updates**: Real-time on item add/move/delete/resize\n   * **Minimum**: 0 (CSS min-height: 400px will apply)\n   *\n   * **Formula**:\n   * ```\n   * calculatedHeight = gridToPixelsY(maxItemBottom + 5)\n   * ```\n   *\n   * **Applied in render**:\n   * ```typescript\n   * style={{ height: calculatedHeight > 0 ? `${calculatedHeight}px` : undefined }}\n   * ```\n   */\n  @State() private calculatedHeight: number = 0;\n\n  /**\n   * Drop target state\n   *\n   * **Internal state**: Tracks whether this canvas is currently a valid drop target\n   * **Used for**: Adding 'drop-target' class for visual feedback during drag operations\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - false: No drag is over this canvas\n   * - true: A draggable element is currently over this canvas\n   */\n  @State() private isDropTarget: boolean = false;\n\n  /**\n   * Grid container DOM reference\n   *\n   * **Used for**:\n   * - interact.js dropzone setup\n   * - ResizeObserver monitoring\n   * - Position calculations (getBoundingClientRect)\n   */\n  private gridContainerRef: HTMLElement;\n\n  /**\n   * Dropzone initialization flag\n   *\n   * **Prevents**: Multiple dropzone setups on same element\n   * **Set in**: initializeDropzone()\n   * **Checked in**: initializeDropzone(), disconnectedCallback()\n   */\n  private dropzoneInitialized: boolean = false;\n\n  /**\n   * ResizeObserver instance\n   *\n   * **Monitors**: gridContainerRef size changes\n   * **Callback**: Clears grid cache, increments renderVersion\n   * **Cleanup**: disconnectedCallback() disconnects observer\n   */\n  private resizeObserver: ResizeObserver;\n\n  /**\n   * Component will load lifecycle hook\n   *\n   * **Called**: Before first render\n   * **Purpose**: Load initial canvas state and subscribe to changes\n   *\n   * **Operations**:\n   * 1. Load canvas from global state\n   * 2. Subscribe to 'canvases' state changes\n   * 3. Update local canvas state on changes\n   * 4. Increment renderVersion to trigger item re-renders\n   */\n  componentWillLoad() {\n    // Initial load\n    this.canvas = gridState.canvases[this.canvasId];\n\n    // Calculate initial height\n    this.calculatedHeight = calculateCanvasHeight(this.canvasId, this.config);\n\n    // Subscribe to state changes\n    onChange(\"canvases\", () => {\n      try {\n        if (this.canvasId && gridState.canvases[this.canvasId]) {\n          this.canvas = gridState.canvases[this.canvasId];\n          this.renderVersion++; // Force re-render\n\n          // Recalculate canvas height based on content\n          this.calculatedHeight = calculateCanvasHeight(\n            this.canvasId,\n            this.config,\n          );\n        }\n      } catch (error) {\n        console.debug(\"Canvas section state update skipped:\", error);\n      }\n    });\n\n    // Subscribe to viewport changes (desktop â†” mobile)\n    onChange(\"currentViewport\", () => {\n      // Recalculate height for new viewport layout\n      this.calculatedHeight = calculateCanvasHeight(this.canvasId, this.config);\n    });\n\n    // Subscribe to grid visibility changes\n    onChange(\"showGrid\", () => {\n      // Force re-render to update grid visibility class\n      this.renderVersion++;\n    });\n  }\n\n  /**\n   * Component will update lifecycle hook\n   *\n   * **Called**: Before each re-render\n   * **Purpose**: Ensure canvas reference is fresh from state\n   */\n  componentWillUpdate() {\n    this.canvas = gridState.canvases[this.canvasId];\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize interact.js dropzone and ResizeObserver\n   */\n  componentDidLoad() {\n    this.initializeDropzone();\n    this.setupResizeObserver();\n    this.setupCanvasClickListener();\n  }\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component removed from DOM\n   * **Purpose**: Clean up interact.js and ResizeObserver\n   */\n  disconnectedCallback() {\n    // Cleanup interact.js\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n    }\n\n    // Cleanup ResizeObserver\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n  }\n\n  /**\n   * Watch for canvasId prop changes\n   *\n   * **When triggered**: Parent changes which canvas this component displays\n   * **Actions**: Reload canvas data from state, recalculate height\n   *\n   * **Why needed**:\n   * - Canvas ID is the key to access state\n   * - Changing canvas ID means displaying different canvas\n   * - Must reload items, metadata, and recalculate layout\n   *\n   * **Note**: This is rare in practice - usually canvas IDs are static\n   */\n  @Watch(\"canvasId\")\n  handleCanvasIdChange(newCanvasId: string, oldCanvasId: string) {\n    // Skip if canvas ID hasn't changed\n    if (newCanvasId === oldCanvasId) return;\n\n    // Reload canvas data from state\n    this.canvas = gridState.canvases[newCanvasId];\n\n    // Recalculate canvas height for new canvas\n    this.calculatedHeight = calculateCanvasHeight(newCanvasId, this.config);\n\n    // Reinitialize dropzone with new canvas ID\n    // (dropzone needs to know which canvas it belongs to)\n    if (this.gridContainerRef && this.dropzoneInitialized) {\n      interact(this.gridContainerRef).unset();\n      this.dropzoneInitialized = false;\n      this.initializeDropzone();\n    }\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Recalculate canvas height with new grid settings\n   *\n   * **Why needed**:\n   * - Grid calculations depend on config (min/max grid size, etc.)\n   * - Canvas height calculation uses grid-to-pixels conversions\n   * - Config changes affect layout calculations\n   */\n  @Watch(\"config\")\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Recalculate canvas height with new config\n    this.calculatedHeight = calculateCanvasHeight(this.canvasId, newConfig);\n\n    // Force re-render to update item positions with new grid size\n    this.renderVersion++;\n  }\n\n  /**\n   * Watch for isActive prop changes\n   *\n   * **When triggered**: Active canvas changes in grid-builder\n   * **Purpose**: Apply/remove 'active' CSS class for styling\n   *\n   * **Note**: No action needed - the prop change triggers re-render\n   * and the render() method applies the 'active' class based on this.isActive\n   *\n   * **Visual feedback**:\n   * - Active canvas may have highlighted border\n   * - Canvas title may be un-dimmed\n   * - Host app can style via `.grid-container.active` selector\n   */\n  @Watch(\"isActive\")\n  handleIsActiveChange(newIsActive: boolean, oldIsActive: boolean) {\n    // Skip if active state hasn't changed\n    if (newIsActive === oldIsActive) return;\n\n    // No action needed - render() will apply/remove 'active' class\n    // This watcher is just for documentation and potential future enhancements\n  }\n\n  /**\n   * Setup canvas click listener for background selection\n   *\n   * **Purpose**: Detect clicks on canvas background (not on grid items)\n   *\n   * **Event dispatch**:\n   * - Only fires when clicking empty canvas area\n   * - Does not fire when clicking grid items\n   * - Bubbles up to grid-builder for host app to handle\n   *\n   * **Custom event**:\n   * ```typescript\n   * new CustomEvent('canvas-click', {\n   *   detail: { canvasId },\n   *   bubbles: true,\n   *   composed: true\n   * })\n   * ```\n   *\n   * **Use case**: Host app can show canvas settings panel when canvas selected\n   */\n  private setupCanvasClickListener = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    this.gridContainerRef.addEventListener(\"click\", (event: MouseEvent) => {\n      // Only fire if clicking directly on the grid container\n      // (not on a grid item or other child element)\n      if (event.target === this.gridContainerRef) {\n        // Set this canvas as active\n        setActiveCanvas(this.canvasId);\n\n        // Emit canvas-activated event\n        const canvasActivatedEvent = new CustomEvent(\"canvas-activated\", {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasActivatedEvent);\n\n        // Emit canvas-click event (backward compatibility)\n        const canvasClickEvent = new CustomEvent(\"canvas-click\", {\n          detail: {\n            canvasId: this.canvasId,\n          },\n          bubbles: true,\n          composed: true,\n        });\n        this.gridContainerRef.dispatchEvent(canvasClickEvent);\n      }\n    });\n  };\n\n  /**\n   * Setup ResizeObserver for grid cache invalidation\n   *\n   * **Purpose**: Detect container size changes and force grid recalculation\n   *\n   * **Observer callback**:\n   * 1. Clear grid size cache (grid-calculations.ts)\n   * 2. Increment renderVersion (triggers item re-renders)\n   *\n   * **Why needed**:\n   * - Grid calculations cached for performance\n   * - Cache based on container width (responsive 2% units)\n   * - Container resize invalidates cache\n   * - Items need to recalculate positions with new dimensions\n   */\n  private setupResizeObserver = () => {\n    if (!this.gridContainerRef) {\n      return;\n    }\n\n    // Watch for canvas container size changes\n    this.resizeObserver = new ResizeObserver(() => {\n      // Clear grid size cache when container resizes\n      clearGridSizeCache();\n\n      // Force re-render to update item positions\n      this.renderVersion++;\n    });\n\n    this.resizeObserver.observe(this.gridContainerRef);\n  };\n\n  /**\n   * Initialize interact.js dropzone\n   *\n   * **Called from**: componentDidLoad (after DOM available)\n   * **Purpose**: Setup dropzone to receive palette items and grid items\n   *\n   * ## Dropzone Configuration\n   *\n   * **Accept pattern**: `.palette-item, .grid-item`\n   * - `.palette-item` - New components from palette\n   * - `.grid-item` - Existing items for cross-canvas moves\n   *\n   * **Overlap mode**: `'pointer'`\n   * - Drop detection based on cursor position\n   * - More intuitive than element overlap\n   *\n   * ## Drop Event Handling\n   *\n   * ### 1. Palette Item Drop (Create New)\n   *\n   * **Component type extraction**:\n   * ```typescript\n   * const componentType = droppedElement.getAttribute('data-component-type');\n   * ```\n   *\n   * **Position calculation**:\n   * - Get component's defaultSize from definition\n   * - Calculate half dimensions for cursor-centering\n   * - Subtract half dimensions from cursor position\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-drop', {\n   *   detail: { canvasId, componentType, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   *\n   * ### 2. Grid Item Drop (Cross-Canvas Move)\n   *\n   * **Only process cross-canvas moves**:\n   * - Same-canvas moves handled by drag handler\n   * - Prevents duplicate events\n   *\n   * **Position calculation**:\n   * - Use element's bounding rect (already positioned by drag handler)\n   * - Calculate position relative to target canvas\n   *\n   * **Custom event dispatch**:\n   * ```typescript\n   * dispatchEvent(new CustomEvent('canvas-move', {\n   *   detail: { itemId, sourceCanvasId, targetCanvasId, x, y },\n   *   bubbles: true,\n   *   composed: true\n   * }));\n   * ```\n   */\n  private initializeDropzone = () => {\n    if (!this.gridContainerRef || this.dropzoneInitialized) {\n      return;\n    }\n\n    const interactable = interact(this.gridContainerRef);\n\n    interactable.dropzone({\n      accept: \".palette-item, .grid-item, .grid-item-header\",\n      overlap: \"pointer\",\n\n      listeners: {\n        dragenter: (_event: any) => {\n          // Add visual feedback when drag enters canvas (replaces classList.add)\n          this.isDropTarget = true;\n        },\n\n        dragleave: (_event: any) => {\n          // Remove visual feedback when drag leaves canvas (replaces classList.remove)\n          this.isDropTarget = false;\n        },\n\n        drop: (event: any) => {\n          // Remove visual feedback on successful drop (replaces classList.remove)\n          this.isDropTarget = false;\n          let droppedElement = event.relatedTarget;\n\n          // If dropped element is inside a palette item, get the palette item\n          const paletteItem = droppedElement.closest(\".palette-item\");\n          if (paletteItem) {\n            droppedElement = paletteItem;\n          }\n\n          const isPaletteItem =\n            droppedElement.classList.contains(\"palette-item\");\n\n          // Mark palette item drop as valid (for snap-back animation)\n          if (isPaletteItem) {\n            (droppedElement as any)._dropWasValid = true;\n          }\n\n          // Check if it's a grid item or grid item header (drag handle)\n          const isGridItemHeader =\n            droppedElement.classList.contains(\"grid-item-header\");\n          const isGridItem = droppedElement.classList.contains(\"grid-item\");\n\n          // If it's the header, find the parent grid-item\n          const gridItem = isGridItemHeader\n            ? droppedElement.closest(\".grid-item\")\n            : droppedElement;\n\n          if (isPaletteItem) {\n            // Dropping from palette - create new item\n            const componentType = droppedElement.getAttribute(\n              \"data-component-type\",\n            );\n\n            // Get stored dimensions from palette drag handler (or fall back to 10Ã—6 default)\n            const defaultWidth = (droppedElement as any)._defaultWidth || 10;\n            const defaultHeight = (droppedElement as any)._defaultHeight || 6;\n            const widthPx = gridToPixelsX(\n              defaultWidth,\n              this.canvasId,\n              this.config,\n            );\n            const heightPx = gridToPixelsY(defaultHeight);\n            const halfWidth = widthPx / 2;\n            const halfHeight = heightPx / 2;\n\n            // Get drop position relative to grid container (cursor-centered)\n            const rect = this.gridContainerRef.getBoundingClientRect();\n            const x = event.dragEvent.clientX - rect.left - halfWidth;\n            const y = event.dragEvent.clientY - rect.top - halfHeight;\n\n            // Dispatch custom event for grid-builder to handle\n            const dropEvent = new CustomEvent(\"canvas-drop\", {\n              detail: {\n                canvasId: this.canvasId,\n                componentType,\n                x,\n                y,\n              },\n              bubbles: true,\n              composed: true,\n            });\n            this.gridContainerRef.dispatchEvent(dropEvent);\n          } else if (isGridItem || isGridItemHeader) {\n            // Moving existing grid item to different canvas\n            const itemId = gridItem.id;\n            const sourceCanvasId = gridItem.getAttribute(\"data-canvas-id\");\n\n            // Only process cross-canvas moves\n            if (sourceCanvasId !== this.canvasId) {\n              // Get element's position (already positioned by drag handler)\n              const droppedRect = gridItem.getBoundingClientRect();\n              const rect = this.gridContainerRef.getBoundingClientRect();\n\n              // Calculate position relative to target canvas\n              const x = droppedRect.left - rect.left;\n              const y = droppedRect.top - rect.top;\n\n              // Dispatch custom event for cross-canvas move\n              const moveEvent = new CustomEvent(\"canvas-move\", {\n                detail: {\n                  itemId,\n                  sourceCanvasId,\n                  targetCanvasId: this.canvasId,\n                  x,\n                  y,\n                },\n                bubbles: true,\n                composed: true,\n              });\n              this.gridContainerRef.dispatchEvent(moveEvent);\n            }\n          }\n        },\n      },\n    });\n\n    this.dropzoneInitialized = true;\n  };\n\n  /**\n   * Render component template\n   *\n   * **Structure**:\n   * - Grid container with background\n   * - Dynamic class for grid visibility\n   * - Background color from canvas state\n   * - Item rendering loop\n   *\n   * **Grid background**:\n   * - CSS linear gradients (2% horizontal, 20px vertical)\n   * - Toggleable via gridState.showGrid\n   * - Hidden when .hide-grid class applied\n   *\n   * **Item rendering**:\n   * - Maps over canvas.items\n   * - Renders grid-item-wrapper for each item\n   * - Passes renderVersion to force recalculation\n   */\n  render() {\n    const showGrid = gridState.showGrid;\n    const verticalGridSize = getGridSizeVertical(this.config);\n\n    // Calculate min-height from config (default 20 grid units)\n    const minHeightGridUnits = this.config?.canvasMinHeight ?? 20;\n    const minHeightPx = gridToPixelsY(minHeightGridUnits, this.config);\n\n    return (\n      <div class=\"canvas-section\" data-canvas-id={this.canvasId}>\n        <div\n          class={{\n            \"grid-container\": true,\n            \"hide-grid\": !showGrid,\n            active: this.isActive,\n            \"drop-target\": this.isDropTarget,\n          }}\n          id={this.canvasId}\n          role=\"region\"\n          aria-label={this.canvasTitle || `Canvas ${this.canvasId}`}\n          data-canvas-id={this.canvasId}\n          style={{\n            backgroundColor: this.backgroundColor || \"#ffffff\",\n            backgroundSize: `2% ${verticalGridSize}px`,\n            minHeight: `${minHeightPx}px`,\n            ...(this.calculatedHeight > 0\n              ? { height: `${this.calculatedHeight}px` }\n              : {}),\n          }}\n          ref={(el) => (this.gridContainerRef = el)}\n        >\n          {/* Grid items rendered by grid-item-wrapper components */}\n          {this.canvas?.items.map((item: GridItem) => (\n            <grid-item-wrapper\n              key={item.id}\n              item={item}\n              renderVersion={this.renderVersion}\n              config={this.config}\n              componentRegistry={this.componentRegistry}\n              onBeforeDelete={this.onBeforeDelete}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  }\n}\n","/**\n * Component Palette Styles\n * =========================\n *\n * Styles for component-palette component with draggable items and drag clone.\n */\n\n/* Component Palette */\n.palette {\n  width: 250px;\n  padding: 20px;\n  border-right: 1px solid #ddd;\n  background: white;\n  overflow-y: auto;\n}\n\n.palette h2 {\n  margin-bottom: 20px;\n  color: #333;\n  font-size: 18px;\n}\n\n/* Chromeless Mode - for embedding with custom structure */\n.palette-chromeless {\n  /* Remove default padding/border if you want minimal styling */\n  /* Consumers can override these via their own CSS if needed */\n\n  /* Remove top padding when there's no header */\n  padding-top: 10px;\n}\n\n.palette-empty {\n  color: #999;\n  font-size: 13px;\n  font-style: italic;\n}\n\n.palette-item {\n  margin-bottom: 10px;\n  cursor: move;\n  user-select: none;\n  touch-action: none; /* Enable touch dragging from palette on mobile/tablet */\n\n  /* Default styling for components without renderPaletteItem */\n  &:not(:has(> div)) {\n    padding: 15px;\n    border-radius: 4px;\n    background: #4a90e2;\n    color: white;\n    font-weight: 500;\n    text-align: center;\n    transition: transform 0.2s, box-shadow 0.2s;\n  }\n}\n\n.palette-item:hover {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 10%);\n  transform: translateY(-2px);\n}\n\n.palette-item.dragging-from-palette {\n  opacity: 0.5;\n}\n\n/* Drag Clone - only positioning, no visual styling */\n.dragging-clone {\n  position: fixed;\n  z-index: 10000;\n  pointer-events: none;\n}\n","/**\n * Component Palette Component (Library Version)\n * ===============================================\n *\n * Draggable component library providing visual component selection and drag-and-drop\n * functionality for adding new items to canvases.\n *\n * ## Key Differences from POC\n *\n * **Removed POC-specific features**:\n * - Hardcoded componentTemplates import\n * - Undo/redo UI controls (will be plugin/UI override)\n * - Complex/simple categorization (consumer can provide via props)\n *\n * **Library-specific features**:\n * - Renders from ComponentDefinition[] prop\n * - Clean component list without hardcoded data\n * - Fully customizable via props\n * - Chromeless mode for flexible embedding\n *\n * ## Component-Driven Design\n *\n * **Standard mode with header**:\n * ```typescript\n * <component-palette components={componentDefinitions} />\n * ```\n *\n * **Chromeless mode (no header)**:\n * ```typescript\n * <component-palette\n *   components={componentDefinitions}\n *   showHeader={false}\n * />\n * ```\n *\n * **Consumer provides**:\n * - Component types (via ComponentDefinition[])\n * - Icons, names, default sizes\n * - All visual content\n * - Optional: Header visibility preference\n *\n * **Library provides**:\n * - Drag initiation infrastructure\n * - Visual drag clone\n * - Cursor-centered positioning\n * - interact.js integration\n * - Flexible header display (chromeless mode)\n *\n * ## Drag Clone Strategy\n *\n * **Why create clone**:\n * - Original palette item stays in place\n * - Visual feedback at correct size\n * - Cursor centered on component (UX polish)\n * - Doesn't interfere with drop detection\n *\n * **Clone sizing**:\n * ```typescript\n * // Uses ComponentDefinition.defaultSize (or fallback 10Ã—6)\n * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n * const heightPx = gridToPixelsY(defaultSize.height);\n *\n * // Center cursor in clone\n * clone.style.left = event.clientX - halfWidth + 'px';\n * clone.style.top = event.clientY - halfHeight + 'px';\n * ```\n *\n * **Why half dimensions**:\n * - Centers cursor in dragged element\n * - Better visual alignment with drop target\n * - Matches user expectations from other tools\n *\n * ## Data Transfer Pattern\n *\n * **Component type stored in**:\n * - `data-component-type` attribute on palette item\n * - Read in `start` event: `event.target.getAttribute('data-component-type')`\n * - Canvas retrieves from dropzone event\n *\n * **Why data attribute**:\n * - Standard HTML pattern\n * - Accessible in event handlers\n * - No global state needed\n * - Works with interact.js events\n *\n * ## Performance Characteristics\n *\n * **Drag clone creation**: ~1-2ms (DOM creation + styling)\n * **Drag move**: <1ms (style updates only, no layout)\n * **Drag end**: <1ms (remove clone)\n * **Re-renders**: Only on components prop changes\n *\n * **Optimization**: Drag clone uses `position: fixed` + `pointer-events: none`\n * to avoid triggering layout recalculations during drag.\n *\n * @module component-palette\n */\n\nimport { Component, h, Prop, State, Watch, Element } from \"@stencil/core\";\nimport interact from \"interactjs\";\n\n// Type imports\nimport { ComponentDefinition } from \"../../types/component-definition\";\nimport { GridConfig } from \"../../types/grid-config\";\n\n// Utility imports\nimport { gridToPixelsX, gridToPixelsY } from \"../../utils/grid-calculations\";\n\n/**\n * ComponentPalette Component\n * ===========================\n *\n * Library component providing draggable component palette UI.\n *\n * **Tag**: `<component-palette>`\n * **Shadow DOM**: Disabled (for consistency with other components)\n * **Reactivity**: Re-renders when components prop changes\n *\n * ## Usage Patterns\n *\n * **Pattern 1: Default (inside grid-builder)**\n * ```typescript\n * // Palette automatically rendered by grid-builder\n * <grid-builder components={componentDefinitions} />\n * ```\n *\n * **Pattern 2: Independent placement**\n * ```typescript\n * // Place palette anywhere in your app\n * <div class=\"my-layout\">\n *   <aside class=\"sidebar\">\n *     <component-palette\n *       components={componentDefinitions}\n *       config={gridConfig}\n *     />\n *   </aside>\n *   <main>\n *     <grid-builder\n *       components={componentDefinitions}\n *       config={gridConfig}\n *       uiOverrides={{\n *         ComponentPalette: () => null  // Hide default palette\n *       }}\n *     />\n *   </main>\n * </div>\n * ```\n *\n * **Pattern 3: Custom wrapper component**\n * ```typescript\n * // Wrap in your own component for styling\n * @Component({ tag: 'my-palette-sidebar' })\n * export class MyPaletteSidebar {\n *   @Prop() components: ComponentDefinition[];\n *\n *   render() {\n *     return (\n *       <div class=\"custom-sidebar\">\n *         <h3>Components</h3>\n *         <component-palette components={this.components} />\n *       </div>\n *     );\n *   }\n * }\n * ```\n *\n * ## Key Features\n *\n * - **Self-contained**: Works independently of grid-builder\n * - **Drag/drop ready**: Uses interact.js for drag functionality\n * - **Flexible placement**: Can be rendered anywhere in DOM\n * - **Works across boundaries**: Drag from palette to any canvas-section\n */\n@Component({\n  tag: \"component-palette\",\n  styleUrl: \"component-palette.scss\",\n  shadow: false,\n})\nexport class ComponentPalette {\n  /**\n   * Host element reference\n   *\n   * **Used for**: Scoping querySelectorAll to only palette items in this instance\n   */\n  @Element() hostElement: HTMLElement;\n\n  /**\n   * Component definitions to render in palette\n   *\n   * **Required prop**: Array of ComponentDefinition objects\n   * **Source**: Passed from grid-builder component\n   *\n   * **Each definition provides**:\n   * - type: Unique identifier for component\n   * - name: Display name in palette\n   * - icon: Visual identifier (emoji recommended)\n   * - defaultSize: Size when dropped (for drag clone sizing)\n   *\n   * **Example**:\n   * ```typescript\n   * const components = [\n   *   {\n   *     type: 'header',\n   *     name: 'Header',\n   *     icon: 'ðŸ“„',\n   *     defaultSize: { width: 20, height: 8 },\n   *     render: ({ itemId, config }) => <my-header itemId={itemId} config={config} />\n   *   }\n   * ];\n   * ```\n   */\n  @Prop() components!: ComponentDefinition[];\n\n  /**\n   * Grid configuration options\n   *\n   * **Optional prop**: Customizes grid system behavior\n   * **Passed from**: grid-builder component\n   * **Used for**: Drag clone sizing (gridToPixelsX/Y calculations)\n   */\n  @Prop() config?: GridConfig;\n\n  /**\n   * Show palette header (title)\n   *\n   * **Optional prop**: Controls whether the \"Components\" header is displayed\n   * **Default**: true (shows header for backward compatibility)\n   *\n   * **Use cases**:\n   * - `showHeader={true}` (default): Standard palette with \"Components\" title\n   * - `showHeader={false}`: Chromeless mode - just the component list\n   *\n   * **Chromeless mode benefits**:\n   * - Embed palette in custom layouts\n   * - Add your own headers/titles\n   * - Integrate into existing UI structures\n   * - More flexible component placement\n   *\n   * **Example - Chromeless with custom wrapper**:\n   * ```typescript\n   * <div class=\"my-custom-sidebar\">\n   *   <h3 class=\"my-title\">Available Components</h3>\n   *   <p class=\"my-description\">Drag to add</p>\n   *   <component-palette\n   *     components={componentDefinitions}\n   *     showHeader={false}\n   *   />\n   * </div>\n   * ```\n   *\n   * @default true\n   */\n  @Prop() showHeader?: boolean = true;\n\n  /**\n   * Custom label for this palette instance\n   *\n   * **Optional prop**: Provides a descriptive label for this specific palette\n   * **Default**: \"Component palette\"\n   * **Used for**: ARIA label on toolbar container\n   *\n   * **Use case - Multiple palettes**:\n   * When multiple component palettes exist on the same page (e.g., categorized palettes),\n   * provide unique labels for screen reader users:\n   *\n   * ```typescript\n   * <component-palette\n   *   components={contentComponents}\n   *   paletteLabel=\"Content components\"\n   * />\n   * <component-palette\n   *   components={mediaComponents}\n   *   paletteLabel=\"Media components\"\n   * />\n   * <component-palette\n   *   components={interactiveComponents}\n   *   paletteLabel=\"Interactive components\"\n   * />\n   * ```\n   *\n   * **Accessibility benefit**:\n   * - Screen readers announce: \"Content components, toolbar\"\n   * - Users can navigate between palettes by their distinct labels\n   * - Each palette has unique ARIA IDs to avoid conflicts\n   *\n   * @default \"Component palette\"\n   */\n  @Prop() paletteLabel?: string = \"Component palette\";\n\n  /**\n   * Currently dragging component type\n   *\n   * **Internal state**: Tracks which palette item is being dragged\n   * **Used for**: Adding 'dragging-from-palette' class to the dragged item\n   * **Pattern**: Replaces classList manipulation with reactive state\n   *\n   * **Value**:\n   * - null: No item is being dragged\n   * - string: The component type of the item being dragged\n   */\n  @State() draggingItemType: string | null = null;\n\n  /**\n   * Unique ID for this palette instance\n   *\n   * **Internal state**: Ensures unique ARIA IDs when multiple palettes exist\n   * **Generated**: Once on component load (timestamp + random)\n   * **Used for**: Creating unique `id` attributes for help text and aria-describedby\n   *\n   * **Why needed**:\n   * - Multiple palettes on same page would create duplicate IDs (invalid HTML)\n   * - Each palette needs unique `palette-help-{id}` for aria-describedby\n   * - Prevents ARIA reference conflicts\n   *\n   * **Example HTML output**:\n   * ```html\n   * <!-- Palette 1 -->\n   * <div role=\"toolbar\" aria-label=\"Content components\">\n   *   <div id=\"palette-help-1234567890\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-1234567890\">...</div>\n   * </div>\n   *\n   * <!-- Palette 2 -->\n   * <div role=\"toolbar\" aria-label=\"Media components\">\n   *   <div id=\"palette-help-0987654321\" class=\"sr-only\">...</div>\n   *   <div aria-describedby=\"palette-help-0987654321\">...</div>\n   * </div>\n   * ```\n   */\n  @State() private paletteId: string = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  /**\n   * Watch for components prop changes\n   *\n   * **When triggered**: Parent passes updated component definitions\n   * **Actions**: Reinitialize drag handlers for new/changed palette items\n   *\n   * **Why needed**:\n   * - Component list may change dynamically (add/remove components)\n   * - New items need drag handlers attached\n   * - More efficient than componentDidUpdate (only runs on prop change)\n   */\n  @Watch(\"components\")\n  handleComponentsChange(\n    newComponents: ComponentDefinition[],\n    oldComponents: ComponentDefinition[],\n  ) {\n    // Skip if components reference hasn't changed\n    if (newComponents === oldComponents) return;\n\n    // Skip if not yet mounted (componentDidLoad will handle initialization)\n    if (!oldComponents) return;\n\n    // Reinitialize palette items with new component list\n    // Use requestAnimationFrame to ensure DOM has updated\n    requestAnimationFrame(() => {\n      this.initializePaletteItems();\n    });\n  }\n\n  /**\n   * Watch for config prop changes\n   *\n   * **When triggered**: Parent passes updated GridConfig\n   * **Actions**: Config changes affect drag clone sizing\n   *\n   * **Note**: Config stored in closure by initializePaletteItems\n   * Will be used on next drag start, no immediate action needed\n   */\n  @Watch(\"config\")\n  handleConfigChange(newConfig: GridConfig, oldConfig: GridConfig) {\n    // Skip if config reference hasn't changed\n    if (newConfig === oldConfig) return;\n\n    // Config changes are rare but affect drag clone sizing\n    // No immediate action needed - next drag will use new config\n    // If we want to be explicit, could reinitialize handlers:\n    // requestAnimationFrame(() => this.initializePaletteItems());\n  }\n\n  /**\n   * Component did load lifecycle hook\n   *\n   * **Called**: After first render (DOM available)\n   * **Purpose**: Initialize drag functionality on palette items\n   *\n   * **Why after render**:\n   * - Needs DOM elements to exist\n   * - Queries `.palette-item` elements\n   * - Attaches interact.js drag handlers\n   *\n   * **One-time setup**:\n   * - Only runs once after mount\n   * - Doesn't re-run on state changes\n   * - Drag handlers persist across re-renders\n   */\n  componentDidLoad() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Component did update lifecycle hook\n   *\n   * **Called**: After props change and re-render\n   * **Purpose**: Re-initialize drag handlers if components changed\n   *\n   * **Why needed**:\n   * - New palette items need drag handlers\n   * - Components prop may change dynamically\n   * - Ensures all items are draggable\n   */\n  componentDidUpdate() {\n    this.initializePaletteItems();\n  }\n\n  /**\n   * Render component template\n   *\n   * **Reactive**: Re-runs when components prop changes\n   * **Pure**: No side effects, only returns JSX\n   *\n   * **Component rendering**:\n   * - Maps over components prop\n   * - Renders each as draggable palette item\n   * - Uses icon and name from definition\n   *\n   * **Data attributes**:\n   * - `data-component-type`: Used by drag handlers to identify component\n   * - `key`: React-style key for list rendering\n   */\n  render() {\n    const paletteClasses = {\n      palette: true,\n      \"palette-chromeless\": !this.showHeader,\n    };\n\n    // Generate unique ID for this palette instance's help text\n    const helpTextId = `palette-help-${this.paletteId}`;\n\n    if (!this.components || this.components.length === 0) {\n      return (\n        <div class={paletteClasses}>\n          {this.showHeader && <h2>Components</h2>}\n          <p class=\"palette-empty\" role=\"status\" aria-live=\"polite\">No components available</p>\n        </div>\n      );\n    }\n\n    return (\n      <div class={paletteClasses} role=\"toolbar\" aria-label={this.paletteLabel} aria-orientation=\"vertical\">\n        {/* Screen reader help text with unique ID per instance */}\n        <div id={helpTextId} class=\"sr-only\">\n          {this.config?.enableClickToAdd !== false\n            ? \"Click or press Enter/Space to add component to active canvas, or drag to position on any canvas\"\n            : \"Drag component to canvas to add\"}\n        </div>\n\n        {this.showHeader && <h2 id=\"palette-heading\">Components</h2>}\n\n        {this.components.map((component) => {\n          // Class binding with reactive state\n          const itemClasses = {\n            \"palette-item\": true,\n            \"palette-item-custom\": !!component.renderPaletteItem,\n            \"dragging-from-palette\": this.draggingItemType === component.type,\n          };\n\n          // Improved aria-label with interaction methods\n          const ariaLabel = this.config?.enableClickToAdd !== false\n            ? `${component.name} component. Click to add to active canvas or drag to position`\n            : `${component.name} component. Drag to canvas`;\n\n          return (\n            <div\n              class={itemClasses}\n              data-component-type={component.type}\n              key={component.type}\n              role=\"button\"\n              tabindex={0}\n              aria-label={ariaLabel}\n              aria-describedby={helpTextId}\n              aria-pressed={this.draggingItemType === component.type ? \"true\" : \"false\"}\n              onClick={(e) => this.handlePaletteItemClick(e)}\n              onKeyDown={(e) => this.handlePaletteItemKeyDown(e)}\n            >\n              {component.renderPaletteItem\n                ? (() => {\n                    const rendered = component.renderPaletteItem({\n                      componentType: component.type,\n                      name: component.name,\n                      icon: component.icon,\n                    });\n\n                    // If render returns a DOM element (HTMLElement), wrap it in a div\n                    // This handles cases where consumer uses document.createElement()\n                    if (rendered instanceof HTMLElement) {\n                      return (\n                        <div\n                          ref={(el) =>\n                            el && !el.hasChildNodes() && el.appendChild(rendered)\n                          }\n                        />\n                      );\n                    }\n\n                    // Otherwise return the vNode directly (JSX)\n                    return rendered;\n                  })()\n                : `${component.icon} ${component.name}`}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  /**\n   * Initialize drag functionality for palette items\n   *\n   * **Called from**: componentDidLoad, componentDidUpdate\n   * **Purpose**: Attach interact.js drag handlers to all `.palette-item` elements\n   *\n   * ## Drag Lifecycle\n   *\n   * **Three phases**:\n   * 1. **start**: Create drag clone, store metadata\n   * 2. **move**: Update clone position\n   * 3. **end**: Clean up clone\n   *\n   * ## interact.js Configuration\n   *\n   * **Options**:\n   * - `inertia: false` - No momentum after release (precise control)\n   * - `autoScroll: false` - Manual scroll handling (prevents conflicts)\n   *\n   * **Why these settings**:\n   * - Inertia would interfere with drop detection\n   * - Auto-scroll conflicts with canvas scroll handling\n   * - Simpler, more predictable behavior\n   *\n   * ## Drag Clone Storage Pattern\n   *\n   * **Stores on event.target**:\n   * ```typescript\n   * (event.target as any)._dragClone = dragClone;\n   * (event.target as any)._halfWidth = halfWidth;\n   * (event.target as any)._halfHeight = halfHeight;\n   * ```\n   *\n   * **Why store on target**:\n   * - Available in move/end events\n   * - No closure needed\n   * - Automatic cleanup when element removed\n   * - Per-element isolation (multiple drags)\n   *\n   * @private\n   */\n  private initializePaletteItems = () => {\n    // IMPORTANT: Scope to only palette items within THIS component instance\n    // Multiple component-palette instances may exist (Content, Interactive, Media categories)\n    // Using document.querySelectorAll would find ALL palette items, causing\n    // drag handlers from one palette to try accessing component definitions from another\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n\n    paletteItems.forEach((element: HTMLElement) => {\n      // Check if already initialized to prevent duplicate handlers\n      if ((element as any)._dragInitialized) {\n        return;\n      }\n\n      interact(element).draggable({\n        inertia: false,\n        autoScroll: false,\n        listeners: {\n          /**\n           * Drag start event handler\n           *\n           * **Triggered**: User begins dragging palette item\n           * **Purpose**: Create visual drag clone with correct sizing\n           *\n           * ## Operations\n           *\n           * 1. **Add visual feedback**: `.dragging-from-palette` class\n           * 2. **Get component metadata**: Type and definition from components prop\n           * 3. **Calculate component size**: Convert grid units to pixels\n           * 4. **Create drag clone**: Fixed-position element following cursor\n           * 5. **Center cursor**: Offset by half dimensions\n           * 6. **Store references**: Clone and dimensions on event.target\n           *\n           * ## Sizing Strategy\n           *\n           * **Uses ComponentDefinition.defaultSize**:\n           * ```typescript\n           * const defaultSize = definition.defaultSize || { width: 10, height: 6 };\n           * const widthPx = gridToPixelsX(defaultSize.width, 'canvas1', this.config);\n           * const heightPx = gridToPixelsY(defaultSize.height);\n           * ```\n           *\n           * **Fallback**: 10 units wide Ã— 6 units tall if not specified\n           *\n           * ## Clone Styling\n           *\n           * **Key styles**:\n           * - `position: fixed` - Relative to viewport (follows scroll)\n           * - `pointer-events: none` - Doesn't block drop detection\n           * - `z-index: 10000` - Above all other elements\n           * - `background: rgba(74, 144, 226, 0.9)` - Semi-transparent blue\n           *\n           * ## Cursor Centering\n           *\n           * **Formula**:\n           * ```typescript\n           * left = clientX - halfWidth\n           * top = clientY - halfHeight\n           * ```\n           *\n           * @param event - interact.js drag start event\n           */\n          start: (event: any) => {\n            // Get the .palette-item element (in case event.target is a nested child)\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) {\n              console.warn(\"Could not find .palette-item element\");\n              return;\n            }\n\n            // Get component type and find definition\n            const componentType = paletteItem.getAttribute(\n              \"data-component-type\",\n            );\n\n            // Set dragging state (replaces classList.add)\n            this.draggingItemType = componentType;\n\n            // Store original palette item position for snap-back animation\n            const paletteRect = paletteItem.getBoundingClientRect();\n            (paletteItem as any)._originalPosition = {\n              left: paletteRect.left,\n              top: paletteRect.top,\n            };\n            (paletteItem as any)._dropWasValid = false; // Flag to track if drop occurred\n            const definition = this.components.find(\n              (c) => c.type === componentType,\n            );\n\n            if (!definition) {\n              console.warn(\n                `Component definition not found for type: ${componentType}`,\n              );\n              return;\n            }\n\n            // Calculate actual component size from definition (or use default)\n            const defaultSize = definition.defaultSize || {\n              width: 10,\n              height: 6,\n            };\n\n            // Get first available canvas ID from gridState for size calculation\n            const gridState = (window as any).gridState;\n            const canvasIds = gridState?.canvases\n              ? Object.keys(gridState.canvases)\n              : [];\n            const canvasId = canvasIds.length > 0 ? canvasIds[0] : null;\n\n            // Calculate size - if no canvas exists yet, use fallback calculation\n            let widthPx: number;\n            let heightPx: number;\n\n            if (canvasId) {\n              // Use actual canvas for accurate sizing\n              widthPx = gridToPixelsX(defaultSize.width, canvasId, this.config);\n              heightPx = gridToPixelsY(defaultSize.height);\n            } else {\n              // Fallback: estimate size based on default grid settings (2% of 1000px = 20px per unit)\n              const estimatedGridSize = 20; // Approximate default grid size\n              widthPx = defaultSize.width * estimatedGridSize;\n              heightPx = defaultSize.height * estimatedGridSize;\n            }\n\n            const halfWidth = widthPx / 2;\n            const halfHeight = heightPx / 2;\n\n            // Create drag clone container with base styling\n            const dragClone = document.createElement(\"div\");\n            dragClone.className = \"dragging-clone\";\n            dragClone.style.position = \"fixed\";\n            dragClone.style.left = event.clientX - halfWidth + \"px\";\n            dragClone.style.top = event.clientY - halfHeight + \"px\";\n            dragClone.style.width = widthPx + \"px\";\n            dragClone.style.height = heightPx + \"px\";\n            dragClone.style.overflow = \"hidden\"; // Clip content to size\n            dragClone.style.pointerEvents = \"none\";\n            dragClone.style.zIndex = \"10000\";\n            dragClone.style.border = \"2px solid rgba(74, 144, 226, 0.5)\";\n            dragClone.style.borderRadius = \"4px\";\n            dragClone.style.boxShadow = \"0 4px 12px rgba(0, 0, 0, 0.2)\";\n            dragClone.style.cursor = \"grabbing\";\n\n            // Render custom drag clone (supports both VNode and HTMLElement)\n            const cloneContent = definition.renderDragClone();\n\n            // Check if it's a real DOM element (from document.createElement)\n            if (cloneContent instanceof HTMLElement) {\n              // Direct DOM element - just append it\n              dragClone.appendChild(cloneContent);\n            } else {\n              // Stencil VNode - extract tag and create element\n              const vNode = cloneContent;\n              const tagName = vNode.$tag$;\n\n              // Create the drag clone element (components are pre-loaded in blog-app.tsx)\n              const contentElement = document.createElement(tagName);\n\n              // Copy any props from vNode to element\n              if (vNode.$attrs$) {\n                Object.keys(vNode.$attrs$).forEach((key) => {\n                  contentElement.setAttribute(key, vNode.$attrs$[key]);\n                });\n              }\n\n              dragClone.appendChild(contentElement);\n            }\n            document.body.appendChild(dragClone);\n\n            // Store clone reference, half dimensions, and default size for move/drop events\n            (paletteItem as any)._dragClone = dragClone;\n            (paletteItem as any)._halfWidth = halfWidth;\n            (paletteItem as any)._halfHeight = halfHeight;\n            (paletteItem as any)._defaultWidth = defaultSize.width;\n            (paletteItem as any)._defaultHeight = defaultSize.height;\n          },\n\n          /**\n           * Drag move event handler\n           *\n           * **Triggered**: Every mousemove while dragging (high frequency)\n           * **Purpose**: Update drag clone position to follow cursor\n           *\n           * ## Performance Optimization\n           *\n           * **Only style updates**: No layout/reflow\n           * ```typescript\n           * dragClone.style.left = event.clientX - halfWidth + 'px';\n           * dragClone.style.top = event.clientY - halfHeight + 'px';\n           * ```\n           *\n           * **Why fast**:\n           * - Changes `left/top` only (no width/height/padding)\n           * - `position: fixed` + `pointer-events: none` avoids reflow\n           * - No DOM queries (uses stored reference)\n           * - Runs at ~60fps even with 100+ items on canvas\n           *\n           * @param event - interact.js drag move event\n           */\n          move: (event: any) => {\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const halfWidth = (paletteItem as any)._halfWidth;\n            const halfHeight = (paletteItem as any)._halfHeight;\n            if (dragClone) {\n              dragClone.style.left = event.clientX - halfWidth + \"px\";\n              dragClone.style.top = event.clientY - halfHeight + \"px\";\n            }\n          },\n\n          /**\n           * Drag end event handler\n           *\n           * **Triggered**: User releases mouse button\n           * **Purpose**: Clean up drag clone and visual state\n           *\n           * ## Cleanup Operations\n           *\n           * 1. **Remove visual class**: `.dragging-from-palette`\n           * 2. **Remove drag clone**: `dragClone.remove()` from DOM\n           * 3. **Delete references**: Clean up element properties\n           *\n           * ## Memory Management\n           *\n           * **Deletes stored properties**:\n           * ```typescript\n           * delete (event.target as any)._dragClone;\n           * delete (event.target as any)._halfWidth;\n           * delete (event.target as any)._halfHeight;\n           * ```\n           *\n           * **Why important**:\n           * - Prevents memory leaks\n           * - Allows garbage collection of clone element\n           * - Clean state for next drag\n           *\n           * @param event - interact.js drag end event\n           */\n          end: (event: any) => {\n            // Clear dragging state (replaces classList.remove)\n            this.draggingItemType = null;\n\n            const paletteItem = event.target.closest(\".palette-item\");\n            if (!paletteItem) return;\n\n            const dragClone = (paletteItem as any)._dragClone;\n            const dropWasValid = (paletteItem as any)._dropWasValid;\n            const originalPos = (paletteItem as any)._originalPosition;\n\n            if (dragClone) {\n              if (!dropWasValid && originalPos) {\n                // Invalid drop - animate back to palette\n                dragClone.style.transition =\n                  \"all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)\";\n                dragClone.style.left = originalPos.left + \"px\";\n                dragClone.style.top = originalPos.top + \"px\";\n                dragClone.style.opacity = \"0\";\n\n                // Remove after animation completes\n                setTimeout(() => {\n                  dragClone.remove();\n                }, 300);\n              } else {\n                // Valid drop - remove immediately\n                dragClone.remove();\n              }\n\n              // Cleanup\n              delete (paletteItem as any)._dragClone;\n              delete (paletteItem as any)._halfWidth;\n              delete (paletteItem as any)._halfHeight;\n              delete (paletteItem as any)._dropWasValid;\n              delete (paletteItem as any)._originalPosition;\n            }\n          },\n        },\n      });\n\n      // Mark as initialized\n      (element as any)._dragInitialized = true;\n    });\n  };\n\n  /**\n   * Handle palette item click (for click-to-add feature)\n   *\n   * **Triggered**: User clicks on palette item\n   * **Purpose**: Emit event for grid-builder to add component to active canvas\n   *\n   * ## Implementation\n   *\n   * 1. **Check if enabled**: Only proceed if `config.enableClickToAdd !== false`\n   * 2. **Prevent drag conflict**: Don't trigger if currently dragging\n   * 3. **Get component type**: From `data-component-type` attribute\n   * 4. **Dispatch event**: Bubble up to grid-builder\n   *\n   * ## Event Details\n   *\n   * **Event name**: `palette-item-click`\n   * **Event detail**: `{ componentType: string }`\n   * **Bubbles**: true (so grid-builder can listen)\n   * **Composed**: true (crosses shadow DOM boundaries)\n   *\n   * ## Accessibility\n   *\n   * **Keyboard support**: Enter/Space keys also trigger (via handlePaletteItemKeyDown)\n   * **Screen reader**: Uses aria-label to announce action\n   * **Focus**: Palette items are focusable (tabindex=0)\n   *\n   * **Example event listener** (in grid-builder):\n   * ```typescript\n   * @Listen('palette-item-click')\n   * handlePaletteClick(event: CustomEvent<{ componentType: string }>) {\n   *   const { componentType } = event.detail;\n   *   this.addComponentToActiveCanvas(componentType);\n   * }\n   * ```\n   *\n   * @param event - Mouse click event\n   * @private\n   */\n  private handlePaletteItemClick = (event: MouseEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Don't trigger click if currently dragging\n    if (this.draggingItemType) {\n      return;\n    }\n\n    // Get the palette item element (in case event.target is a nested child)\n    const paletteItem = (event.target as HTMLElement).closest('.palette-item') as HTMLElement;\n    if (!paletteItem) {\n      return;\n    }\n\n    // Get component type from data attribute\n    const componentType = paletteItem.getAttribute('data-component-type');\n    if (!componentType) {\n      console.warn('handlePaletteItemClick: Component type not found');\n      return;\n    }\n\n    // Dispatch event for grid-builder to handle\n    const clickEvent = new CustomEvent('palette-item-click', {\n      detail: { componentType },\n      bubbles: true,\n      composed: true,\n    });\n    this.hostElement.dispatchEvent(clickEvent);\n  };\n\n  /**\n   * Handle palette item keyboard interaction (for accessibility)\n   *\n   * **Triggered**: User presses key on focused palette item\n   * **Purpose**: Enable keyboard users to add components via Enter/Space\n   *\n   * ## Implementation\n   *\n   * **Supported keys**:\n   * - Enter: Add component (same as click)\n   * - Space: Add component (same as click)\n   *\n   * **Behavior**:\n   * - Prevents default scrolling on Space\n   * - Calls handlePaletteItemClick for consistency\n   *\n   * ## Accessibility Impact\n   *\n   * **Benefits**:\n   * - Keyboard-only users can add components\n   * - Screen reader users can navigate and activate palette items\n   * - Matches standard button behavior (Enter/Space activation)\n   *\n   * **WCAG Compliance**:\n   * - 2.1.1 Keyboard (Level A): All functionality available via keyboard\n   * - 2.1.3 Keyboard (No Exception) (Level AAA): Enhanced keyboard access\n   *\n   * @param event - Keyboard event\n   * @private\n   */\n  private handlePaletteItemKeyDown = (event: KeyboardEvent) => {\n    // Check if click-to-add is enabled (default: true)\n    const enableClickToAdd = this.config?.enableClickToAdd ?? true;\n    if (!enableClickToAdd) {\n      return;\n    }\n\n    // Handle Enter and Space keys\n    if (event.key === 'Enter' || event.key === ' ') {\n      // Prevent default Space behavior (page scroll)\n      event.preventDefault();\n\n      // Trigger the same handler as click\n      this.handlePaletteItemClick(event as any);\n    }\n  };\n\n  /**\n   * Disconnected callback (cleanup)\n   *\n   * **Called**: When component is removed from DOM\n   * **Purpose**: Clean up interact.js instances to prevent memory leaks\n   *\n   * ## Cleanup Process\n   *\n   * 1. **Query all palette items**: Find all elements with `.palette-item` class\n   * 2. **Remove interact.js**: Call `interact(element).unset()` on each\n   * 3. **Clear flags**: Remove `_dragInitialized` marker\n   *\n   * ## Why Important\n   *\n   * **Without cleanup**:\n   * - interact.js event listeners persist after unmount\n   * - Memory leaks accumulate with mount/unmount cycles\n   * - References prevent garbage collection\n   *\n   * **With cleanup**:\n   * - All event listeners removed\n   * - Elements can be garbage collected\n   * - Clean state for future mounts\n   *\n   * ## Pattern Match\n   *\n   * This follows the same cleanup pattern as:\n   * - canvas-section.tsx: Cleans up dropzone interact instance\n   * - grid-item-wrapper.tsx: Cleans up drag/resize handlers\n   */\n  disconnectedCallback() {\n    // Cleanup interact.js on all palette items (scoped to this instance)\n    const paletteItems = this.hostElement.querySelectorAll(\".palette-item\");\n    paletteItems.forEach((element: HTMLElement) => {\n      if ((element as any)._dragInitialized) {\n        interact(element).unset();\n        delete (element as any)._dragInitialized;\n      }\n    });\n  }\n}\n"],"names":["gridState"],"mappings":"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"}