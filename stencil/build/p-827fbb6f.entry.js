import{r as t,h as e}from"./p-CC73Dkup.js";import{a as i,s,u as n}from"./p-BmMMCJ61.js";import{c as o,C as a,a as r,p as d,M as h,v as l}from"./p-CMWmbO8u.js";import{e as c}from"./p-Bh3ZsUIZ.js";import{d as p,e as m,a as g,p as f,f as u,b as w,g as x}from"./p-1wddBNwA.js";function v(t){const e=t.style.transform;const i=e.match(/translate\(([\d.-]+)px,\s*([\d.-]+)px\)/);if(i){return{x:parseFloat(i[1]),y:parseFloat(i[2])}}return{x:0,y:0}}class b{constructor(t,e,i,s,n,o){this.interactInstance=null;this.basePosition={x:0,y:0};this.dragStartCanvasId="";this.hasMoved=false;this.dragRafId=null;this.element=t;this.item=e;this.onUpdate=i;this.config=s;this.dragHandleElement=n;this.onDragMove=o;this.initialize()}destroy(){if(this.interactInstance){this.interactInstance.unset()}}initialize(){var t,e;const i=window.interact;if(!i){console.warn("interact.js not loaded");return}const s=this.dragHandleElement||this.element;const n=(e=(t=this.config)===null||t===void 0?void 0:t.enableAutoScroll)!==null&&e!==void 0?e:true;const o={inertia:false,autoScroll:n?{enabled:true,container:window,margin:60,speed:600}:false,listeners:{start:this.handleDragStart.bind(this),move:this.handleDragMove.bind(this),end:this.handleDragEnd.bind(this)}};if(!this.dragHandleElement){o.allowFrom=".grid-item-header";o.ignoreFrom=".resize-handle"}this.interactInstance=i(s).draggable(o)}handleDragStart(t){if(window.perfMonitor){window.perfMonitor.startOperation("drag")}this.hasMoved=false;const e=this.dragHandleElement?this.element:t.target;e.classList.add("dragging");this.dragStartCanvasId=this.item.canvasId;i(this.item.canvasId);const s=this.dragHandleElement?this.element:t.target;this.basePosition=v(s);this.element._originalTransform=this.element.style.transform;this.element._originalPosition={x:this.basePosition.x,y:this.basePosition.y};t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0")}handleDragMove(t){const e=(parseFloat(t.target.getAttribute("data-x"))||0)+t.dx;const i=(parseFloat(t.target.getAttribute("data-y"))||0)+t.dy;t.target.setAttribute("data-x",e.toString());t.target.setAttribute("data-y",i.toString());if(!this.hasMoved&&this.onDragMove){this.hasMoved=true;this.onDragMove()}if(this.dragRafId){cancelAnimationFrame(this.dragRafId)}this.dragRafId=requestAnimationFrame((()=>{const s=this.dragHandleElement?this.element:t.target;s.style.transform=`translate(${this.basePosition.x+e}px, ${this.basePosition.y+i}px)`;this.dragRafId=null}))}handleDragEnd(t){var e;if(this.dragRafId){cancelAnimationFrame(this.dragRafId);this.dragRafId=null}const i=parseFloat(t.target.getAttribute("data-x"))||0;const s=parseFloat(t.target.getAttribute("data-y"))||0;const n=this.dragHandleElement?this.element:t.target;n.classList.remove("dragging");if(this.hasMoved){const e=t.target;const i=t=>{t.stopPropagation();t.preventDefault();e.removeEventListener("click",i,true)};e.addEventListener("click",i,true);setTimeout((()=>{e.removeEventListener("click",i,true)}),100)}const r=this.dragHandleElement?this.element:t.target;const d=r.getBoundingClientRect();let h=this.item.canvasId;let l=false;const c=document.querySelectorAll(".grid-container");c.forEach((t=>{const e=t.getBoundingClientRect();if(d.left>=e.left&&d.right<=e.right&&d.top>=e.top&&d.bottom<=e.bottom){h=t.getAttribute("data-canvas-id")||this.item.canvasId;l=true}}));if(!l){const t=d.left+d.width/2;const e=d.top+d.height/2;c.forEach((i=>{const s=i.getBoundingClientRect();if(t>=s.left&&t<=s.right&&e>=s.top&&e<=s.bottom){h=i.getAttribute("data-canvas-id")||this.item.canvasId}}))}if(h!==this.dragStartCanvasId){t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");if(window.perfMonitor){window.perfMonitor.endOperation("drag")}return}const w=p.getCanvas(h);if(!w){this.snapBackToOriginalPosition(t);return}const x=m(h);const v=g();let b=this.basePosition.x+i;let z=this.basePosition.y+s;b=Math.round(b/x)*x;z=Math.round(z/v)*v;const y=this.dragHandleElement?this.element:t.target;const k=parseFloat(y.style.width)||0;const I=parseFloat(y.style.height)||0;const M=f(b,h,this.config);const C=u(z,this.config);const R=f(k,h,this.config);const F=u(I,this.config);const $=o(M,C,R,F,a);const D=m(h);const S=g();b=$.x*D;z=$.y*S;const E=((e=window.gridState)===null||e===void 0?void 0:e.currentViewport)||"desktop";const j=this.item.layouts[E];j.x=$.x;j.y=$.y;if(E==="mobile"){this.item.layouts.mobile.customized=true;if(this.item.layouts.mobile.width===null){this.item.layouts.mobile.width=this.item.layouts.desktop.width}if(this.item.layouts.mobile.height===null){this.item.layouts.mobile.height=this.item.layouts.desktop.height}}requestAnimationFrame((()=>{const e=this.dragHandleElement?this.element:t.target;e.style.transform=`translate(${b}px, ${z}px)`;t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");if(window.perfMonitor){window.perfMonitor.endOperation("drag")}this.onUpdate(this.item)}))}snapBackToOriginalPosition(t){const e=this.element._originalPosition;const i=this.element._originalTransform;if(!e){const e=this.dragHandleElement?this.element:t.target;e.classList.remove("dragging");return}const s=this.dragHandleElement?this.element:t.target;s.style.transition="transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";s.style.transform=i||`translate(${e.x}px, ${e.y}px)`;setTimeout((()=>{s.style.transition="";s.classList.remove("dragging")}),300);t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");delete this.element._originalPosition;delete this.element._originalTransform;if(window.perfMonitor){window.perfMonitor.endOperation("drag")}}}const z="2025-11-24T03:02:15.752Z";const y=r("resize-handler");function k(t){const e=t.style.transform;const i=e.match(/translate\(([\d.-]+)px,\s*([\d.-]+)px\)/);if(i){return{x:parseFloat(i[1]),y:parseFloat(i[2])}}return{x:0,y:0}}class I{constructor(t,e,i,s,n){this.interactInstance=null;this.resizeRafId=null;this.startRect={x:0,y:0,width:0,height:0};this.lastCalculated={x:0,y:0,width:0,height:0};this.minWidth=100;this.minHeight=80;this.maxWidth=Infinity;this.maxHeight=Infinity;this.element=t;this.item=e;this.onUpdate=i;this.componentDefinition=s;this.config=n;if(!t.style.width||!t.style.height){console.warn("Element missing width/height styles, waiting for next frame");requestAnimationFrame((()=>this.initialize()))}else{this.initialize()}}destroy(){if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId);this.resizeRafId=null}if(this.interactInstance){this.interactInstance.unset()}}initialize(){var t,e;y.log("üì¶ resize-handler.ts build:",z);y.log("üîß Grid config fix applied - resize handler now uses same grid calculations as render");const i=window.interact;if(!i){console.warn("interact.js not loaded");return}const s=(t=this.componentDefinition)===null||t===void 0?void 0:t.minSize;const n=(e=this.componentDefinition)===null||e===void 0?void 0:e.maxSize;this.minWidth=s?w(s.width,this.item.canvasId,this.config):100;this.minHeight=s?x(s.height,this.config):80;this.maxWidth=n?w(n.width,this.item.canvasId,this.config):Infinity;this.maxHeight=n?x(n.height,this.config):Infinity;const o=this.maxWidth===Infinity||this.maxWidth>this.minWidth;const a=this.maxHeight===Infinity||this.maxHeight>this.minHeight;y.log("üîß ResizeHandler init for",this.item.id,{minWidth:this.minWidth,maxWidth:this.maxWidth,minHeight:this.minHeight,maxHeight:this.maxHeight,canResizeWidth:o,canResizeHeight:a,componentDefinition:this.componentDefinition});if(!o){y.log("  ‚ùå Disabling width resize");this.element.classList.add("resize-width-disabled")}if(!a){y.log("  ‚ùå Disabling height resize");this.element.classList.add("resize-height-disabled")}this.interactInstance=i(this.element).resizable({edges:{left:o,right:o,bottom:a,top:a},ignoreFrom:".grid-item-header",listeners:{start:this.handleResizeStart.bind(this),move:this.handleResizeMove.bind(this),end:this.handleResizeEnd.bind(this)}})}handleResizeStart(t){if(window.perfMonitor){window.perfMonitor.startOperation("resize")}t.target.classList.add("resizing");i(this.item.canvasId);const e=k(t.target);this.startRect.x=e.x;this.startRect.y=e.y;this.startRect.width=parseFloat(t.target.style.width)||0;this.startRect.height=parseFloat(t.target.style.height)||0;t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");t.target.setAttribute("data-width","0");t.target.setAttribute("data-height","0");y.log("üü¢ RESIZE START:",{edges:t.edges,startRect:Object.assign({},this.startRect),itemId:this.item.id})}handleResizeMove(t){const e=(parseFloat(t.target.getAttribute("data-x"))||0)+t.deltaRect.left;const i=(parseFloat(t.target.getAttribute("data-y"))||0)+t.deltaRect.top;const s=(parseFloat(t.target.getAttribute("data-width"))||0)+t.deltaRect.width;const n=(parseFloat(t.target.getAttribute("data-height"))||0)+t.deltaRect.height;t.target.setAttribute("data-x",e.toString());t.target.setAttribute("data-y",i.toString());t.target.setAttribute("data-width",s.toString());t.target.setAttribute("data-height",n.toString());let o=this.startRect.width+s;let a=this.startRect.height+n;let r=this.startRect.x+e;let d=this.startRect.y+i;const h=p.getCanvas(this.item.canvasId);const l=h?h.clientWidth:Infinity;const c=h?h.clientHeight:Infinity;o=Math.max(this.minWidth,Math.min(this.maxWidth,o));a=Math.max(this.minHeight,Math.min(this.maxHeight,a));if(r<0){if(t.edges.left){o=Math.max(this.minWidth,o+r)}r=0}if(d<0){if(t.edges.top){a=Math.max(this.minHeight,a+d)}d=0}if(r+o>l){o=Math.max(this.minWidth,l-r)}if(d+a>c){a=Math.max(this.minHeight,c-d)}if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId)}this.resizeRafId=requestAnimationFrame((()=>{y.log("üîµ RESIZE MOVE (RAF):",{edges:t.edges,deltas:{deltaX:e,deltaY:i,deltaWidth:s,deltaHeight:n},startRect:Object.assign({},this.startRect),calculated:{newX:r,newY:d,newWidth:o,newHeight:a}});t.target.style.transform=`translate(${r}px, ${d}px)`;t.target.style.width=o+"px";t.target.style.height=a+"px";this.resizeRafId=null}))}handleResizeEnd(t){var e;if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId);this.resizeRafId=null}t.target.classList.remove("resizing");const i=p.getCanvas(this.item.canvasId);if(!i){return}const s=i.getBoundingClientRect();const n=m(this.item.canvasId);const o=g();const a=parseFloat(t.target.getAttribute("data-x"))||0;const r=parseFloat(t.target.getAttribute("data-y"))||0;const d=parseFloat(t.target.getAttribute("data-width"))||0;const h=parseFloat(t.target.getAttribute("data-height"))||0;t.target.removeAttribute("data-x");t.target.removeAttribute("data-y");t.target.removeAttribute("data-width");t.target.removeAttribute("data-height");let l=this.startRect.x+a;let c=this.startRect.y+r;let w=this.startRect.width+d;let x=this.startRect.height+h;y.log("üî¥ RESIZE END:",{edges:t.edges,eventRect:{left:t.rect.left,top:t.rect.top,width:t.rect.width,height:t.rect.height},containerRect:{left:s.left,top:s.top},beforeSnap:{newX:l,newY:c,newWidth:w,newHeight:x},gridSize:{gridSizeX:n,gridSizeY:o},startRect:Object.assign({},this.startRect),lastCalculated:Object.assign({},this.lastCalculated)});if(w>this.startRect.width){w=Math.ceil(w/n)*n}else if(w<this.startRect.width){w=Math.floor(w/n)*n}else{w=Math.round(w/n)*n}w=Math.max(this.minWidth,w);if(x>this.startRect.height){x=Math.ceil(x/o)*o}else if(x<this.startRect.height){x=Math.floor(x/o)*o}else{x=Math.round(x/o)*o}x=Math.max(this.minHeight,x);if(l<this.startRect.x){l=Math.floor(l/n)*n}else if(l>this.startRect.x){l=Math.ceil(l/n)*n}else{l=Math.round(l/n)*n}if(c<this.startRect.y){c=Math.floor(c/o)*o}else if(c>this.startRect.y){c=Math.ceil(c/o)*o}else{c=Math.round(c/o)*o}y.log("  afterDirectionalSnap:",{newX:l,newY:c,newWidth:w,newHeight:x});const v=w;const b=x;w=Math.max(this.minWidth,Math.min(this.maxWidth,w));x=Math.max(this.minHeight,Math.min(this.maxHeight,x));if(v!==w&&t.edges.left){const t=v-w;l+=t}if(b!==x&&t.edges.top){const t=b-x;c+=t}y.log("  afterMinMaxClamp:",{newX:l,newY:c,newWidth:w,newHeight:x});const z=i.clientWidth;const k=i.clientHeight;y.log("  canvasBounds:",{canvasWidth:z,canvasHeight:k});if(w>z){y.log("  ‚ö†Ô∏è Width exceeds canvas, shrinking from",w,"to",z);w=z}if(l<0){y.log("  ‚ö†Ô∏è Left edge outside canvas, moving from x =",l,"to x = 0");l=0}if(l+w>z){if(t.edges&&t.edges.right){const t=z-l;y.log("  ‚ö†Ô∏è Right edge overflow (resizing from right), clamping width from",w,"to",t);w=Math.max(this.minWidth,t)}else{const t=z-w;y.log("  ‚ö†Ô∏è Right edge outside canvas, moving from x =",l,"to x =",t);l=t;if(l<0){y.log("  ‚ö†Ô∏è Cannot fit by moving, shrinking width to",z);w=z;l=0}}}if(x>k){y.log("  ‚ö†Ô∏è Height exceeds canvas, shrinking from",x,"to",k);x=k}if(c<0){y.log("  ‚ö†Ô∏è Top edge outside canvas, moving from y =",c,"to y = 0");c=0}if(c+x>k){if(t.edges&&t.edges.bottom){const t=k-c;y.log("  ‚ö†Ô∏è Bottom edge overflow (resizing from bottom), clamping height from",x,"to",t);x=Math.max(this.minHeight,t)}else{const t=k-x;y.log("  ‚ö†Ô∏è Bottom edge outside canvas, moving from y =",c,"to y =",t);c=t;if(c<0){y.log("  ‚ö†Ô∏è Cannot fit by moving, shrinking height to",k);x=k;c=0}}}y.log("  afterBoundaryCheck:",{newX:l,newY:c,newWidth:w,newHeight:x});t.target.style.transform=`translate(${l}px, ${c}px)`;t.target.style.width=w+"px";t.target.style.height=x+"px";y.log("  appliedToDOM:",{transform:`translate(${l}px, ${c}px)`,width:`${w}px`,height:`${x}px`});const I=((e=window.gridState)===null||e===void 0?void 0:e.currentViewport)||"desktop";const M=this.item.layouts[I];M.width=f(w,this.item.canvasId,this.config);M.height=u(x,this.config);M.x=f(l,this.item.canvasId,this.config);M.y=u(c,this.config);y.log("  finalGridUnits:",{x:M.x,y:M.y,width:M.width,height:M.height});y.log("---");if(I==="mobile"){this.item.layouts.mobile.customized=true}if(window.perfMonitor){window.perfMonitor.endOperation("resize")}this.onUpdate(this.item)}}const M=".sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.grid-item{position:absolute;min-width:100px;min-height:80px;box-sizing:border-box;padding:20px;border:2px solid transparent;border-radius:0;background:transparent;box-shadow:none;cursor:default;transition:border-color 0.2s, box-shadow 0.2s;will-change:transform;touch-action:none;container-type:inline-size;--selection-color:#f59e0b}.grid-item.with-animations{transition:border-color 0.2s, box-shadow 0.2s, transform var(--animation-duration, 200ms) ease-out, width var(--animation-duration, 200ms) ease-out, height var(--animation-duration, 200ms) ease-out}.grid-item.dragging,.grid-item.resizing{transition:none !important}.grid-item:hover{border-color:var(--selection-color)}.grid-item[data-viewer-mode=true]:hover{border-color:transparent}.grid-item.selected{outline:3px solid var(--selection-color);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--selection-color) 20%, transparent), 0 4px 12px color-mix(in srgb, var(--selection-color) 30%, transparent);}.grid-item[data-viewer-mode=true].selected{padding:20px;border:2px solid transparent;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1)}.grid-item.dragging{cursor:move;opacity:0.7}.grid-item.resizing{user-select:none}.grid-item-header{position:absolute;z-index:100;top:-26px;left:12px;display:flex;align-items:center;padding:4px 10px;border:2px solid var(--selection-color);border-radius:4px 4px 0 0;border-bottom:none;background:var(--selection-color);color:white;cursor:move !important;font-size:11px;font-weight:600;gap:6px;letter-spacing:0.3px;opacity:0;pointer-events:auto;transition:opacity 0.2s;user-select:none;touch-action:none;}.grid-item.selected .grid-item-header,.grid-item:hover .grid-item-header{opacity:1}.grid-item.selected .grid-item-header{top:-27px;border:3px solid var(--selection-color);border-bottom:none}.grid-item-content{overflow:hidden;max-width:100%;color:#666;font-size:13px}.grid-item-content[data-component-type=blog-image]{height:100%;}.component-placeholder,.component-error{display:flex;height:100%;align-items:center;justify-content:center;color:#999;font-size:12px}.component-error{color:#f44}.grid-item-controls{position:absolute;z-index:10;top:-16px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity 0.2s}.grid-item.selected .grid-item-controls,.grid-item:hover .grid-item-controls{opacity:1}.grid-item.selected .grid-item-controls{top:-16px;right:8px}.grid-item-control-btn{width:24px;height:24px;padding:0;border:none;border-radius:4px;background:#4a90e2;color:white;cursor:pointer;font-size:12px;line-height:1;transition:background 0.2s}.grid-item-control-btn:hover{background:#357abd}.grid-item-delete{width:24px;height:24px;padding:0;border:none;border-radius:50%;background:#f44;color:white;cursor:pointer;font-size:14px;line-height:1;transition:background 0.2s}.grid-item-delete:hover{background:#c00}.drag-handle{display:none}.resize-handle{position:absolute;z-index:10;width:14px;height:14px;border:2px solid white;border-radius:50%;background:var(--selection-color);box-shadow:0 0 4px rgba(0, 0, 0, 0.4);opacity:0;transition:opacity 0.2s, transform 0.2s;touch-action:none;}.resize-handle:hover{transform:scale(1.2)}.grid-item.selected .resize-handle,.grid-item:hover .resize-handle{opacity:1}.resize-handle.nw{top:-7px;left:-7px;cursor:nw-resize}.resize-handle.ne{top:-7px;right:-7px;cursor:ne-resize}.resize-handle.sw{bottom:-7px;left:-7px;cursor:sw-resize}.resize-handle.se{right:-7px;bottom:-7px;cursor:se-resize}.resize-handle.n{top:-7px;left:50%;width:30px;height:6px;border-radius:3px;cursor:n-resize;transform:translateX(-50%)}.resize-handle.s{bottom:-7px;left:50%;width:30px;height:6px;border-radius:3px;cursor:s-resize;transform:translateX(-50%)}.resize-handle.e{top:50%;right:-7px;width:6px;height:30px;border-radius:3px;cursor:e-resize;transform:translateY(-50%)}.resize-handle.w{top:50%;left:-7px;width:6px;height:30px;border-radius:3px;cursor:w-resize;transform:translateY(-50%)}.grid-item.selected .resize-handle.nw,.grid-item.selected .resize-handle.n,.grid-item.selected .resize-handle.ne{top:-8px;}.grid-item.selected .resize-handle.sw,.grid-item.selected .resize-handle.s,.grid-item.selected .resize-handle.se{bottom:-8px;}.grid-item.selected .resize-handle.nw,.grid-item.selected .resize-handle.w,.grid-item.selected .resize-handle.sw{left:-8px;}.grid-item.selected .resize-handle.ne,.grid-item.selected .resize-handle.e,.grid-item.selected .resize-handle.se{right:-8px;}.grid-item.resize-width-disabled .resize-handle.w,.grid-item.resize-width-disabled .resize-handle.e,.grid-item.resize-width-disabled .resize-handle.nw,.grid-item.resize-width-disabled .resize-handle.ne,.grid-item.resize-width-disabled .resize-handle.sw,.grid-item.resize-width-disabled .resize-handle.se{display:none}.grid-item.resize-height-disabled .resize-handle.n,.grid-item.resize-height-disabled .resize-handle.s{display:none}@keyframes component-animate-in{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}.component-animate-in{animation:component-animate-in 400ms ease-out}";const C=r("grid-item-wrapper");const R=class{constructor(e){t(this,e);this.viewerMode=false;this.isSelected=false;this.isVisible=false;this.itemSnapshot=null;this.wasDragged=false;this.captureItemSnapshot=()=>{this.itemSnapshot=JSON.parse(JSON.stringify(this.item))};this.handleItemUpdate=t=>{let e=false;let i=false;if(this.itemSnapshot){const n=this.itemSnapshot;const o=(n.layouts.desktop.x!==t.layouts.desktop.x||n.layouts.desktop.y!==t.layouts.desktop.y)&&n.layouts.desktop.width===t.layouts.desktop.width&&n.layouts.desktop.height===t.layouts.desktop.height;const a=n.layouts.desktop.width!==t.layouts.desktop.width||n.layouts.desktop.height!==t.layouts.desktop.height;const r=n.canvasId!==t.canvasId;e=o||r;i=a;if(e||i){const e=s.canvases[n.canvasId];const o=(e===null||e===void 0?void 0:e.items.findIndex((t=>t.id===this.item.id)))||0;d(new h(t.id,n.canvasId,t.canvasId,{x:n.layouts.desktop.x,y:n.layouts.desktop.y},{x:t.layouts.desktop.x,y:t.layouts.desktop.y},o,i?{width:n.layouts.desktop.width,height:n.layouts.desktop.height}:undefined,i?{width:t.layouts.desktop.width,height:t.layouts.desktop.height}:undefined))}}const n=s.canvases[this.item.canvasId];const o=n.items.findIndex((t=>t.id===this.item.id));if(o!==-1){n.items[o]=t;s.canvases=Object.assign({},s.canvases)}if(e){c.emit("componentDragged",{itemId:t.id,canvasId:t.canvasId,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y}})}if(i){c.emit("componentResized",{itemId:t.id,canvasId:t.canvasId,size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}})}};this.handleClick=t=>{if(this.viewerMode){C.log("  ‚è≠Ô∏è Skipping - viewer mode");return}if(this.wasDragged){C.log("  ‚è≠Ô∏è Skipping - was dragged");setTimeout((()=>{this.wasDragged=false}),10);return}const e=t.target;if(e.classList.contains("drag-handle")||e.closest(".drag-handle")||e.classList.contains("resize-handle")||e.closest(".resize-handle")||e.classList.contains("grid-item-delete")||e.classList.contains("grid-item-control-btn")){C.log("  ‚è≠Ô∏è Skipping - clicked on control element");return}C.log("  ‚úÖ Proceeding with click handling");s.selectedItemId=this.item.id;s.selectedCanvasId=this.item.canvasId;i(this.item.canvasId);c.emit("componentSelected",{itemId:this.item.id,canvasId:this.item.canvasId});C.log("  üì§ Dispatching item-click event",{itemId:this.item.id,canvasId:this.item.canvasId,hasItemRef:!!this.itemRef});const n=new CustomEvent("item-click",{detail:{itemId:this.item.id,canvasId:this.item.canvasId},bubbles:true,composed:true});this.itemRef.dispatchEvent(n);C.log("  ‚úÖ item-click event dispatched")};this.handleDelete=async(t,e)=>{C.log("üóëÔ∏è handleDelete (default wrapper button)",{itemId:t,canvasId:e});const i=this.item;if(this.onBeforeDelete){C.log("  ü™ù Calling deletion hook...");try{const s=await this.onBeforeDelete({item:i,canvasId:e,itemId:t});if(!s){C.log("  ‚ùå Deletion cancelled by hook");return}C.log("  ‚úÖ Deletion approved by hook")}catch(t){console.error("  ‚ùå Deletion hook error:",t);return}}const s=new CustomEvent("grid-item:delete",{detail:{itemId:t,canvasId:e},bubbles:true,composed:true});C.log("  üì§ Dispatching grid-item:delete (internal event)");this.itemRef.dispatchEvent(s)}}componentWillLoad(){var t;this.updateComponentState();if(((t=this.config)===null||t===void 0?void 0:t.enableVirtualRendering)===false){this.isVisible=true}}componentWillUpdate(){this.updateComponentState()}updateComponentState(){this.isSelected=s.selectedItemId===this.item.id;this.captureItemSnapshot()}componentDidLoad(){var t,e;if(((t=this.config)===null||t===void 0?void 0:t.enableVirtualRendering)!==false){l.observe(this.itemRef,this.item.id,(t=>{this.isVisible=t}))}else{this.isVisible=true}this.injectComponentContent();if(!this.viewerMode){const t=(e=this.componentRegistry)===null||e===void 0?void 0:e.get(this.item.type);const i=this.itemRef.querySelector(".grid-item-header");this.dragHandler=new b(this.itemRef,this.item,this.handleItemUpdate,this.config,i,(()=>{this.wasDragged=true}));this.resizeHandler=new I(this.itemRef,this.item,this.handleItemUpdate,t,this.config)}}componentDidUpdate(){this.injectComponentContent()}injectComponentContent(){var t;const e=(t=this.componentRegistry)===null||t===void 0?void 0:t.get(this.item.type);if(!(e===null||e===void 0?void 0:e.renderItemWrapper)||!this.itemRef)return;const i=`${this.item.id}-content`;const s=this.itemRef.querySelector(`#${i}`);if(!s)return;if(s.hasAttribute("data-content-injected"))return;const n=this.renderComponent();s.innerHTML="";if(n instanceof HTMLElement){s.appendChild(n)}else{const t=document.createElement("div");s.appendChild(t);t.textContent="[Component Content]"}s.setAttribute("data-content-injected","true")}disconnectedCallback(){if(this.dragHandler){this.dragHandler.destroy()}if(this.resizeHandler){this.resizeHandler.destroy()}if(this.itemRef){l.unobserve(this.itemRef,this.item.id)}}handleItemChange(t,e){if(t===e)return;C.log("üì¶ Item prop changed:",{itemId:t.id,oldId:e===null||e===void 0?void 0:e.id});this.updateComponentState();if(!this.viewerMode&&this.dragHandler&&this.resizeHandler){C.log("  ‚úÖ Handlers updated with new item reference")}}handleRenderVersionChange(t,e){if(t===e)return;C.log("üîÑ RenderVersion changed:",{oldVersion:e,newVersion:t,itemId:this.item.id})}handleConfigChange(t,e){var i;if(t===e)return;C.log("‚öôÔ∏è Config prop changed:",{itemId:this.item.id,oldConfig:e,newConfig:t});if(!this.viewerMode&&this.itemRef){if(this.dragHandler){this.dragHandler.destroy()}if(this.resizeHandler){this.resizeHandler.destroy()}const e=(i=this.componentRegistry)===null||i===void 0?void 0:i.get(this.item.type);const s=this.itemRef.querySelector(".grid-item-header");this.dragHandler=new b(this.itemRef,this.item,this.handleItemUpdate,t,s,(()=>{this.wasDragged=true}));this.resizeHandler=new I(this.itemRef,this.item,this.handleItemUpdate,e,t);C.log("  ‚úÖ Handlers reinitialized with new config")}}handleViewportChange(t,e){if(t===e)return;if(!this.viewerMode)return;C.log("üì± Viewport prop changed (viewer mode):",{oldViewport:e,newViewport:t,itemId:this.item.id})}handleItemDeleteEvent(t){C.log("üî¥ @Listen(item-delete) - from custom wrapper",{eventTarget:t.target,itemId:this.item.id});t.stopPropagation();const e=new CustomEvent("grid-item:delete",{detail:{itemId:this.item.id,canvasId:this.item.canvasId},bubbles:true,composed:true});C.log("  üì§ Re-dispatching as grid-item:delete");this.itemRef.dispatchEvent(e)}handleItemBringToFrontEvent(t){t.stopPropagation();const e=s.canvases[this.item.canvasId];if(!e)return;const i=Math.max(...e.items.map((t=>t.zIndex)));n(this.item.canvasId,this.item.id,{zIndex:i+1})}handleItemSendToBackEvent(t){t.stopPropagation();const e=s.canvases[this.item.canvasId];if(!e)return;const i=Math.min(...e.items.map((t=>t.zIndex)));n(this.item.canvasId,this.item.id,{zIndex:i-1})}renderComponent(){if(!this.isVisible){return e("div",{class:"component-placeholder"},"Loading...")}if(!this.componentRegistry){console.error(`GridItemWrapper: componentRegistry not provided for item ${this.item.id}`);return e("div",{class:"component-error"},"Component registry not available")}const t=this.componentRegistry.get(this.item.type);if(!t){console.error(`GridItemWrapper: Unknown component type "${this.item.type}" for item ${this.item.id}`);return e("div",{class:"component-error"},"Unknown component type: ",this.item.type)}const i=t.render({itemId:this.item.id,config:this.item.config});if(i instanceof HTMLElement){return e("div",{ref:t=>t&&!t.hasChildNodes()&&t.appendChild(i)})}return i}render(){var t,i,n,o,a,r,d;const h=this.item.id;const l=this.item.canvasId;const c=this.viewerMode?this.currentViewport||"desktop":s.currentViewport;const p=this.item.layouts[c];let m=p;if(c==="mobile"&&!this.item.layouts.mobile.customized){const e=this.viewerMode?this.canvasItems||[]:((t=s.canvases[this.item.canvasId])===null||t===void 0?void 0:t.items)||[];const n=(i=e.findIndex((t=>t.id===this.item.id)))!==null&&i!==void 0?i:0;let o=0;if(n>0){for(let t=0;t<n;t++){const i=e[t];o+=i.layouts.desktop.height||6}}m={x:0,y:o,width:50,height:this.item.layouts.desktop.height||6}}const g=!this.viewerMode&&s.selectedItemId===this.item.id;const f={"grid-item":true,selected:g,"with-animations":(o=(n=this.config)===null||n===void 0?void 0:n.enableAnimations)!==null&&o!==void 0?o:true};const u=w(m.x,this.item.canvasId,this.config);const v=x(m.y);const b=w(m.width,this.item.canvasId,this.config);const z=x(m.height);const y=(a=this.componentRegistry)===null||a===void 0?void 0:a.get(this.item.type);const k=(y===null||y===void 0?void 0:y.icon)||"ÔøΩ";const I=this.item.name||(y===null||y===void 0?void 0:y.name)||this.item.type;const M=(y===null||y===void 0?void 0:y.selectionColor)||"#f59e0b";const C={transform:`translate(${u}px, ${v}px)`,width:`${b}px`,height:`${z}px`,zIndex:this.item.zIndex.toString(),"--selection-color":M,"--animation-duration":`${(d=(r=this.config)===null||r===void 0?void 0:r.animationDuration)!==null&&d!==void 0?d:100}ms`};const R=`${this.item.id}-content`;const F=`${this.item.id}-description`;const $=!this.viewerMode?"Use arrow keys to nudge position, drag header to move, resize handles to change size, Delete to remove. Drag components from palette to add new items.":null;if(y===null||y===void 0?void 0:y.renderItemWrapper){const t=y.renderItemWrapper({itemId:this.item.id,componentType:this.item.type,name:I,icon:k,isSelected:g,contentSlotId:R});return e("div",{class:f,id:this.item.id,tabindex:this.viewerMode?undefined:0,"aria-selected":g?"true":"false","aria-describedby":$?F:undefined,"data-canvas-id":this.item.canvasId,"data-component-name":I,"data-viewer-mode":this.viewerMode?"true":"false",style:C,onClick:t=>this.handleClick(t),ref:t=>this.itemRef=t},$&&e("div",{id:F,class:"sr-only"},$),t,e("div",{class:"resize-handle nw"}),e("div",{class:"resize-handle ne"}),e("div",{class:"resize-handle sw"}),e("div",{class:"resize-handle se"}),e("div",{class:"resize-handle n"}),e("div",{class:"resize-handle s"}),e("div",{class:"resize-handle e"}),e("div",{class:"resize-handle w"}))}return e("div",{class:f,id:this.item.id,role:"group","aria-label":`${I} component`,tabindex:this.viewerMode?undefined:0,"aria-selected":g?"true":"false","aria-describedby":$?F:undefined,"data-canvas-id":this.item.canvasId,"data-component-name":I,"data-viewer-mode":this.viewerMode?"true":"false",style:C,onClick:t=>this.handleClick(t),ref:t=>this.itemRef=t},$&&e("div",{id:F,class:"sr-only"},$),!this.viewerMode&&[e("div",{class:"drag-handle",key:"drag-handle","aria-label":`Drag ${I}`,role:"button","aria-grabbed":false}),e("div",{class:"grid-item-header",key:"header","aria-label":`${I} component header`},k," ",I),e("div",{class:"grid-item-controls",key:"controls"},e("button",{class:"grid-item-delete","aria-label":`Delete ${I} component`,onClick:()=>this.handleDelete(h,l)},"√ó"))],e("div",{class:"grid-item-content",id:R,"data-component-type":this.item.type},this.renderComponent()),!this.viewerMode&&[e("div",{class:"resize-handle nw",key:"resize-nw",role:"slider","aria-label":"Resize top-left corner",tabindex:-1}),e("div",{class:"resize-handle ne",key:"resize-ne",role:"slider","aria-label":"Resize top-right corner",tabindex:-1}),e("div",{class:"resize-handle sw",key:"resize-sw",role:"slider","aria-label":"Resize bottom-left corner",tabindex:-1}),e("div",{class:"resize-handle se",key:"resize-se",role:"slider","aria-label":"Resize bottom-right corner",tabindex:-1}),e("div",{class:"resize-handle n",key:"resize-n",role:"slider","aria-label":"Resize top edge",tabindex:-1}),e("div",{class:"resize-handle s",key:"resize-s",role:"slider","aria-label":"Resize bottom edge",tabindex:-1}),e("div",{class:"resize-handle e",key:"resize-e",role:"slider","aria-label":"Resize right edge",tabindex:-1}),e("div",{class:"resize-handle w",key:"resize-w",role:"slider","aria-label":"Resize left edge",tabindex:-1})])}static get watchers(){return{item:["handleItemChange"],renderVersion:["handleRenderVersionChange"],config:["handleConfigChange"],currentViewport:["handleViewportChange"]}}};R.style=M;export{R as grid_item_wrapper};
//# sourceMappingURL=p-827fbb6f.entry.js.map