{"file":"grid-calculations-54c868d5.js","mappings":"AAAA;;;;;;;AAQA;;;AAGA,MAAM,QAAQ;IAAd;QACU,aAAQ,GAA6B,IAAI,GAAG,EAAE,CAAC;KAoCxD;;;;;IA9BC,SAAS,CAAC,QAAgB;;QAExB,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAC/B,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAE,CAAC;SACrC;;QAGD,MAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACjD,IAAI,MAAM,EAAE;YACV,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SACrC;QAED,OAAO,MAAM,CAAC;KACf;;;;;IAMD,UAAU,CAAC,QAAgB;QACzB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;KAChC;;;;;IAMD,KAAK;QACH,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;KACvB;CACF;AAED;MACa,QAAQ,GAAG,IAAI,QAAQ;;ACnDpC;;;;;;;;AAWA,MAAM,kBAAkB,GAAG,EAAE,CAAC;AAC9B,MAAM,4BAA4B,GAAG,IAAI,CAAC;AAE1C;AACA,MAAM,aAAa,GAAG,IAAI,GAAG,EAAkB,CAAC;AAEhD;;;;SAIgB,kBAAkB;IAChC,aAAa,CAAC,KAAK,EAAE,CAAC;AACxB,CAAC;AAED;;;;SAIgB,qBAAqB,CAAC,QAAgB,EAAE,cAAuB,KAAK;IAClF,MAAM,QAAQ,GAAG,GAAG,QAAQ,IAAI,CAAC;IAEjC,IAAI,CAAC,WAAW,IAAI,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;QAC/C,OAAO,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAE,CAAC;KACrC;;IAGD,MAAM,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;IAC/C,IAAI,CAAC,SAAS,EAAE;QACd,OAAO,CAAC,IAAI,CAAC,+BAA+B,QAAQ,EAAE,CAAC,CAAC;QACxD,OAAO,CAAC,CAAC;KACV;IAED,MAAM,IAAI,GAAG,SAAS,CAAC,WAAW,GAAG,4BAA4B,CAAC;IAClE,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAClC,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;SAGgB,mBAAmB;IACjC,OAAO,kBAAkB,CAAC;AAC5B,CAAC;AAED;;;;SAIgB,aAAa,CAAC,SAAiB,EAAE,QAAgB;;IAE/D,MAAM,QAAQ,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC;IACjD,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC,CAAC;AAC1C,CAAC;AAED;;;;SAIgB,aAAa,CAAC,SAAiB;IAC7C,OAAO,SAAS,GAAG,kBAAkB,CAAC;AACxC,CAAC;AAED;;;SAGgB,aAAa,CAAC,MAAc,EAAE,QAAgB;;IAE5D,MAAM,QAAQ,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC;IACjD,IAAI,QAAQ,KAAK,CAAC,EAAE;QAClB,OAAO,CAAC,CAAC;KACV;IACD,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,CAAC,CAAC;AACvC,CAAC;AAED;;;SAGgB,aAAa,CAAC,MAAc;IAC1C,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,kBAAkB,CAAC,CAAC;AACjD;;;;","names":[],"sources":["src/utils/dom-cache.ts","src/utils/grid-calculations.ts"],"sourcesContent":["/**\n * DOM Cache Utility\n * Cache DOM queries for performance\n *\n * Purpose: Reduce repeated document.getElementById() calls\n * which can be slow when called frequently during drag/resize operations\n */\n\n/**\n * DOM Cache for canvas containers and frequently accessed elements\n */\nclass DOMCache {\n  private canvases: Map<string, HTMLElement> = new Map();\n\n  /**\n   * Get canvas element by ID (cached)\n   * Falls back to document.getElementById if not cached\n   */\n  getCanvas(canvasId: string): HTMLElement | null {\n    // Check cache first\n    if (this.canvases.has(canvasId)) {\n      return this.canvases.get(canvasId)!;\n    }\n\n    // Query DOM and cache\n    const canvas = document.getElementById(canvasId);\n    if (canvas) {\n      this.canvases.set(canvasId, canvas);\n    }\n\n    return canvas;\n  }\n\n  /**\n   * Invalidate cache for a specific canvas\n   * Call this when canvas is removed or replaced\n   */\n  invalidate(canvasId: string): void {\n    this.canvases.delete(canvasId);\n  }\n\n  /**\n   * Clear entire cache\n   * Call this on major DOM restructuring\n   */\n  clear(): void {\n    this.canvases.clear();\n  }\n}\n\n// Export singleton instance\nexport const domCache = new DOMCache();\n","/**\n * Grid Calculations Utility\n * Pure functions for grid coordinate conversions\n *\n * Grid System:\n * - Horizontal: 2% responsive grid (50 units across full width)\n * - Vertical: Fixed 20px grid\n */\n\nimport { domCache } from './dom-cache';\n\nconst GRID_SIZE_VERTICAL = 20; // Fixed 20px vertical grid\nconst GRID_SIZE_HORIZONTAL_PERCENT = 0.02; // 2% horizontal grid\n\n// Grid size cache - avoid recalculating on every operation\nconst gridSizeCache = new Map<string, number>();\n\n/**\n * Clear grid size cache\n * Call this when canvas containers are resized\n */\nexport function clearGridSizeCache() {\n  gridSizeCache.clear();\n}\n\n/**\n * Calculate horizontal grid size (responsive, based on container width)\n * Uses cache to avoid repeated DOM queries\n */\nexport function getGridSizeHorizontal(canvasId: string, forceRecalc: boolean = false): number {\n  const cacheKey = `${canvasId}-h`;\n\n  if (!forceRecalc && gridSizeCache.has(cacheKey)) {\n    return gridSizeCache.get(cacheKey)!;\n  }\n\n  // Use DOM cache instead of getElementById\n  const container = domCache.getCanvas(canvasId);\n  if (!container) {\n    console.warn(`Canvas container not found: ${canvasId}`);\n    return 0;\n  }\n\n  const size = container.clientWidth * GRID_SIZE_HORIZONTAL_PERCENT;\n  gridSizeCache.set(cacheKey, size);\n  return size;\n}\n\n/**\n * Calculate vertical grid size (fixed 20px)\n */\nexport function getGridSizeVertical(): number {\n  return GRID_SIZE_VERTICAL;\n}\n\n/**\n * Convert grid units to pixels for horizontal values (x, width)\n * Uses percentage calculation to match CSS background grid\n */\nexport function gridToPixelsX(gridUnits: number, canvasId: string): number {\n  // Use cached grid size for better performance\n  const gridSize = getGridSizeHorizontal(canvasId);\n  return Math.round(gridUnits * gridSize);\n}\n\n/**\n * Convert grid units to pixels for vertical values (y, height)\n * Uses fixed 20px grid size\n */\nexport function gridToPixelsY(gridUnits: number): number {\n  return gridUnits * GRID_SIZE_VERTICAL;\n}\n\n/**\n * Convert pixels to grid units for horizontal values (x, width)\n */\nexport function pixelsToGridX(pixels: number, canvasId: string): number {\n  // Use cached grid size for better performance\n  const gridSize = getGridSizeHorizontal(canvasId);\n  if (gridSize === 0) {\n    return 0;\n  }\n  return Math.round(pixels / gridSize);\n}\n\n/**\n * Convert pixels to grid units for vertical values (y, height)\n */\nexport function pixelsToGridY(pixels: number): number {\n  return Math.round(pixels / GRID_SIZE_VERTICAL);\n}\n"],"version":3}