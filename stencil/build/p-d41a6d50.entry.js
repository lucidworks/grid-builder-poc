import{r as t,h as e,a as i}from"./p-CC73Dkup.js";import{i as s}from"./p-BKH_Whl_.js";import{a as n,s as o,o as a}from"./p-BmMMCJ61.js";import{c as r,b as c,g as l,a as d}from"./p-1wddBNwA.js";import{a as h}from"./p-D0wwQuOO.js";const p=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}@keyframes canvas-highlight-pulse{0%,100%{box-shadow:0 0 0 0 var(--primary-color, #f59e0b);opacity:1}50%{box-shadow:0 0 0 4px var(--primary-color, #f59e0b);opacity:0.7}}.canvas-highlight{animation:canvas-highlight-pulse 600ms ease-out}@keyframes position-indicator-fade{0%{opacity:0.8}70%{opacity:0.8}100%{opacity:0}}.position-indicator{position:absolute;border:2px dashed var(--primary-color, #007bff);opacity:0.8;pointer-events:none;z-index:9999;animation:position-indicator-fade 800ms ease-out forwards}";const m=class{constructor(e){t(this,e);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.isDropTarget=false;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){n(this.canvasId);const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const e=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(e)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((()=>{r();this.renderVersion++}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=s(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{this.isDropTarget=true},dragleave:t=>{this.isDropTarget=false},drop:t=>{this.isDropTarget=false;let e=t.relatedTarget;const i=e.closest(".palette-item");if(i){e=i}const s=e.classList.contains("palette-item");if(s){e._dropWasValid=true}const n=e.classList.contains("grid-item-header");const o=e.classList.contains("grid-item");const a=n?e.closest(".grid-item"):e;if(s){const i=e.getAttribute("data-component-type");const s=e._defaultWidth||10;const n=e._defaultHeight||6;const o=c(s,this.canvasId,this.config);const a=l(n);const r=o/2;const d=a/2;const h=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-h.left-r;const m=t.dragEvent.clientY-h.top-d;const u=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:i,x:p,y:m},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(u)}else if(o||n){const t=a.id;const e=a.getAttribute("data-canvas-id");if(e!==this.canvasId){const i=a.getBoundingClientRect();const s=this.gridContainerRef.getBoundingClientRect();const n=i.left-s.left;const o=i.top-s.top;const r=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:e,targetCanvasId:this.canvasId,x:n,y:o},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(r)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=o.canvases[this.canvasId];this.calculatedHeight=h(this.canvasId,this.config);a("canvases",(()=>{try{if(this.canvasId&&o.canvases[this.canvasId]){this.canvas=o.canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=h(this.canvasId,this.config)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));a("currentViewport",(()=>{this.calculatedHeight=h(this.canvasId,this.config)}));a("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=o.canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,e){if(t===e)return;this.canvas=o.canvases[t];this.calculatedHeight=h(t,this.config);if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,e){if(t===e)return;this.calculatedHeight=h(this.canvasId,t);this.renderVersion++}handleIsActiveChange(t,e){if(t===e)return}render(){var t,i,s;const n=o.showGrid;const a=d(this.config);const r=(i=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&i!==void 0?i:20;const c=l(r,this.config);return e("div",{key:"93d93db72e4a5595dcc9134d5072fb50d1a9ba8e",class:"canvas-section","data-canvas-id":this.canvasId},e("div",{key:"a5ccb051cbe23d6e510fc6feab0bfd3d86b65aae",class:{"grid-container":true,"hide-grid":!n,active:this.isActive,"drop-target":this.isDropTarget},id:this.canvasId,role:"region","aria-label":this.canvasTitle||`Canvas ${this.canvasId}`,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${a}px`,minHeight:`${c}px`},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(s=this.canvas)===null||s===void 0?void 0:s.items.map((t=>e("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};m.style=p;const u=".palette{width:250px;padding:20px;border-right:1px solid #ddd;background:white;overflow-y:auto}.palette h2{margin-bottom:20px;color:#333;font-size:18px}.palette-chromeless{padding-top:10px}.palette-empty{color:#999;font-size:13px;font-style:italic}.palette-item{margin-bottom:10px;cursor:move;user-select:none;touch-action:none;}.palette-item:not(:has(>div)){padding:15px;border-radius:4px;background:#4a90e2;color:white;font-weight:500;text-align:center;transition:transform 0.2s, box-shadow 0.2s}.palette-item:hover{box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);transform:translateY(-2px)}.palette-item.dragging-from-palette{opacity:0.5}.dragging-clone{position:fixed;z-index:10000;pointer-events:none}";const f=class{constructor(e){t(this,e);this.showHeader=true;this.paletteLabel="Component palette";this.draggingItemType=null;this.paletteId=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;this.initializePaletteItems=()=>{const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){return}s(t).draggable({inertia:false,autoScroll:false,listeners:{start:t=>{const e=t.target.closest(".palette-item");if(!e){console.warn("Could not find .palette-item element");return}const i=e.getAttribute("data-component-type");this.draggingItemType=i;const s=e.getBoundingClientRect();e._originalPosition={left:s.left,top:s.top};e._dropWasValid=false;const n=this.components.find((t=>t.type===i));if(!n){console.warn(`Component definition not found for type: ${i}`);return}const o=n.defaultSize||{width:10,height:6};const a=window.gridState;const r=(a===null||a===void 0?void 0:a.canvases)?Object.keys(a.canvases):[];const d=r.length>0?r[0]:null;let h;let p;if(d){h=c(o.width,d,this.config);p=l(o.height)}else{const t=20;h=o.width*t;p=o.height*t}const m=h/2;const u=p/2;const f=document.createElement("div");f.className="dragging-clone";f.style.position="fixed";f.style.left=t.clientX-m+"px";f.style.top=t.clientY-u+"px";f.style.width=h+"px";f.style.height=p+"px";f.style.overflow="hidden";f.style.pointerEvents="none";f.style.zIndex="10000";f.style.border="2px solid rgba(74, 144, 226, 0.5)";f.style.borderRadius="4px";f.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)";f.style.cursor="grabbing";const g=n.renderDragClone();if(g instanceof HTMLElement){f.appendChild(g)}else{const t=g;const e=t.t;const i=document.createElement(e);if(t.i){Object.keys(t.i).forEach((e=>{i.setAttribute(e,t.i[e])}))}f.appendChild(i)}document.body.appendChild(f);e._dragClone=f;e._halfWidth=m;e._halfHeight=u;e._defaultWidth=o.width;e._defaultHeight=o.height},move:t=>{const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const s=e._halfWidth;const n=e._halfHeight;if(i){i.style.left=t.clientX-s+"px";i.style.top=t.clientY-n+"px"}},end:t=>{this.draggingItemType=null;const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const s=e._dropWasValid;const n=e._originalPosition;if(i){if(!s&&n){i.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";i.style.left=n.left+"px";i.style.top=n.top+"px";i.style.opacity="0";setTimeout((()=>{i.remove()}),300)}else{i.remove()}delete e._dragClone;delete e._halfWidth;delete e._halfHeight;delete e._dropWasValid;delete e._originalPosition}}}});t._dragInitialized=true}))};this.handlePaletteItemClick=t=>{var e,i;const s=(i=(e=this.config)===null||e===void 0?void 0:e.enableClickToAdd)!==null&&i!==void 0?i:true;if(!s){return}if(this.draggingItemType){return}const n=t.target.closest(".palette-item");if(!n){return}const o=n.getAttribute("data-component-type");if(!o){console.warn("handlePaletteItemClick: Component type not found");return}const a=new CustomEvent("palette-item-click",{detail:{componentType:o},bubbles:true,composed:true});this.hostElement.dispatchEvent(a)};this.handlePaletteItemKeyDown=t=>{var e,i;const s=(i=(e=this.config)===null||e===void 0?void 0:e.enableClickToAdd)!==null&&i!==void 0?i:true;if(!s){return}if(t.key==="Enter"||t.key===" "){t.preventDefault();this.handlePaletteItemClick(t)}}}handleComponentsChange(t,e){if(t===e)return;if(!e)return;requestAnimationFrame((()=>{this.initializePaletteItems()}))}handleConfigChange(t,e){if(t===e)return}componentDidLoad(){this.initializePaletteItems()}componentDidUpdate(){this.initializePaletteItems()}render(){var t;const i={palette:true,"palette-chromeless":!this.showHeader};const s=`palette-help-${this.paletteId}`;if(!this.components||this.components.length===0){return e("div",{class:i},this.showHeader&&e("h2",null,"Components"),e("p",{class:"palette-empty",role:"status","aria-live":"polite"},"No components available"))}return e("div",{class:i,role:"toolbar","aria-label":this.paletteLabel,"aria-orientation":"vertical"},e("div",{id:s,class:"sr-only"},((t=this.config)===null||t===void 0?void 0:t.enableClickToAdd)!==false?"Click or press Enter/Space to add component to active canvas, or drag to position on any canvas":"Drag component to canvas to add"),this.showHeader&&e("h2",{id:"palette-heading"},"Components"),this.components.map((t=>{var i;const n={"palette-item":true,"palette-item-custom":!!t.renderPaletteItem,"dragging-from-palette":this.draggingItemType===t.type};const o=((i=this.config)===null||i===void 0?void 0:i.enableClickToAdd)!==false?`${t.name} component. Click to add to active canvas or drag to position`:`${t.name} component. Drag to canvas`;return e("div",{class:n,"data-component-type":t.type,key:t.type,role:"button",tabindex:0,"aria-label":o,"aria-describedby":s,"aria-pressed":this.draggingItemType===t.type?"true":"false",onClick:t=>this.handlePaletteItemClick(t),onKeyDown:t=>this.handlePaletteItemKeyDown(t)},t.renderPaletteItem?(()=>{const i=t.renderPaletteItem({componentType:t.type,name:t.name,icon:t.icon});if(i instanceof HTMLElement){return e("div",{ref:t=>t&&!t.hasChildNodes()&&t.appendChild(i)})}return i})():`${t.icon} ${t.name}`)})))}disconnectedCallback(){const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){s(t).unset();delete t._dragInitialized}}))}get hostElement(){return i(this)}static get watchers(){return{components:["handleComponentsChange"],config:["handleConfigChange"]}}};f.style=u;export{m as canvas_section,f as component_palette};
//# sourceMappingURL=p-d41a6d50.entry.js.map