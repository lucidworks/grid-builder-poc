import{c as t,g as s,u as i,d as n,a as o}from"./p-Dn6kA53k.js";import{e}from"./p-CxIZTn1z.js";class c{constructor(){this.observer=null;this.observedElements=new Map;this.initialize()}initialize(){this.observer=new IntersectionObserver((t=>{t.forEach((t=>{const s=t.target.id;const i=this.observedElements.get(s);if(i){i(t.isIntersecting)}}))}),{rootMargin:"200px",threshold:[0,.01]})}observe(t,s,i){if(!this.observer||!t){return}this.observedElements.set(s,i);this.observer.observe(t);const n=t.getBoundingClientRect();const o=window.innerHeight||document.documentElement.clientHeight;const e=window.innerWidth||document.documentElement.clientWidth;const c=n.top<o+200&&n.bottom>-200&&n.left<e+200&&n.right>-200;if(c){i(true)}}unobserve(t,s){if(!this.observer||!t){return}this.observedElements.delete(s);this.observer.unobserve(t)}destroy(){if(this.observer){this.observer.disconnect();this.observer=null}this.observedElements.clear()}}const d=new c;const a=t("undo-redo-commands");class h{constructor(t,s,i,n,o,e,c,d,a,h){this.itemId=t;this.sourceCanvasId=s;this.targetCanvasId=i;this.sourcePosition=Object.assign({},n);this.targetPosition=Object.assign({},o);this.sourceIndex=e;this.sourceZIndex=c;this.targetZIndex=d;this.sourceSize=a?Object.assign({},a):undefined;this.targetSize=h?Object.assign({},h):undefined}undo(){a.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let t=s.canvases[this.targetCanvasId];let i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){for(const n in s.canvases){const o=s.canvases[n];i=o.items.find((t=>t.id===this.itemId));if(i){t=o;break}}}if(!i||!t){console.warn("  âŒ Item or canvas not found, aborting undo");return}a.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.sourceCanvasId;i.layouts.desktop.x=this.sourcePosition.x;i.layouts.desktop.y=this.sourcePosition.y;i.zIndex=this.sourceZIndex;a.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.sourceSize){i.layouts.desktop.width=this.sourceSize.width;i.layouts.desktop.height=this.sourceSize.height}const n=s.canvases[this.sourceCanvasId];if(!n){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=n.items.length){n.items.splice(this.sourceIndex,0,i)}else{n.items.push(i)}s.canvases=Object.assign({},s.canvases);const o=document.getElementById(this.itemId);if(o){a.log("  ðŸŽ¨ Clearing inline transform style");o.style.transform=""}a.log("  âœ… Undo complete")}redo(){a.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const t=s.canvases[this.sourceCanvasId];const i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){console.warn("  âŒ Item not found, aborting redo");return}a.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.targetCanvasId;i.layouts.desktop.x=this.targetPosition.x;i.layouts.desktop.y=this.targetPosition.y;i.zIndex=this.targetZIndex;a.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.targetSize){i.layouts.desktop.width=this.targetSize.width;i.layouts.desktop.height=this.targetSize.height}const n=s.canvases[this.targetCanvasId];if(!n){console.warn("  âŒ Target canvas not found, aborting redo");return}n.items.push(i);s.canvases=Object.assign({},s.canvases);const o=document.getElementById(this.itemId);if(o){a.log("  ðŸŽ¨ Clearing inline transform style");o.style.transform=""}a.log("  âœ… Redo complete")}}class r{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));n(t)}redo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}}class u{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}redo(){const t=this.itemsData.map((t=>t.id));n(t)}}class l{constructor(t){this.updates=t.map((({itemId:t,canvasId:i,updates:n})=>{const o=s.canvases[i];const e=o===null||o===void 0?void 0:o.items.find((s=>s.id===t));if(!e){return null}return{itemId:t,canvasId:i,oldItem:JSON.parse(JSON.stringify(e)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},e),n)))}})).filter(Boolean)}undo(){const t=this.updates.map((({itemId:t,canvasId:s,oldItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}redo(){const t=this.updates.map((({itemId:t,canvasId:s,newItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}}class f{constructor(t){this.description="Add Canvas";this.canvasId=t}undo(){a.log("ðŸ”™ AddCanvasCommand.undo() - removing canvas:",this.canvasId);delete s.canvases[this.canvasId];s.canvases=Object.assign({},s.canvases);a.log("  ðŸ“¢ Emitting canvasRemoved event for:",this.canvasId);e.emit("canvasRemoved",{canvasId:this.canvasId})}redo(){s.canvases[this.canvasId]={zIndexCounter:1,items:[]};s.canvases=Object.assign({},s.canvases);e.emit("canvasAdded",{canvasId:this.canvasId})}}class v{constructor(t){this.description="Remove Canvas";this.canvasSnapshot=null;this.canvasId=t;const i=s.canvases[t];if(i){this.canvasSnapshot=JSON.parse(JSON.stringify(i))}}undo(){if(this.canvasSnapshot){s.canvases[this.canvasId]=JSON.parse(JSON.stringify(this.canvasSnapshot));s.canvases=Object.assign({},s.canvases);e.emit("canvasAdded",{canvasId:this.canvasId})}}redo(){delete s.canvases[this.canvasId];s.canvases=Object.assign({},s.canvases);e.emit("canvasRemoved",{canvasId:this.canvasId})}}const m=t("undo-redo");const I=50;class O{constructor(){this.commandHistory=[];this.historyPosition=-1;const{state:t,dispose:s}=o({canUndo:false,canRedo:false});this.state=t;this.dispose=s}updateButtonStates(){this.state.canUndo=this.historyPosition>=0;this.state.canRedo=this.historyPosition<this.commandHistory.length-1}push(t){m.log("âž• PUSH: Adding command to history:",t.description||t);this.commandHistory.splice(this.historyPosition+1);this.commandHistory.push(t);if(this.commandHistory.length>I){this.commandHistory.shift()}else{this.historyPosition++}m.log("  History position now:",this.historyPosition,", Total commands:",this.commandHistory.length);this.updateButtonStates()}undo(){if(this.historyPosition<0){return}const t=this.commandHistory[this.historyPosition];m.log("ðŸ”™ UNDO: Executing command at position",this.historyPosition,":",t);m.log("  Command description:",t.description);t.undo();this.historyPosition--;m.log("  New position after undo:",this.historyPosition);this.updateButtonStates()}redo(){if(this.historyPosition>=this.commandHistory.length-1){return}this.historyPosition++;const t=this.commandHistory[this.historyPosition];t.redo();this.updateButtonStates()}canUndo(){return this.historyPosition>=0}canRedo(){return this.historyPosition<this.commandHistory.length-1}clearHistory(){this.commandHistory.length=0;this.historyPosition=-1;this.updateButtonStates()}}const p=new O;const b=p.state;const j=t=>p.push(t);const g=50;function C(t,s=g){var i;const n=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;return n<=s}function w(t,s=g){var i,n,o,e;const c=t.defaultSize.width;const d=t.defaultSize.height;const a=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;const h=((n=t.maxSize)===null||n===void 0?void 0:n.width)||Infinity;let r=c;let u=d;let l=false;if(r>s){r=s;l=true}if(r<a){r=a}if(r>h){r=h}const f=((o=t.minSize)===null||o===void 0?void 0:o.height)||0;const v=((e=t.maxSize)===null||e===void 0?void 0:e.height)||Infinity;if(u<f){u=f}if(u>v){u=v}return{width:r,height:u,wasAdjusted:l}}function S(t,s,i,n,o=g){let e=t;let c=s;let d=false;if(e<0){e=0;d=true}if(e+i>o){e=o-i;d=true}if(c<0){c=0;d=true}e=Math.max(0,e);c=Math.max(0,c);return{x:e,y:c,width:i,height:n,positionAdjusted:d,sizeAdjusted:false}}function x(t,s,i,n=g){var o;if(!C(t,n)){console.warn(`Component "${t.name}" minSize (${(o=t.minSize)===null||o===void 0?void 0:o.width}) `+`exceeds canvas width (${n}). Placement rejected.`);return null}const e=w(t,n);const c=S(s,i,e.width,e.height,n);return Object.assign(Object.assign({},c),{sizeAdjusted:e.wasAdjusted})}export{f as A,l as B,g as C,h as M,v as R,O as U,c as V,x as a,u as b,S as c,r as d,j as p,b as u,d as v};
//# sourceMappingURL=p-CxK_M2fX.js.map