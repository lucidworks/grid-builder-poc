import{r as t,h as i}from"./p-BS4nUT4S.js";import{c as e,C as s,M as n}from"./p-C9Eu2TsU.js";import{s as o,h as r,i as a,b as h,p as d,j as l,f as c,e as p,a as g}from"./p-DR95X3EV.js";function m(t){const i=t.style.transform;const e=i.match(/translate\(([\d.-]+)px,\s*([\d.-]+)px\)/);if(e){return{x:parseFloat(e[1]),y:parseFloat(e[2])}}return{x:0,y:0}}class f{constructor(t,i,e,s,n,o,r,a,h,d){this.interactInstance=null;this.basePosition={x:0,y:0};this.dragStartCanvasId="";this.hasMoved=false;this.dragRafId=null;this.element=t;this.item=i;this.state=e;this.onUpdate=s;this.domCacheInstance=n;this.config=o;this.dragHandleElement=r;this.onDragMove=a;this.onOperationStart=h;this.onOperationEnd=d;this.initialize()}destroy(){if(this.interactInstance){this.interactInstance.unset()}}initialize(){var t,i;const e=window.interact;if(!e){console.warn("interact.js not loaded");return}const s=this.dragHandleElement||this.element;const n=(i=(t=this.config)===null||t===void 0?void 0:t.enableAutoScroll)!==null&&i!==void 0?i:true;const o={inertia:false,autoScroll:n?{enabled:true,container:window,margin:60,speed:600}:false,listeners:{start:this.handleDragStart.bind(this),move:this.handleDragMove.bind(this),end:this.handleDragEnd.bind(this)}};if(!this.dragHandleElement){o.allowFrom=".grid-item-header";o.ignoreFrom=".resize-handle"}this.interactInstance=e(s).draggable(o)}handleDragStart(t){var i;(i=this.onOperationStart)===null||i===void 0?void 0:i.call(this);if(window.perfMonitor){window.perfMonitor.startOperation("drag")}this.hasMoved=false;const e=this.dragHandleElement?this.element:t.target;e.classList.add("dragging");this.dragStartCanvasId=this.item.canvasId;o(this.item.canvasId);r(this.item.id,this.item.canvasId);const s=this.dragHandleElement?this.element:t.target;this.basePosition=m(s);this.element._originalTransform=this.element.style.transform;this.element._originalPosition={x:this.basePosition.x,y:this.basePosition.y};t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0")}handleDragMove(t){const i=(parseFloat(t.target.getAttribute("data-x"))||0)+t.dx;const e=(parseFloat(t.target.getAttribute("data-y"))||0)+t.dy;t.target.setAttribute("data-x",i.toString());t.target.setAttribute("data-y",e.toString());if(!this.hasMoved&&this.onDragMove){this.hasMoved=true;this.onDragMove()}if(this.dragRafId){cancelAnimationFrame(this.dragRafId)}this.dragRafId=requestAnimationFrame((()=>{const s=this.dragHandleElement?this.element:t.target;s.style.transform=`translate(${this.basePosition.x+i}px, ${this.basePosition.y+e}px)`;this.dragRafId=null}))}handleDragEnd(t){var i,n;if(this.dragRafId){cancelAnimationFrame(this.dragRafId);this.dragRafId=null}const o=parseFloat(t.target.getAttribute("data-x"))||0;const r=parseFloat(t.target.getAttribute("data-y"))||0;const c=this.dragHandleElement?this.element:t.target;c.classList.remove("dragging");if(this.hasMoved){const i=t.target;const e=t=>{t.stopPropagation();t.preventDefault();i.removeEventListener("click",e,true)};i.addEventListener("click",e,true);setTimeout((()=>{i.removeEventListener("click",e,true)}),100)}const p=this.dragHandleElement?this.element:t.target;const g=p.getBoundingClientRect();let m=this.item.canvasId;let f=false;const u=document.querySelectorAll(".grid-container");u.forEach((t=>{const i=t.getBoundingClientRect();if(g.left>=i.left&&g.right<=i.right&&g.top>=i.top&&g.bottom<=i.bottom){m=t.getAttribute("data-canvas-id")||this.item.canvasId;f=true}}));if(!f){const t=g.left+g.width/2;const i=g.top+g.height/2;u.forEach((e=>{const s=e.getBoundingClientRect();if(t>=s.left&&t<=s.right&&i>=s.top&&i<=s.bottom){m=e.getAttribute("data-canvas-id")||this.item.canvasId}}))}if(m!==this.dragStartCanvasId){t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");if(window.perfMonitor){window.perfMonitor.endOperation("drag")}(i=this.onOperationEnd)===null||i===void 0?void 0:i.call(this);return}const v=this.domCacheInstance.getCanvas(m);if(!v){this.snapBackToOriginalPosition(t);(n=this.onOperationEnd)===null||n===void 0?void 0:n.call(this);return}const x=a(m,this.config,false,this.domCacheInstance);const w=h(this.config);let b=this.basePosition.x+o;let z=this.basePosition.y+r;b=Math.round(b/x)*x;z=Math.round(z/w)*w;const y=this.dragHandleElement?this.element:t.target;const k=parseFloat(y.style.width)||0;const I=parseFloat(y.style.height)||0;const M=d(b,m,this.config);const R=l(z,this.config);const C=d(k,m,this.config);const F=l(I,this.config);const E=e(M,R,C,F,s);const j=a(m,this.config,false,this.domCacheInstance);const S=h(this.config);b=E.x*j;z=E.y*S;const $=this.state.canvases[this.item.canvasId];const O=$===null||$===void 0?void 0:$.items.find((t=>t.id===this.item.id));const D=O||this.item;const T=JSON.parse(JSON.stringify(D));const H=this.state.currentViewport||"desktop";const W=T.layouts[H];W.x=E.x;W.y=E.y;if(H==="mobile"){T.layouts.mobile.customized=true;if(T.layouts.mobile.width===null){T.layouts.mobile.width=T.layouts.desktop.width}if(T.layouts.mobile.height===null){T.layouts.mobile.height=T.layouts.desktop.height}}requestAnimationFrame((()=>{var i;const e=this.dragHandleElement?this.element:t.target;e.style.transform=`translate(${b}px, ${z}px)`;t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");if(window.perfMonitor){window.perfMonitor.endOperation("drag")}this.onUpdate(T);(i=this.onOperationEnd)===null||i===void 0?void 0:i.call(this)}))}snapBackToOriginalPosition(t){const i=this.element._originalPosition;const e=this.element._originalTransform;if(!i){const i=this.dragHandleElement?this.element:t.target;i.classList.remove("dragging");return}const s=this.dragHandleElement?this.element:t.target;s.style.transition="transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";s.style.transform=e||`translate(${i.x}px, ${i.y}px)`;setTimeout((()=>{s.style.transition="";s.classList.remove("dragging")}),300);t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");delete this.element._originalPosition;delete this.element._originalTransform;if(window.perfMonitor){window.perfMonitor.endOperation("drag")}}}const u="2025-12-03T06:52:12.277Z";const v=c("resize-handler");function x(t){const i=t.style.transform;const e=i.match(/translate\(([\d.-]+)px,\s*([\d.-]+)px\)/);if(e){return{x:parseFloat(e[1]),y:parseFloat(e[2])}}return{x:0,y:0}}class w{constructor(t,i,e,s,n,o,r,a,h){this.interactInstance=null;this.resizeRafId=null;this.startRect={x:0,y:0,width:0,height:0};this.lastCalculated={x:0,y:0,width:0,height:0};this.minWidth=100;this.minHeight=80;this.maxWidth=Infinity;this.maxHeight=Infinity;this.element=t;this.item=i;this.state=e;this.onUpdate=s;this.domCacheInstance=n;this.componentDefinition=o;this.config=r;this.onOperationStart=a;this.onOperationEnd=h;if(!t.style.width||!t.style.height){console.warn("Element missing width/height styles, waiting for next frame");requestAnimationFrame((()=>this.initialize()))}else{this.initialize()}}destroy(){if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId);this.resizeRafId=null}if(this.interactInstance){this.interactInstance.unset()}}initialize(){var t,i;v.log("üì¶ resize-handler.ts build:",u);v.log("üîß Grid config fix applied - resize handler now uses same grid calculations as render");const e=window.interact;if(!e){console.warn("interact.js not loaded");return}const s=(t=this.componentDefinition)===null||t===void 0?void 0:t.minSize;const n=(i=this.componentDefinition)===null||i===void 0?void 0:i.maxSize;this.minWidth=s?p(s.width,this.item.canvasId,this.config):100;this.minHeight=s?g(s.height,this.config):80;this.maxWidth=n?p(n.width,this.item.canvasId,this.config):Infinity;this.maxHeight=n?g(n.height,this.config):Infinity;const o=this.maxWidth===Infinity||this.maxWidth>this.minWidth;const r=this.maxHeight===Infinity||this.maxHeight>this.minHeight;v.log("üîß ResizeHandler init for",this.item.id,{minWidth:this.minWidth,maxWidth:this.maxWidth,minHeight:this.minHeight,maxHeight:this.maxHeight,canResizeWidth:o,canResizeHeight:r,componentDefinition:this.componentDefinition});if(!o){v.log("  ‚ùå Disabling width resize");this.element.classList.add("resize-width-disabled")}if(!r){v.log("  ‚ùå Disabling height resize");this.element.classList.add("resize-height-disabled")}this.interactInstance=e(this.element).resizable({edges:{left:o,right:o,bottom:r,top:r},ignoreFrom:".grid-item-header",listeners:{start:this.handleResizeStart.bind(this),move:this.handleResizeMove.bind(this),end:this.handleResizeEnd.bind(this)}})}handleResizeStart(t){var i;(i=this.onOperationStart)===null||i===void 0?void 0:i.call(this);if(window.perfMonitor){window.perfMonitor.startOperation("resize")}t.target.classList.add("resizing");o(this.item.canvasId);const e=x(t.target);this.startRect.x=e.x;this.startRect.y=e.y;this.startRect.width=parseFloat(t.target.style.width)||0;this.startRect.height=parseFloat(t.target.style.height)||0;t.target.setAttribute("data-x","0");t.target.setAttribute("data-y","0");t.target.setAttribute("data-width","0");t.target.setAttribute("data-height","0");v.log("üü¢ RESIZE START:",{edges:t.edges,startRect:Object.assign({},this.startRect),itemId:this.item.id})}handleResizeMove(t){const i=(parseFloat(t.target.getAttribute("data-x"))||0)+t.deltaRect.left;const e=(parseFloat(t.target.getAttribute("data-y"))||0)+t.deltaRect.top;const s=(parseFloat(t.target.getAttribute("data-width"))||0)+t.deltaRect.width;const n=(parseFloat(t.target.getAttribute("data-height"))||0)+t.deltaRect.height;t.target.setAttribute("data-x",i.toString());t.target.setAttribute("data-y",e.toString());t.target.setAttribute("data-width",s.toString());t.target.setAttribute("data-height",n.toString());let o=this.startRect.width+s;let r=this.startRect.height+n;let a=this.startRect.x+i;let h=this.startRect.y+e;const d=this.domCacheInstance.getCanvas(this.item.canvasId);const l=d?d.clientWidth:Infinity;const c=d?d.clientHeight:Infinity;o=Math.max(this.minWidth,Math.min(this.maxWidth,o));r=Math.max(this.minHeight,Math.min(this.maxHeight,r));if(t.edges.top){const t=this.startRect.y+this.startRect.height;h=t-r}if(t.edges.left){const t=this.startRect.x+this.startRect.width;a=t-o}if(a<0){if(t.edges.left){o=Math.max(this.minWidth,o+a)}a=0}if(h<0){if(t.edges.top){r=Math.max(this.minHeight,r+h)}h=0}if(a+o>l){o=Math.max(this.minWidth,l-a)}if(h+r>c){r=Math.max(this.minHeight,c-h)}if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId)}this.resizeRafId=requestAnimationFrame((()=>{v.log("üîµ RESIZE MOVE (RAF):",{edges:t.edges,deltas:{deltaX:i,deltaY:e,deltaWidth:s,deltaHeight:n},startRect:Object.assign({},this.startRect),calculated:{newX:a,newY:h,newWidth:o,newHeight:r}});t.target.style.transform=`translate(${a}px, ${h}px)`;t.target.style.width=o+"px";t.target.style.height=r+"px";this.resizeRafId=null}))}handleResizeEnd(t){var i,e;if(this.resizeRafId){cancelAnimationFrame(this.resizeRafId);this.resizeRafId=null}t.target.classList.remove("resizing");if(t.interaction&&typeof t.interaction.stop==="function"){t.interaction.stop()}const s=this.domCacheInstance.getCanvas(this.item.canvasId);if(!s){(i=this.onOperationEnd)===null||i===void 0?void 0:i.call(this);return}const n=s.getBoundingClientRect();const o=a(this.item.canvasId,this.config,false,this.domCacheInstance);const r=h(this.config);const c=parseFloat(t.target.getAttribute("data-x"))||0;const p=parseFloat(t.target.getAttribute("data-y"))||0;const g=parseFloat(t.target.getAttribute("data-width"))||0;const m=parseFloat(t.target.getAttribute("data-height"))||0;t.target.removeAttribute("data-x");t.target.removeAttribute("data-y");t.target.removeAttribute("data-width");t.target.removeAttribute("data-height");let f=this.startRect.x+c;let u=this.startRect.y+p;let x=this.startRect.width+g;let w=this.startRect.height+m;v.log("üî¥ RESIZE END:",{edges:t.edges,eventRect:{left:t.rect.left,top:t.rect.top,width:t.rect.width,height:t.rect.height},containerRect:{left:n.left,top:n.top},beforeSnap:{newX:f,newY:u,newWidth:x,newHeight:w},gridSize:{gridSizeX:o,gridSizeY:r},startRect:Object.assign({},this.startRect),lastCalculated:Object.assign({},this.lastCalculated)});if(x>this.startRect.width){x=Math.ceil(x/o)*o}else if(x<this.startRect.width){x=Math.floor(x/o)*o}else{x=Math.round(x/o)*o}x=Math.max(this.minWidth,x);if(w>this.startRect.height){w=Math.ceil(w/r)*r}else if(w<this.startRect.height){w=Math.floor(w/r)*r}else{w=Math.round(w/r)*r}w=Math.max(this.minHeight,w);if(f<this.startRect.x){f=Math.floor(f/o)*o}else if(f>this.startRect.x){f=Math.ceil(f/o)*o}else{f=Math.round(f/o)*o}if(u<this.startRect.y){u=Math.floor(u/r)*r}else if(u>this.startRect.y){u=Math.ceil(u/r)*r}else{u=Math.round(u/r)*r}v.log("  afterDirectionalSnap:",{newX:f,newY:u,newWidth:x,newHeight:w});if(t.edges.top){const t=this.startRect.y+this.startRect.height;u=t-w;v.log("  ‚úÖ TOP EDGE RESIZE: Preserving bottom edge",{bottomEdge:t,snappedHeight:w,adjustedY:u})}if(t.edges.left){const t=this.startRect.x+this.startRect.width;f=t-x;v.log("  ‚úÖ LEFT EDGE RESIZE: Preserving right edge",{rightEdge:t,snappedWidth:x,adjustedX:f})}const b=x;const z=w;x=Math.max(this.minWidth,Math.min(this.maxWidth,x));w=Math.max(this.minHeight,Math.min(this.maxHeight,w));if(b!==x&&t.edges.left){const t=b-x;f+=t}if(z!==w&&t.edges.top){const t=z-w;u+=t}v.log("  afterMinMaxClamp:",{newX:f,newY:u,newWidth:x,newHeight:w});const y=s.clientWidth;const k=s.clientHeight;v.log("  canvasBounds:",{canvasWidth:y,canvasHeight:k});v.log("  event.edges:",t.edges);if(x>y){v.log("  ‚ö†Ô∏è Width exceeds canvas, shrinking from",x,"to",y);x=y}if(f<0){v.log("  ‚ö†Ô∏è Left edge outside canvas, moving from x =",f,"to x = 0");f=0}if(f+x>y){if(t.edges&&t.edges.right){const t=y-f;v.log("  ‚ö†Ô∏è Right edge overflow (resizing from right), clamping width from",x,"to",t);x=Math.max(this.minWidth,t)}else{const t=y-x;v.log("  ‚ö†Ô∏è Right edge outside canvas, moving from x =",f,"to x =",t);f=t;if(f<0){v.log("  ‚ö†Ô∏è Cannot fit by moving, shrinking width to",y);x=y;f=0}}}if(w>k){v.log("  ‚ö†Ô∏è Height exceeds canvas, shrinking from",w,"to",k);w=k}if(u<0){v.log("  ‚ö†Ô∏è Top edge outside canvas, moving from y =",u,"to y = 0");u=0}if(u+w>k){if(t.edges&&t.edges.bottom){const t=k-u;v.log("  ‚ö†Ô∏è Bottom edge overflow (resizing from bottom), clamping height from",w,"to",t);w=Math.max(this.minHeight,t)}else{const t=k-w;v.log("  ‚ö†Ô∏è Bottom edge outside canvas, moving from y =",u,"to y =",t);u=t;if(u<0){v.log("  ‚ö†Ô∏è Cannot fit by moving, shrinking height to",k);w=k;u=0}}}v.log("  afterBoundaryCheck:",{newX:f,newY:u,newWidth:x,newHeight:w});t.target.style.transform=`translate(${f}px, ${u}px)`;t.target.style.width=x+"px";t.target.style.height=w+"px";v.log("  appliedToDOM:",{transform:`translate(${f}px, ${u}px)`,width:`${x}px`,height:`${w}px`});const I=this.state.canvases[this.item.canvasId];const M=I===null||I===void 0?void 0:I.items.find((t=>t.id===this.item.id));const R=M||this.item;const C=JSON.parse(JSON.stringify(R));const F=this.state.currentViewport||"desktop";const E=C.layouts[F];E.width=d(x,C.canvasId,this.config);E.height=l(w,this.config);E.x=d(f,C.canvasId,this.config);E.y=l(u,this.config);v.log("  finalGridUnits:",{x:E.x,y:E.y,width:E.width,height:E.height});v.log("---");if(F==="mobile"){C.layouts.mobile.customized=true}if(window.perfMonitor){window.perfMonitor.endOperation("resize")}this.onUpdate(C);(e=this.onOperationEnd)===null||e===void 0?void 0:e.call(this)}}const b='@charset "UTF-8";.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.grid-item{position:absolute;box-sizing:border-box;padding:0;border:none;border-radius:0;background:transparent;box-shadow:none;outline:2px solid transparent;outline-offset:-2px;cursor:default;transition:outline-color 0.2s, box-shadow 0.2s;will-change:transform;touch-action:none;container-type:inline-size;--selection-color:#f59e0b}.grid-item.with-animations{transition:border-color 0.2s, box-shadow 0.2s, transform var(--animation-duration, 200ms) ease-out, width var(--animation-duration, 200ms) ease-out, height var(--animation-duration, 200ms) ease-out}.grid-item.dragging,.grid-item.resizing{transition:none !important}.grid-item:hover{outline-color:var(--selection-color)}.grid-item[data-viewer-mode=true]:hover{outline-color:transparent}.grid-item.selected{outline:3px solid var(--selection-color);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--selection-color) 20%, transparent), 0 4px 12px color-mix(in srgb, var(--selection-color) 30%, transparent);}.grid-item[data-viewer-mode=true].selected{outline:2px solid transparent;outline-offset:-2px;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1)}.grid-item.dragging{cursor:move;opacity:0.7}.grid-item.resizing{user-select:none}.grid-item-header{position:absolute;z-index:100;top:-26px;left:12px;display:flex;align-items:center;padding:4px 10px;border:2px solid var(--selection-color);border-radius:4px 4px 0 0;border-bottom:none;background:var(--selection-color);color:white;cursor:move !important;font-size:11px;font-weight:600;gap:6px;letter-spacing:0.3px;opacity:0;pointer-events:auto;transition:opacity 0.2s;user-select:none;touch-action:none;}.grid-item.selected .grid-item-header,.grid-item:hover .grid-item-header{opacity:1}.grid-item.selected .grid-item-header{top:-27px;border:3px solid var(--selection-color);border-bottom:none;z-index:9999;}.grid-item-content{width:100%;height:100%;margin:0;padding:0;overflow:hidden;color:#666;font-size:13px;box-sizing:border-box;}.component-wrapper{width:100%;height:100%;margin:0;padding:0;box-sizing:border-box}.component-placeholder,.component-error{display:flex;flex-direction:column;height:100%;align-items:center;justify-content:center;padding:16px;font-size:12px;text-align:center;gap:8px}.component-placeholder{color:#999;font-style:italic}.component-error{color:#dc3545;background:#fff3f3;border:1px dashed #dc3545;border-radius:4px;font-weight:500}.component-error::before{content:"‚ö†Ô∏è";font-size:24px;display:block}.grid-item-controls{position:absolute;z-index:10;top:-16px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity 0.2s}.grid-item.selected .grid-item-controls,.grid-item:hover .grid-item-controls{opacity:1}.grid-item.selected .grid-item-controls{top:-16px;right:8px;z-index:9999;}.grid-item-control-btn{width:24px;height:24px;padding:0;border:none;border-radius:4px;background:#4a90e2;color:white;cursor:pointer;font-size:12px;line-height:1;transition:background 0.2s}.grid-item-control-btn:hover{background:#357abd}.grid-item-delete{width:24px;height:24px;padding:0;border:none;border-radius:50%;background:#f44;color:white;cursor:pointer;font-size:14px;line-height:1;transition:background 0.2s}.grid-item-delete:hover{background:#c00}.drag-handle{display:none}.resize-handle{position:absolute;z-index:10;width:14px;height:14px;border:2px solid white;border-radius:50%;background:var(--selection-color);box-shadow:0 0 4px rgba(0, 0, 0, 0.4);opacity:0;transition:opacity 0.2s, transform 0.2s;touch-action:none;}.resize-handle:hover{transform:scale(1.2)}.grid-item.selected .resize-handle,.grid-item:hover .resize-handle{opacity:1}.grid-item.selected .resize-handle{z-index:9999;}.resize-handle.nw{top:-7px;left:-7px;cursor:nw-resize}.resize-handle.ne{top:-7px;right:-7px;cursor:ne-resize}.resize-handle.sw{bottom:-7px;left:-7px;cursor:sw-resize}.resize-handle.se{right:-7px;bottom:-7px;cursor:se-resize}.resize-handle.n{top:-7px;left:50%;width:30px;height:6px;border-radius:3px;cursor:n-resize;transform:translateX(-50%)}.resize-handle.s{bottom:-7px;left:50%;width:30px;height:6px;border-radius:3px;cursor:s-resize;transform:translateX(-50%)}.resize-handle.e{top:50%;right:-7px;width:6px;height:30px;border-radius:3px;cursor:e-resize;transform:translateY(-50%)}.resize-handle.w{top:50%;left:-7px;width:6px;height:30px;border-radius:3px;cursor:w-resize;transform:translateY(-50%)}.grid-item.selected .resize-handle.nw,.grid-item.selected .resize-handle.n,.grid-item.selected .resize-handle.ne{top:-8px;}.grid-item.selected .resize-handle.sw,.grid-item.selected .resize-handle.s,.grid-item.selected .resize-handle.se{bottom:-8px;}.grid-item.selected .resize-handle.nw,.grid-item.selected .resize-handle.w,.grid-item.selected .resize-handle.sw{left:-8px;}.grid-item.selected .resize-handle.ne,.grid-item.selected .resize-handle.e,.grid-item.selected .resize-handle.se{right:-8px;}.grid-item.resize-width-disabled .resize-handle.w,.grid-item.resize-width-disabled .resize-handle.e,.grid-item.resize-width-disabled .resize-handle.nw,.grid-item.resize-width-disabled .resize-handle.ne,.grid-item.resize-width-disabled .resize-handle.sw,.grid-item.resize-width-disabled .resize-handle.se{display:none}.grid-item.resize-height-disabled .resize-handle.n,.grid-item.resize-height-disabled .resize-handle.s{display:none}@keyframes component-animate-in{0%,100%{outline-color:var(--selection-color);box-shadow:0 0 0 2px rgba(74, 144, 226, 0.5)}50%{outline-color:var(--selection-color);box-shadow:0 0 0 6px rgba(74, 144, 226, 0.7)}}.component-animate-in{animation:component-animate-in 600ms ease-out;outline-color:var(--selection-color);}';const z=c("grid-item-wrapper");const y=class{constructor(i){t(this,i);this.viewerMode=false;this.isSelected=false;this.isVisible=false;this.itemSnapshot=null;this.wasDragged=false;this.isOperating=false;this.captureItemSnapshot=()=>{this.itemSnapshot=JSON.parse(JSON.stringify(this.item));const t=this.stateInstance.currentViewport||"desktop";z.log("üì∏ Snapshot captured",{itemId:this.item.id,viewport:t,desktopPosition:{x:this.itemSnapshot.layouts.desktop.x,y:this.itemSnapshot.layouts.desktop.y},mobilePosition:{x:this.itemSnapshot.layouts.mobile.x,y:this.itemSnapshot.layouts.mobile.y,customized:this.itemSnapshot.layouts.mobile.customized}})};this.handleItemUpdate=t=>{z.log("üîÑ handleItemUpdate called",{itemId:t.id,hasSnapshot:!!this.itemSnapshot,hasUndoRedoManager:!!this.undoRedoManagerInstance,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y},size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}});let i=false;let e=false;const s=this.stateInstance.currentViewport||"desktop";if(this.itemSnapshot){const o=this.itemSnapshot;const r=o.layouts[s];const a=t.layouts[s];const h=(r.x!==a.x||r.y!==a.y)&&r.width===a.width&&r.height===a.height;const d=r.width!==a.width||r.height!==a.height;const l=o.canvasId!==t.canvasId;i=h||l;e=d;if(i||e){const s=this.stateInstance.canvases;const r=s[o.canvasId];const a=(r===null||r===void 0?void 0:r.items.findIndex((t=>t.id===this.item.id)))||0;const h=o.zIndex;let d=h;if(o.canvasId!==t.canvasId){const i=s[t.canvasId];if(i){d=i.zIndexCounter++;t.zIndex=d}}if(this.undoRedoManagerInstance){const s=this.stateInstance.currentViewport;const r=o.layouts[s];const l=t.layouts[s];z.log("  ‚úÖ Pushing undo/redo command",{isDrag:i,isResize:e,viewport:s,snapshotData:{desktop:{x:o.layouts.desktop.x,y:o.layouts.desktop.y},mobile:{x:o.layouts.mobile.x,y:o.layouts.mobile.y,customized:o.layouts.mobile.customized}},currentLayoutUsed:{x:r.x,y:r.y,width:r.width,height:r.height},updatedLayoutUsed:{x:l.x,y:l.y,width:l.width,height:l.height},from:{x:r.x,y:r.y},to:{x:l.x,y:l.y}});this.undoRedoManagerInstance.push(new n(t.id,o.canvasId,t.canvasId,{x:r.x,y:r.y},{x:l.x,y:l.y},a,h,d,e?{width:r.width,height:r.height}:undefined,e?{width:l.width,height:l.height}:undefined,this.stateInstance,s,{x:o.layouts.mobile.x,y:o.layouts.mobile.y,width:o.layouts.mobile.width,height:o.layouts.mobile.height,customized:o.layouts.mobile.customized},{x:t.layouts.mobile.x,y:t.layouts.mobile.y,width:t.layouts.mobile.width,height:t.layouts.mobile.height,customized:t.layouts.mobile.customized}))}}}const o=this.stateInstance.canvases;const r=o[this.item.canvasId];const a=r.items.findIndex((t=>t.id===this.item.id));if(a!==-1){const i=r.items.map(((i,e)=>e===a?t:i));const e=Object.assign(Object.assign({},r),{items:i});const s=Object.assign(Object.assign({},o),{[this.item.canvasId]:e});this.stateInstance.canvases=s}if(this.eventManagerInstance){const n=t.layouts[s];if(i){this.eventManagerInstance.emit("componentDragged",{itemId:t.id,canvasId:t.canvasId,position:{x:n.x,y:n.y}})}if(e){this.eventManagerInstance.emit("componentResized",{itemId:t.id,canvasId:t.canvasId,size:{width:n.width,height:n.height}})}}};this.handleClick=t=>{if(this.viewerMode){z.log("  ‚è≠Ô∏è Skipping - viewer mode");return}if(this.wasDragged){z.log("  ‚è≠Ô∏è Skipping - was dragged");setTimeout((()=>{this.wasDragged=false}),10);return}const i=t.target;if(i.classList.contains("drag-handle")||i.closest(".drag-handle")||i.classList.contains("resize-handle")||i.closest(".resize-handle")||i.classList.contains("grid-item-delete")||i.classList.contains("grid-item-control-btn")){z.log("  ‚è≠Ô∏è Skipping - clicked on control element");return}z.log("  ‚úÖ Proceeding with click handling");this.stateInstance.selectedItemId=this.item.id;this.stateInstance.selectedCanvasId=this.item.canvasId;this.stateInstance.activeCanvasId=this.item.canvasId;this.eventManagerInstance.emit("canvasActivated",{canvasId:this.item.canvasId});this.eventManagerInstance.emit("componentSelected",{itemId:this.item.id,canvasId:this.item.canvasId});z.log("  üì§ Dispatching item-click event",{itemId:this.item.id,canvasId:this.item.canvasId,hasItemRef:!!this.itemRef});const e=new CustomEvent("item-click",{detail:{itemId:this.item.id,canvasId:this.item.canvasId},bubbles:true,composed:true});this.itemRef.dispatchEvent(e);z.log("  ‚úÖ item-click event dispatched")};this.handleDelete=async(t,i)=>{z.log("üóëÔ∏è handleDelete (default wrapper button)",{itemId:t,canvasId:i});const e=new CustomEvent("grid-item:delete",{detail:{itemId:t,canvasId:i},bubbles:true,composed:true});z.log("  üì§ Dispatching grid-item:delete (internal event)");this.itemRef.dispatchEvent(e)}}componentWillLoad(){var t;this.updateComponentState();if(((t=this.config)===null||t===void 0?void 0:t.enableVirtualRendering)===false){this.isVisible=true}}componentWillUpdate(){this.updateComponentState()}updateComponentState(){if(this.viewerMode){this.isSelected=false;return}const t=this.stateInstance.selectedItemId;this.isSelected=t===this.item.id;if(!this.isOperating){this.captureItemSnapshot()}}componentDidLoad(){var t;requestAnimationFrame((()=>{var t;if(((t=this.config)===null||t===void 0?void 0:t.enableVirtualRendering)!==false&&this.virtualRendererInstance){this.virtualRendererInstance.observe(this.itemRef,this.item.id,(t=>{this.isVisible=t}))}else{this.isVisible=true}}));this.injectComponentContent();if(!this.viewerMode){const i=(t=this.componentRegistry)===null||t===void 0?void 0:t.get(this.item.type);const e=this.itemRef.querySelector(".grid-item-header");this.dragHandler=new f(this.itemRef,this.item,this.stateInstance,this.handleItemUpdate,this.domCacheInstance,this.config,e,(()=>{this.wasDragged=true}),(()=>{this.isOperating=true}),(()=>{this.isOperating=false}));this.resizeHandler=new w(this.itemRef,this.item,this.stateInstance,this.handleItemUpdate,this.domCacheInstance,i,this.config,(()=>{this.isOperating=true}),(()=>{this.isOperating=false}))}}componentDidUpdate(){this.injectComponentContent()}injectComponentContent(){var t;const i=(t=this.componentRegistry)===null||t===void 0?void 0:t.get(this.item.type);if(!(i===null||i===void 0?void 0:i.renderItemWrapper)||!this.itemRef)return;const e=`${this.item.id}-content`;const s=this.itemRef.querySelector(`#${e}`);if(!s)return;if(s.hasAttribute("data-content-injected"))return;const n=this.renderComponent();s.innerHTML="";if(n instanceof HTMLElement){s.appendChild(n)}else{const t=document.createElement("div");s.appendChild(t);t.textContent="[Component Content]"}s.setAttribute("data-content-injected","true")}disconnectedCallback(){if(this.dragHandler){this.dragHandler.destroy()}if(this.resizeHandler){this.resizeHandler.destroy()}if(this.itemRef&&this.virtualRendererInstance){this.virtualRendererInstance.unobserve(this.itemRef,this.item.id)}}handleItemChange(t,i){if(t===i)return;z.log("üì¶ Item prop changed:",{itemId:t.id,oldId:i===null||i===void 0?void 0:i.id});this.updateComponentState();if(!this.viewerMode&&this.dragHandler&&this.resizeHandler){z.log("  ‚úÖ Handlers updated with new item reference")}}handleRenderVersionChange(t,i){if(t===i)return;z.log("üîÑ RenderVersion changed:",{oldVersion:i,newVersion:t,itemId:this.item.id})}handleConfigChange(t,i){var e;if(t===i)return;z.log("‚öôÔ∏è Config prop changed:",{itemId:this.item.id,oldConfig:i,newConfig:t});if(!this.viewerMode&&this.itemRef){if(this.dragHandler){this.dragHandler.destroy()}if(this.resizeHandler){this.resizeHandler.destroy()}const i=(e=this.componentRegistry)===null||e===void 0?void 0:e.get(this.item.type);const s=this.itemRef.querySelector(".grid-item-header");this.dragHandler=new f(this.itemRef,this.item,this.stateInstance,this.handleItemUpdate,this.domCacheInstance,t,s,(()=>{this.wasDragged=true}),(()=>{this.isOperating=true}),(()=>{this.isOperating=false}));this.resizeHandler=new w(this.itemRef,this.item,this.stateInstance,this.handleItemUpdate,this.domCacheInstance,i,t,(()=>{this.isOperating=true}),(()=>{this.isOperating=false}));z.log("  ‚úÖ Handlers reinitialized with new config")}}handleViewportChange(t,i){if(t===i)return;if(!this.viewerMode)return;z.log("üì± Viewport prop changed (viewer mode):",{oldViewport:i,newViewport:t,itemId:this.item.id})}handleItemDeleteEvent(t){z.log("üî¥ @Listen(item-delete) - from custom wrapper",{eventTarget:t.target,itemId:this.item.id});t.stopPropagation();const i=new CustomEvent("grid-item:delete",{detail:{itemId:this.item.id,canvasId:this.item.canvasId},bubbles:true,composed:true});z.log("  üì§ Re-dispatching as grid-item:delete");this.itemRef.dispatchEvent(i)}handleItemBringToFrontEvent(t){t.stopPropagation();if(this.viewerMode)return;const i=this.stateInstance.canvases[this.item.canvasId];if(!i)return;const e=Math.max(...i.items.map((t=>t.zIndex)));const s=i.items.map((t=>t.id===this.item.id?Object.assign(Object.assign({},t),{zIndex:e+1}):t));this.stateInstance.canvases=Object.assign(Object.assign({},this.stateInstance.canvases),{[this.item.canvasId]:Object.assign(Object.assign({},i),{items:s})})}handleItemSendToBackEvent(t){t.stopPropagation();if(this.viewerMode)return;const i=this.stateInstance.canvases[this.item.canvasId];if(!i)return;const e=Math.min(...i.items.map((t=>t.zIndex)));const s=i.items.map((t=>t.id===this.item.id?Object.assign(Object.assign({},t),{zIndex:e-1}):t));this.stateInstance.canvases=Object.assign(Object.assign({},this.stateInstance.canvases),{[this.item.canvasId]:Object.assign(Object.assign({},i),{items:s})})}renderComponent(){var t,e;if(!this.isVisible){return i("div",{class:"component-placeholder"},"Loading...")}if(!this.componentRegistry){console.error(`GridItemWrapper: componentRegistry not provided for item ${this.item.id}`);return i("div",{class:"component-error"},"Component registry not available")}const s=this.componentRegistry.get(this.item.type);if(!s){if((t=this.config)===null||t===void 0?void 0:t.hideUnknownComponents){z.log(`GridItemWrapper: Hiding unknown component type "${this.item.type}" (hideUnknownComponents=true)`);return null}if((e=this.config)===null||e===void 0?void 0:e.renderUnknownComponent){z.log(`GridItemWrapper: Rendering custom unknown component for type "${this.item.type}"`);const t=this.config.renderUnknownComponent({type:this.item.type,itemId:this.item.id});if(t instanceof HTMLElement){return i("div",{ref:i=>i&&!i.hasChildNodes()&&i.appendChild(t)})}return t}console.error(`GridItemWrapper: Unknown component type "${this.item.type}" for item ${this.item.id}`);return i("div",{class:"component-error"},"Unknown component type: ",this.item.type)}const n=s.render({itemId:this.item.id,config:this.item.config});if(n instanceof HTMLElement){return i("div",{class:"component-wrapper",ref:t=>t&&!t.hasChildNodes()&&t.appendChild(n)})}return n}render(){var t,e,s,n,o,r,a,h,d,l;const c=this.item.id;const m=this.item.canvasId;const f=this.viewerMode?this.currentViewport||"desktop":this.stateInstance.currentViewport||"desktop";const u=this.item.layouts[f];let v=u;if(f==="mobile"&&!this.item.layouts.mobile.customized){const i=this.viewerMode?this.canvasItems||[]:((t=this.stateInstance.canvases[this.item.canvasId])===null||t===void 0?void 0:t.items)||[];const s=(e=i.findIndex((t=>t.id===this.item.id)))!==null&&e!==void 0?e:0;let n=0;if(s>0){for(let t=0;t<s;t++){const e=i[t];n+=e.layouts.desktop.height||6}}v={x:0,y:n,width:50,height:this.item.layouts.desktop.height||6}}const x=this.stateInstance.selectedItemId;const w=!this.viewerMode&&x===this.item.id;const b={"grid-item":true,selected:w,"with-animations":(n=(s=this.config)===null||s===void 0?void 0:s.enableAnimations)!==null&&n!==void 0?n:true};const z=p(v.x,this.item.canvasId,this.config);const y=g(v.y,this.config);const k=p(v.width,this.item.canvasId,this.config);const I=g(v.height,this.config);const M=(o=this.componentRegistry)===null||o===void 0?void 0:o.get(this.item.type);const R=(M===null||M===void 0?void 0:M.icon)||"ÔøΩ";const C=this.item.name||(M===null||M===void 0?void 0:M.name)||this.item.type;const F=(M===null||M===void 0?void 0:M.selectionColor)||((r=this.theme)===null||r===void 0?void 0:r.selectionColor)||"#f59e0b";const E=(a=M===null||M===void 0?void 0:M.configSchema)===null||a===void 0?void 0:a.find((t=>t.name==="backgroundColor"));const j=((h=this.item.config)===null||h===void 0?void 0:h.backgroundColor)||(E===null||E===void 0?void 0:E.defaultValue)||"transparent";const S={transform:`translate(${z}px, ${y}px)`,width:`${k}px`,height:`${I}px`,zIndex:this.item.zIndex.toString(),"--selection-color":F,"--animation-duration":`${(l=(d=this.config)===null||d===void 0?void 0:d.animationDuration)!==null&&l!==void 0?l:100}ms`,background:j};const $=`${this.item.id}-content`;const O=`${this.item.id}-description`;const D=!this.viewerMode?"Use arrow keys to nudge position, drag header to move, resize handles to change size, Delete to remove. Drag components from palette to add new items.":null;if(M===null||M===void 0?void 0:M.renderItemWrapper){const t=M.renderItemWrapper({itemId:this.item.id,componentType:this.item.type,name:C,icon:R,isSelected:w,contentSlotId:$});return i("div",{class:b,id:this.item.id,tabindex:this.viewerMode?undefined:0,"aria-selected":w?"true":"false","aria-describedby":D?O:undefined,"data-canvas-id":this.item.canvasId,"data-component-name":C,"data-viewer-mode":this.viewerMode?"true":"false",style:S,onClick:t=>this.handleClick(t),ref:t=>this.itemRef=t},D&&i("div",{id:O,class:"sr-only"},D),t,i("div",{class:"resize-handle nw"}),i("div",{class:"resize-handle ne"}),i("div",{class:"resize-handle sw"}),i("div",{class:"resize-handle se"}),i("div",{class:"resize-handle n"}),i("div",{class:"resize-handle s"}),i("div",{class:"resize-handle e"}),i("div",{class:"resize-handle w"}))}return i("div",{class:b,id:this.item.id,role:"group","aria-label":`${C} component`,tabindex:this.viewerMode?undefined:0,"aria-selected":w?"true":"false","aria-describedby":D?O:undefined,"data-canvas-id":this.item.canvasId,"data-component-name":C,"data-viewer-mode":this.viewerMode?"true":"false",style:S,onClick:t=>this.handleClick(t),ref:t=>this.itemRef=t},D&&i("div",{id:O,class:"sr-only"},D),!this.viewerMode&&[i("div",{class:"drag-handle",key:"drag-handle","aria-label":`Drag ${C}`,role:"button","aria-grabbed":false}),i("div",{class:"grid-item-header",key:"header","aria-label":`${C} component header`},R," ",C),i("div",{class:"grid-item-controls",key:"controls"},i("button",{class:"grid-item-delete","aria-label":`Delete ${C} component`,onClick:()=>this.handleDelete(c,m)},"√ó"))],i("div",{class:"grid-item-content",id:$,"data-component-type":this.item.type},this.renderComponent()),!this.viewerMode&&[i("div",{class:"resize-handle nw",key:"resize-nw",role:"slider","aria-label":"Resize top-left corner",tabindex:-1}),i("div",{class:"resize-handle ne",key:"resize-ne",role:"slider","aria-label":"Resize top-right corner",tabindex:-1}),i("div",{class:"resize-handle sw",key:"resize-sw",role:"slider","aria-label":"Resize bottom-left corner",tabindex:-1}),i("div",{class:"resize-handle se",key:"resize-se",role:"slider","aria-label":"Resize bottom-right corner",tabindex:-1}),i("div",{class:"resize-handle n",key:"resize-n",role:"slider","aria-label":"Resize top edge",tabindex:-1}),i("div",{class:"resize-handle s",key:"resize-s",role:"slider","aria-label":"Resize bottom edge",tabindex:-1}),i("div",{class:"resize-handle e",key:"resize-e",role:"slider","aria-label":"Resize right edge",tabindex:-1}),i("div",{class:"resize-handle w",key:"resize-w",role:"slider","aria-label":"Resize left edge",tabindex:-1})])}static get watchers(){return{item:["handleItemChange"],renderVersion:["handleRenderVersionChange"],config:["handleConfigChange"],currentViewport:["handleViewportChange"]}}};y.style=b;export{y as grid_item_wrapper};
//# sourceMappingURL=p-2a2f910d.entry.js.map