import{f as t}from"./p-DR95X3EV.js";const i=t("undo-redo-commands");class s{constructor(t,i,s,n,e,o,h,d,c,a,r,u,l,v){this.itemId=t;this.sourceCanvasId=i;this.targetCanvasId=s;this.sourcePosition=Object.assign({},n);this.targetPosition=Object.assign({},e);this.sourceIndex=o;this.sourceZIndex=h;this.targetZIndex=d;this.sourceSize=c?Object.assign({},c):undefined;this.targetSize=a?Object.assign({},a):undefined;this.stateInstance=r;this.activeViewport=u;this.sourceMobileLayout=l?Object.assign({},l):undefined;this.targetMobileLayout=v?Object.assign({},v):undefined}undo(){i.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let t=this.stateInstance.canvases[this.targetCanvasId];let s=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!s){for(const i in this.stateInstance.canvases){const n=this.stateInstance.canvases[i];s=n.items.find((t=>t.id===this.itemId));if(s){t=n;break}}}if(!s||!t){console.warn("  âŒ Item or canvas not found, aborting undo");return}i.log("  ðŸ“ Found item, current position:",{viewport:this.activeViewport,x:s.layouts[this.activeViewport].x,y:s.layouts[this.activeViewport].y});t.items=t.items.filter((t=>t.id!==this.itemId));s.canvasId=this.sourceCanvasId;s.zIndex=this.sourceZIndex;s.layouts[this.activeViewport].x=this.sourcePosition.x;s.layouts[this.activeViewport].y=this.sourcePosition.y;i.log("  âœ… Updated item position and z-index to:",{viewport:this.activeViewport,x:s.layouts[this.activeViewport].x,y:s.layouts[this.activeViewport].y,zIndex:s.zIndex});if(this.sourceSize){s.layouts[this.activeViewport].width=this.sourceSize.width;s.layouts[this.activeViewport].height=this.sourceSize.height}if(this.activeViewport==="desktop"&&this.sourceMobileLayout){s.layouts.mobile=Object.assign({},this.sourceMobileLayout)}const n=this.stateInstance.canvases[this.sourceCanvasId];if(!n){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=n.items.length){n.items.splice(this.sourceIndex,0,s)}else{n.items.push(s)}this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);const e=document.getElementById(this.itemId);if(e){i.log("  ðŸŽ¨ Clearing inline transform style");e.style.transform=""}i.log("  âœ… Undo complete")}redo(){i.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const t=this.stateInstance.canvases[this.sourceCanvasId];const s=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!s){console.warn("  âŒ Item not found, aborting redo");return}i.log("  ðŸ“ Found item, current position:",{viewport:this.activeViewport,x:s.layouts[this.activeViewport].x,y:s.layouts[this.activeViewport].y});t.items=t.items.filter((t=>t.id!==this.itemId));s.canvasId=this.targetCanvasId;s.zIndex=this.targetZIndex;s.layouts[this.activeViewport].x=this.targetPosition.x;s.layouts[this.activeViewport].y=this.targetPosition.y;i.log("  âœ… Updated item position and z-index to:",{viewport:this.activeViewport,x:s.layouts[this.activeViewport].x,y:s.layouts[this.activeViewport].y,zIndex:s.zIndex});if(this.targetSize){s.layouts[this.activeViewport].width=this.targetSize.width;s.layouts[this.activeViewport].height=this.targetSize.height}if(this.activeViewport==="desktop"&&this.targetMobileLayout){s.layouts.mobile=Object.assign({},this.targetMobileLayout)}const n=this.stateInstance.canvases[this.targetCanvasId];if(!n){console.warn("  âŒ Target canvas not found, aborting redo");return}n.items.push(s);this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);const e=document.getElementById(this.itemId);if(e){i.log("  ðŸŽ¨ Clearing inline transform style");e.style.transform=""}i.log("  âœ… Redo complete")}getDescription(){const t=this.sourceSize&&this.targetSize&&(this.sourceSize.width!==this.targetSize.width||this.sourceSize.height!==this.targetSize.height);return{action:t?"resize":"move",source:{position:this.sourcePosition,size:this.sourceSize},target:{position:this.targetPosition,size:this.targetSize}}}}class n{constructor(t,i){this.stateInstance=i;this.itemsData=t.map((t=>{const i=Object.values(this.stateInstance.canvases).flatMap((t=>t.items)).find((i=>i.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));const i=Object.assign({},this.stateInstance.canvases);for(const s in i){const n=i[s];n.items=n.items.filter((i=>!t.includes(i.id)))}this.stateInstance.canvases=i}redo(){const t=Object.assign({},this.stateInstance.canvases);for(const i of this.itemsData){const s=t[i.canvasId];if(s){const t=s.items.some((t=>t.id===i.id));if(!t){s.items.push(i)}}}this.stateInstance.canvases=t}getDescription(){return{action:"batchAdd",itemCount:this.itemsData.length,items:this.itemsData.map((t=>({id:t.id,type:t.type,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y},size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}})))}}}class e{constructor(t,i){this.stateInstance=i;this.itemsData=t.map((t=>{const i=Object.values(this.stateInstance.canvases).flatMap((t=>t.items)).find((i=>i.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=Object.assign({},this.stateInstance.canvases);for(const i of this.itemsData){const s=t[i.canvasId];if(s){const t=s.items.some((t=>t.id===i.id));if(!t){s.items.push(i)}}}this.stateInstance.canvases=t}redo(){const t=this.itemsData.map((t=>t.id));const i=Object.assign({},this.stateInstance.canvases);for(const s in i){const n=i[s];n.items=n.items.filter((i=>!t.includes(i.id)))}this.stateInstance.canvases=i}getDescription(){return{action:"batchDelete",itemCount:this.itemsData.length,items:this.itemsData.map((t=>({id:t.id,type:t.type,position:{x:t.layouts.desktop.x,y:t.layouts.desktop.y},size:{width:t.layouts.desktop.width,height:t.layouts.desktop.height}})))}}}class o{constructor(t,i){this.stateInstance=i;this.updates=t.map((({itemId:t,canvasId:i,updates:s})=>{const n=this.stateInstance.canvases[i];const e=n===null||n===void 0?void 0:n.items.find((i=>i.id===t));if(!e){return null}return{itemId:t,canvasId:i,oldItem:JSON.parse(JSON.stringify(e)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},e),s)))}})).filter(Boolean)}undo(){const t=Object.assign({},this.stateInstance.canvases);this.updates.forEach((({itemId:i,canvasId:s,oldItem:n})=>{const e=t[s];const o=e===null||e===void 0?void 0:e.items.find((t=>t.id===i));if(o){Object.assign(o,n)}}));this.stateInstance.canvases=t}redo(){const t=Object.assign({},this.stateInstance.canvases);this.updates.forEach((({itemId:i,canvasId:s,newItem:n})=>{const e=t[s];const o=e===null||e===void 0?void 0:e.items.find((t=>t.id===i));if(o){Object.assign(o,n)}}));this.stateInstance.canvases=t}getDescription(){return{action:"batchUpdateConfig",updateCount:this.updates.length,updates:this.updates.map((({itemId:t,canvasId:i,oldItem:s,newItem:n})=>({itemId:t,canvasId:i,oldConfig:s.config,newConfig:n.config})))}}}class h{constructor(t,i,s){this.description="Add Canvas";this.canvasId=t;this.stateInstance=i;this.eventManagerInstance=s}undo(){i.log("ðŸ”™ AddCanvasCommand.undo() - removing canvas:",this.canvasId);delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);i.log("  ðŸ“¢ Emitting canvasRemoved event for:",this.canvasId);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}redo(){this.stateInstance.canvases[this.canvasId]={zIndexCounter:1,items:[]};this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}getDescription(){return{action:"addCanvas",canvasId:this.canvasId}}}class d{constructor(t,i,s){this.description="Remove Canvas";this.canvasSnapshot=null;this.canvasId=t;this.stateInstance=i;this.eventManagerInstance=s;const n=this.stateInstance.canvases[t];if(n){this.canvasSnapshot=JSON.parse(JSON.stringify(n))}}undo(){if(this.canvasSnapshot){this.stateInstance.canvases[this.canvasId]=JSON.parse(JSON.stringify(this.canvasSnapshot));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}}redo(){delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}getDescription(){var t;return{action:"removeCanvas",canvasId:this.canvasId,itemCount:((t=this.canvasSnapshot)===null||t===void 0?void 0:t.items.length)||0}}}class c{constructor(t,i,s){this.changes=t;this.eventManager=i;this.stateInstance=s;if(t.length===1){const i=t[0];this.description=`Change Z-Index (${i.oldZIndex} â†’ ${i.newZIndex})`}else{this.description=`Reorder ${t.length} Layers`}}undo(){this.changes.forEach((t=>{const s=this.stateInstance.canvases[t.canvasId];const n=s===null||s===void 0?void 0:s.items.find((i=>i.id===t.itemId));if(n){n.zIndex=t.oldZIndex;i.log(`Undo z-index change: ${t.itemId} from ${t.newZIndex} to ${t.oldZIndex}`)}}));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);if(this.changes.length===1){const t=this.changes[0];this.eventManager.emit("zIndexChanged",{itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.newZIndex,newZIndex:t.oldZIndex})}else{this.eventManager.emit("zIndexBatchChanged",{changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.newZIndex,newZIndex:t.oldZIndex})))})}}redo(){this.changes.forEach((t=>{const s=this.stateInstance.canvases[t.canvasId];const n=s===null||s===void 0?void 0:s.items.find((i=>i.id===t.itemId));if(n){n.zIndex=t.newZIndex;i.log(`Redo z-index change: ${t.itemId} from ${t.oldZIndex} to ${t.newZIndex}`)}}));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);if(this.changes.length===1){const t=this.changes[0];this.eventManager.emit("zIndexChanged",{itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})}else{this.eventManager.emit("zIndexBatchChanged",{changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})))})}}getDescription(){return{action:"changeZIndex",changeCount:this.changes.length,changes:this.changes.map((t=>({itemId:t.itemId,canvasId:t.canvasId,oldZIndex:t.oldZIndex,newZIndex:t.newZIndex})))}}}const a=50;function r(t,i=a){var s;const n=((s=t.minSize)===null||s===void 0?void 0:s.width)||0;return n<=i}function u(t,i=a){var s,n,e,o;const h=t.defaultSize.width;const d=t.defaultSize.height;const c=((s=t.minSize)===null||s===void 0?void 0:s.width)||0;const r=((n=t.maxSize)===null||n===void 0?void 0:n.width)||Infinity;let u=h;let l=d;let v=false;if(u>i){u=i;v=true}if(u<c){u=c}if(u>r){u=r}const f=((e=t.minSize)===null||e===void 0?void 0:e.height)||0;const I=((o=t.maxSize)===null||o===void 0?void 0:o.height)||Infinity;if(l<f){l=f}if(l>I){l=I}return{width:u,height:l,wasAdjusted:v}}function l(t,i,s,n,e=a){let o=t;let h=i;let d=false;if(o<0){o=0;d=true}if(o+s>e){o=e-s;d=true}if(h<0){h=0;d=true}o=Math.max(0,o);h=Math.max(0,h);return{x:o,y:h,width:s,height:n,positionAdjusted:d,sizeAdjusted:false}}function v(t,i,s,n=a){var e;if(!r(t,n)){console.warn(`Component "${t.name}" minSize (${(e=t.minSize)===null||e===void 0?void 0:e.width}) `+`exceeds canvas width (${n}). Placement rejected.`);return null}const o=u(t,n);const h=l(i,s,o.width,o.height,n);return Object.assign(Object.assign({},h),{sizeAdjusted:o.wasAdjusted})}export{h as A,o as B,a as C,s as M,d as R,v as a,c as b,l as c,e as d,n as e};
//# sourceMappingURL=p-CcnOUdBE.js.map