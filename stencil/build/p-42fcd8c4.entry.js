import{r as t,h as i}from"./p-4Z_c7dK2.js";import{i as s}from"./p-BKH_Whl_.js";import{s as e,b as a,g as n,a as o}from"./p-BKzIrvZ3.js";import{c as r}from"./p-BN6JK3j5.js";import"./p-DhZJyO2V.js";const h=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}@keyframes canvas-highlight-pulse{0%,100%{box-shadow:0 0 0 0 var(--primary-color, #f59e0b);opacity:1}50%{box-shadow:0 0 0 4px var(--primary-color, #f59e0b);opacity:0.7}}.canvas-highlight{animation:canvas-highlight-pulse 600ms ease-out}@keyframes position-indicator-fade{0%{opacity:0.8}70%{opacity:0.8}100%{opacity:0}}.position-indicator{position:absolute;border:2px dashed var(--primary-color, #007bff);opacity:0.8;pointer-events:none;z-index:9999;animation:position-indicator-fade 800ms ease-out forwards}";const c=class{constructor(i){t(this,i);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.isDropTarget=false;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){this.stateInstance.activeCanvasId=this.canvasId;const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const i=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(i)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((t=>{requestAnimationFrame((()=>{for(const i of t){const t=i.contentRect.width;if(t>100){e(this.canvasId,t,this.config);this.renderVersion++}}}))}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=s(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{this.isDropTarget=true},dragleave:t=>{this.isDropTarget=false},drop:t=>{this.isDropTarget=false;let i=t.relatedTarget;const s=i.closest(".palette-item");if(s){i=s}const e=i.classList.contains("palette-item");if(e){i._dropWasValid=true}const o=i.classList.contains("grid-item-header");const r=i.classList.contains("grid-item");const h=o?i.closest(".grid-item"):i;if(e){const s=i.getAttribute("data-component-type");const e=i._defaultWidth||10;const o=i._defaultHeight||6;const r=a(e,this.canvasId,this.config);const h=n(o,this.config);const c=r/2;const d=h/2;const l=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-l.left-c;const v=t.dragEvent.clientY-l.top-d;const g=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:s,x:p,y:v},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(g)}else if(r||o){const t=h.id;const i=h.getAttribute("data-canvas-id");if(i!==this.canvasId){const s=h.getBoundingClientRect();const e=this.gridContainerRef.getBoundingClientRect();const a=s.left-e.left;const n=s.top-e.top;const o=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:i,targetCanvasId:this.canvasId,x:a,y:n},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(o)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=this.stateInstance.canvases[this.canvasId];this.calculatedHeight=r(this.canvasId,this.config,this.stateInstance);this.onStateChange("canvases",(()=>{try{if(this.canvasId&&this.stateInstance.canvases[this.canvasId]){this.canvas=this.stateInstance.canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=r(this.canvasId,this.config,this.stateInstance)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));this.onStateChange("currentViewport",(()=>{this.calculatedHeight=r(this.canvasId,this.config,this.stateInstance)}));this.onStateChange("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=this.stateInstance.canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,i){if(t===i)return;this.canvas=this.stateInstance.canvases[t];this.calculatedHeight=r(t,this.config,this.stateInstance);if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,i){if(t===i)return;this.calculatedHeight=r(this.canvasId,t,this.stateInstance);this.renderVersion++}handleIsActiveChange(t,i){if(t===i)return}render(){var t,s,e,a,r,h;const c=this.stateInstance.showGrid;const d=o(this.config);const l=(s=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&s!==void 0?s:20;const p=n(l,this.config);return i("div",{key:"efa6e6d6c8ef5a89d6f7a599a6db066e075e17f3",class:"canvas-section","data-canvas-id":this.canvasId},i("div",{key:"f7261de1b947b0b9156c7004d419d2b94ddcfbb6",class:{"grid-container":true,"hide-grid":!c,active:this.isActive,"drop-target":this.isDropTarget},id:this.canvasId,role:"region","aria-label":this.canvasTitle||`Canvas ${this.canvasId}`,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${d}px`,backgroundImage:c?`linear-gradient(${((e=this.theme)===null||e===void 0?void 0:e.gridLineColor)||"rgba(0, 0, 0, 0.05)"} 1px, transparent 1px), linear-gradient(90deg, ${((a=this.theme)===null||a===void 0?void 0:a.gridLineColor)||"rgba(0, 0, 0, 0.05)"} 1px, transparent 1px)`:"none",minHeight:`${p}px`,["--primary-color"]:((r=this.theme)===null||r===void 0?void 0:r.primaryColor)||"#007bff"},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(h=this.canvas)===null||h===void 0?void 0:h.items.map((t=>i("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete,virtualRendererInstance:this.virtualRendererInstance,eventManagerInstance:this.eventManagerInstance,undoRedoManagerInstance:this.undoRedoManagerInstance,stateInstance:this.stateInstance,domCacheInstance:this.domCacheInstance,theme:this.theme})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};c.style=h;export{c as canvas_section};
//# sourceMappingURL=p-42fcd8c4.entry.js.map