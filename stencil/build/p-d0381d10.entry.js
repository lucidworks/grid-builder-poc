import{r as t,c as e,h as i,g as n,H as o}from"./p-CR9rAByj.js";import{i as s}from"./p-BKH_Whl_.js";import{e as a,a as r,f as c,n as d,S as l,k as h,U as p,l as u,c as f,p as v,j as m,u as b,m as g,D as x,o as y}from"./p-BiM0xz1T.js";import{b as w}from"./p-DOH5unU-.js";import{c as I,h as k,i as C,M as A,j,R as O,A as z,B as $,k as S,l as _,m as D,a as B,C as R}from"./p-xVfEtzcZ.js";const E=".canvas-header{position:absolute;top:0;right:0;z-index:10;display:flex;align-items:center;justify-content:flex-end;padding:12px;margin:0;gap:8px}.canvas-wrapper:not(:first-child) .canvas-header{margin-top:-38px}.canvas-header .canvas-title{display:inline-flex;align-items:center;padding:6px 12px;border-radius:4px;margin:0;background:#4a90e2;box-shadow:0 1px 3px rgba(74, 144, 226, 0.2);color:white;cursor:pointer;font-size:13px;font-weight:500;text-transform:none;opacity:0.6;transition:all 0.15s}.canvas-header .canvas-title:hover{background:#357abd;box-shadow:0 2px 6px rgba(74, 144, 226, 0.3)}.canvas-header.is-active .canvas-title{opacity:1}.canvas-header .canvas-actions{display:flex;align-items:center;gap:6px}.canvas-header .canvas-actions .delete-canvas-btn{display:flex;width:28px;height:28px;align-items:center;justify-content:center;padding:0;border:1px solid #dee2e6;border-radius:4px;background:white;color:#dc3545;cursor:pointer;font-size:20px;font-weight:300;line-height:1;transition:all 0.15s}.canvas-header .canvas-actions .delete-canvas-btn:hover{border-color:#dc3545;background:rgba(220, 53, 69, 0.1);transform:scale(1.1)}.canvas-header .canvas-actions .delete-canvas-btn:active{transform:scale(1)}";const M=class{constructor(i){t(this,i);this.headerClick=e(this,"headerClick",7);this.deleteClick=e(this,"deleteClick",7);this.isDeletable=true;this.isActive=false;this.handleTitleClick=()=>{this.headerClick.emit({canvasId:this.canvasId})};this.handleDeleteClick=()=>{this.deleteClick.emit({canvasId:this.canvasId})}}render(){const t=`canvas-header ${this.isActive?"is-active":""}`;return i("div",{key:"e19aad576d3ce150c2620b0d48920a47f05f5669",class:t,"data-canvas-id":this.canvasId},i("div",{key:"f7eef579a0015eabcc35916c92b9be2effc6556b",class:"canvas-actions"},i("span",{key:"1a21187ca3eb70e218bd08cf24db5baf8905ce57",class:"canvas-title",onClick:this.handleTitleClick},this.sectionTitle),this.isDeletable&&i("button",{key:"aa63c3cce177351ba748870c0281be2dc7a85e4e",class:"delete-canvas-btn",title:"Delete this section",onClick:this.handleDeleteClick},"Ã—")))}};M.style=E;const G=".palette{width:250px;padding:20px;border-right:1px solid #ddd;background:white;overflow-y:visible;}.palette h2{margin-bottom:20px;color:#333;font-size:18px}.palette-chromeless{padding-top:10px}.palette-empty{color:#999;font-size:13px;font-style:italic}.palette-item{margin-bottom:10px;cursor:move;user-select:none;touch-action:none;}.palette-item:not(:has(>div)){padding:15px;border-radius:4px;background:#4a90e2;color:white;font-weight:500;text-align:center;transition:transform 0.2s, box-shadow 0.2s}.palette-item:hover{box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);transform:translateY(-2px)}.palette-item.dragging-from-palette{opacity:0.5}.dragging-clone{position:fixed;z-index:10000;pointer-events:none}";const T=class{constructor(e){t(this,e);this.showHeader=true;this.paletteLabel="Component palette";this.draggingItemType=null;this.cachedComponents=[];this.paletteId=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;this.initializePaletteItems=()=>{const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){return}s(t).draggable({inertia:false,autoScroll:false,listeners:{start:t=>{var e;const i=t.target.closest(".palette-item");if(!i){console.warn("Could not find .palette-item element");return}const n=i.getAttribute("data-component-type");this.draggingItemType=n;const o=i.getBoundingClientRect();i._originalPosition={left:o.left,top:o.top};i._dropWasValid=false;const s=this.cachedComponents.find((t=>t.type===n));if(!s){console.warn(`Component definition not found for type: ${n}`);return}const c=s.defaultSize||{width:10,height:6};const d=this.targetGridBuilderId||"gridBuilderAPI";const l=window[d];const h=(e=l===null||l===void 0?void 0:l.getState)===null||e===void 0?void 0:e.call(l);const p=(h===null||h===void 0?void 0:h.canvases)?Object.keys(h.canvases):[];const u=p.length>0?p[0]:null;let f;let v;if(u){f=a(c.width,u,this.config);v=r(c.height,this.config)}else{const t=20;f=c.width*t;v=c.height*t}const m=f/2;const b=v/2;const g=document.createElement("div");g.className="dragging-clone";g.style.position="fixed";g.style.left=t.clientX-m+"px";g.style.top=t.clientY-b+"px";g.style.width=f+"px";g.style.height=v+"px";g.style.overflow="hidden";g.style.pointerEvents="none";g.style.zIndex="10000";g.style.border="2px solid rgba(74, 144, 226, 0.5)";g.style.borderRadius="4px";g.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)";g.style.cursor="grabbing";const x=s.renderDragClone();if(x instanceof HTMLElement){g.appendChild(x)}else{const t=x;const e=t.t;const i=document.createElement(e);if(t.i){Object.keys(t.i).forEach((e=>{i.setAttribute(e,t.i[e])}))}g.appendChild(i)}document.body.appendChild(g);i._dragClone=g;i._halfWidth=m;i._halfHeight=b;i._defaultWidth=c.width;i._defaultHeight=c.height},move:t=>{const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const n=e._halfWidth;const o=e._halfHeight;if(i){i.style.left=t.clientX-n+"px";i.style.top=t.clientY-o+"px"}},end:t=>{this.draggingItemType=null;const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const n=e._dropWasValid;const o=e._originalPosition;if(i){if(!n&&o){i.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";i.style.left=o.left+"px";i.style.top=o.top+"px";i.style.opacity="0";setTimeout((()=>{i.remove()}),300)}else{i.remove()}delete e._dragClone;delete e._halfWidth;delete e._halfHeight;delete e._dropWasValid;delete e._originalPosition}}}});t._dragInitialized=true}))};this.handlePaletteItemClick=t=>{var e,i;const n=(i=(e=this.config)===null||e===void 0?void 0:e.enableClickToAdd)!==null&&i!==void 0?i:true;if(!n){return}if(this.draggingItemType){return}const o=t.target.closest(".palette-item");if(!o){return}const s=o.getAttribute("data-component-type");if(!s){console.warn("handlePaletteItemClick: Component type not found");return}const a=new CustomEvent("palette-item-click",{detail:{componentType:s,targetGridBuilderId:this.targetGridBuilderId},bubbles:true,composed:true});this.hostElement.dispatchEvent(a)};this.handlePaletteItemKeyDown=t=>{var e,i;const n=(i=(e=this.config)===null||e===void 0?void 0:e.enableClickToAdd)!==null&&i!==void 0?i:true;if(!n){return}if(t.key==="Enter"||t.key===" "){t.preventDefault();this.handlePaletteItemClick(t)}}}handleComponentsChange(t,e){if(t===e)return;if(!e&&!t)return;if(!this.componentRegistry&&t){this.cachedComponents=t}else if(!this.componentRegistry&&!t){this.cachedComponents=[]}requestAnimationFrame((()=>{this.initializePaletteItems()}))}handleConfigChange(t,e){if(t===e)return}handleComponentRegistryChange(t,e){if(t===e)return;if(!e&&!t)return;if(this.unsubscribeFromRegistry){this.unsubscribeFromRegistry();this.unsubscribeFromRegistry=undefined}if(t){this.cachedComponents=t.getAll();this.unsubscribeFromRegistry=t.onChange((()=>{this.cachedComponents=t.getAll();requestAnimationFrame((()=>{this.initializePaletteItems()}))}));requestAnimationFrame((()=>{this.initializePaletteItems()}))}else{this.cachedComponents=[]}}componentWillLoad(){if(this.componentRegistry){this.cachedComponents=this.componentRegistry.getAll();this.unsubscribeFromRegistry=this.componentRegistry.onChange((()=>{this.cachedComponents=this.componentRegistry.getAll();requestAnimationFrame((()=>{this.initializePaletteItems()}))}))}else if(this.components){this.cachedComponents=this.components}else{this.cachedComponents=[]}}componentDidLoad(){this.initializePaletteItems()}componentDidUpdate(){this.initializePaletteItems()}render(){var t;const e={palette:true,"palette-chromeless":!this.showHeader};const n=`palette-help-${this.paletteId}`;if(!this.cachedComponents||this.cachedComponents.length===0){return i("div",{class:e},this.showHeader&&i("h2",null,"Components"),i("p",{class:"palette-empty",role:"status","aria-live":"polite"},"No components available"))}return i("div",{class:e,role:"toolbar","aria-label":this.paletteLabel,"aria-orientation":"vertical"},i("div",{id:n,class:"sr-only"},((t=this.config)===null||t===void 0?void 0:t.enableClickToAdd)!==false?"Click or press Enter/Space to add component to active canvas, or drag to position on any canvas":"Drag component to canvas to add"),this.showHeader&&i("h2",{id:"palette-heading"},"Components"),this.cachedComponents.map((t=>{var e;const o={"palette-item":true,"palette-item-custom":!!t.renderPaletteItem,"dragging-from-palette":this.draggingItemType===t.type};const s=((e=this.config)===null||e===void 0?void 0:e.enableClickToAdd)!==false?`${t.name} component. Click to add to active canvas or drag to position`:`${t.name} component. Drag to canvas`;return i("div",{class:o,"data-component-type":t.type,key:t.type,role:"button",tabindex:0,"aria-label":s,"aria-describedby":n,"aria-pressed":this.draggingItemType===t.type?"true":"false",onClick:t=>this.handlePaletteItemClick(t),onKeyDown:t=>this.handlePaletteItemKeyDown(t)},t.renderPaletteItem?(()=>{const e=t.renderPaletteItem({componentType:t.type,name:t.name,icon:t.icon});if(e instanceof HTMLElement){return i("div",{ref:t=>t&&!t.hasChildNodes()&&t.appendChild(e)})}return e})():`${t.icon} ${t.name}`)})))}disconnectedCallback(){if(this.unsubscribeFromRegistry){this.unsubscribeFromRegistry();this.unsubscribeFromRegistry=undefined}const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){s(t).unset();delete t._dragInitialized}}))}get hostElement(){return n(this)}static get watchers(){return{components:["handleComponentsChange"],config:["handleConfigChange"],componentRegistry:["handleComponentRegistryChange"]}}};T.style=G;const P="confirmation-modal .confirmation-overlay{position:fixed;z-index:10000;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.2s ease-out;background:rgba(0, 0, 0, 0.5)}confirmation-modal .confirmation-modal{width:90%;max-width:400px;border-radius:8px;animation:slideUp 0.2s ease-out;background:white;box-shadow:0 4px 20px rgba(0, 0, 0, 0.15)}confirmation-modal .modal-header{padding:20px 24px;border-bottom:1px solid #e9ecef}confirmation-modal .modal-header .modal-title{margin:0;color:#212529;font-size:18px;font-weight:600}confirmation-modal .modal-body{padding:24px}confirmation-modal .modal-body .modal-message{margin:0;color:#495057;font-size:14px;line-height:1.5}confirmation-modal .modal-footer{display:flex;justify-content:flex-end;padding:16px 24px;border-top:1px solid #e9ecef;gap:12px}confirmation-modal .modal-footer button{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.15s}confirmation-modal .modal-footer button.cancel-btn{background:#f8f9fa;color:#495057}confirmation-modal .modal-footer button.cancel-btn:hover{background:#e9ecef}confirmation-modal .modal-footer button.confirm-btn{background:#dc3545;color:white}confirmation-modal .modal-footer button.confirm-btn:hover{background:#c82333}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}";const F=class{constructor(i){t(this,i);this.confirm=e(this,"confirm",7);this.cancel=e(this,"cancel",7);this.isOpen=false;this.data=null;this.handleConfirm=()=>{this.confirm.emit()};this.handleCancel=()=>{this.cancel.emit()}}render(){if(!this.isOpen||!this.data){return null}return i("div",{class:"confirmation-overlay",onClick:this.handleCancel},i("div",{class:"confirmation-modal",onClick:t=>t.stopPropagation()},i("div",{class:"modal-header"},i("h2",{class:"modal-title"},this.data.title)),i("div",{class:"modal-body"},i("p",{class:"modal-message"},this.data.message)),i("div",{class:"modal-footer"},i("button",{class:"cancel-btn",onClick:this.handleCancel},"Cancel"),i("button",{class:"confirm-btn",onClick:this.handleConfirm},"Delete"))))}};F.style=P;const L='.custom-config-panel{position:fixed;right:0;bottom:0;width:400px;max-width:90vw;max-height:80vh;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:12px 0 0 0;box-shadow:0 -4px 20px rgba(0, 0, 0, 0.15);display:flex;flex-direction:column;z-index:1000;transform:translateY(100%);transition:transform 0.3s ease-in-out;overflow:hidden}.custom-config-panel.panel-open{transform:translateY(0)}.custom-panel-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;background:rgba(255, 255, 255, 0.1);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255, 255, 255, 0.2)}.custom-panel-header .header-content{display:flex;align-items:center;gap:12px;color:#ffffff}.custom-panel-header .header-content .component-icon{font-size:24px;line-height:1}.custom-panel-header .header-content h2{margin:0;font-size:20px;font-weight:600;color:#ffffff}.custom-panel-header .close-btn{background:rgba(255, 255, 255, 0.2);border:none;color:#ffffff;width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all 0.2s ease}.custom-panel-header .close-btn:hover{background:rgba(255, 255, 255, 0.3);transform:scale(1.1)}.custom-panel-header .close-btn:active{transform:scale(0.95)}.custom-panel-body{flex:1;overflow-y:auto;padding:24px;background:#ffffff}.custom-panel-body .config-section{margin-bottom:24px}.custom-panel-body .config-section:last-child{margin-bottom:0}.custom-panel-body .config-section .section-label{display:block;font-size:14px;font-weight:600;color:#374151;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}.custom-panel-body .config-section.info-section{background:#f9fafb;border-radius:8px;padding:16px}.custom-panel-body .config-section.info-section .info-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #e5e7eb}.custom-panel-body .config-section.info-section .info-row:last-child{border-bottom:none;padding-bottom:0}.custom-panel-body .config-section.info-section .info-row:first-child{padding-top:0}.custom-panel-body .config-section.info-section .info-row .info-label{font-size:13px;font-weight:500;color:#6b7280}.custom-panel-body .config-section.info-section .info-row .info-value{font-size:13px;color:#1f2937;font-family:"Monaco", "Menlo", monospace;background:#ffffff;padding:4px 8px;border-radius:4px}.custom-panel-body .config-field{margin-bottom:16px}.custom-panel-body .config-field:last-child{margin-bottom:0}.custom-panel-body .config-field .field-label{display:block;font-size:13px;font-weight:500;color:#4b5563;margin-bottom:6px}.custom-panel-body .text-input{width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:6px;font-size:14px;color:#1f2937;transition:all 0.2s ease}.custom-panel-body .text-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}.custom-panel-body .text-input:disabled{background:#f9fafb;color:#9ca3af;cursor:not-allowed}.custom-panel-body .text-input::placeholder{color:#9ca3af}.custom-panel-body .textarea-input{width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:6px;font-size:14px;color:#1f2937;font-family:inherit;line-height:1.5;min-height:80px;resize:vertical;transition:all 0.2s ease}.custom-panel-body .textarea-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}.custom-panel-body .textarea-input:disabled{background:#f9fafb;color:#9ca3af;cursor:not-allowed}.custom-panel-body .textarea-input::placeholder{color:#9ca3af}.custom-panel-body .select-input{width:100%;padding:10px 12px;border:2px solid #e5e7eb;border-radius:6px;font-size:14px;color:#1f2937;background:#ffffff;cursor:pointer;transition:all 0.2s ease}.custom-panel-body .select-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}.custom-panel-body .checkbox-label{display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none}.custom-panel-body .checkbox-label input[type=checkbox]{width:18px;height:18px;cursor:pointer;accent-color:#667eea}.custom-panel-body .checkbox-label .checkbox-text{font-size:14px;color:#4b5563}.custom-panel-body .color-input-wrapper{display:flex;align-items:center;gap:12px}.custom-panel-body .color-input-wrapper .color-input{width:60px;height:40px;border:2px solid #e5e7eb;border-radius:6px;cursor:pointer;transition:all 0.2s ease}.custom-panel-body .color-input-wrapper .color-input:hover{border-color:#667eea}.custom-panel-body .color-input-wrapper .color-value{font-size:13px;font-family:"Monaco", "Menlo", monospace;color:#6b7280;background:#f9fafb;padding:8px 12px;border-radius:4px}.custom-panel-body .no-config-message{text-align:center;color:#9ca3af;font-size:14px;padding:24px;margin:0}.custom-panel-body .field-error{color:#ef4444;font-size:13px;margin:0;padding:8px;background:#fef2f2;border-radius:4px}.custom-panel-footer{display:flex;gap:12px;padding:20px 24px;background:#f9fafb;border-top:1px solid #e5e7eb}.custom-panel-footer .btn{flex:1;padding:12px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s ease;text-transform:uppercase;letter-spacing:0.5px}.custom-panel-footer .btn:active{transform:translateY(1px)}.custom-panel-footer .btn.btn-secondary{background:#ffffff;color:#6b7280;border:2px solid #e5e7eb}.custom-panel-footer .btn.btn-secondary:hover{background:#f9fafb;border-color:#d1d5db}.custom-panel-footer .btn.btn-primary{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:#ffffff;box-shadow:0 4px 6px rgba(102, 126, 234, 0.3)}.custom-panel-footer .btn.btn-primary:hover{box-shadow:0 6px 12px rgba(102, 126, 234, 0.4);transform:translateY(-2px)}.custom-panel-footer .btn.btn-primary:active{transform:translateY(0);box-shadow:0 2px 4px rgba(102, 126, 234, 0.3)}@media (max-width: 768px){.custom-config-panel{width:100%;max-width:100vw;max-height:70vh;border-radius:12px 12px 0 0}}';const U=class{constructor(e){t(this,e);this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentConfig={};this.componentName="";this.originalState=null;this.componentRegistry=new Map;this.eventsSubscribed=false;this.handleItemRemoved=t=>{console.log("ðŸŽ¨ custom-config-panel received itemRemoved event",{eventItemId:t.itemId,selectedItemId:this.selectedItemId,isOpen:this.isOpen});if(this.isOpen&&this.selectedItemId&&t.itemId===this.selectedItemId){console.log("  âœ… Custom panel: Closing because selected item was deleted");this.closePanel()}};this.handleItemClick=t=>{console.log("ðŸŽ¨ custom-config-panel handleItemClick called",t.detail);this.ensureEventSubscription();const{itemId:e,canvasId:i}=t.detail;this.selectedItemId=e;this.selectedCanvasId=i;const n=this.getAPI();console.log("  ðŸ”§ API exists:",!!n);const o=n===null||n===void 0?void 0:n.getItem(e);console.log("  ðŸ”§ Item retrieved:",!!o,o);if(!o){console.log("  âŒ No item found - exiting");return}const s=this.componentRegistry.get(o.type);console.log("  ðŸ”§ Definition found:",!!s,s===null||s===void 0?void 0:s.name);this.originalState={name:o.name||(s===null||s===void 0?void 0:s.name)||o.type,zIndex:o.zIndex,config:o.config?Object.assign({},o.config):{}};this.componentName=this.originalState.name;this.componentConfig=Object.assign({},this.originalState.config);console.log("  ðŸšª Opening panel - setting isOpen = true");this.isOpen=true;console.log("  âœ… Panel should now be open, isOpen =",this.isOpen)};this.closePanel=()=>{const t=this.getAPI();if(this.selectedItemId&&this.selectedCanvasId&&this.originalState&&t){t.updateConfig(this.selectedItemId,this.originalState.config);const e=t.getState();for(const t in e.canvases){const i=e.canvases[t];const n=i.items.findIndex((t=>t.id===this.selectedItemId));if(n!==-1){i.items[n]=Object.assign(Object.assign({},i.items[n]),{name:this.originalState.name});e.canvases=Object.assign({},e.canvases);break}}}this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentName="";this.componentConfig={};this.originalState=null};this.saveConfig=()=>{this.isOpen=false;this.selectedItemId=null;this.selectedCanvasId=null;this.componentName="";this.componentConfig={};this.originalState=null};this.handleNameChange=t=>{const e=t.target.value;this.componentName=e;const i=this.getAPI();if(this.selectedItemId&&i){const t=i.getState();for(const i in t.canvases){const n=t.canvases[i];const o=n.items.findIndex((t=>t.id===this.selectedItemId));if(o!==-1){n.items[o]=Object.assign(Object.assign({},n.items[o]),{name:e});t.canvases=Object.assign({},t.canvases);break}}}};this.handleConfigChange=(t,e)=>{this.componentConfig=Object.assign(Object.assign({},this.componentConfig),{[t]:e});const i=this.getAPI();if(this.selectedItemId&&i){i.updateConfig(this.selectedItemId,this.componentConfig)}}}getAPI(){return this.api||window.gridBuilderAPI||null}ensureEventSubscription(){if(this.eventsSubscribed){return}const t=this.getAPI();if(!t){return}t.on("itemRemoved",this.handleItemRemoved);this.eventsSubscribed=true;console.log("  âœ… Custom panel: Subscribed to itemRemoved event")}handleApiChange(t,e){console.log("ðŸŽ¨ custom-config-panel API prop changed",{hadOldApi:!!e,hasNewApi:!!t,newApiType:typeof t});if(t&&!this.eventsSubscribed){this.ensureEventSubscription()}}componentDidLoad(){console.log("ðŸŽ¨ custom-config-panel componentDidLoad - setting up component registry");const t=this.getAPI();console.log("  ðŸ”§ API status:",{apiExists:!!t,apiType:typeof t,fromProp:!!this.api,fromWindow:!!window.gridBuilderAPI});this.componentRegistry=new Map(w.map((t=>[t.type,t])));this.ensureEventSubscription();document.addEventListener("item-click",this.handleItemClick);console.log("  âœ… Custom panel: Listening for item-click events")}disconnectedCallback(){console.log("ðŸŽ¨ custom-config-panel disconnectedCallback - cleaning up");const t=this.getAPI();if(t&&this.eventsSubscribed){t.off("itemRemoved",this.handleItemRemoved);this.eventsSubscribed=false}document.removeEventListener("item-click",this.handleItemClick)}render(){if(!this.isOpen){return null}const t=this.getAPI();const e=t===null||t===void 0?void 0:t.getItem(this.selectedItemId);if(!e){return null}const n=this.componentRegistry.get(e.type);if(!n){return null}const o={"custom-config-panel":true,"panel-open":this.isOpen};return i("div",{class:o},i("div",{class:"custom-panel-header"},i("div",{class:"header-content"},i("span",{class:"component-icon"},n.icon),i("h2",null,"Edit Component")),i("button",{class:"close-btn",onClick:()=>this.closePanel(),title:"Close"},"âœ•")),i("div",{class:"custom-panel-body"},i("div",{class:"config-section"},i("label",{class:"section-label"},"Component Name"),i("input",{type:"text",class:"text-input",value:this.componentName,placeholder:"Enter component name",onInput:t=>this.handleNameChange(t)})),i("div",{class:"config-section info-section"},i("div",{class:"info-row"},i("span",{class:"info-label"},"Type:"),i("span",{class:"info-value"},n.name)),i("div",{class:"info-row"},i("span",{class:"info-label"},"ID:"),i("span",{class:"info-value"},e.id))),n.configSchema&&n.configSchema.length>0?i("div",{class:"config-section"},i("label",{class:"section-label"},"Configuration"),n.configSchema.map((t=>i("div",{class:"config-field",key:t.name},i("label",{class:"field-label"},t.label),this.renderConfigField(t))))):i("div",{class:"config-section"},i("p",{class:"no-config-message"},"No configuration options available for this component."))),i("div",{class:"custom-panel-footer"},i("button",{class:"btn btn-secondary",onClick:()=>this.closePanel()},"Cancel"),i("button",{class:"btn btn-primary",onClick:()=>this.saveConfig()},"Save Changes")))}renderConfigField(t){var e,n,o;const s=(n=(e=this.componentConfig[t.name])!==null&&e!==void 0?e:t.defaultValue)!==null&&n!==void 0?n:"";switch(t.type){case"text":return i("input",{type:"text",class:"text-input",value:s,onInput:e=>this.handleConfigChange(t.name,e.target.value),placeholder:t.placeholder});case"textarea":return i("textarea",{class:"textarea-input",value:s,onInput:e=>this.handleConfigChange(t.name,e.target.value),placeholder:t.placeholder,rows:t.rows||3});case"number":return i("input",{type:"number",class:"text-input",value:s,onInput:e=>this.handleConfigChange(t.name,Number(e.target.value)),min:t.min,max:t.max,step:t.step});case"select":return i("select",{class:"select-input",onChange:e=>this.handleConfigChange(t.name,e.target.value)},(o=t.options)===null||o===void 0?void 0:o.map((t=>{const e=typeof t==="string"?t:t.value;const n=typeof t==="string"?t:t.label;return i("option",{key:e,value:e,selected:s===e},n)})));case"checkbox":return i("label",{class:"checkbox-label"},i("input",{type:"checkbox",checked:!!s,onChange:e=>this.handleConfigChange(t.name,e.target.checked)}),i("span",{class:"checkbox-text"},t.label));case"color":return i("div",{class:"color-input-wrapper"},i("input",{type:"color",class:"color-input",value:s,onInput:e=>this.handleConfigChange(t.name,e.target.value)}),i("span",{class:"color-value"},s));default:return i("p",{class:"field-error"},"Unknown field type: ",t.type)}}static get watchers(){return{api:["handleApiChange"]}}};U.style=L;class N{constructor(){this.observer=null;this.observedElements=new Map;this.initialize()}initialize(){this.observer=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.target.id;const i=this.observedElements.get(e);if(i){i(t.isIntersecting)}}))}),{rootMargin:"200px",threshold:[0,.01]})}observe(t,e,i){if(!this.observer||!t){return}this.observedElements.set(e,i);this.observer.observe(t);const n=t.getBoundingClientRect();const o=window.innerHeight||document.documentElement.clientHeight;const s=window.innerWidth||document.documentElement.clientWidth;const a=n.top<o+200&&n.bottom>-200&&n.left<s+200&&n.right>-200;if(a){i(true)}}unobserve(t,e){if(!this.observer||!t){return}this.observedElements.delete(e);this.observer.unobserve(t)}destroy(){if(this.observer){this.observer.disconnect();this.observer=null}this.observedElements.clear()}}class V{constructor(){this.listeners=new Map;this.debounceTimers=new Map;this.debounceDelay=300;this.debouncedEvents=new Set(["componentDragged","componentResized","stateChanged"])}on(t,e){if(!this.listeners.has(t)){this.listeners.set(t,new Set)}this.listeners.get(t).add(e)}off(t,e){const i=this.listeners.get(t);if(i){i.delete(e);if(i.size===0){this.listeners.delete(t)}}}emit(t,e){if(this.debouncedEvents.has(t)){this.emitDebounced(t,e)}else{this.emitImmediate(t,e)}}emitImmediate(t,e){const i=this.listeners.get(t);if(i){i.forEach((i=>{try{i(e)}catch(e){console.error(`Error in event callback for "${t}":`,e)}}))}}emitDebounced(t,e){const i=this.debounceTimers.get(t);if(i){clearTimeout(i)}const n=setTimeout((()=>{this.emitImmediate(t,e);this.debounceTimers.delete(t)}),this.debounceDelay);this.debounceTimers.set(t,n)}setDebounceDelay(t){this.debounceDelay=t}getDebounceDelay(){return this.debounceDelay}removeAllListeners(t){if(t){this.listeners.delete(t)}else{this.listeners.clear()}}listenerCount(t){var e;return((e=this.listeners.get(t))===null||e===void 0?void 0:e.size)||0}}class K{constructor(t){this.changeListeners=new Set;this.definitions=new Map;if(t){t.forEach((t=>this.register(t)))}}register(t){if(!t.type||typeof t.type!=="string"){throw new Error("Component definition must have a valid type string")}this.definitions.set(t.type,t);this.notifyListeners()}registerAll(t){t.forEach((t=>{if(!t.type||typeof t.type!=="string"){throw new Error("Component definition must have a valid type string")}this.definitions.set(t.type,t)}));this.notifyListeners()}get(t){return this.definitions.get(t)}has(t){return this.definitions.has(t)}getTypes(){return Array.from(this.definitions.keys())}getAll(){return Array.from(this.definitions.values())}unregister(t){const e=this.definitions.delete(t);if(e){this.notifyListeners()}return e}clear(){const t=this.definitions.size>0;this.definitions.clear();if(t){this.notifyListeners()}}size(){return this.definitions.size}onChange(t){this.changeListeners.add(t);return()=>{this.changeListeners.delete(t)}}notifyListeners(){this.changeListeners.forEach((t=>t()))}}function Z(t,e){return Object.assign({errorBoundary:t},e)}function Y(t,e){if(t==="grid-builder"){return"critical"}if(t==="canvas-section"){if(e.message.includes("invalid")||e.message.includes("not found")){return"error"}return"critical"}if(t==="grid-item-wrapper"){return"error"}return"error"}function q(t,e){if(t==="grid-item-wrapper"){return true}if(t==="canvas-section"){if(e.message.includes("fatal")||e.message.includes("critical")){return false}return true}if(t==="grid-builder"){if(e.message.includes("validation")||e.message.includes("config")){return true}return false}return true}function H(t,e,i=false){if(i){return`${t.errorBoundary}: ${e.name}: ${e.message}`}switch(t.errorBoundary){case"grid-item-wrapper":if(t.componentType){return`Unable to load ${t.componentType} component. Please try again.`}return"Unable to load component. Please try again.";case"canvas-section":return"Unable to render canvas section. Please refresh the page.";case"grid-builder":return"Grid builder failed to initialize. Please refresh the page.";default:return"Something went wrong. Please try again."}}var W=undefined&&undefined.__rest||function(t,e){var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0)i[n]=t[n];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++){if(e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o]))i[n[o]]=t[n[o]]}return i};class J{constructor(t,e,i={}){this.eventManager=t;this.gridId=e;this.options=Object.assign({logErrors:true,reportToSentry:false},i)}convertToGridError(t){const e=t.errorInfo,{errorBoundary:i,itemId:n,canvasId:o,componentType:s}=e,a=W(e,["errorBoundary","itemId","canvasId","componentType"]);const r=Object.assign({errorBoundary:i,itemId:n,canvasId:o,componentType:s,timestamp:t.errorInfo.timestamp,userAgent:t.errorInfo.userAgent,componentStack:t.errorInfo.componentStack},a);const c=Y(r.errorBoundary,t.error);const d=q(r.errorBoundary,t.error);return{error:t.error,errorInfo:r,severity:c,recoverable:d}}handleErrorEvent(t){const e=this.convertToGridError(t);if(this.options.logErrors){this.logError(e)}if(this.options.reportToSentry){this.reportError(e)}this.eventManager.emit("error",e)}logError(t){const e="production"!=="production";const i=H(t.errorInfo,t.error,e);const n={message:i,grid:this.gridId,errorBoundary:t.errorInfo.errorBoundary,itemId:t.errorInfo.itemId,canvasId:t.errorInfo.canvasId,componentType:t.errorInfo.componentType,severity:t.severity,recoverable:t.recoverable,timestamp:new Date(t.errorInfo.timestamp).toISOString()};switch(t.severity){case"critical":console.error("ðŸ”´ CRITICAL ERROR:",n,t.error);if(t.error.stack){console.error("Stack trace:",t.error.stack)}break;case"error":console.error("âŒ ERROR:",n,t.error);break;case"warning":console.warn("âš ï¸ WARNING:",n,t.error);break;case"info":console.info("â„¹ï¸ INFO:",n,t.error);break}}reportError(t){if(typeof window==="undefined"||!window.Sentry){console.warn("GridErrorAdapter: Sentry is not configured, skipping error report");return}const e=window.Sentry;e.withScope((i=>{i.setTag("grid-id",this.gridId);i.setTag("error-boundary",t.errorInfo.errorBoundary);i.setTag("severity",t.severity);i.setLevel(t.severity==="critical"?"fatal":t.severity);i.setContext("grid-error",{errorBoundary:t.errorInfo.errorBoundary,itemId:t.errorInfo.itemId,canvasId:t.errorInfo.canvasId,componentType:t.errorInfo.componentType,recoverable:t.recoverable});if(t.errorInfo.componentStack){i.setContext("component-stack",{stack:t.errorInfo.componentStack})}e.captureException(t.error)}))}createErrorBoundaryConfig(t,e={}){const i=Z(t,e);const n="production"!=="production";const o=this.options.showErrorUI!==undefined?this.options.showErrorUI:n;return{errorBoundary:t,showErrorUI:o,errorFallback:this.options.errorFallback,recoveryStrategy:this.options.recoveryStrategy,context:i,onError:t=>this.handleErrorEvent(t.detail)}}wrapRender(t,e,i={}){try{return e()}catch(e){const n=e instanceof Error?e:new Error(String(e));const o=Z(t,i);const s=Object.assign({errorBoundary:t,timestamp:Date.now(),userAgent:typeof navigator!=="undefined"?navigator.userAgent:undefined},o);const a=I(n);const r={error:n,errorInfo:s,severity:a.severity,recoverable:a.recoverable};this.handleErrorEvent(r);if(this.options.errorFallback){return this.options.errorFallback(n,s,undefined)}return null}}getOptions(){return Object.assign({},this.options)}updateOptions(t){this.options=Object.assign(Object.assign({},this.options),t)}getGridId(){return this.gridId}}const X=':host{--grid-builder-primary-color:#007bff;--grid-builder-palette-bg:#f5f5f5;--grid-builder-canvas-bg:#ffffff;--grid-builder-grid-line-color:rgba(0, 0, 0, 0.1);--grid-builder-selection-color:#007bff;--grid-builder-resize-handle-color:#007bff;--grid-builder-font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell",\n    "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;display:block;width:100%;height:100%;font-family:var(--grid-builder-font-family)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.grid-builder-container{position:relative;display:flex;width:100%;height:100%}.canvas-area{position:relative;flex:1;background:var(--grid-builder-canvas-bg);overflow-y:auto}.canvases-container{display:flex;flex-direction:column;min-height:100%;gap:0;}.canvas-wrapper{position:relative;display:flex;flex-direction:column;gap:0}.canvas-wrapper:first-child{padding-top:38px}.config-area{position:fixed;z-index:1000;right:0;bottom:0;display:none;width:350px;max-height:60%;border:1px solid #ddd;border-radius:8px 8px 0 0;background:white;box-shadow:0 -2px 10px rgba(0, 0, 0, 0.1)}.config-area.visible{display:block}';const Q=c("grid-builder");const tt=class{constructor(i){t(this,i);this.registryReady=e(this,"registryReady",6);this.apiRef={key:"gridBuilderAPI"};this.componentRegistry=new K;this.initializedPlugins=[];this.announcement="";this.setupViewportResizeObserver=()=>{if(!this.hostElement){return}this.viewportResizeObserver=new ResizeObserver((t=>{var e,i;for(const n of t){const t=this.hostElement.offsetWidth||((i=(e=n.borderBoxSize)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.inlineSize)||n.contentRect.width;if(t<100){Q.log(`ðŸ“± Skipping viewport switch - container not yet laid out (width: ${Math.round(t)}px)`);return}const o=this.stateManager.state.breakpoints;const s=k(t,o);if(this.stateManager.state.currentViewport!==s){Q.log(`ðŸ“± Container-based viewport switch: ${this.stateManager.state.currentViewport} â†’ ${s} (width: ${Math.round(t)}px)`);this.stateManager.state.currentViewport=s}}}));this.viewportResizeObserver.observe(this.hostElement)};this.setupScreenReaderAnnouncements=()=>{var t,e,i,n,o,s;(t=this.eventManagerInstance)===null||t===void 0?void 0:t.on("componentAdded",(t=>{const e=this.componentRegistry.get(t.item.type);const i=(e===null||e===void 0?void 0:e.name)||t.item.type;this.announce(`${i} component added to canvas`)}));(e=this.eventManagerInstance)===null||e===void 0?void 0:e.on("componentDeleted",(t=>{this.announce(`Component deleted`)}));(i=this.eventManagerInstance)===null||i===void 0?void 0:i.on("componentMoved",(t=>{this.announce(`Component moved to new canvas`)}));(n=this.eventManagerInstance)===null||n===void 0?void 0:n.on("undoExecuted",(()=>{this.announce(`Undo action performed`);this.restoreFocusToSelection()}));(o=this.eventManagerInstance)===null||o===void 0?void 0:o.on("redoExecuted",(()=>{this.announce(`Redo action performed`);this.restoreFocusToSelection()}));(s=this.eventManagerInstance)===null||s===void 0?void 0:s.on("canvasActivated",(t=>{var e;const i=(e=this.canvasMetadata)===null||e===void 0?void 0:e[t.canvasId];const n=(i===null||i===void 0?void 0:i.title)||t.canvasId;this.announce(`${n} canvas activated`)}))};this.announce=t=>{this.announcement=t;setTimeout((()=>{this.announcement=""}),100)};this.moveFocusAfterDeletion=(t,e)=>{const i=this.stateManager.state.canvases[t];if(!i){Q.log("âŒ¨ï¸ Focus: Canvas not found, focusing palette");const t=this.hostElement.querySelector("component-palette");if(t){t.focus()}return}const n=i.items;if(n.length===0){Q.log("âŒ¨ï¸ Focus: No items left, focusing canvas");const e=this.hostElement.querySelector(`canvas-section[canvas-id="${t}"]`);if(e){e.focus()}else{const t=this.hostElement.querySelector("component-palette");if(t){t.focus()}}return}const o=[...n].sort(((t,e)=>{const i=t.layouts.desktop;const n=e.layouts.desktop;if(i.y!==n.y){return i.y-n.y}return i.x-n.x}));const s=o[0];Q.log("âŒ¨ï¸ Focus: Focusing next item",{itemId:s.id,position:{x:s.layouts.desktop.x,y:s.layouts.desktop.y}});const a=this.hostElement.querySelector(`#${s.id}`);if(a){a.focus();this.stateManager.state.selectedItemId=s.id;this.stateManager.state.selectedCanvasId=s.canvasId}};this.restoreFocusToSelection=()=>{setTimeout((()=>{if(this.stateManager.state.selectedItemId){Q.log("âŒ¨ï¸ Focus: Restoring focus to selected item",{itemId:this.stateManager.state.selectedItemId});const t=this.hostElement.querySelector(`#${this.stateManager.state.selectedItemId}`);if(t){t.focus()}}}),10)}}handleGridItemDelete(t){var e;Q.log("ðŸ—‘ï¸ @Listen(grid-item:delete) in grid-builder",{detail:t.detail});const{itemId:i}=t.detail;if(i){Q.log("  âœ… Deleting item via API (with undo support):",i);(e=this.api)===null||e===void 0?void 0:e.deleteComponent(i)}}async handlePaletteItemClick(t){var e,i,n,o,s,a,r;Q.log("âž• @Listen(palette-item-click) in grid-builder",{detail:t.detail});const{targetGridBuilderId:c}=t.detail;if(c){const t=((e=this.apiRef)===null||e===void 0?void 0:e.key)||"gridBuilderAPI";if(c!==t){Q.log(`  â­ï¸ Skipping - event targeted at ${c}, this instance is ${t}`);return}Q.log(`  âœ… Event matches this instance (${t})`)}const d=(n=(i=this.config)===null||i===void 0?void 0:i.enableClickToAdd)!==null&&n!==void 0?n:true;if(!d){Q.log("  â­ï¸ Click-to-add disabled via config");return}const{componentType:l}=t.detail;if(!l){Q.warn("handlePaletteItemClick: Component type not provided");return}let h=this.stateManager.state.activeCanvasId;if(!h){const t=Object.keys(this.stateManager.state.canvases);if(t.length===0){Q.warn("handlePaletteItemClick: No canvases available");return}h=t[0];(o=this.api)===null||o===void 0?void 0:o.setActiveCanvas(h);Q.log(`  ðŸŽ¯ Auto-selected first canvas: ${h}`)}const p=this.componentRegistry.get(l);if(!p){Q.error(`handlePaletteItemClick: Component definition not found for type: ${l}`);return}const u=p.defaultSize||{width:10,height:6};const{findFreeSpace:f}=await import("./p-B8J010Vu.js");const v=f(h,u.width,u.height,this.stateManager.state);if(!v){Q.error(`handlePaletteItemClick: Could not find space on canvas ${h}`);return}Q.log("  ðŸ“ Found free space:",v);const m=await import("./p-DOsePewr.js");m.highlightCanvas(h);m.showPositionIndicator(h,v.x,v.y,u.width,u.height,this.config);Q.log("  âž• Adding component via API");const b=(s=this.api)===null||s===void 0?void 0:s.addComponent(h,l,{x:v.x,y:v.y,width:u.width,height:u.height},{});if(!b){Q.error("Failed to add component to canvas");return}(a=this.api)===null||a===void 0?void 0:a.setActiveCanvas(h);Q.log(`  ðŸŽ¯ Activated canvas: ${h}`);requestAnimationFrame((()=>{requestAnimationFrame((()=>{m.animateComponentIn(b)}))}));this.stateManager.state.selectedItemId=b;this.stateManager.state.selectedCanvasId=h;const g=this.stateManager.state.canvases[h];const x=g===null||g===void 0?void 0:g.items.find((t=>t.id===b));if(x){(r=this.eventManagerInstance)===null||r===void 0?void 0:r.emit("componentAdded",{item:x,canvasId:h})}Q.log("  âœ… Component added successfully")}componentWillLoad(){var t,e,i,n,o,a,r,c;if(!this.components||this.components.length===0){console.error("GridBuilder: components prop is required");return}this.componentRegistry=new K(this.components);if(this.componentRegistry.size()!==this.components.length){Q.warn("GridBuilder: Duplicate component types detected")}this.registryReady.emit({registry:this.componentRegistry});window.interact=s;const v=((t=this.apiKey)===null||t===void 0?void 0:t.trim())||undefined;if(v){this.resolvedInstanceId=this.instanceId||`grid-builder-${Date.now()}-${Math.random().toString(36).substring(2,9)}`;Q.log(`GridBuilder: Instance ID: ${this.resolvedInstanceId}`);Q.log(`GridBuilder: Will register with SharedStateRegistry via StateManager (apiKey: ${v}, instanceId: ${this.resolvedInstanceId})`)}const m=((e=this.apiRef)===null||e===void 0?void 0:e.key)||"default";this.cacheInstanceId=`${m}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Q.log("GridBuilder: Instance identifiers",{apiKey:v||"(none - local-only mode)",resolvedInstanceId:this.resolvedInstanceId||"(not needed - local mode)",cacheInstanceId:this.cacheInstanceId,willShareState:!!v});let b=this.initialState;if(this.breakpoints&&!((i=this.initialState)===null||i===void 0?void 0:i.breakpoints)){const t=d(this.breakpoints);b=Object.assign(Object.assign({},this.initialState),{breakpoints:t});Q.log("GridBuilder: Custom breakpoints will be configured",t)}this.stateManager=new l(v,this.resolvedInstanceId,b);if(v){const t=h.get(v);if(t){this.undoRedoManager=t.undoManager;Q.log("GridBuilder: Using shared undo/redo manager",{apiKey:v})}else{this.undoRedoManager=new p;Q.warn("GridBuilder: Could not find shared undo manager, using local",{apiKey:v})}}else{this.undoRedoManager=new p;Q.log("GridBuilder: Using local undo/redo manager (local-only mode)")}this.eventManagerInstance=new V;this.virtualRendererInstance=new N;this.domCacheInstance=new u;this.errorAdapter=new J(this.eventManagerInstance,this.instanceId,{showErrorUI:(n=this.config)===null||n===void 0?void 0:n.showErrorUI,logErrors:(o=this.config)===null||o===void 0?void 0:o.logErrors,reportToSentry:(a=this.config)===null||a===void 0?void 0:a.reportToSentry,errorFallback:(r=this.config)===null||r===void 0?void 0:r.errorFallback,recoveryStrategy:(c=this.config)===null||c===void 0?void 0:c.recoveryStrategy});Q.log("GridBuilder: Service instances created",{stateManager:!!this.stateManager,undoRedoManager:!!this.undoRedoManager,eventManagerInstance:!!this.eventManagerInstance,virtualRendererInstance:!!this.virtualRendererInstance,domCacheInstance:!!this.domCacheInstance,errorAdapter:!!this.errorAdapter,cacheInstanceId:this.cacheInstanceId,hasCustomConfig:!!this.config});f(this.cacheInstanceId);Q.log("GridBuilder: Cleared instance cache on load",{cacheInstanceId:this.cacheInstanceId});if(this.initialState){Object.assign(this.stateManager.state,this.initialState)}}componentDidLoad(){var t,e,i,n;this.api=this.createAPI();Q.log("ðŸ”§ grid-builder exposing API and service instances",{hasApiRef:!!this.apiRef,apiRefKey:(t=this.apiRef)===null||t===void 0?void 0:t.key,apiCreated:!!this.api});if(this.apiRef&&this.apiRef.key){Q.log("  ðŸ“¤ Setting API and services on window",{key:this.apiRef.key});window[this.apiRef.key]=this.api;window[`${this.apiRef.key}_virtualRenderer`]=this.virtualRendererInstance;Q.log("  âœ… API and services set on window",{key:this.apiRef.key,apiExists:!!window[this.apiRef.key],virtualRendererExists:!!window[`${this.apiRef.key}_virtualRenderer`]})}if(this.plugins&&this.plugins.length>0){this.initializedPlugins=this.plugins.filter((t=>{try{t.init(this.api);Q.log(`GridBuilder: Initialized plugin "${t.name}"`);return true}catch(e){console.error(`GridBuilder: Failed to initialize plugin "${t.name}":`,e);return false}}))}if(this.theme){this.applyTheme(this.theme)}const o=(i=(e=this.config)===null||e===void 0?void 0:e.eventDebounceDelay)!==null&&i!==void 0?i:300;(n=this.eventManagerInstance)===null||n===void 0?void 0:n.setDebounceDelay(o);Q.log(`GridBuilder: Event debounce delay set to ${o}ms`);window.debugInteractables=()=>{const t=s.interactables.list;Q.log("Total interactables:",t.length);t.forEach(((t,e)=>{Q.log(`Interactable ${e}:`,{target:t.target,actions:t._actions,options:t.options})}))};this.canvasDropHandler=t=>{var e,i;const n=t;const{canvasId:o,componentType:s,x:a,y:r}=n.detail;Q.log("ðŸŽ¯ canvas-drop event received:",{canvasId:o,componentType:s,x:a,y:r});const c=this.componentRegistry.get(s);if(!c){Q.warn(`Component definition not found for type: ${s}`);return}const d=v(a,o,this.config);const l=m(r,this.config);Q.log("  Converting to grid units (before constraints):",{gridX:d,gridY:l,defaultWidth:c.defaultSize.width,defaultHeight:c.defaultSize.height});const h=C(c,d,l);if(!h){Q.warn(`Cannot place component "${c.name}" - minimum size exceeds canvas width`);return}Q.log("  After boundary constraints:",h);const p=(e=this.api)===null||e===void 0?void 0:e.addComponent(o,s,{x:h.x,y:h.y,width:h.width,height:h.height});Q.log("  Created item:",p);(i=this.api)===null||i===void 0?void 0:i.setActiveCanvas(o)};this.hostElement.addEventListener("canvas-drop",this.canvasDropHandler);this.canvasMoveHandler=t=>{var e,i,n;const o=t;const{itemId:s,sourceCanvasId:a,targetCanvasId:r,x:c,y:d}=o.detail;Q.log("ðŸ”„ canvas-move event received:",{itemId:s,sourceCanvasId:a,targetCanvasId:r,x:c,y:d});const l=this.stateManager.state.canvases[a];if(!l){console.error("Source canvas not found:",a);return}const h=l.items.findIndex((t=>t.id===s));if(h===-1){console.error("Item not found in source canvas:",s);return}const p=l.items[h];const u={x:p.layouts.desktop.x,y:p.layouts.desktop.y};const f={x:p.layouts.mobile.x,y:p.layouts.mobile.y,width:p.layouts.mobile.width,height:p.layouts.mobile.height,customized:p.layouts.mobile.customized};let b=v(c,r,this.config);let g=m(d,this.config);const x=B(b,g,p.layouts.desktop.width,p.layouts.desktop.height,R);b=x.x;g=x.y;const y={x:b,y:g};const w=p.zIndex;p.layouts.desktop.x=b;p.layouts.desktop.y=g;l.items=l.items.filter((t=>t.id!==s));p.canvasId=r;const I=this.stateManager.state.canvases[r];I.items.push(p);const k=I.zIndexCounter++;p.zIndex=k;this.stateManager.state.canvases=Object.assign({},this.stateManager.state.canvases);(e=this.api)===null||e===void 0?void 0:e.setActiveCanvas(r);if(this.stateManager.state.selectedItemId===s){this.stateManager.state.selectedCanvasId=r}const C=new A(s,a,r,u,y,h,w,k,undefined,undefined,this.stateManager.state,this.stateManager.state.currentViewport,f,f);(i=this.undoRedoManager)===null||i===void 0?void 0:i.push(C);(n=this.eventManagerInstance)===null||n===void 0?void 0:n.emit("componentMoved",{item:p,sourceCanvasId:a,targetCanvasId:r,position:y});requestAnimationFrame((()=>{const t=document.getElementById(s);if(t){t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}));Q.log("âœ… Cross-canvas move completed:",{itemId:s,from:a,to:r,position:y})};this.hostElement.addEventListener("canvas-move",this.canvasMoveHandler);this.canvasActivatedHandler=t=>{var e;const i=t;const{canvasId:n}=i.detail;Q.log("ðŸŽ¨ canvas-activated event received:",{canvasId:n});(e=this.eventManagerInstance)===null||e===void 0?void 0:e.emit("canvasActivated",{canvasId:n})};this.hostElement.addEventListener("canvas-activated",this.canvasActivatedHandler);this.keyboardHandler=t=>{var e,i,n,o,s;const a=(t.metaKey||t.ctrlKey)&&t.key==="z"&&!t.shiftKey;const r=(t.metaKey||t.ctrlKey)&&(t.key==="z"&&t.shiftKey||t.key==="y");if(a){Q.log("âŒ¨ï¸ Keyboard: Undo triggered");t.preventDefault();(e=this.api)===null||e===void 0?void 0:e.undo();return}if(r){Q.log("âŒ¨ï¸ Keyboard: Redo triggered");t.preventDefault();(i=this.api)===null||i===void 0?void 0:i.redo();return}if(t.key==="Delete"||t.key==="Backspace"){if(this.stateManager.state.selectedItemId&&this.stateManager.state.selectedCanvasId){Q.log("âŒ¨ï¸ Keyboard: Delete triggered",{itemId:this.stateManager.state.selectedItemId});t.preventDefault();const e=this.stateManager.state.selectedItemId;const i=this.stateManager.state.selectedCanvasId;(n=this.api)===null||n===void 0?void 0:n.deleteComponent(this.stateManager.state.selectedItemId).then((t=>{if(t){this.announce("Component deleted");this.moveFocusAfterDeletion(i,e)}}));return}}if(t.key==="Escape"){if(this.stateManager.state.selectedItemId||this.stateManager.state.selectedCanvasId){Q.log("âŒ¨ï¸ Keyboard: Escape triggered (deselecting)");t.preventDefault();this.stateManager.state.selectedItemId=null;this.stateManager.state.selectedCanvasId=null;this.announce("Selection cleared");return}}if(!this.stateManager.state.selectedItemId||!this.stateManager.state.selectedCanvasId){return}const c=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key);if(!c){return}t.preventDefault();const d=this.stateManager.state.canvases[this.stateManager.state.selectedCanvasId];if(!d){return}const l=d.items.find((t=>t.id===this.stateManager.state.selectedItemId));if(!l){return}const h=this.stateManager.state.currentViewport;const p=l.layouts[h];const u=1;let f=0;let v=0;switch(t.key){case"ArrowUp":v=-1;break;case"ArrowDown":v=u;break;case"ArrowLeft":f=-1;break;case"ArrowRight":f=u;break}Q.log("âŒ¨ï¸ Keyboard: Nudging component",{key:t.key,deltaX:f,deltaY:v,itemId:l.id});const m=p.x;const b=p.y;const g=Math.max(0,p.x+f);const x=Math.max(0,p.y+v);const y=100-p.width;const w=Math.min(g,y);const I=x;if(m===w&&b===I){return}p.x=w;p.y=I;const k={x:l.layouts.mobile.x,y:l.layouts.mobile.y,width:l.layouts.mobile.width,height:l.layouts.mobile.height,customized:l.layouts.mobile.customized};const C=new A(l.id,this.stateManager.state.selectedCanvasId,this.stateManager.state.selectedCanvasId,{x:m,y:b},{x:w,y:I},d.items.findIndex((t=>t.id===l.id)),l.zIndex,l.zIndex,undefined,undefined,this.stateManager.state,h,k,k);(o=this.undoRedoManager)===null||o===void 0?void 0:o.push(C);this.stateManager.state.canvases=Object.assign({},this.stateManager.state.canvases);(s=this.eventManagerInstance)===null||s===void 0?void 0:s.emit("componentDragged",{itemId:l.id,canvasId:this.stateManager.state.selectedCanvasId,position:{x:w,y:I}})};document.addEventListener("keydown",this.keyboardHandler);this.setupViewportResizeObserver();this.setupScreenReaderAnnouncements()}disconnectedCallback(){if(this.canvasDropHandler){this.hostElement.removeEventListener("canvas-drop",this.canvasDropHandler)}if(this.canvasMoveHandler){this.hostElement.removeEventListener("canvas-move",this.canvasMoveHandler)}if(this.canvasActivatedHandler){this.hostElement.removeEventListener("canvas-activated",this.canvasActivatedHandler)}if(this.keyboardHandler){document.removeEventListener("keydown",this.keyboardHandler)}if(this.viewportResizeObserver){this.viewportResizeObserver.disconnect()}if(this.initializedPlugins.length>0){this.initializedPlugins.forEach((t=>{try{t.destroy();Q.log(`GridBuilder: Destroyed plugin "${t.name}"`)}catch(e){console.error(`GridBuilder: Failed to destroy plugin "${t.name}":`,e)}}));this.initializedPlugins=[]}if(this.undoRedoManager){this.undoRedoManager.dispose();Q.log("GridBuilder: Disposed undoRedoManager")}if(this.virtualRendererInstance){this.virtualRendererInstance.destroy();Q.log("GridBuilder: Destroyed virtualRendererInstance")}if(this.eventManagerInstance){this.eventManagerInstance.removeAllListeners();Q.log("GridBuilder: Cleared eventManagerInstance listeners")}if(this.domCacheInstance){this.domCacheInstance.clear();Q.log("GridBuilder: Cleared domCacheInstance")}if(this.stateManager){this.stateManager.dispose();Q.log("GridBuilder: Disposed stateManager")}if(this.cacheInstanceId){f(this.cacheInstanceId);Q.log("GridBuilder: Cleared grid size cache for instance",{cacheInstanceId:this.cacheInstanceId})}if(this.apiRef&&this.apiRef.key){delete window[this.apiRef.key];delete window[`${this.apiRef.key}_virtualRenderer`]}}handleComponentsChange(t){this.componentRegistry=new K(t)}handleThemeChange(t){if(t){this.applyTheme(t)}}createAPI(){return{on:(t,e)=>{var i;(i=this.eventManagerInstance)===null||i===void 0?void 0:i.on(t,e)},off:(t,e)=>{var i;(i=this.eventManagerInstance)===null||i===void 0?void 0:i.off(t,e)},getState:()=>this.stateManager.state,getItems:t=>{var e;return((e=this.stateManager.state.canvases[t])===null||e===void 0?void 0:e.items)||[]},getItem:t=>{for(const e in this.stateManager.state.canvases){const i=this.stateManager.state.canvases[e];const n=i.items.find((e=>e.id===t));if(n){return n}}return null},addComponent:(t,e,i,n)=>{var o,s;const a=this.stateManager.state.canvases[t];if(!a){console.error(`Canvas not found: ${t}`);return null}const r=this.componentRegistry.get(e);const c=(r===null||r===void 0?void 0:r.name)||e;const d=this.stateManager.state.breakpoints;const l=Object.assign(Object.assign({},i),{customized:true});const h=_(d,l);const p={id:g(),canvasId:t,name:c,type:e,zIndex:++a.zIndexCounter,layouts:h,config:n||{}};const u=[...a.items,p];const f=Object.assign(Object.assign({},a),{items:u});const v=Object.assign(Object.assign({},this.stateManager.state.canvases),{[t]:f});this.stateManager.state.canvases=v;(o=this.undoRedoManager)===null||o===void 0?void 0:o.push(new D([p.id],this.stateManager.state));(s=this.eventManagerInstance)===null||s===void 0?void 0:s.emit("componentAdded",{item:p,canvasId:t});return p.id},deleteComponent:async t=>{var e,i;let n=null;let o=null;for(const e in this.stateManager.state.canvases){const i=this.stateManager.state.canvases[e];const s=i.items.find((e=>e.id===t));if(s){n=e;o=s;break}}if(!n||!o){return false}if(this.onBeforeDelete){try{const e=await this.onBeforeDelete({item:o,canvasId:n,itemId:t});if(!e){return false}}catch(t){console.error("Error in onBeforeDelete hook:",t);return false}}const s=this.stateManager.state.canvases[n];const a=s.items.findIndex((e=>e.id===t));if(a!==-1){(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(new S([t],this.stateManager.state));s.items.splice(a,1);this.stateManager.state.canvases=Object.assign({},this.stateManager.state.canvases);if(this.stateManager.state.selectedItemId===t){this.stateManager.state.selectedItemId=null;this.stateManager.state.selectedCanvasId=null}(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("componentDeleted",{itemId:t,canvasId:n});return true}return false},updateConfig:(t,e)=>{var i,n;for(const o in this.stateManager.state.canvases){const s=this.stateManager.state.canvases[o];const a=s.items.findIndex((e=>e.id===t));if(a!==-1){const r=s.items[a];const c=Object.assign(Object.assign({},r.config),e);const d=[{itemId:t,canvasId:o,updates:{config:c}}];(i=this.undoRedoManager)===null||i===void 0?void 0:i.push(new $(d,this.stateManager.state));s.items[a]=Object.assign(Object.assign({},s.items[a]),{config:c});this.stateManager.state.canvases=Object.assign({},this.stateManager.state.canvases);(n=this.eventManagerInstance)===null||n===void 0?void 0:n.emit("configChanged",{itemId:t,canvasId:o,config:e});return true}}return false},addComponentsBatch:t=>{var e,i;const n=this.stateManager.state.breakpoints;const o=t.map((({canvasId:t,type:e,position:i,config:o})=>{const s=this.componentRegistry.get(e);const a=(s===null||s===void 0?void 0:s.name)||e;const r=Object.assign(Object.assign({},i),{customized:true});const c=_(n,r);return{canvasId:t,type:e,name:a,layouts:c,config:o||{}}}));const s=this.stateManager.addItemsBatch(o);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(new D(s,this.stateManager.state));const a=s.map((t=>{var e;const i=(e=this.api)===null||e===void 0?void 0:e.getItem(t);return i?{item:i,canvasId:i.canvasId}:null})).filter(Boolean);(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("componentsBatchAdded",{items:a});return s},deleteComponentsBatch:t=>{var e,i;const n=t.map((t=>{var e;const i=(e=this.api)===null||e===void 0?void 0:e.getItem(t);return i?{itemId:t,canvasId:i.canvasId}:null})).filter(Boolean);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(new S(t,this.stateManager.state));this.stateManager.deleteItemsBatch(t);if(this.stateManager.state.selectedItemId&&t.includes(this.stateManager.state.selectedItemId)){this.stateManager.state.selectedItemId=null;this.stateManager.state.selectedCanvasId=null}(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("componentsBatchDeleted",{items:n})},updateConfigsBatch:t=>{var e,i;const n=t.map((({itemId:t,config:e})=>{var i;const n=(i=this.api)===null||i===void 0?void 0:i.getItem(t);if(!n){Q.warn(`Item ${t} not found for config update`);return null}return{itemId:t,canvasId:n.canvasId,updates:{config:Object.assign(Object.assign({},n.config),e)}}})).filter(Boolean);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(new $(n,this.stateManager.state));this.stateManager.updateItemsBatch(n);const o=n.map((({itemId:t,canvasId:e,updates:i})=>({itemId:t,canvasId:e,config:i.config})));(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("configsBatchChanged",{items:o})},getCanvasElement:t=>document.getElementById(t),undo:()=>{var t,e;const i=(t=this.undoRedoManager)===null||t===void 0?void 0:t.undo();if(i){const t=typeof i==="object"&&"action"in i?i.action:"undo";(e=this.eventManagerInstance)===null||e===void 0?void 0:e.emit("undoExecuted",{description:i,actionType:t})}},redo:()=>{var t,e;const i=(t=this.undoRedoManager)===null||t===void 0?void 0:t.redo();if(i){const t=typeof i==="object"&&"action"in i?i.action:"redo";(e=this.eventManagerInstance)===null||e===void 0?void 0:e.emit("redoExecuted",{description:i,actionType:t})}},canUndo:()=>{var t;return(t=this.undoRedoManager)===null||t===void 0?void 0:t.canUndo()},canRedo:()=>{var t;return(t=this.undoRedoManager)===null||t===void 0?void 0:t.canRedo()},undoRedoState:b,addCanvas:t=>{var e,i;const n=new z(t,this.stateManager.state,this.eventManagerInstance);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(n);n.redo();this.stateManager.state.activeCanvasId=t;(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("canvasActivated",{canvasId:t});requestAnimationFrame((()=>{var e;const i=(e=this.domCacheInstance)===null||e===void 0?void 0:e.getCanvas(t);if(i){i.scrollIntoView({behavior:"smooth",block:"center"})}}))},removeCanvas:t=>{var e;const i=new O(t,this.stateManager.state,this.eventManagerInstance);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(i);i.redo()},setActiveCanvas:t=>{var e;this.stateManager.state.activeCanvasId=t;(e=this.eventManagerInstance)===null||e===void 0?void 0:e.emit("canvasActivated",{canvasId:t})},getActiveCanvas:()=>this.stateManager.state.activeCanvasId,moveItem:(t,e,i)=>{var n,o;const s=this.stateManager.state.canvases[t];if(!s){console.warn(`Source canvas ${t} not found`);return}const a=s.items.find((t=>t.id===i));if(!a){console.warn(`Item ${i} not found in canvas ${t}`);return}const r=s.items.findIndex((t=>t.id===i));const c=a.zIndex;const d=this.stateManager.state.currentViewport;const l=a.layouts[d];const h={x:l.x,y:l.y};const p={x:l.x,y:l.y};const u={x:a.layouts.mobile.x,y:a.layouts.mobile.y,width:a.layouts.mobile.width,height:a.layouts.mobile.height,customized:a.layouts.mobile.customized};let f=c;if(t!==e){const t=this.stateManager.state.canvases[e];if(t){f=++t.zIndexCounter}}const v=new A(i,t,e,h,p,r,c,f,undefined,undefined,this.stateManager.state,d,u,u);v.redo();(n=this.undoRedoManager)===null||n===void 0?void 0:n.push(v);(o=this.eventManagerInstance)===null||o===void 0?void 0:o.emit("componentMoved",{itemId:i,fromCanvasId:t,toCanvasId:e});if(t!==e){requestAnimationFrame((()=>{const t=document.getElementById(i);if(t){t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}))}},setItemsZIndexBatch:t=>{var e,i;if(t.length===0){return}const n=t.map((({itemId:t,canvasId:e,newZIndex:i})=>{const n=this.stateManager.state.canvases[e];if(!n){console.warn(`Canvas ${e} not found for item ${t}, skipping`);return null}const o=n.items.find((e=>e.id===t));if(!o){console.warn(`Item ${t} not found in canvas ${e}, skipping`);return null}const s=o.zIndex;if(s===i){return null}return{itemId:t,canvasId:e,oldZIndex:s,newZIndex:i}})).filter(Boolean);if(n.length===0){return}n.forEach((({itemId:t,canvasId:e,newZIndex:i})=>{const n=this.stateManager.state.canvases[e];const o=n.items.find((e=>e.id===t));if(o){o.zIndex=i}}));this.stateManager.state.canvases=Object.assign({},this.stateManager.state.canvases);const o=new j(n,this.eventManagerInstance,this.stateManager.state);(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(o);(i=this.eventManagerInstance)===null||i===void 0?void 0:i.emit("zIndexBatchChanged",{changes:n})},pushCommand:t=>{var e;(e=this.undoRedoManager)===null||e===void 0?void 0:e.push(t)},registerComponent:t=>{var e;if(!t.type||typeof t.type!=="string"){console.error("registerComponent: Component definition must have a valid type string");return}this.componentRegistry.register(t);Q.log(`âœ… Registered component: ${t.type}`,{name:t.name,icon:t.icon,totalComponents:this.componentRegistry.size()});(e=this.eventManagerInstance)===null||e===void 0?void 0:e.emit("componentRegistered",{type:t.type,name:t.name})},getComponents:()=>this.componentRegistry.getAll()}}applyTheme(t){const e=this.el;if(!e)return;if(t.primaryColor){e.style.setProperty("--grid-builder-primary-color",t.primaryColor)}if(t.paletteBackground){e.style.setProperty("--grid-builder-palette-bg",t.paletteBackground)}if(t.canvasBackground){e.style.setProperty("--grid-builder-canvas-bg",t.canvasBackground)}if(t.gridLineColor){e.style.setProperty("--grid-builder-grid-line-color",t.gridLineColor)}if(t.selectionColor){e.style.setProperty("--grid-builder-selection-color",t.selectionColor)}if(t.resizeHandleColor){e.style.setProperty("--grid-builder-resize-handle-color",t.resizeHandleColor)}if(t.fontFamily){e.style.setProperty("--grid-builder-font-family",t.fontFamily)}if(t.customProperties){Object.entries(t.customProperties).forEach((([t,i])=>{e.style.setProperty(t,i)}))}}async exportState(){const t={version:"1.0.0",canvases:{},viewport:this.stateManager.state.currentViewport,metadata:{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}};for(const e in this.stateManager.state.canvases){const i=this.stateManager.state.canvases[e];t.canvases[e]={items:i.items.map((t=>({id:t.id,canvasId:t.canvasId,type:t.type,name:t.name,layouts:{desktop:Object.assign({},t.layouts.desktop),mobile:Object.assign({},t.layouts.mobile)},zIndex:t.zIndex,config:Object.assign({},t.config)})))}}return t}async importState(t){if(t.canvases){this.stateManager.state.canvases=JSON.parse(JSON.stringify(t.canvases))}const e=t;if(e.currentViewport!==undefined){this.stateManager.state.currentViewport=e.currentViewport}if(e.selectedItemId!==undefined){this.stateManager.state.selectedItemId=e.selectedItemId}if(e.selectedCanvasId!==undefined){this.stateManager.state.selectedCanvasId=e.selectedCanvasId}if(e.activeCanvasId!==undefined){this.stateManager.state.activeCanvasId=e.activeCanvasId}}async getState(){return this.stateManager.state}async addCanvas(t){var e;(e=this.api)===null||e===void 0?void 0:e.addCanvas(t)}async removeCanvas(t){var e;(e=this.api)===null||e===void 0?void 0:e.removeCanvas(t)}async setActiveCanvas(t){var e;(e=this.api)===null||e===void 0?void 0:e.setActiveCanvas(t)}async getActiveCanvas(){var t;return((t=this.api)===null||t===void 0?void 0:t.getActiveCanvas())||null}async undo(){var t;(t=this.api)===null||t===void 0?void 0:t.undo()}async redo(){var t;(t=this.api)===null||t===void 0?void 0:t.redo()}async canUndo(){var t;return((t=this.api)===null||t===void 0?void 0:t.canUndo())||false}async canRedo(){var t;return((t=this.api)===null||t===void 0?void 0:t.canRedo())||false}async addComponent(t,e,i,n){var o;return((o=this.api)===null||o===void 0?void 0:o.addComponent(t,e,i,n))||null}async deleteComponent(t){var e;return((e=this.api)===null||e===void 0?void 0:e.deleteComponent(t))||false}async updateConfig(t,e){var i;return((i=this.api)===null||i===void 0?void 0:i.updateConfig(t,e))||false}render(){const t=Object.keys(this.stateManager.state.canvases);const e=this.config?Object.assign(Object.assign({},this.config),{instanceId:this.cacheInstanceId}):{instanceId:this.cacheInstanceId};return i(o,{key:"be023c85d233e2d0eed27b48b88b6612c6be7eeb",ref:t=>this.el=t},i("div",{key:"dbbe6bf1beff097292cc775bf6b6da0c5097133a",class:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true"},this.announcement),i("div",{key:"934f03cef042e0262222713ab09389e461d3d078",class:"grid-builder-container",role:"application","aria-label":"Grid builder"},i("div",{key:"a9bab6464502a8ba6574c8534ca94f848f0c924c",class:"canvas-area"},i("div",{key:"60a0d708c95b843dc2912ee309464548895ae3c8",class:"canvases-container"},t.map((t=>{var n,o,s;const a=this.stateManager.state.activeCanvasId===t;const r=((n=this.canvasMetadata)===null||n===void 0?void 0:n[t])||{};const c=(s=(o=this.uiOverrides)===null||o===void 0?void 0:o.CanvasHeader)===null||s===void 0?void 0:s.call(o,{canvasId:t,metadata:r,isActive:a});const d=c instanceof HTMLElement?i("div",{ref:t=>{if(t){t.innerHTML="";t.appendChild(c)}}}):c;return i("div",{key:t,class:"canvas-wrapper"},d,i("canvas-section",{canvasId:t,isActive:a,config:e,componentRegistry:this.componentRegistry,backgroundColor:r.backgroundColor,canvasTitle:r.title,onBeforeDelete:this.onBeforeDelete,virtualRendererInstance:this.virtualRendererInstance,eventManagerInstance:this.eventManagerInstance,undoRedoManagerInstance:this.undoRedoManager,stateInstance:this.stateManager.state,onStateChange:(t,e)=>this.stateManager.onChange(t,e),domCacheInstance:this.domCacheInstance,errorAdapterInstance:this.errorAdapter,theme:this.theme}))}))))))}get hostElement(){return n(this)}static get watchers(){return{components:["handleComponentsChange"],theme:["handleThemeChange"]}}};tt.style=X;const et='@charset "UTF-8";:host{--grid-viewer-primary-color:#007bff;--grid-viewer-canvas-bg:#ffffff;--grid-viewer-font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen",\n    "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;display:block;width:100%;height:100%;font-family:var(--grid-viewer-font-family)}.grid-viewer-container{width:100%;height:100%;background:var(--grid-viewer-canvas-bg);overflow:auto}.canvas-area{width:100%;height:100%;overflow-y:auto;overflow-x:hidden}.canvases-container{display:flex;flex-direction:column;gap:0;width:100%;min-height:100%}';const it=c("grid-viewer");const nt=class{constructor(e){t(this,e);this.componentRegistry=new K;this.setupViewportResizeObserver=()=>{if(!this.hostElement){return}this.viewportResizeObserver=new ResizeObserver((t=>{var e,i;for(const n of t){const t=this.hostElement.offsetWidth||((i=(e=n.borderBoxSize)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.inlineSize)||n.contentRect.width;if(t<100){it.log(`ðŸ“± [Viewer] Skipping viewport switch - container not yet laid out (width: ${Math.round(t)}px)`);return}const o=this.viewerState.state.breakpoints;const s=k(t,o);if(this.viewerState.state.currentViewport!==s){it.log(`ðŸ“± [Viewer] Container-based viewport switch: ${this.viewerState.state.currentViewport} â†’ ${s} (width: ${Math.round(t)}px)`);this.viewerState.state.currentViewport=s}}}));this.viewportResizeObserver.observe(this.hostElement)}}componentWillLoad(){var t,e,i;const n=this.breakpoints?d(this.breakpoints):x;it.log("GridViewer: Breakpoints configured",n);const o=((t=this.apiKey)===null||t===void 0?void 0:t.trim())||undefined;if(!this.components||this.components.length===0){console.error("GridViewer: components prop is required");if(o){this.resolvedInstanceId=this.instanceId||`grid-viewer-${Date.now()}-${Math.random().toString(36).substring(2,9)}`;const t=h.getOrCreate(o,{canvases:{}});this.sharedDataStore=t.store;h.addInstance(o,this.resolvedInstanceId);this.viewerState=y({canvases:this.sharedDataStore.state.canvases,currentViewport:"desktop",selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,breakpoints:n})}else{this.viewerState=y({canvases:{},currentViewport:"desktop",selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,breakpoints:n})}return}this.componentRegistry=new K(this.components);if(this.componentRegistry.size()!==this.components.length){it.warn("GridViewer: Duplicate component types detected")}if(o){it.log(`GridViewer: Initializing in shared mode (apiKey: ${o})`);this.resolvedInstanceId=this.instanceId||`grid-viewer-${Date.now()}-${Math.random().toString(36).substring(2,9)}`;it.log(`GridViewer: Instance ID: ${this.resolvedInstanceId}`);let t={};if(this.initialState){if("viewport"in this.initialState){t=this.initialState.canvases}else if(this.initialState.canvases){t=this.initialState.canvases}}const i=h.getOrCreate(o,{canvases:t});this.sharedDataStore=i.store;h.addInstance(o,this.resolvedInstanceId);it.log(`GridViewer: Registered with SharedStateRegistry (apiKey: ${o}, instanceId: ${this.resolvedInstanceId})`);const s=this.initialState&&"viewport"in this.initialState?this.initialState.viewport:((e=this.initialState)===null||e===void 0?void 0:e.currentViewport)||"desktop";this.viewerState=y({canvases:this.sharedDataStore.state.canvases,currentViewport:s,selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,breakpoints:n});it.log(`GridViewer: Shared mode initialized (canvases: ${Object.keys(this.sharedDataStore.state.canvases).length})`)}else{it.log("GridViewer: Initializing in local-only mode (no apiKey)");const t={canvases:{},currentViewport:"desktop",selectedItemId:null,selectedCanvasId:null,activeCanvasId:null,breakpoints:n};if(this.initialState){if("viewport"in this.initialState){t.currentViewport=this.initialState.viewport;t.canvases=this.initialState.canvases}else{Object.assign(t,this.initialState)}}this.viewerState=y(t);it.log(`GridViewer: Local mode initialized (canvases: ${Object.keys(this.viewerState.state.canvases).length})`)}if(((i=this.config)===null||i===void 0?void 0:i.enableVirtualRendering)!==false){this.virtualRendererInstance=new N}}componentDidLoad(){if(this.theme){this.applyTheme(this.theme)}this.setupViewportResizeObserver()}disconnectedCallback(){var t;if(this.viewportResizeObserver){this.viewportResizeObserver.disconnect()}const e=((t=this.apiKey)===null||t===void 0?void 0:t.trim())||undefined;if(e&&this.resolvedInstanceId){h.removeInstance(e,this.resolvedInstanceId);it.log(`GridViewer: Unregistered from SharedStateRegistry (apiKey: ${e}, instanceId: ${this.resolvedInstanceId})`)}}handleComponentsChange(t){this.componentRegistry=new K(t)}handleInitialStateChange(t){var e;if(!t||!this.viewerState)return;const i=((e=this.apiKey)===null||e===void 0?void 0:e.trim())||undefined;if(i&&this.sharedDataStore){it.log(`GridViewer: Updating state in shared mode (apiKey: ${i})`);if("viewport"in t){this.viewerState.state.currentViewport=t.viewport;this.sharedDataStore.state.canvases=t.canvases;this.viewerState.state.canvases=this.sharedDataStore.state.canvases}else{if(t.currentViewport){this.viewerState.state.currentViewport=t.currentViewport}if(t.canvases){this.sharedDataStore.state.canvases=t.canvases;this.viewerState.state.canvases=this.sharedDataStore.state.canvases}}}else{it.log("GridViewer: Updating state in local mode");if("viewport"in t){this.viewerState.state.currentViewport=t.viewport;this.viewerState.state.canvases=t.canvases}else{Object.assign(this.viewerState.state,t)}}}applyTheme(t){const e=this.el;if(!e)return;if(t.primaryColor){e.style.setProperty("--grid-viewer-primary-color",t.primaryColor)}if(t.canvasBackground){e.style.setProperty("--grid-viewer-canvas-bg",t.canvasBackground)}if(t.fontFamily){e.style.setProperty("--grid-viewer-font-family",t.fontFamily)}if(t.customProperties){Object.entries(t.customProperties).forEach((([t,i])=>{e.style.setProperty(t,i)}))}}render(){if(!this.viewerState){return i(o,null)}const t=Object.keys(this.viewerState.state.canvases);return i(o,{ref:t=>this.el=t},i("div",{class:"grid-viewer-container"},i("div",{class:"canvas-area"},i("div",{class:"canvases-container"},t.map((t=>{var e,n;return i("canvas-section-viewer",{key:t,canvasId:t,config:this.config,componentRegistry:this.componentRegistry,items:this.viewerState.state.canvases[t].items,currentViewport:this.viewerState.state.currentViewport,breakpoints:this.viewerState.state.breakpoints,backgroundColor:(n=(e=this.canvasMetadata)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.backgroundColor,virtualRendererInstance:this.virtualRendererInstance,stateInstance:this.viewerState.state})}))))))}get hostElement(){return n(this)}static get watchers(){return{components:["handleComponentsChange"],initialState:["handleInitialStateChange"]}}};nt.style=et;const ot=".layer-panel{display:flex;flex-direction:column;width:100%;background:#fafafa;overflow:hidden;box-sizing:border-box}.layer-panel__header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #e0e0e0;background:#ffffff}.layer-panel__title{margin:0;font-size:16px;font-weight:600;color:#333}.layer-panel__count{font-size:12px;color:#757575;background:#f5f5f5;padding:2px 8px;border-radius:12px}.layer-panel__search{padding:12px 16px;border-bottom:1px solid #e0e0e0;background:#ffffff}.layer-panel__search-input{width:100%;padding:8px 12px;border:1px solid #e0e0e0;border-radius:4px;font-size:14px;outline:none;transition:border-color 0.2s ease;box-sizing:border-box}.layer-panel__search-input:focus{border-color:#4a90e2;box-shadow:0 0 0 2px rgba(74, 144, 226, 0.1)}.layer-panel__search-input::placeholder{color:#9e9e9e}.layer-panel__list{overflow-x:hidden;padding:8px;background:#fafafa;width:100%;box-sizing:border-box;min-height:400px;}.layer-panel__list::-webkit-scrollbar{width:8px}.layer-panel__list::-webkit-scrollbar-track{background:#f5f5f5}.layer-panel__list::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}.layer-panel__list::-webkit-scrollbar-thumb:hover{background:#aaa}.layer-panel__list-inner{position:relative;min-height:100%;width:100%;box-sizing:border-box}.layer-panel__visible-items{position:absolute;width:100%;will-change:transform}.layer-panel__empty{text-align:center;padding:32px 16px;color:#9e9e9e;font-size:14px}.layer-panel__footer{padding:8px 16px;border-top:1px solid #e0e0e0;background:#ffffff}.layer-panel__hint{font-size:11px;color:#757575;text-align:center}";const st=class{constructor(e){t(this,e);this.canvasMetadata={};this.folderHeight=40;this.itemHeight=40;this.virtualWindowSize=50;this.virtualBufferPx=200;this.searchDebounceMs=300;this.allItems=[];this.filteredItems=[];this.searchQuery="";this.folderExpandedState={};this.searchDebounceTimer=null;this.virtualScrollOffset=0;this.cleanupFunctions=[];this.draggedItem=null;this.setupLayerPanel=()=>{console.log("ðŸ”§ setupLayerPanel called");if(!this.api){console.warn("  âš ï¸ No API - aborting");return}if(this.cleanupFunctions.length>0){console.log("  â„¹ï¸ Already initialized, skipping");return}this.initializeFolderState();this.refreshItems();const t=()=>{this.refreshItems()};this.api.on("componentAdded",t);this.api.on("componentDeleted",t);this.api.on("componentDragged",t);this.api.on("componentResized",t);this.api.on("componentsBatchAdded",t);this.api.on("componentsBatchDeleted",t);this.api.on("zIndexChanged",t);this.api.on("zIndexBatchChanged",t);this.cleanupFunctions.push((()=>{this.api.off("componentAdded",t);this.api.off("componentDeleted",t);this.api.off("componentDragged",t);this.api.off("componentResized",t);this.api.off("componentsBatchAdded",t);this.api.off("componentsBatchDeleted",t);this.api.off("zIndexChanged",t);this.api.off("zIndexBatchChanged",t)}));const e=()=>{this.allItems=[...this.allItems]};this.api.on("componentSelected",e);this.api.on("canvasActivated",e);this.cleanupFunctions.push((()=>{this.api.off("componentSelected",e);this.api.off("canvasActivated",e)}));const i=()=>{const t=this.api.getState();const e=t.activeCanvasId;if(e){console.log("ðŸ“ Canvas activated, expanding folder:",e);const i={};Object.keys(t.canvases).forEach((t=>{i[t]=t===e}));this.folderExpandedState=i}};this.api.on("canvasActivated",i);this.cleanupFunctions.push((()=>{this.api.off("canvasActivated",i)}));this.initializeVirtualScrolling()};this.initializeFolderState=()=>{console.log("ðŸ“ initializeFolderState called");if(!this.api){console.warn("  âš ï¸ No API - aborting");return}const t=this.api.getState();const e=t.activeCanvasId;console.log("  Active canvas:",e);const i={};Object.keys(t.canvases).forEach((t=>{i[t]=t===e}));console.log("  Folder state:",i);this.folderExpandedState=i};this.refreshItems=()=>{console.log("ðŸ”„ refreshItems called");if(!this.api){console.warn("  âš ï¸ No API - aborting");return}const t=this.api.getState();console.log("  State from API:",t);console.log("  Canvases:",Object.keys(t.canvases||{}));const e=[];Object.entries(t.canvases).forEach((([t,i])=>{var n;console.log(`  Canvas ${t}: ${((n=i.items)===null||n===void 0?void 0:n.length)||0} items`);i.items.forEach((i=>{e.push(Object.assign(Object.assign({},i),{canvasId:t}))}))}));console.log(`  Total items collected: ${e.length}`);e.sort(((t,e)=>e.zIndex-t.zIndex));this.allItems=e;console.log("  this.allItems set to:",this.allItems.length,"items");this.applySearchFilter();console.log("  After filter:",this.filteredItems.length,"items")};this.applySearchFilter=()=>{if(!this.searchQuery){this.filteredItems=this.allItems;return}const t=this.searchQuery.toLowerCase();this.filteredItems=this.allItems.filter((e=>e.name.toLowerCase().includes(t)))};this.handleSearchInput=t=>{const e=t.target;const i=e.value;if(this.searchDebounceTimer){clearTimeout(this.searchDebounceTimer)}this.searchDebounceTimer=window.setTimeout((()=>{this.searchQuery=i;this.applySearchFilter()}),this.searchDebounceMs)};this.groupItemsByCanvas=t=>{const e={};t.forEach((t=>{if(!e[t.canvasId]){e[t.canvasId]=[]}e[t.canvasId].push(t)}));return e};this.getCanvasTitle=t=>{var e,i;return((i=(e=this.canvasMetadata)===null||e===void 0?void 0:e[t])===null||i===void 0?void 0:i.title)||t};this.toggleFolder=t=>{this.folderExpandedState=Object.assign(Object.assign({},this.folderExpandedState),{[t]:!this.folderExpandedState[t]})};this.initializeVirtualScrolling=()=>{const t=this.hostElement.querySelector(".layer-panel__list");if(!t)return;t.addEventListener("scroll",(()=>{const e=t.scrollTop;this.virtualScrollOffset=e}))};this.buildVirtualItemsList=()=>{const t=[];let e=0;const i=this.groupItemsByCanvas(this.allItems);const n=this.groupItemsByCanvas(this.filteredItems);const o=this.canvasMetadata?Object.keys(this.canvasMetadata):Object.keys(i);o.forEach((o=>{var s;if(!i[o])return;const a=i[o]||[];const r=n[o]||[];const c=(s=this.folderExpandedState[o])!==null&&s!==void 0?s:true;const d=this.searchQuery&&r.length===0;t.push({type:"folder",data:{canvasId:o,title:this.getCanvasTitle(o),itemCount:r.length,totalItemCount:a.length,isEmpty:d},height:this.folderHeight,offset:e});e+=this.folderHeight;if(c){r.forEach((i=>{t.push({type:"item",data:i,height:this.itemHeight,offset:e});e+=this.itemHeight}))}}));return t};this.calculateVirtualScrolling=()=>{const t=this.buildVirtualItemsList();const e=t.length>0?t[t.length-1].offset+t[t.length-1].height:0;const i=this.virtualScrollOffset;const n=this.hostElement.querySelector(".layer-panel__list");const o=(n===null||n===void 0?void 0:n.clientHeight)||600;const s=Math.max(0,i-this.virtualBufferPx);const a=i+o+this.virtualBufferPx;let r=0;for(let e=0;e<t.length;e++){if(t[e].offset+t[e].height>=s){r=e;break}}let c=r;for(let e=r;e<t.length;e++){if(t[e].offset>a){break}c=e}const d=t.slice(r,c+1);return{visibleItems:d,totalHeight:e}}}handleApiChange(t){console.log("ðŸ”§ Layer panel: API prop changed",{hasApi:!!t});if(t){this.setupLayerPanel()}}componentDidLoad(){console.log("ðŸ”§ Layer panel componentDidLoad called");console.log("  API available:",!!this.api);if(this.api){this.setupLayerPanel()}else{console.warn("  âš ï¸ API not yet available, waiting for prop...")}}disconnectedCallback(){this.cleanupFunctions.forEach((t=>t()));this.cleanupFunctions=[];if(this.searchDebounceTimer){clearTimeout(this.searchDebounceTimer)}}handleLayerItemSelect(t){if(!this.api)return;const{itemId:e,canvasId:i}=t.detail;const n=this.api.getState();n.selectedItemId=e;n.selectedCanvasId=i;n.activeCanvasId=i}handleToggleFolder(t){this.toggleFolder(t.detail.canvasId)}handleActivateCanvas(t){if(!this.api)return;const e=this.api.getState();e.activeCanvasId=t.detail.canvasId}handleScrollToCanvas(t){const{canvasId:e}=t.detail;console.log("ðŸ“œ Scrolling to canvas:",e);const i=document.getElementById(e);if(i){i.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});console.log("  âœ… Scrolled to canvas element")}else{console.warn("  âš ï¸ Canvas element not found:",e)}}handleLayerItemDragStart(t){const{itemId:e,canvasId:i,zIndex:n}=t.detail;this.draggedItem={itemId:e,canvasId:i,zIndex:n}}handleLayerItemDropped(t){console.log("ðŸŽ¯ Layer item dropped",{event:t.detail,draggedItem:this.draggedItem,hasApi:!!this.api});if(!this.draggedItem||!this.api){console.warn("  âš ï¸ No draggedItem or API, aborting");return}const e=this.api.getState();const{targetItemId:i,targetCanvasId:n,targetZIndex:o,dropAbove:s}=t.detail;const{itemId:a,canvasId:r,zIndex:c}=this.draggedItem;if(a===i&&r===n){console.log("  â„¹ï¸ Dropped on self, ignoring");this.draggedItem=null;return}console.log("  ðŸ“¦ Processing drop:",{draggedItemId:a,draggedCanvasId:r,draggedZIndex:c,targetItemId:i,targetCanvasId:n,targetZIndex:o,dropAbove:s});const d=[];if(r!==n){const t=e.canvases[r];const c=e.canvases[n];if(!t||!c)return;this.api.moveItem(r,n,a);const l=this.api.getState().canvases[n];const h=[...l.items].sort(((t,e)=>t.zIndex-e.zIndex));const p=h.findIndex((t=>t.id===i));let u;if(s){u=o;h.forEach((t=>{if(t.id!==a&&t.zIndex>=u){d.push({itemId:t.id,canvasId:n,newZIndex:t.zIndex+1})}}))}else{if(p<h.length-1){const t=h[p+1];u=t.zIndex;h.forEach((t=>{if(t.id!==a&&t.zIndex>=u){d.push({itemId:t.id,canvasId:n,newZIndex:t.zIndex+1})}}))}else{u=o+1}}d.push({itemId:a,canvasId:n,newZIndex:u})}else{const t=e.canvases[r];const n=[...t.items].sort(((t,e)=>t.zIndex-e.zIndex));const l=n.findIndex((t=>t.id===a));const h=n.findIndex((t=>t.id===i));let p;if(s){p=o;n.forEach((t=>{if(t.id!==a){if(l<h){if(t.zIndex>c&&t.zIndex<=o){d.push({itemId:t.id,canvasId:r,newZIndex:t.zIndex-1})}}else{if(t.zIndex>=o&&t.zIndex<c){d.push({itemId:t.id,canvasId:r,newZIndex:t.zIndex+1})}}}}))}else{if(h<n.length-1){p=o+1;n.forEach((t=>{if(t.id!==a){if(l<h){if(t.zIndex>c&&t.zIndex<=p){d.push({itemId:t.id,canvasId:r,newZIndex:t.zIndex-1})}}else{if(t.zIndex>=p&&t.zIndex<c){d.push({itemId:t.id,canvasId:r,newZIndex:t.zIndex+1})}}}}))}else{p=o+1}}d.push({itemId:a,canvasId:r,newZIndex:p})}if(d.length>0){this.api.setItemsZIndexBatch(d)}this.draggedItem=null}render(){var t;const{visibleItems:e,totalHeight:n}=this.calculateVirtualScrolling();const o=(t=this.api)===null||t===void 0?void 0:t.getState();const s=o===null||o===void 0?void 0:o.activeCanvasId;const a=o===null||o===void 0?void 0:o.selectedItemId;const r=o===null||o===void 0?void 0:o.selectedCanvasId;return i("div",{key:"871ee1dcb1abe2f74ee70f9d4b5a494e4af3e800",class:"layer-panel"},i("div",{key:"d0c626ae0f55c800c39b62493a09c9eed38ebc03",class:"layer-panel__header"},i("h3",{key:"f519a370f9158f777632061148f03637d50a6502",class:"layer-panel__title"},"Layers"),i("div",{key:"9b1822d976bfb83f4229bf9c4fcf6b71182959c8",class:"layer-panel__count"},this.filteredItems.length," items")),i("div",{key:"45e8bf9794ed44a28fbecb80e7f34f8c4ebcf9ad",class:"layer-panel__search"},i("input",{key:"04913da7450ad524ff08cd62737be1c345845ca4",type:"text",class:"layer-panel__search-input",placeholder:"Search layers...",onInput:this.handleSearchInput})),i("div",{key:"e0c6cbae88ff81b00a979e4955c494d348d8e09e",class:"layer-panel__list"},i("div",{key:"3f552646fbce3a8721c8ddff0072092fcccedffb",class:"layer-panel__list-inner",style:{height:`${n}px`,position:"relative"}},e.length===0&&i("div",{key:"57767a8b0c54add5cd1c1c957d2712790244ebd4",class:"layer-panel__empty"},"No items found"),e.map((t=>{var e;if(t.type==="folder"){const n=t.data;return i("layer-panel-folder-header",{key:`folder-${n.canvasId}`,canvasId:n.canvasId,canvasTitle:n.title,itemCount:n.itemCount,totalItemCount:n.totalItemCount,isExpanded:(e=this.folderExpandedState[n.canvasId])!==null&&e!==void 0?e:true,isActive:n.canvasId===s,isEmpty:n.isEmpty,style:{position:"absolute",top:`${t.offset}px`,left:"0",right:"0",height:`${t.height}px`}})}else{const e=t.data;return i("layer-panel-item",{key:e.id,itemId:e.id,canvasId:e.canvasId,name:e.name,type:e.type,zIndex:e.zIndex,isActive:e.id===a&&e.canvasId===r,style:{position:"absolute",top:`${t.offset}px`,left:"0",right:"0",height:`${t.height}px`}})}})))),i("div",{key:"badc7d65f29137d5730fa87579f32072e2f726a3",class:"layer-panel__footer"},i("div",{key:"2ea39c533d8c5cad4aff2f50a6a4f38d96bf4a84",class:"layer-panel__hint"},"Click folder to expand/collapse Â· Click item to select")))}get hostElement(){return n(this)}static get watchers(){return{api:["handleApiChange"]}}};st.style=ot;const at='section-editor-panel .section-editor-overlay{position:fixed;z-index:10000;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.2s ease-out;background:rgba(0, 0, 0, 0.5)}section-editor-panel .section-editor-panel{width:90%;max-width:440px;border-radius:12px;animation:slideUp 0.2s ease-out;background:white;box-shadow:0 8px 32px rgba(0, 0, 0, 0.12)}section-editor-panel .panel-header{display:flex;align-items:center;justify-content:space-between;padding:28px 32px 24px;border-bottom:1px solid #e9ecef}section-editor-panel .panel-header .panel-title{margin:0;color:#212529;font-size:20px;font-weight:600;letter-spacing:-0.02em}section-editor-panel .panel-header .close-btn{display:flex;width:32px;height:32px;align-items:center;justify-content:center;padding:0;border:none;border-radius:6px;background:transparent;color:#6c757d;cursor:pointer;font-size:24px;font-weight:300;line-height:1;transition:all 0.15s}section-editor-panel .panel-header .close-btn:hover{background:#f8f9fa;color:#212529}section-editor-panel .panel-header .close-btn:active{transform:scale(0.95)}section-editor-panel .panel-body{padding:32px}section-editor-panel .panel-body .form-group{margin-bottom:28px}section-editor-panel .panel-body .form-group:last-child{margin-bottom:0}section-editor-panel .panel-body .form-group label{display:block;margin-bottom:10px;color:#495057;font-size:13px;font-weight:600;letter-spacing:0.01em;text-transform:uppercase}section-editor-panel .panel-body .form-group .section-title-input{width:100%;box-sizing:border-box;padding:12px 16px;border:1.5px solid #e1e4e8;border-radius:8px;background:#f8f9fa;color:#212529;font-size:15px;transition:all 0.2s}section-editor-panel .panel-body .form-group .section-title-input:hover{background:white;border-color:#cbd3da}section-editor-panel .panel-body .form-group .section-title-input:focus{border-color:#4a90e2;background:white;box-shadow:0 0 0 3px rgba(74, 144, 226, 0.08);outline:none}section-editor-panel .panel-body .form-group .section-title-input::placeholder{color:#adb5bd}section-editor-panel .panel-body .form-group .color-picker-wrapper{display:flex;align-items:stretch;gap:14px}section-editor-panel .panel-body .form-group .color-picker-wrapper .section-color-input{width:64px;height:48px;padding:6px;border:1.5px solid #e1e4e8;border-radius:8px;cursor:pointer;transition:all 0.2s}section-editor-panel .panel-body .form-group .color-picker-wrapper .section-color-input:hover{border-color:#4a90e2;box-shadow:0 2px 8px rgba(74, 144, 226, 0.15)}section-editor-panel .panel-body .form-group .color-picker-wrapper .section-color-input:focus{border-color:#4a90e2;box-shadow:0 0 0 3px rgba(74, 144, 226, 0.08);outline:none}section-editor-panel .panel-body .form-group .color-picker-wrapper .color-hex-input{flex:1;padding:12px 16px;border:1.5px solid #e1e4e8;border-radius:8px;background:#f8f9fa;color:#495057;font-family:"SF Mono", "Monaco", "Courier New", monospace;font-size:14px;transition:all 0.2s}section-editor-panel .panel-body .form-group .color-picker-wrapper .color-hex-input:hover{background:white;border-color:#cbd3da}section-editor-panel .panel-body .form-group .color-picker-wrapper .color-hex-input:focus{border-color:#4a90e2;background:white;box-shadow:0 0 0 3px rgba(74, 144, 226, 0.08);outline:none}section-editor-panel .panel-body .form-group .color-picker-wrapper .color-hex-input::placeholder{color:#adb5bd}section-editor-panel .panel-footer{display:flex;align-items:center;justify-content:space-between;padding:24px 32px 28px;border-top:1px solid #e9ecef}section-editor-panel .panel-footer .footer-actions{display:flex;gap:12px}section-editor-panel .panel-footer button{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.2s}section-editor-panel .panel-footer button:active{transform:translateY(1px)}section-editor-panel .panel-footer .delete-btn{padding:12px 16px;margin-right:16px;border:1.5px solid #dc3545;background:transparent;color:#dc3545;font-weight:500}section-editor-panel .panel-footer .delete-btn:hover{background:#fff5f5;border-color:#c82333;color:#c82333}section-editor-panel .panel-footer .delete-btn:active{background:#ffe5e5}section-editor-panel .panel-footer .cancel-btn{border:1.5px solid #e1e4e8;background:white;color:#495057}section-editor-panel .panel-footer .cancel-btn:hover{border-color:#cbd3da;background:#f8f9fa}section-editor-panel .panel-footer .cancel-btn:active{background:#e9ecef}section-editor-panel .panel-footer .save-btn{background:#4a90e2;color:white;box-shadow:0 2px 8px rgba(74, 144, 226, 0.2)}section-editor-panel .panel-footer .save-btn:hover{background:#357abd;box-shadow:0 4px 12px rgba(74, 144, 226, 0.25);transform:translateY(-1px)}section-editor-panel .panel-footer .save-btn:active{background:#2a5f8f;box-shadow:0 1px 4px rgba(74, 144, 226, 0.2);transform:translateY(0)}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}';const rt=class{constructor(i){t(this,i);this.closePanel=e(this,"closePanel",7);this.updateSection=e(this,"updateSection",7);this.previewColorChange=e(this,"previewColorChange",7);this.previewTitleChange=e(this,"previewTitleChange",7);this.deleteSection=e(this,"deleteSection",7);this.isOpen=false;this.sectionData=null;this.editedTitle="";this.editedColor="";this.originalColor="";this.originalTitle="";this.handleClose=()=>{if(this.sectionData){this.previewColorChange.emit({canvasId:this.sectionData.canvasId,backgroundColor:this.originalColor});this.previewTitleChange.emit({canvasId:this.sectionData.canvasId,title:this.originalTitle})}this.closePanel.emit()};this.handleSave=()=>{if(this.sectionData){this.updateSection.emit({canvasId:this.sectionData.canvasId,title:this.editedTitle,backgroundColor:this.editedColor});this.closePanel.emit()}};this.handleDelete=()=>{if(this.sectionData){this.deleteSection.emit({canvasId:this.sectionData.canvasId});this.closePanel.emit()}};this.handleTitleInput=t=>{this.editedTitle=t.target.value;if(this.sectionData){this.previewTitleChange.emit({canvasId:this.sectionData.canvasId,title:this.editedTitle})}};this.handleColorInput=t=>{this.editedColor=t.target.value;if(this.sectionData){this.previewColorChange.emit({canvasId:this.sectionData.canvasId,backgroundColor:this.editedColor})}}}handleSectionDataChange(t){if(t){this.editedTitle=t.title;this.editedColor=t.backgroundColor;this.originalColor=t.backgroundColor;this.originalTitle=t.title}}componentWillLoad(){if(this.sectionData){this.editedTitle=this.sectionData.title;this.editedColor=this.sectionData.backgroundColor;this.originalColor=this.sectionData.backgroundColor;this.originalTitle=this.sectionData.title}}render(){if(!this.isOpen||!this.sectionData){return null}return i("div",{class:"section-editor-overlay",onClick:this.handleClose},i("div",{class:"section-editor-panel",onClick:t=>t.stopPropagation()},i("div",{class:"panel-header"},i("h2",{class:"panel-title"},"Edit Section"),i("button",{class:"close-btn",onClick:this.handleClose,title:"Close"},"Ã—")),i("div",{class:"panel-body"},i("div",{class:"form-group"},i("label",{htmlFor:"section-title"},"Section Name"),i("input",{type:"text",id:"section-title",class:"section-title-input",value:this.editedTitle,onInput:this.handleTitleInput,placeholder:"Enter section name"})),i("div",{class:"form-group"},i("label",{htmlFor:"section-color"},"Background Color"),i("div",{class:"color-picker-wrapper"},i("input",{type:"color",id:"section-color",class:"section-color-input",value:this.editedColor,onInput:this.handleColorInput}),i("input",{type:"text",class:"color-hex-input",value:this.editedColor,onInput:this.handleColorInput,placeholder:"#ffffff"})))),i("div",{class:"panel-footer"},i("button",{class:"delete-btn",onClick:this.handleDelete},"Delete Section"),i("div",{class:"footer-actions"},i("button",{class:"cancel-btn",onClick:this.handleClose},"Cancel"),i("button",{class:"save-btn",onClick:this.handleSave},"Save Changes")))))}static get watchers(){return{sectionData:["handleSectionDataChange"]}}};rt.style=at;export{M as canvas_header,T as component_palette,F as confirmation_modal,U as custom_config_panel,tt as grid_builder,nt as grid_viewer,st as layer_panel,rt as section_editor_panel};
//# sourceMappingURL=p-d0381d10.entry.js.map