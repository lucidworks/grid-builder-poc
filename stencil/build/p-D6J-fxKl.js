import{c as t,g as s,u as i,d as n}from"./p-DhZJyO2V.js";const o=t("undo-redo-commands");class e{constructor(t,s,i,n,o,e,d,c,a,h){this.itemId=t;this.sourceCanvasId=s;this.targetCanvasId=i;this.sourcePosition=Object.assign({},n);this.targetPosition=Object.assign({},o);this.sourceIndex=e;this.sourceZIndex=d;this.targetZIndex=c;this.sourceSize=a?Object.assign({},a):undefined;this.targetSize=h?Object.assign({},h):undefined}undo(){o.log("ðŸ”™ MoveItemCommand.undo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});let t=s.canvases[this.targetCanvasId];let i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){for(const n in s.canvases){const o=s.canvases[n];i=o.items.find((t=>t.id===this.itemId));if(i){t=o;break}}}if(!i||!t){console.warn("  âŒ Item or canvas not found, aborting undo");return}o.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.sourceCanvasId;i.layouts.desktop.x=this.sourcePosition.x;i.layouts.desktop.y=this.sourcePosition.y;i.zIndex=this.sourceZIndex;o.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.sourceSize){i.layouts.desktop.width=this.sourceSize.width;i.layouts.desktop.height=this.sourceSize.height}const n=s.canvases[this.sourceCanvasId];if(!n){console.warn("  âŒ Source canvas not found, aborting undo");return}if(this.sourceIndex>=0&&this.sourceIndex<=n.items.length){n.items.splice(this.sourceIndex,0,i)}else{n.items.push(i)}s.canvases=Object.assign({},s.canvases);const e=document.getElementById(this.itemId);if(e){o.log("  ðŸŽ¨ Clearing inline transform style");e.style.transform=""}o.log("  âœ… Undo complete")}redo(){o.log("ðŸ”œ MoveItemCommand.redo()",{itemId:this.itemId,sourceCanvasId:this.sourceCanvasId,targetCanvasId:this.targetCanvasId,sourcePosition:this.sourcePosition,targetPosition:this.targetPosition});const t=s.canvases[this.sourceCanvasId];const i=t===null||t===void 0?void 0:t.items.find((t=>t.id===this.itemId));if(!i){console.warn("  âŒ Item not found, aborting redo");return}o.log("  ðŸ“ Found item, current position:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y});t.items=t.items.filter((t=>t.id!==this.itemId));i.canvasId=this.targetCanvasId;i.layouts.desktop.x=this.targetPosition.x;i.layouts.desktop.y=this.targetPosition.y;i.zIndex=this.targetZIndex;o.log("  âœ… Updated item position and z-index to:",{x:i.layouts.desktop.x,y:i.layouts.desktop.y,zIndex:i.zIndex});if(this.targetSize){i.layouts.desktop.width=this.targetSize.width;i.layouts.desktop.height=this.targetSize.height}const n=s.canvases[this.targetCanvasId];if(!n){console.warn("  âŒ Target canvas not found, aborting redo");return}n.items.push(i);s.canvases=Object.assign({},s.canvases);const e=document.getElementById(this.itemId);if(e){o.log("  ðŸŽ¨ Clearing inline transform style");e.style.transform=""}o.log("  âœ… Redo complete")}}class d{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=this.itemsData.map((t=>t.id));n(t)}redo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}}class c{constructor(t){this.itemsData=t.map((t=>{const i=Object.values(s.canvases).flatMap((t=>t.items)).find((s=>s.id===t));return i?JSON.parse(JSON.stringify(i)):null})).filter(Boolean)}undo(){const t=Object.assign({},s.canvases);for(const s of this.itemsData){const i=t[s.canvasId];if(i){const t=i.items.some((t=>t.id===s.id));if(!t){i.items.push(s)}}}s.canvases=t}redo(){const t=this.itemsData.map((t=>t.id));n(t)}}class a{constructor(t){this.updates=t.map((({itemId:t,canvasId:i,updates:n})=>{const o=s.canvases[i];const e=o===null||o===void 0?void 0:o.items.find((s=>s.id===t));if(!e){return null}return{itemId:t,canvasId:i,oldItem:JSON.parse(JSON.stringify(e)),newItem:JSON.parse(JSON.stringify(Object.assign(Object.assign({},e),n)))}})).filter(Boolean)}undo(){const t=this.updates.map((({itemId:t,canvasId:s,oldItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}redo(){const t=this.updates.map((({itemId:t,canvasId:s,newItem:i})=>({itemId:t,canvasId:s,updates:i})));i(t)}}class h{constructor(t,s,i){this.description="Add Canvas";this.canvasId=t;this.stateInstance=s;this.eventManagerInstance=i}undo(){o.log("ðŸ”™ AddCanvasCommand.undo() - removing canvas:",this.canvasId);delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);o.log("  ðŸ“¢ Emitting canvasRemoved event for:",this.canvasId);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}redo(){this.stateInstance.canvases[this.canvasId]={zIndexCounter:1,items:[]};this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}}class r{constructor(t,s,i){this.description="Remove Canvas";this.canvasSnapshot=null;this.canvasId=t;this.stateInstance=s;this.eventManagerInstance=i;const n=this.stateInstance.canvases[t];if(n){this.canvasSnapshot=JSON.parse(JSON.stringify(n))}}undo(){if(this.canvasSnapshot){this.stateInstance.canvases[this.canvasId]=JSON.parse(JSON.stringify(this.canvasSnapshot));this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasAdded",{canvasId:this.canvasId})}}redo(){delete this.stateInstance.canvases[this.canvasId];this.stateInstance.canvases=Object.assign({},this.stateInstance.canvases);this.eventManagerInstance.emit("canvasRemoved",{canvasId:this.canvasId})}}const u=50;function l(t,s=u){var i;const n=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;return n<=s}function v(t,s=u){var i,n,o,e;const d=t.defaultSize.width;const c=t.defaultSize.height;const a=((i=t.minSize)===null||i===void 0?void 0:i.width)||0;const h=((n=t.maxSize)===null||n===void 0?void 0:n.width)||Infinity;let r=d;let l=c;let v=false;if(r>s){r=s;v=true}if(r<a){r=a}if(r>h){r=h}const f=((o=t.minSize)===null||o===void 0?void 0:o.height)||0;const m=((e=t.maxSize)===null||e===void 0?void 0:e.height)||Infinity;if(l<f){l=f}if(l>m){l=m}return{width:r,height:l,wasAdjusted:v}}function f(t,s,i,n,o=u){let e=t;let d=s;let c=false;if(e<0){e=0;c=true}if(e+i>o){e=o-i;c=true}if(d<0){d=0;c=true}e=Math.max(0,e);d=Math.max(0,d);return{x:e,y:d,width:i,height:n,positionAdjusted:c,sizeAdjusted:false}}function m(t,s,i,n=u){var o;if(!l(t,n)){console.warn(`Component "${t.name}" minSize (${(o=t.minSize)===null||o===void 0?void 0:o.width}) `+`exceeds canvas width (${n}). Placement rejected.`);return null}const e=v(t,n);const d=f(s,i,e.width,e.height,n);return Object.assign(Object.assign({},d),{sizeAdjusted:e.wasAdjusted})}export{h as A,a as B,u as C,e as M,r as R,m as a,c as b,f as c,d};
//# sourceMappingURL=p-D6J-fxKl.js.map