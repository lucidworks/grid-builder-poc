{"file":"canvas-height-calculator.js","mappings":";;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCG;AAMH;;;;;;;;;;;;;;AAcG;AACH,MAAM,gCAAgC,GAAG,CAAC;AAE1C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BG;SACa,8BAA8B,CAC5C,KAAY,EACZ,QAA8B,EAC9B,MAAmB,EAAA;;IAEnB,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;;AAEhC,QAAA,OAAO,CAAC;;;IAIV,IAAI,WAAW,GAAG,CAAC;AAEnB,IAAA,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;QACxB,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;;QAGrC,MAAM,CAAC,GAAG,CAAA,EAAA,GAAA,MAAM,CAAC,CAAC,MAAA,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,EAAA,GAAI,CAAC;QACvB,MAAM,MAAM,GAAG,CAAA,EAAA,GAAA,MAAM,CAAC,MAAM,MAAA,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,EAAA,GAAI,CAAC;AAEjC,QAAA,MAAM,UAAU,GAAG,CAAC,GAAG,MAAM;AAC7B,QAAA,IAAI,UAAU,GAAG,WAAW,EAAE;YAC5B,WAAW,GAAG,UAAU;;;;AAK5B,IAAA,MAAM,YAAY,GAAG,CAAA,EAAA,GAAA,MAAM,KAAN,IAAA,IAAA,MAAM,KAAN,MAAA,GAAA,MAAA,GAAA,MAAM,CAAE,kBAAkB,MAAI,IAAA,IAAA,EAAA,KAAA,MAAA,GAAA,EAAA,GAAA,gCAAgC;;AAGnF,IAAA,MAAM,cAAc,GAAG,WAAW,GAAG,YAAY;;IAGjD,MAAM,QAAQ,GAAG,aAAa,CAAC,cAAc,EAAE,MAAM,CAAC;AAEtD,IAAA,OAAO,QAAQ;AACjB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCG;AACa,SAAA,qBAAqB,CAAC,QAAgB,EAAE,MAAmB,EAAA;;IAEzE,MAAM,MAAM,GAAGA,KAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC;AAC3C,IAAA,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;;AAEzD,QAAA,OAAO,CAAC;;;AAIV,IAAA,MAAM,QAAQ,GAAGA,KAAS,CAAC,eAAe,IAAI,SAAS;;IAGvD,OAAO,8BAA8B,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,CAAC;AACvE;;;;","names":["gridState"],"sources":["src/utils/canvas-height-calculator.ts"],"sourcesContent":["/**\n * Canvas Height Calculator\n * =========================\n *\n * Utility for calculating dynamic canvas heights based on content.\n *\n * ## Purpose\n *\n * Automatically calculates canvas height to fit all items with a bottom margin:\n * - Finds the bottommost item in the canvas\n * - Adds configurable grid-based margin (default: 5 grid units)\n * - Converts to pixels for rendering\n * - Returns 0 for empty canvases (CSS min-height will apply)\n *\n * ## Design Philosophy\n *\n * **Content-driven heights**:\n * - Canvas height adapts to content in real-time\n * - Shrinks when items removed or moved up\n * - Grows when items added or moved down\n * - Always maintains consistent bottom margin\n *\n * **Grid-based margin**:\n * - Uses grid units instead of pixels for consistent proportions\n * - Desktop: 5 units ≈ 100px (2% grid)\n * - Mobile: 5 units ≈ 100px (fixed 20px grid)\n * - Scales naturally with canvas resize\n *\n * ## Usage\n *\n * ```typescript\n * import { calculateCanvasHeight } from './canvas-height-calculator';\n *\n * const height = calculateCanvasHeight('canvas1');\n * canvas.style.height = height > 0 ? `${height}px` : '';\n * ```\n *\n * @module canvas-height-calculator\n */\n\nimport { gridState } from '../services/state-manager';\nimport { gridToPixelsY } from './grid-calculations';\nimport { GridConfig } from '../types/grid-config';\n\n/**\n * Default bottom margin in grid units\n *\n * **Value**: 5 grid units\n * **Approximate pixels**:\n * - Desktop: ~100px (with 2% grid = 20px per unit)\n * - Mobile: 100px (with fixed 20px grid)\n *\n * **Why 5 units**:\n * - Provides comfortable spacing for new item placement\n * - Not too large (wastes space) or too small (cramped)\n * - Aligns with grid for visual consistency\n *\n * **Override**: Can be customized via GridConfig.canvasBottomMargin\n */\nconst DEFAULT_BOTTOM_MARGIN_GRID_UNITS = 5;\n\n/**\n * Calculate canvas height from items array\n *\n * **Reusable core logic**: Works with any items array (not tied to global state)\n *\n * **Algorithm**:\n * 1. Find bottommost item (max of `y + height` for all items)\n * 2. Add bottom margin (configurable via GridConfig.canvasBottomMargin, default 5 grid units)\n * 3. Convert to pixels using current grid size\n * 4. Return pixel height (or 0 if no items)\n *\n * **Example calculation**:\n * ```\n * Items:\n * - Item 1: y=2, height=6  → bottom=8\n * - Item 2: y=10, height=4 → bottom=14 (bottommost)\n * - Item 3: y=5, height=3  → bottom=8\n *\n * Bottommost: 14 grid units\n * + Margin: 5 grid units (default)\n * = Total: 19 grid units\n * × Grid size: 20px\n * = Height: 380px\n * ```\n *\n * @param items - Array of grid items\n * @param viewport - Current viewport ('desktop' | 'mobile')\n * @param config - Optional grid configuration (for custom bottom margin)\n * @returns Canvas height in pixels (0 if no items)\n */\nexport function calculateCanvasHeightFromItems(\n  items: any[],\n  viewport: 'desktop' | 'mobile',\n  config?: GridConfig\n): number {\n  if (!items || items.length === 0) {\n    // Empty canvas - return 0 (CSS min-height will apply)\n    return 0;\n  }\n\n  // Find bottommost item position\n  let bottommostY = 0;\n\n  for (const item of items) {\n    const layout = item.layouts[viewport];\n\n    // Handle auto-layout mobile items (y and height may be null)\n    const y = layout.y ?? 0;\n    const height = layout.height ?? 0;\n\n    const itemBottom = y + height;\n    if (itemBottom > bottommostY) {\n      bottommostY = itemBottom;\n    }\n  }\n\n  // Get bottom margin from config or use default\n  const bottomMargin = config?.canvasBottomMargin ?? DEFAULT_BOTTOM_MARGIN_GRID_UNITS;\n\n  // Add bottom margin in grid units\n  const totalGridUnits = bottommostY + bottomMargin;\n\n  // Convert to pixels\n  const heightPx = gridToPixelsY(totalGridUnits, config);\n\n  return heightPx;\n}\n\n/**\n * Calculate canvas height based on content (from global state)\n *\n * **For grid-builder**: Uses global gridState\n *\n * **Algorithm**:\n * 1. Get all items in the specified canvas from gridState\n * 2. Delegate to calculateCanvasHeightFromItems for calculation\n *\n * **Current viewport handling**:\n * - Uses `gridState.currentViewport` to determine which layout to read\n * - Desktop viewport: reads `item.layouts.desktop`\n * - Mobile viewport: reads `item.layouts.mobile` (with auto-layout fallback)\n *\n * **Empty canvas behavior**:\n * - Returns 0 when no items present\n * - CSS `min-height` will apply as fallback (configurable via GridConfig.canvasMinHeight)\n * - Prevents canvas from collapsing completely\n *\n * **Bottom margin**:\n * - Configurable via GridConfig.canvasBottomMargin (default: 5 grid units)\n *\n * @param canvasId - Canvas identifier\n * @param config - Optional grid configuration (for custom bottom margin)\n * @returns Canvas height in pixels (0 if empty)\n *\n * @example\n * ```typescript\n * // Calculate height for canvas with 3 items (default margin)\n * const height = calculateCanvasHeight('canvas1');\n * // Returns: 380 (if bottommost item at y=14, height=4, + 5 grid units margin)\n *\n * // Empty canvas\n * const emptyHeight = calculateCanvasHeight('canvas2');\n * // Returns: 0 (CSS min-height will apply)\n *\n * // Custom bottom margin\n * const heightCustom = calculateCanvasHeight('canvas1', { canvasBottomMargin: 10 });\n * // Returns: 480 (if bottommost item at y=14, height=4, + 10 grid units margin)\n * ```\n */\nexport function calculateCanvasHeight(canvasId: string, config?: GridConfig): number {\n  // Get canvas from state\n  const canvas = gridState.canvases[canvasId];\n  if (!canvas || !canvas.items || canvas.items.length === 0) {\n    // Empty canvas - return 0 (CSS min-height will apply)\n    return 0;\n  }\n\n  // Get current viewport\n  const viewport = gridState.currentViewport || 'desktop';\n\n  // Delegate to reusable function\n  return calculateCanvasHeightFromItems(canvas.items, viewport, config);\n}\n"],"version":3}