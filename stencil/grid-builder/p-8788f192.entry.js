import{r as t,h as e,a as i}from"./p-CC73Dkup.js";import{i as s}from"./p-BKH_Whl_.js";import{a as n,s as o,o as a}from"./p-CDiz7xEh.js";import{c as r,b as c,g as h,a as d}from"./p-CcbD7Svb.js";import{a as l}from"./p-DZpb-Vl1.js";const p=".canvas-section{position:relative;display:flex;width:100%;margin:0;padding:0;flex-direction:column}.grid-container{position:relative;width:100%;background-image:linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);transition:background-color 0.2s}.grid-container.hide-grid{background-image:none}.grid-container.active{outline:2px solid var(--primary-color, #007bff);outline-offset:-2px;box-shadow:0 0 0 1px rgba(0, 123, 255, 0.3)}.grid-container.drop-target:not(.active){outline:3px dashed var(--primary-color, #007bff);outline-offset:-3px;box-shadow:0 0 0 3px color-mix(in srgb, var(--primary-color) 25%, transparent), inset 0 0 30px color-mix(in srgb, var(--primary-color) 15%, transparent);background-color:color-mix(in srgb, var(--primary-color) 8%, transparent)}.canvas-title{opacity:0.3;transition:opacity 0.2s ease}.canvas-header:has(+canvas-section .grid-container.active) .canvas-title{opacity:1}";const m=class{constructor(e){t(this,e);this.isActive=false;this.renderVersion=0;this.calculatedHeight=0;this.isDropTarget=false;this.dropzoneInitialized=false;this.setupCanvasClickListener=()=>{if(!this.gridContainerRef){return}this.gridContainerRef.addEventListener("click",(t=>{if(t.target===this.gridContainerRef){n(this.canvasId);const t=new CustomEvent("canvas-activated",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(t);const e=new CustomEvent("canvas-click",{detail:{canvasId:this.canvasId},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(e)}}))};this.setupResizeObserver=()=>{if(!this.gridContainerRef){return}this.resizeObserver=new ResizeObserver((()=>{r();this.renderVersion++}));this.resizeObserver.observe(this.gridContainerRef)};this.initializeDropzone=()=>{if(!this.gridContainerRef||this.dropzoneInitialized){return}const t=s(this.gridContainerRef);t.dropzone({accept:".palette-item, .grid-item, .grid-item-header",overlap:"pointer",listeners:{dragenter:t=>{this.isDropTarget=true},dragleave:t=>{this.isDropTarget=false},drop:t=>{this.isDropTarget=false;let e=t.relatedTarget;const i=e.closest(".palette-item");if(i){e=i}const s=e.classList.contains("palette-item");if(s){e._dropWasValid=true}const n=e.classList.contains("grid-item-header");const o=e.classList.contains("grid-item");const a=n?e.closest(".grid-item"):e;if(s){const i=e.getAttribute("data-component-type");const s=e._defaultWidth||10;const n=e._defaultHeight||6;const o=c(s,this.canvasId,this.config);const a=h(n);const r=o/2;const d=a/2;const l=this.gridContainerRef.getBoundingClientRect();const p=t.dragEvent.clientX-l.left-r;const m=t.dragEvent.clientY-l.top-d;const f=new CustomEvent("canvas-drop",{detail:{canvasId:this.canvasId,componentType:i,x:p,y:m},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(f)}else if(o||n){const t=a.id;const e=a.getAttribute("data-canvas-id");if(e!==this.canvasId){const i=a.getBoundingClientRect();const s=this.gridContainerRef.getBoundingClientRect();const n=i.left-s.left;const o=i.top-s.top;const r=new CustomEvent("canvas-move",{detail:{itemId:t,sourceCanvasId:e,targetCanvasId:this.canvasId,x:n,y:o},bubbles:true,composed:true});this.gridContainerRef.dispatchEvent(r)}}}}});this.dropzoneInitialized=true}}componentWillLoad(){this.canvas=o.canvases[this.canvasId];this.calculatedHeight=l(this.canvasId,this.config);a("canvases",(()=>{try{if(this.canvasId&&o.canvases[this.canvasId]){this.canvas=o.canvases[this.canvasId];this.renderVersion++;this.calculatedHeight=l(this.canvasId,this.config)}}catch(t){console.debug("Canvas section state update skipped:",t)}}));a("currentViewport",(()=>{this.calculatedHeight=l(this.canvasId,this.config)}));a("showGrid",(()=>{this.renderVersion++}))}componentWillUpdate(){this.canvas=o.canvases[this.canvasId]}componentDidLoad(){this.initializeDropzone();this.setupResizeObserver();this.setupCanvasClickListener()}disconnectedCallback(){if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset()}if(this.resizeObserver){this.resizeObserver.disconnect()}}handleCanvasIdChange(t,e){if(t===e)return;this.canvas=o.canvases[t];this.calculatedHeight=l(t,this.config);if(this.gridContainerRef&&this.dropzoneInitialized){s(this.gridContainerRef).unset();this.dropzoneInitialized=false;this.initializeDropzone()}}handleConfigChange(t,e){if(t===e)return;this.calculatedHeight=l(this.canvasId,t);this.renderVersion++}handleIsActiveChange(t,e){if(t===e)return}render(){var t,i,s;const n=o.showGrid;const a=d(this.config);const r=(i=(t=this.config)===null||t===void 0?void 0:t.canvasMinHeight)!==null&&i!==void 0?i:20;const c=h(r,this.config);return e("div",{key:"bc5192c7b62094bddee28fd3160dea812c1c9529",class:"canvas-section","data-canvas-id":this.canvasId},e("div",{key:"56d6c915ceb7053236f5fa240b64d6dd60cfce11",class:{"grid-container":true,"hide-grid":!n,active:this.isActive,"drop-target":this.isDropTarget},id:this.canvasId,"data-canvas-id":this.canvasId,style:Object.assign({backgroundColor:this.backgroundColor||"#ffffff",backgroundSize:`2% ${a}px`,minHeight:`${c}px`},this.calculatedHeight>0?{height:`${this.calculatedHeight}px`}:{}),ref:t=>this.gridContainerRef=t},(s=this.canvas)===null||s===void 0?void 0:s.items.map((t=>e("grid-item-wrapper",{key:t.id,item:t,renderVersion:this.renderVersion,config:this.config,componentRegistry:this.componentRegistry,onBeforeDelete:this.onBeforeDelete})))))}static get watchers(){return{canvasId:["handleCanvasIdChange"],config:["handleConfigChange"],isActive:["handleIsActiveChange"]}}};m.style=p;const f=".palette{width:250px;padding:20px;border-right:1px solid #ddd;background:white;overflow-y:auto}.palette h2{margin-bottom:20px;color:#333;font-size:18px}.palette-chromeless{padding-top:10px}.palette-empty{color:#999;font-size:13px;font-style:italic}.palette-item{padding:15px;border-radius:4px;margin-bottom:10px;background:#4a90e2;color:white;cursor:move;font-weight:500;text-align:center;transition:transform 0.2s, box-shadow 0.2s;user-select:none;touch-action:none;}.palette-item:hover{box-shadow:0 4px 8px rgba(0, 0, 0, 0.1);transform:translateY(-2px)}.palette-item.dragging-from-palette{opacity:0.5}.dragging-clone{position:fixed;z-index:10000;pointer-events:none}";const g=class{constructor(e){t(this,e);this.showHeader=true;this.draggingItemType=null;this.initializePaletteItems=()=>{const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){return}s(t).draggable({inertia:false,autoScroll:false,listeners:{start:t=>{const e=t.target.closest(".palette-item");if(!e){console.warn("Could not find .palette-item element");return}const i=e.getAttribute("data-component-type");this.draggingItemType=i;const s=e.getBoundingClientRect();e._originalPosition={left:s.left,top:s.top};e._dropWasValid=false;const n=this.components.find((t=>t.type===i));if(!n){console.warn(`Component definition not found for type: ${i}`);return}const o=n.defaultSize||{width:10,height:6};const a=window.gridState;const r=(a===null||a===void 0?void 0:a.canvases)?Object.keys(a.canvases):[];const d=r.length>0?r[0]:null;let l;let p;if(d){l=c(o.width,d,this.config);p=h(o.height)}else{const t=20;l=o.width*t;p=o.height*t}const m=l/2;const f=p/2;const g=document.createElement("div");g.className="dragging-clone";g.style.position="fixed";g.style.left=t.clientX-m+"px";g.style.top=t.clientY-f+"px";g.style.width=l+"px";g.style.height=p+"px";g.style.overflow="hidden";g.style.pointerEvents="none";g.style.zIndex="10000";g.style.border="2px solid rgba(74, 144, 226, 0.5)";g.style.borderRadius="4px";g.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)";g.style.cursor="grabbing";const u=n.renderDragClone();const v=u.t;const b=document.createElement(v);if(u.i){Object.keys(u.i).forEach((t=>{b.setAttribute(t,u.i[t])}))}g.appendChild(b);document.body.appendChild(g);e._dragClone=g;e._halfWidth=m;e._halfHeight=f;e._defaultWidth=o.width;e._defaultHeight=o.height},move:t=>{const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const s=e._halfWidth;const n=e._halfHeight;if(i){i.style.left=t.clientX-s+"px";i.style.top=t.clientY-n+"px"}},end:t=>{this.draggingItemType=null;const e=t.target.closest(".palette-item");if(!e)return;const i=e._dragClone;const s=e._dropWasValid;const n=e._originalPosition;if(i){if(!s&&n){i.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)";i.style.left=n.left+"px";i.style.top=n.top+"px";i.style.opacity="0";setTimeout((()=>{i.remove()}),300)}else{i.remove()}delete e._dragClone;delete e._halfWidth;delete e._halfHeight;delete e._dropWasValid;delete e._originalPosition}}}});t._dragInitialized=true}))}}handleComponentsChange(t,e){if(t===e)return;if(!e)return;requestAnimationFrame((()=>{this.initializePaletteItems()}))}handleConfigChange(t,e){if(t===e)return}componentDidLoad(){this.initializePaletteItems()}componentDidUpdate(){this.initializePaletteItems()}render(){const t={palette:true,"palette-chromeless":!this.showHeader};if(!this.components||this.components.length===0){return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),e("p",{class:"palette-empty"},"No components available"))}return e("div",{class:t},this.showHeader&&e("h2",null,"Components"),this.components.map((t=>{const i={"palette-item":true,"dragging-from-palette":this.draggingItemType===t.type};return e("div",{class:i,"data-component-type":t.type,key:t.type},t.renderPaletteItem?t.renderPaletteItem({componentType:t.type,name:t.name,icon:t.icon}):`${t.icon} ${t.name}`)})))}disconnectedCallback(){const t=this.hostElement.querySelectorAll(".palette-item");t.forEach((t=>{if(t._dragInitialized){s(t).unset();delete t._dragInitialized}}))}get hostElement(){return i(this)}static get watchers(){return{components:["handleComponentsChange"],config:["handleConfigChange"]}}};g.style=f;export{m as canvas_section,g as component_palette};
//# sourceMappingURL=p-8788f192.entry.js.map